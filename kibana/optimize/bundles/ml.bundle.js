/*! Copyright Elasticsearch B.V. and/or license to Elasticsearch B.V. under one or more contributor license agreements
 * Licensed under the Elastic License; you may not use this file except in compliance with the Elastic License. */
webpackJsonp([2],{127:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.parseInterval=parseInterval;var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _datemath=__webpack_require__(83);var _datemath2=_interopRequireDefault(_datemath);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var INTERVAL_STRING_RE=new RegExp("^([0-9]*)\\s*("+_datemath2.default.units.join("|")+")$");var SUPPORT_ZERO_DURATION_UNITS=["ms","s","m","h"];function parseInterval(interval){var matches=String(interval).trim().match(INTERVAL_STRING_RE);if(!Array.isArray(matches))return null;if(matches.length<3)return null;try{var value=parseInt(matches[1]);var unit=matches[2];if(isNaN(value)||value<1&&-1===SUPPORT_ZERO_DURATION_UNITS.indexOf(unit))return null;return _moment2.default.duration(value,unit)}catch(e){return null}}},128:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.loadIndexPatterns=loadIndexPatterns;exports.getIndexPatterns=getIndexPatterns;exports.getIndexPatternIdFromName=getIndexPatternIdFromName;exports.loadCurrentIndexPattern=loadCurrentIndexPattern;exports.getIndexPatternById=getIndexPatternById;exports.loadCurrentSavedSearch=loadCurrentSavedSearch;exports.getCurrentIndexPattern=getCurrentIndexPattern;exports.getCurrentSavedSearch=getCurrentSavedSearch;exports.timeBasedIndexCheck=timeBasedIndexCheck;var _notify=__webpack_require__(9);var _saved_objects=__webpack_require__(57);var indexPatternCache=[];var fullIndexPatterns=[];var currentIndexPattern=null;var currentSavedSearch=null;function loadIndexPatterns(Private,indexPatterns){fullIndexPatterns=indexPatterns;var savedObjectsClient=Private(_saved_objects.SavedObjectsClientProvider);return savedObjectsClient.find({type:"index-pattern",fields:["title"],perPage:1e4}).then(function(response){indexPatternCache=response.savedObjects;return indexPatternCache})}function getIndexPatterns(){return indexPatternCache}function getIndexPatternIdFromName(name){for(var j=0;j<indexPatternCache.length;j++)if(indexPatternCache[j].get("title")===name)return indexPatternCache[j].id;return name}function loadCurrentIndexPattern(indexPatterns,$route){fullIndexPatterns=indexPatterns;currentIndexPattern=fullIndexPatterns.get($route.current.params.index);return currentIndexPattern}function getIndexPatternById(id){return fullIndexPatterns.get(id)}function loadCurrentSavedSearch($route,savedSearches){currentSavedSearch=savedSearches.get($route.current.params.savedSearchId);return currentSavedSearch}function getCurrentIndexPattern(){return currentIndexPattern}function getCurrentSavedSearch(){return currentSavedSearch}function timeBasedIndexCheck(indexPattern){var showNotification=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(false===indexPattern.isTimeBased()){showNotification&&_notify.toastNotifications.addWarning({title:"The index pattern "+indexPattern.title+" is not based on a time series",text:"Anomaly detection only runs over time-based indices"});return false}return true}},1410:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _management=__webpack_require__(3610);Object.defineProperty(exports,"actionsMenuContent",{enumerable:true,get:function get(){return _management.actionsMenuContent}});var _results=__webpack_require__(3611);Object.defineProperty(exports,"ResultLinks",{enumerable:true,get:function get(){return _results.ResultLinks}})},1411:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _job_group=__webpack_require__(3613);Object.defineProperty(exports,"JobGroup",{enumerable:true,get:function get(){return _job_group.JobGroup}})},1412:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _job_message_icon=__webpack_require__(3615);Object.defineProperty(exports,"JobIcon",{enumerable:true,get:function get(){return _job_message_icon.JobIcon}})},1413:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};exports.saveJob=saveJob;exports.loadSavedDashboards=loadSavedDashboards;exports.loadIndexPatterns=loadIndexPatterns;var _lodash=__webpack_require__(1);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _new_job_defaults=__webpack_require__(253);var _job_service=__webpack_require__(24);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function saveJob(job,newJobData,finish){return new Promise(function(resolve,reject){var jobData=_extends({},extractDescription(job,newJobData),extractGroups(job,newJobData),extractMML(job,newJobData),extractDetectorDescriptions(job,newJobData),extractCustomSettings(job,newJobData));var datafeedData=_extends({},extractDatafeed(job,newJobData));void 0!==jobData.custom_settings&&(jobData.custom_settings=processCustomSettings(jobData,datafeedData));var saveDatafeedWrapper=function saveDatafeedWrapper(){saveDatafeed(datafeedData,job,finish).then(function(){resolve()}).catch(function(error){reject(error)})};Object.keys(jobData).length?_job_service.mlJobService.updateJob(job.job_id,jobData).then(function(resp){resp.success?saveDatafeedWrapper():reject(resp)}).catch(function(error){reject(error)}):saveDatafeedWrapper()})}function saveDatafeed(datafeedData,job){return new Promise(function(resolve,reject){if(Object.keys(datafeedData).length){var datafeedId=job.datafeed_config.datafeed_id;_job_service.mlJobService.updateDatafeed(datafeedId,datafeedData).then(function(resp){resp.success?resolve():reject(resp)})}else resolve()})}function loadSavedDashboards(maxNumber){return new Promise(function(resolve,reject){var savedObjectsClient=_chrome2.default.getSavedObjectsClient();savedObjectsClient.find({type:"dashboard",fields:["title"],perPage:maxNumber}).then(function(resp){var savedObjects=resp.savedObjects;if(void 0!==savedObjects){var dashboards=savedObjects.map(function(savedObj){return{id:savedObj.id,title:savedObj.attributes.title}});dashboards.sort(function(dash1,dash2){return dash1.title.localeCompare(dash2.title)});resolve(dashboards)}}).catch(function(resp){reject(resp)})})}function loadIndexPatterns(maxNumber){return new Promise(function(resolve,reject){var savedObjectsClient=_chrome2.default.getSavedObjectsClient();savedObjectsClient.find({type:"index-pattern",fields:["title"],perPage:maxNumber}).then(function(resp){var savedObjects=resp.savedObjects;if(void 0!==savedObjects){var indexPatterns=savedObjects.map(function(savedObj){return{id:savedObj.id,title:savedObj.attributes.title}});indexPatterns.sort(function(dash1,dash2){return dash1.title.localeCompare(dash2.title)});resolve(indexPatterns)}}).catch(function(resp){reject(resp)})})}function extractDescription(job,newJobData){var description=newJobData.description;if(newJobData.description!==job.description)return{description:description};return{}}function extractGroups(job,newJobData){var groups=newJobData.groups;if(void 0!==newJobData.groups){var diffCount=(0,_lodash.difference)(job.groups,groups).length+(0,_lodash.difference)(groups,job.groups).length;return 0===diffCount?{}:{groups:groups}}return{}}function extractMML(job,newJobData){var jobLimits=(0,_new_job_defaults.newJobLimits)();var mmlData={};if(void 0!==job.analysis_limits.model_memory_limit){var mml=newJobData.mml;""===mml&&(mml=jobLimits.max_model_memory_limit);mml!==job.analysis_limits.model_memory_limit&&(mmlData.analysis_limits={model_memory_limit:mml})}return mmlData}function extractDetectorDescriptions(job,newJobData){var detectors=[];var descriptions=newJobData.detectorDescriptions.map(function(d,i){return{detector_index:i,description:d}});var originalDetectors=job.analysis_config.detectors;originalDetectors.forEach(function(d){descriptions[d.detector_index].description!==d.detector_description&&detectors.push(descriptions[d.detector_index])});return detectors.length?{detectors:detectors}:{}}function extractCustomSettings(job,newJobData){var settingsData={};if(newJobData&&newJobData.customUrls){settingsData.custom_settings=job.custom_settings||{};settingsData.custom_settings.custom_urls=newJobData.customUrls}return settingsData}function extractDatafeed(job,newDatafeedData){var datafeedData={};if(void 0!==job.datafeed_config){var origQueryString=JSON.stringify(job.datafeed_config.query);var newQuery=JSON.parse(newDatafeedData.datafeedQuery);var newQueryString=JSON.stringify(newQuery);origQueryString!==newQueryString&&(datafeedData.query=newQuery);job.datafeed_config.query_delay!==newDatafeedData.datafeedQueryDelay&&(datafeedData.query_delay=newDatafeedData.datafeedQueryDelay);job.datafeed_config.frequency!==newDatafeedData.datafeedFrequency&&""!==newDatafeedData.datafeedFrequency&&(datafeedData.frequency=newDatafeedData.datafeedFrequency);job.datafeed_config.scroll_size!==newDatafeedData.datafeedScrollSize&&(datafeedData.scroll_size=newDatafeedData.datafeedScrollSize)}return datafeedData}function processCustomSettings(jobData,datafeedData){var customSettings={};if(void 0!==jobData.custom_settings){customSettings=_extends({},jobData.custom_settings);void 0!==jobData.custom_settings.created_by&&(void 0!==jobData.detectors||Object.keys(datafeedData).length||void 0!==jobData.custom_settings.custom_urls&&jobData.custom_settings.custom_urls.length)&&delete customSettings.created_by}return customSettings}},1414:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SelectSeverity=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);__webpack_require__(3658);var _anomaly_utils=__webpack_require__(299);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var OPTIONS=[{value:0,label:"warning",color:(0,_anomaly_utils.getSeverityColor)(0)},{value:25,label:"minor",color:(0,_anomaly_utils.getSeverityColor)(25)},{value:50,label:"major",color:(0,_anomaly_utils.getSeverityColor)(50)},{value:75,label:"critical",color:(0,_anomaly_utils.getSeverityColor)(75)}];function optionValueToThreshold(value){var option=OPTIONS.find(function(opt){return opt.value===value});var threshold=OPTIONS[0];void 0!==option&&(threshold={display:option.label,val:option.value});return threshold}var SelectSeverity=function(_Component){_inherits(SelectSeverity,_Component);function SelectSeverity(props){_classCallCheck(this,SelectSeverity);var _this=_possibleConstructorReturn(this,(SelectSeverity.__proto__||Object.getPrototypeOf(SelectSeverity)).call(this,props));_initialiseProps.call(_this);_this.mlSelectSeverityService=_this.props.mlSelectSeverityService;var thresholdState=_this.mlSelectSeverityService.state.get("threshold");var thresholdValue=_lodash2.default.get(thresholdState,"val",0);var threshold=optionValueToThreshold(thresholdValue);var selectedOption=OPTIONS.find(function(opt){return opt.value===threshold.val});_this.mlSelectSeverityService.state.set("threshold",threshold);_this.state={selectedOptions:[selectedOption]};return _this}_createClass(SelectSeverity,[{key:"render",value:function render(){var selectedOptions=this.state.selectedOptions;return _react2.default.createElement(_eui.EuiComboBox,{placeholder:"Select severity",className:"ml-select-severity",singleSelection:true,options:OPTIONS,selectedOptions:selectedOptions,onChange:this.onChange,renderOption:this.renderOption})}}]);return SelectSeverity}(_react.Component);var _initialiseProps=function _initialiseProps(){var _this2=this;this.onChange=function(selectedOptions){if(0===selectedOptions.length)return;_this2.setState({selectedOptions:selectedOptions});var threshold=optionValueToThreshold(selectedOptions[0].value);_this2.mlSelectSeverityService.state.set("threshold",threshold).changed()};this.renderOption=function(option,searchValue,contentClassName){var color=option.color,label=option.label,value=option.value;return _react2.default.createElement(_eui.EuiHealth,{color:color},_react2.default.createElement("span",{className:contentClassName},_react2.default.createElement(_eui.EuiHighlight,{search:searchValue},label)," ",_react2.default.createElement("span",null,"(",value,")")))}};SelectSeverity.propTypes={mlSelectSeverityService:_propTypes2.default.object.isRequired};exports.SelectSeverity=SelectSeverity},1415:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3671);__webpack_require__(3672)},1416:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.copyTextToClipboard=copyTextToClipboard;function copyTextToClipboard(text){var textArea=document.createElement("textarea");textArea.style.position="fixed";textArea.style.top=0;textArea.style.left=0;textArea.style.width="2em";textArea.style.height="2em";textArea.style.padding=0;textArea.style.border="none";textArea.style.outline="none";textArea.style.boxShadow="none";textArea.style.background="transparent";textArea.value=text;document.body.appendChild(textArea);textArea.select();var successful=false;try{successful=document.execCommand("copy");var msg=successful?"successful":"unsuccessful";console.log("Copying text command was "+msg)}catch(err){console.log("Oops, unable to copy")}document.body.removeChild(textArea);return successful}},1417:function(module,exports,__webpack_require__){"use strict";var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);__webpack_require__(3685);__webpack_require__(3692);var _string_utils=__webpack_require__(40);var _detectors_list=__webpack_require__(3695);var _detectors_list2=_interopRequireDefault(_detectors_list);var _detector_modal=__webpack_require__(3696);var _detector_modal2=_interopRequireDefault(_detector_modal);var _detector_filter_modal=__webpack_require__(3697);var _detector_filter_modal2=_interopRequireDefault(_detector_filter_modal);var _job_service=__webpack_require__(24);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlJobDetectorsList",function($modal){return{restrict:"AE",replace:true,scope:{detectors:"=mlDetectors",indices:"=mlIndices",fields:"=mlFields",catFieldNameSelected:"=mlCatFieldNameSelected",editMode:"=mlEditMode"},template:_detectors_list2.default,controller:function controller($scope){$scope.addDetector=function(dtr,index){void 0!==dtr&&(index>=0?$scope.detectors[index]=dtr:$scope.detectors.push(dtr))};$scope.removeDetector=function(index){$scope.detectors.splice(index,1)};$scope.editDetector=function(index){$scope.openNewWindow(index)};$scope.info=function(){};$scope.addFilter=function(dtr,filter,filterIndex){void 0===dtr.rules&&(dtr.rules=[]);filterIndex>=0?dtr.rules[filterIndex]=filter:dtr.rules.push(filter)};$scope.removeFilter=function(detector,filterIndex){detector.rules.splice(filterIndex,1)};$scope.editFilter=function(detector,index){$scope.openFilterWindow(detector,index)};$scope.detectorToString=_string_utils.detectorToString;function validateDetector(dtr){if(void 0!==dtr.exclude_frequent&&""!==dtr.exclude_frequent){var exFrqs=["all","none","by","over"];if(-1===_lodash2.default.indexOf(exFrqs,dtr.exclude_frequent.trim()))return{then:function then(callback){callback({success:false,message:'exclude_frequent value must be: "all", "none", "by" or "over"'})}}}return _job_service.mlJobService.validateDetector(dtr).then(function(resp){return{success:resp.acknowledged||false}}).catch(function(resp){return{success:false,message:resp.message||"Validation failed"}})}$scope.openNewWindow=function(index){index=void 0!==index?index:-1;var dtr=void 0;index>=0&&(dtr=_angular2.default.copy($scope.detectors[index]));$modal.open({template:_detector_modal2.default,controller:"MlDetectorModal",backdrop:"static",keyboard:false,size:"lg",resolve:{params:function params(){return{fields:$scope.fields,validate:validateDetector,detector:dtr,index:index,add:$scope.addDetector,catFieldNameSelected:$scope.catFieldNameSelected}}}})};$scope.openFilterWindow=function(dtr,filterIndex){filterIndex=void 0!==filterIndex?filterIndex:-1;var filter=void 0;filterIndex>=0&&(filter=_angular2.default.copy(dtr.rules[filterIndex]));$modal.open({template:_detector_filter_modal2.default,controller:"MlDetectorFilterModal",backdrop:"static",keyboard:false,size:"lg",resolve:{params:function params(){return{fields:$scope.fields,validate:validateDetector,detector:dtr,filter:filter,index:filterIndex,add:$scope.addFilter}}}})}}}})},1418:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3703);__webpack_require__(3705)},1419:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3738)},1420:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.VALIDATION_STATUS={ERROR:"error",INFO:"info",SUCCESS:"success",WARNING:"warning"};exports.SKIP_BUCKET_SPAN_ESTIMATION=true},1421:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(323);var _propTypes2=_interopRequireDefault(_propTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var arrowRenderer=function arrowRenderer(_ref){var onMouseDown=_ref.onMouseDown;return _react2.default.createElement("span",{className:"Select-arrow",onMouseDown:onMouseDown})};arrowRenderer.propTypes={onMouseDown:_propTypes2.default.func};exports.default=arrowRenderer},1422:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var clearRenderer=function clearRenderer(){return _react2.default.createElement("span",{className:"Select-clear",dangerouslySetInnerHTML:{__html:"&times;"}})};exports.default=clearRenderer},1423:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var map=[{base:"A",letters:/[\u0041\u24B6\uFF21\u00C0\u00C1\u00C2\u1EA6\u1EA4\u1EAA\u1EA8\u00C3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\u00C4\u01DE\u1EA2\u00C5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F]/g},{base:"AA",letters:/[\uA732]/g},{base:"AE",letters:/[\u00C6\u01FC\u01E2]/g},{base:"AO",letters:/[\uA734]/g},{base:"AU",letters:/[\uA736]/g},{base:"AV",letters:/[\uA738\uA73A]/g},{base:"AY",letters:/[\uA73C]/g},{base:"B",letters:/[\u0042\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181]/g},{base:"C",letters:/[\u0043\u24B8\uFF23\u0106\u0108\u010A\u010C\u00C7\u1E08\u0187\u023B\uA73E]/g},{base:"D",letters:/[\u0044\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779]/g},{base:"DZ",letters:/[\u01F1\u01C4]/g},{base:"Dz",letters:/[\u01F2\u01C5]/g},{base:"E",letters:/[\u0045\u24BA\uFF25\u00C8\u00C9\u00CA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\u00CB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E]/g},{base:"F",letters:/[\u0046\u24BB\uFF26\u1E1E\u0191\uA77B]/g},{base:"G",letters:/[\u0047\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E]/g},{base:"H",letters:/[\u0048\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D]/g},{base:"I",letters:/[\u0049\u24BE\uFF29\u00CC\u00CD\u00CE\u0128\u012A\u012C\u0130\u00CF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197]/g},{base:"J",letters:/[\u004A\u24BF\uFF2A\u0134\u0248]/g},{base:"K",letters:/[\u004B\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2]/g},{base:"L",letters:/[\u004C\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780]/g},{base:"LJ",letters:/[\u01C7]/g},{base:"Lj",letters:/[\u01C8]/g},{base:"M",letters:/[\u004D\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C]/g},{base:"N",letters:/[\u004E\u24C3\uFF2E\u01F8\u0143\u00D1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4]/g},{base:"NJ",letters:/[\u01CA]/g},{base:"Nj",letters:/[\u01CB]/g},{base:"O",letters:/[\u004F\u24C4\uFF2F\u00D2\u00D3\u00D4\u1ED2\u1ED0\u1ED6\u1ED4\u00D5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\u00D6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\u00D8\u01FE\u0186\u019F\uA74A\uA74C]/g},{base:"OI",letters:/[\u01A2]/g},{base:"OO",letters:/[\uA74E]/g},{base:"OU",letters:/[\u0222]/g},{base:"P",letters:/[\u0050\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754]/g},{base:"Q",letters:/[\u0051\u24C6\uFF31\uA756\uA758\u024A]/g},{base:"R",letters:/[\u0052\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782]/g},{base:"S",letters:/[\u0053\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784]/g},{base:"T",letters:/[\u0054\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786]/g},{base:"TZ",letters:/[\uA728]/g},{base:"U",letters:/[\u0055\u24CA\uFF35\u00D9\u00DA\u00DB\u0168\u1E78\u016A\u1E7A\u016C\u00DC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244]/g},{base:"V",letters:/[\u0056\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245]/g},{base:"VY",letters:/[\uA760]/g},{base:"W",letters:/[\u0057\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72]/g},{base:"X",letters:/[\u0058\u24CD\uFF38\u1E8A\u1E8C]/g},{base:"Y",letters:/[\u0059\u24CE\uFF39\u1EF2\u00DD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE]/g},{base:"Z",letters:/[\u005A\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762]/g},{base:"a",letters:/[\u0061\u24D0\uFF41\u1E9A\u00E0\u00E1\u00E2\u1EA7\u1EA5\u1EAB\u1EA9\u00E3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\u00E4\u01DF\u1EA3\u00E5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250]/g},{base:"aa",letters:/[\uA733]/g},{base:"ae",letters:/[\u00E6\u01FD\u01E3]/g},{base:"ao",letters:/[\uA735]/g},{base:"au",letters:/[\uA737]/g},{base:"av",letters:/[\uA739\uA73B]/g},{base:"ay",letters:/[\uA73D]/g},{base:"b",letters:/[\u0062\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253]/g},{base:"c",letters:/[\u0063\u24D2\uFF43\u0107\u0109\u010B\u010D\u00E7\u1E09\u0188\u023C\uA73F\u2184]/g},{base:"d",letters:/[\u0064\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A]/g},{base:"dz",letters:/[\u01F3\u01C6]/g},{base:"e",letters:/[\u0065\u24D4\uFF45\u00E8\u00E9\u00EA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\u00EB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD]/g},{base:"f",letters:/[\u0066\u24D5\uFF46\u1E1F\u0192\uA77C]/g},{base:"g",letters:/[\u0067\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F]/g},{base:"h",letters:/[\u0068\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265]/g},{base:"hv",letters:/[\u0195]/g},{base:"i",letters:/[\u0069\u24D8\uFF49\u00EC\u00ED\u00EE\u0129\u012B\u012D\u00EF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131]/g},{base:"j",letters:/[\u006A\u24D9\uFF4A\u0135\u01F0\u0249]/g},{base:"k",letters:/[\u006B\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3]/g},{base:"l",letters:/[\u006C\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747]/g},{base:"lj",letters:/[\u01C9]/g},{base:"m",letters:/[\u006D\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F]/g},{base:"n",letters:/[\u006E\u24DD\uFF4E\u01F9\u0144\u00F1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5]/g},{base:"nj",letters:/[\u01CC]/g},{base:"o",letters:/[\u006F\u24DE\uFF4F\u00F2\u00F3\u00F4\u1ED3\u1ED1\u1ED7\u1ED5\u00F5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\u00F6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\u00F8\u01FF\u0254\uA74B\uA74D\u0275]/g},{base:"oi",letters:/[\u01A3]/g},{base:"ou",letters:/[\u0223]/g},{base:"oo",letters:/[\uA74F]/g},{base:"p",letters:/[\u0070\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755]/g},{base:"q",letters:/[\u0071\u24E0\uFF51\u024B\uA757\uA759]/g},{base:"r",letters:/[\u0072\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783]/g},{base:"s",letters:/[\u0073\u24E2\uFF53\u00DF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B]/g},{base:"t",letters:/[\u0074\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787]/g},{base:"tz",letters:/[\uA729]/g},{base:"u",letters:/[\u0075\u24E4\uFF55\u00F9\u00FA\u00FB\u0169\u1E79\u016B\u1E7B\u016D\u00FC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289]/g},{base:"v",letters:/[\u0076\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C]/g},{base:"vy",letters:/[\uA761]/g},{base:"w",letters:/[\u0077\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73]/g},{base:"x",letters:/[\u0078\u24E7\uFF58\u1E8B\u1E8D]/g},{base:"y",letters:/[\u0079\u24E8\uFF59\u1EF3\u00FD\u0177\u1EF9\u0233\u1E8F\u00FF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF]/g},{base:"z",letters:/[\u007A\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763]/g}];var stripDiacritics=function stripDiacritics(str){for(var i=0;i<map.length;i++)str=str.replace(map[i].letters,map[i].base);return str};exports.default=stripDiacritics},1424:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _classnames=__webpack_require__(5);var _classnames2=_interopRequireDefault(_classnames);var _propTypes=__webpack_require__(323);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _blockEvent=__webpack_require__(3754);var _blockEvent2=_interopRequireDefault(_blockEvent);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var Option=function(_React$Component){_inherits(Option,_React$Component);function Option(props){_classCallCheck(this,Option);var _this=_possibleConstructorReturn(this,(Option.__proto__||Object.getPrototypeOf(Option)).call(this,props));_this.handleMouseDown=_this.handleMouseDown.bind(_this);_this.handleMouseEnter=_this.handleMouseEnter.bind(_this);_this.handleMouseMove=_this.handleMouseMove.bind(_this);_this.handleTouchStart=_this.handleTouchStart.bind(_this);_this.handleTouchEnd=_this.handleTouchEnd.bind(_this);_this.handleTouchMove=_this.handleTouchMove.bind(_this);_this.onFocus=_this.onFocus.bind(_this);return _this}_createClass(Option,[{key:"handleMouseDown",value:function handleMouseDown(event){event.preventDefault();event.stopPropagation();this.props.onSelect(this.props.option,event)}},{key:"handleMouseEnter",value:function handleMouseEnter(event){this.onFocus(event)}},{key:"handleMouseMove",value:function handleMouseMove(event){this.onFocus(event)}},{key:"handleTouchEnd",value:function handleTouchEnd(event){if(this.dragging)return;this.handleMouseDown(event)}},{key:"handleTouchMove",value:function handleTouchMove(){this.dragging=true}},{key:"handleTouchStart",value:function handleTouchStart(){this.dragging=false}},{key:"onFocus",value:function onFocus(event){this.props.isFocused||this.props.onFocus(this.props.option,event)}},{key:"render",value:function render(){var _props=this.props,option=_props.option,instancePrefix=_props.instancePrefix,optionIndex=_props.optionIndex;var className=(0,_classnames2.default)(this.props.className,option.className);return option.disabled?_react2.default.createElement("div",{className:className,onMouseDown:_blockEvent2.default,onClick:_blockEvent2.default},this.props.children):_react2.default.createElement("div",{className:className,style:option.style,role:"option","aria-label":option.label,onMouseDown:this.handleMouseDown,onMouseEnter:this.handleMouseEnter,onMouseMove:this.handleMouseMove,onTouchStart:this.handleTouchStart,onTouchMove:this.handleTouchMove,onTouchEnd:this.handleTouchEnd,id:instancePrefix+"-option-"+optionIndex,title:option.title},this.props.children)}}]);return Option}(_react2.default.Component);Option.propTypes={children:_propTypes2.default.node,className:_propTypes2.default.string,instancePrefix:_propTypes2.default.string.isRequired,isDisabled:_propTypes2.default.bool,isFocused:_propTypes2.default.bool,isSelected:_propTypes2.default.bool,onFocus:_propTypes2.default.func,onSelect:_propTypes2.default.func,onUnfocus:_propTypes2.default.func,option:_propTypes2.default.object.isRequired,optionIndex:_propTypes2.default.number};exports.default=Option},1425:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _classnames=__webpack_require__(5);var _classnames2=_interopRequireDefault(_classnames);var _propTypes=__webpack_require__(323);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var Value=function(_React$Component){_inherits(Value,_React$Component);function Value(props){_classCallCheck(this,Value);var _this=_possibleConstructorReturn(this,(Value.__proto__||Object.getPrototypeOf(Value)).call(this,props));_this.handleMouseDown=_this.handleMouseDown.bind(_this);_this.onRemove=_this.onRemove.bind(_this);_this.handleTouchEndRemove=_this.handleTouchEndRemove.bind(_this);_this.handleTouchMove=_this.handleTouchMove.bind(_this);_this.handleTouchStart=_this.handleTouchStart.bind(_this);return _this}_createClass(Value,[{key:"handleMouseDown",value:function handleMouseDown(event){if("mousedown"===event.type&&0!==event.button)return;if(this.props.onClick){event.stopPropagation();this.props.onClick(this.props.value,event);return}this.props.value.href&&event.stopPropagation()}},{key:"onRemove",value:function onRemove(event){event.preventDefault();event.stopPropagation();this.props.onRemove(this.props.value)}},{key:"handleTouchEndRemove",value:function handleTouchEndRemove(event){if(this.dragging)return;this.onRemove(event)}},{key:"handleTouchMove",value:function handleTouchMove(){this.dragging=true}},{key:"handleTouchStart",value:function handleTouchStart(){this.dragging=false}},{key:"renderRemoveIcon",value:function renderRemoveIcon(){if(this.props.disabled||!this.props.onRemove)return;return _react2.default.createElement("span",{className:"Select-value-icon","aria-hidden":"true",onMouseDown:this.onRemove,onTouchEnd:this.handleTouchEndRemove,onTouchStart:this.handleTouchStart,onTouchMove:this.handleTouchMove},"×")}},{key:"renderLabel",value:function renderLabel(){var className="Select-value-label";return this.props.onClick||this.props.value.href?_react2.default.createElement("a",{className:className,href:this.props.value.href,target:this.props.value.target,onMouseDown:this.handleMouseDown,onTouchEnd:this.handleMouseDown},this.props.children):_react2.default.createElement("span",{className:className,role:"option","aria-selected":"true",id:this.props.id},this.props.children)}},{key:"render",value:function render(){return _react2.default.createElement("div",{className:(0,_classnames2.default)("Select-value",this.props.value.className),style:this.props.value.style,title:this.props.value.title},this.renderRemoveIcon(),this.renderLabel())}}]);return Value}(_react2.default.Component);Value.propTypes={children:_propTypes2.default.node,disabled:_propTypes2.default.bool,id:_propTypes2.default.string,onClick:_propTypes2.default.func,onRemove:_propTypes2.default.func,value:_propTypes2.default.object.isRequired};exports.default=Value},1426:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(323);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _Select=__webpack_require__(632);var _Select2=_interopRequireDefault(_Select);var _stripDiacritics=__webpack_require__(1423);var _stripDiacritics2=_interopRequireDefault(_stripDiacritics);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var propTypes={autoload:_propTypes2.default.bool.isRequired,cache:_propTypes2.default.any,children:_propTypes2.default.func.isRequired,ignoreAccents:_propTypes2.default.bool,ignoreCase:_propTypes2.default.bool,loadOptions:_propTypes2.default.func.isRequired,loadingPlaceholder:_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.node]),multi:_propTypes2.default.bool,noResultsText:_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.node]),onChange:_propTypes2.default.func,onInputChange:_propTypes2.default.func,options:_propTypes2.default.array.isRequired,placeholder:_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.node]),searchPromptText:_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.node]),value:_propTypes2.default.any};var defaultCache={};var defaultChildren=function defaultChildren(props){return _react2.default.createElement(_Select2.default,props)};var defaultProps={autoload:true,cache:defaultCache,children:defaultChildren,ignoreAccents:true,ignoreCase:true,loadingPlaceholder:"Loading...",options:[],searchPromptText:"Type to search"};var Async=function(_Component){_inherits(Async,_Component);function Async(props,context){_classCallCheck(this,Async);var _this=_possibleConstructorReturn(this,(Async.__proto__||Object.getPrototypeOf(Async)).call(this,props,context));_this._cache=props.cache===defaultCache?{}:props.cache;_this.state={inputValue:"",isLoading:false,options:props.options};_this.onInputChange=_this.onInputChange.bind(_this);return _this}_createClass(Async,[{key:"componentDidMount",value:function componentDidMount(){var autoload=this.props.autoload;autoload&&this.loadOptions("")}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){nextProps.options!==this.props.options&&this.setState({options:nextProps.options})}},{key:"componentWillUnmount",value:function componentWillUnmount(){this._callback=null}},{key:"loadOptions",value:function loadOptions(inputValue){var _this2=this;var loadOptions=this.props.loadOptions;var cache=this._cache;if(cache&&Object.prototype.hasOwnProperty.call(cache,inputValue)){this._callback=null;this.setState({isLoading:false,options:cache[inputValue]});return}var callback=function callback(error,data){var options=data&&data.options||[];cache&&(cache[inputValue]=options);if(callback===_this2._callback){_this2._callback=null;_this2.setState({isLoading:false,options:options})}};this._callback=callback;var promise=loadOptions(inputValue,callback);promise&&promise.then(function(data){return callback(null,data)},function(error){return callback(error)});this._callback&&!this.state.isLoading&&this.setState({isLoading:true})}},{key:"onInputChange",value:function onInputChange(inputValue){var _props=this.props,ignoreAccents=_props.ignoreAccents,ignoreCase=_props.ignoreCase,onInputChange=_props.onInputChange;var newInputValue=inputValue;if(onInputChange){var value=onInputChange(newInputValue);null!=value&&"object"!==("undefined"===typeof value?"undefined":_typeof(value))&&(newInputValue=""+value)}var transformedInputValue=newInputValue;ignoreAccents&&(transformedInputValue=(0,_stripDiacritics2.default)(transformedInputValue));ignoreCase&&(transformedInputValue=transformedInputValue.toLowerCase());this.setState({inputValue:newInputValue});this.loadOptions(transformedInputValue);return newInputValue}},{key:"noResultsText",value:function noResultsText(){var _props2=this.props,loadingPlaceholder=_props2.loadingPlaceholder,noResultsText=_props2.noResultsText,searchPromptText=_props2.searchPromptText;var _state=this.state,inputValue=_state.inputValue,isLoading=_state.isLoading;if(isLoading)return loadingPlaceholder;if(inputValue&&noResultsText)return noResultsText;return searchPromptText}},{key:"focus",value:function focus(){this.select.focus()}},{key:"render",value:function render(){var _this3=this;var _props3=this.props,children=_props3.children,loadingPlaceholder=_props3.loadingPlaceholder,placeholder=_props3.placeholder;var _state2=this.state,isLoading=_state2.isLoading,options=_state2.options;var props={noResultsText:this.noResultsText(),placeholder:isLoading?loadingPlaceholder:placeholder,options:isLoading&&loadingPlaceholder?[]:options,ref:function ref(_ref){return _this3.select=_ref}};return children(_extends({},this.props,props,{isLoading:isLoading,onInputChange:this.onInputChange}))}}]);return Async}(_react.Component);exports.default=Async;Async.propTypes=propTypes;Async.defaultProps=defaultProps},1427:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(323);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _defaultFilterOptions=__webpack_require__(869);var _defaultFilterOptions2=_interopRequireDefault(_defaultFilterOptions);var _defaultMenuRenderer=__webpack_require__(870);var _defaultMenuRenderer2=_interopRequireDefault(_defaultMenuRenderer);var _Select=__webpack_require__(632);var _Select2=_interopRequireDefault(_Select);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var CreatableSelect=function(_React$Component){_inherits(CreatableSelect,_React$Component);function CreatableSelect(props,context){_classCallCheck(this,CreatableSelect);var _this=_possibleConstructorReturn(this,(CreatableSelect.__proto__||Object.getPrototypeOf(CreatableSelect)).call(this,props,context));_this.filterOptions=_this.filterOptions.bind(_this);_this.menuRenderer=_this.menuRenderer.bind(_this);_this.onInputKeyDown=_this.onInputKeyDown.bind(_this);_this.onInputChange=_this.onInputChange.bind(_this);_this.onOptionSelect=_this.onOptionSelect.bind(_this);return _this}_createClass(CreatableSelect,[{key:"createNewOption",value:function createNewOption(){var _props=this.props,isValidNewOption=_props.isValidNewOption,newOptionCreator=_props.newOptionCreator,onNewOptionClick=_props.onNewOptionClick,_props$options=_props.options,options=void 0===_props$options?[]:_props$options;if(isValidNewOption({label:this.inputValue})){var option=newOptionCreator({label:this.inputValue,labelKey:this.labelKey,valueKey:this.valueKey});var _isOptionUnique=this.isOptionUnique({option:option,options:options});if(_isOptionUnique)if(onNewOptionClick)onNewOptionClick(option);else{options.unshift(option);this.select.selectValue(option)}}}},{key:"filterOptions",value:function filterOptions(){var _props2=this.props,filterOptions=_props2.filterOptions,isValidNewOption=_props2.isValidNewOption,promptTextCreator=_props2.promptTextCreator;var excludeOptions=(arguments.length<=2?void 0:arguments[2])||[];var filteredOptions=filterOptions.apply(void 0,arguments)||[];if(isValidNewOption({label:this.inputValue})){var _newOptionCreator=this.props.newOptionCreator;var option=_newOptionCreator({label:this.inputValue,labelKey:this.labelKey,valueKey:this.valueKey});var _isOptionUnique2=this.isOptionUnique({option:option,options:excludeOptions.concat(filteredOptions)});if(_isOptionUnique2){var prompt=promptTextCreator(this.inputValue);this._createPlaceholderOption=_newOptionCreator({label:prompt,labelKey:this.labelKey,valueKey:this.valueKey});filteredOptions.unshift(this._createPlaceholderOption)}}return filteredOptions}},{key:"isOptionUnique",value:function isOptionUnique(_ref){var option=_ref.option,options=_ref.options;var isOptionUnique=this.props.isOptionUnique;options=options||this.props.options;return isOptionUnique({labelKey:this.labelKey,option:option,options:options,valueKey:this.valueKey})}},{key:"menuRenderer",value:function menuRenderer(params){var menuRenderer=this.props.menuRenderer;return menuRenderer(_extends({},params,{onSelect:this.onOptionSelect,selectValue:this.onOptionSelect}))}},{key:"onInputChange",value:function onInputChange(input){var onInputChange=this.props.onInputChange;this.inputValue=input;onInputChange&&(this.inputValue=onInputChange(input));return this.inputValue}},{key:"onInputKeyDown",value:function onInputKeyDown(event){var _props3=this.props,shouldKeyDownEventCreateNewOption=_props3.shouldKeyDownEventCreateNewOption,onInputKeyDown=_props3.onInputKeyDown;var focusedOption=this.select.getFocusedOption();if(focusedOption&&focusedOption===this._createPlaceholderOption&&shouldKeyDownEventCreateNewOption({keyCode:event.keyCode})){this.createNewOption();event.preventDefault()}else onInputKeyDown&&onInputKeyDown(event)}},{key:"onOptionSelect",value:function onOptionSelect(option){option===this._createPlaceholderOption?this.createNewOption():this.select.selectValue(option)}},{key:"focus",value:function focus(){this.select.focus()}},{key:"render",value:function render(){var _this2=this;var _props4=this.props,refProp=_props4.ref,restProps=_objectWithoutProperties(_props4,["ref"]);var children=this.props.children;children||(children=defaultChildren);var props=_extends({},restProps,{allowCreate:true,filterOptions:this.filterOptions,menuRenderer:this.menuRenderer,onInputChange:this.onInputChange,onInputKeyDown:this.onInputKeyDown,ref:function ref(_ref2){_this2.select=_ref2;if(_ref2){_this2.labelKey=_ref2.props.labelKey;_this2.valueKey=_ref2.props.valueKey}refProp&&refProp(_ref2)}});return children(props)}}]);return CreatableSelect}(_react2.default.Component);var defaultChildren=function defaultChildren(props){return _react2.default.createElement(_Select2.default,props)};var isOptionUnique=function isOptionUnique(_ref3){var option=_ref3.option,options=_ref3.options,labelKey=_ref3.labelKey,valueKey=_ref3.valueKey;if(!options||!options.length)return true;return 0===options.filter(function(existingOption){return existingOption[labelKey]===option[labelKey]||existingOption[valueKey]===option[valueKey]}).length};var isValidNewOption=function isValidNewOption(_ref4){var label=_ref4.label;return!!label};var newOptionCreator=function newOptionCreator(_ref5){var label=_ref5.label,labelKey=_ref5.labelKey,valueKey=_ref5.valueKey;var option={};option[valueKey]=label;option[labelKey]=label;option.className="Select-create-option-placeholder";return option};var promptTextCreator=function promptTextCreator(label){return'Create option "'+label+'"'};var shouldKeyDownEventCreateNewOption=function shouldKeyDownEventCreateNewOption(_ref6){var keyCode=_ref6.keyCode;switch(keyCode){case 9:case 13:case 188:return true;default:return false}};CreatableSelect.isOptionUnique=isOptionUnique;CreatableSelect.isValidNewOption=isValidNewOption;CreatableSelect.newOptionCreator=newOptionCreator;CreatableSelect.promptTextCreator=promptTextCreator;CreatableSelect.shouldKeyDownEventCreateNewOption=shouldKeyDownEventCreateNewOption;CreatableSelect.defaultProps={filterOptions:_defaultFilterOptions2.default,isOptionUnique:isOptionUnique,isValidNewOption:isValidNewOption,menuRenderer:_defaultMenuRenderer2.default,newOptionCreator:newOptionCreator,promptTextCreator:promptTextCreator,shouldKeyDownEventCreateNewOption:shouldKeyDownEventCreateNewOption};CreatableSelect.propTypes={children:_propTypes2.default.func,filterOptions:_propTypes2.default.any,isOptionUnique:_propTypes2.default.func,isValidNewOption:_propTypes2.default.func,menuRenderer:_propTypes2.default.any,newOptionCreator:_propTypes2.default.func,onInputChange:_propTypes2.default.func,onInputKeyDown:_propTypes2.default.func,onNewOptionClick:_propTypes2.default.func,options:_propTypes2.default.array,promptTextCreator:_propTypes2.default.func,ref:_propTypes2.default.func,shouldKeyDownEventCreateNewOption:_propTypes2.default.func};exports.default=CreatableSelect},1428:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.kbnTypeToMLJobType=kbnTypeToMLJobType;var _field_types=__webpack_require__(322);function kbnTypeToMLJobType(field){var type=void 0;switch(field.type){case _field_types.KBN_FIELD_TYPES.STRING:type=field.aggregatable?_field_types.ML_JOB_FIELD_TYPES.KEYWORD:_field_types.ML_JOB_FIELD_TYPES.TEXT;break;case _field_types.KBN_FIELD_TYPES.NUMBER:type=_field_types.ML_JOB_FIELD_TYPES.NUMBER;break;case _field_types.KBN_FIELD_TYPES.DATE:type=_field_types.ML_JOB_FIELD_TYPES.DATE;break;case _field_types.KBN_FIELD_TYPES.IP:type=_field_types.ML_JOB_FIELD_TYPES.IP;break;case _field_types.KBN_FIELD_TYPES.BOOLEAN:type=_field_types.ML_JOB_FIELD_TYPES.BOOLEAN;break;case _field_types.KBN_FIELD_TYPES.GEO_POINT:type=_field_types.ML_JOB_FIELD_TYPES.GEO_POINT}return type}},1429:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.changeJobIDCase=changeJobIDCase;function changeJobIDCase(config){config.jobId&&(config.jobId=config.jobId.toLowerCase())}},1430:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();exports.SingleMetricJobServiceProvider=SingleMetricJobServiceProvider;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _parse_interval=__webpack_require__(117);var _job_utils=__webpack_require__(41);var _general=__webpack_require__(300);var _string_utils=__webpack_require__(40);var _field_format_service=__webpack_require__(255);var _job_service=__webpack_require__(24);var _results_service=__webpack_require__(426);var _new_job_utils=__webpack_require__(144);var _ml_api_service=__webpack_require__(23);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true}):obj[key]=value;return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function SingleMetricJobServiceProvider(){var SingleMetricJobService=function(){function SingleMetricJobService(){_classCallCheck(this,SingleMetricJobService);this.chartData={line:[],model:[],swimlane:[],hasBounds:false,percentComplete:0,highestValue:0,chartTicksMargin:{width:30},totalResults:0};this.job={}}_createClass(SingleMetricJobService,[{key:"getLineChartResults",value:function getLineChartResults(formConfig){var _this=this;return new Promise(function(resolve,reject){_this.chartData.line=[];_this.chartData.model=[];_this.chartData.swimlane=[];_this.chartData.hasBounds=false;_this.chartData.percentComplete=0;_this.chartData.loadingDifference=0;_this.chartData.eventRateHighestValue=0;_this.chartData.totalResults=0;var aggType=formConfig.agg.type.dslName;formConfig.field&&formConfig.field.id?_this.chartData.fieldFormat=_field_format_service.mlFieldFormatService.getFieldFormatFromIndexPattern(formConfig.indexPattern,formConfig.field.id,aggType):delete _this.chartData.fieldFormat;var obj={success:true,results:{}};var searchJson=getSearchJsonFromConfig(formConfig);_ml_api_service.ml.esSearch(searchJson).then(function(resp){var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]);var highestValue=0;_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=dataForTime.key;var value=_lodash2.default.get(dataForTime,["field_value","value"]);void 0===value&&null!==formConfig.field&&(value=_lodash2.default.get(dataForTime,["field_value","values",_job_utils.ML_MEDIAN_PERCENTS]));void 0===value&&null===formConfig.field&&(value=dataForTime.doc_count);isFinite(value)&&0!==dataForTime.doc_count||(value=null);value>highestValue&&(highestValue=value);obj.results[time]={actual:value}});_this.chartData.totalResults=resp.hits.total;_this.chartData.line=processLineChartResults(obj.results);_this.chartData.highestValue=Math.ceil(highestValue);if(void 0!==_this.chartData.fieldFormat){var highValueFormatted=_this.chartData.fieldFormat.convert(_this.chartData.highestValue,"text");_this.chartData.chartTicksMargin.width=(0,_string_utils.calculateTextWidth)(highValueFormatted,false)+10}else _this.chartData.chartTicksMargin.width=(0,_string_utils.calculateTextWidth)(_this.chartData.highestValue,true)+10;resolve(_this.chartData)}).catch(function(resp){reject(resp)})})}},{key:"getJobFromConfig",value:function getJobFromConfig(formConfig){var _aggregations2,_aggregations3;var job=_job_service.mlJobService.getBlankJob();job.data_description.time_field=formConfig.timeField;var func=formConfig.agg.type.mlName;formConfig.isSparseData&&("count"===formConfig.agg.type.dslName?func=func.replace(/count/,"non_zero_count"):"sum"===formConfig.agg.type.dslName&&(func=func.replace(/sum/,"non_null_sum")));var dtr={function:func};var query={match_all:{}};("*"!==formConfig.query.query_string.query||formConfig.filters.length)&&(query=formConfig.combinedQuery);formConfig.field&&formConfig.field.id&&(dtr.field_name=formConfig.field.id);job.analysis_config.detectors.push(dtr);job.analysis_config.bucket_span=formConfig.bucketSpan;job.analysis_limits={model_memory_limit:formConfig.modelMemoryLimit};delete job.data_description.field_delimiter;delete job.data_description.quote_character;delete job.data_description.time_format;delete job.data_description.format;var bucketSpanSeconds=(0,_parse_interval.parseInterval)(formConfig.bucketSpan).asSeconds();var indices=formConfig.indexPattern.title.split(",").map(function(i){return i.trim()});job.datafeed_config={query:query,indices:indices};job.job_id=formConfig.jobId;job.description=formConfig.description;job.groups=formConfig.jobGroups;job.model_plot_config={enabled:true};formConfig.useDedicatedIndex&&(job.results_index_name=job.job_id);job.custom_settings={created_by:_general.WIZARD_TYPE.SINGLE_METRIC};var aggType=formConfig.agg.type.dslName;var interval=1e3*bucketSpanSeconds;switch(aggType){case"count":job.analysis_config.summary_count_field_name="doc_count";job.datafeed_config.aggregations={buckets:{date_histogram:{field:formConfig.timeField,interval:interval},aggregations:_defineProperty({},formConfig.timeField,{max:{field:formConfig.timeField}})}};break;case"avg":case"median":case"sum":case"min":case"max":job.analysis_config.summary_count_field_name="doc_count";job.datafeed_config.aggregations={buckets:{date_histogram:{field:formConfig.timeField,interval:interval/100*10},aggregations:(_aggregations2={},_defineProperty(_aggregations2,dtr.field_name,_defineProperty({},aggType,{field:formConfig.field.name})),_defineProperty(_aggregations2,formConfig.timeField,{max:{field:formConfig.timeField}}),_aggregations2)}};break;case"cardinality":job.analysis_config.summary_count_field_name="dc_"+dtr.field_name;job.datafeed_config.aggregations={buckets:{date_histogram:{field:formConfig.timeField,interval:interval},aggregations:(_aggregations3={},_defineProperty(_aggregations3,formConfig.timeField,{max:{field:formConfig.timeField}}),_defineProperty(_aggregations3,job.analysis_config.summary_count_field_name,_defineProperty({},aggType,{field:formConfig.field.name})),_aggregations3)}};dtr.function="non_zero_count";dtr.detector_description=func+" ("+dtr.field_name+")";delete dtr.field_name}return job}},{key:"createJob",value:function createJob(formConfig){var _this2=this;return new Promise(function(resolve,reject){_this2.job=_this2.getJobFromConfig(formConfig);var job=(0,_new_job_utils.createJobForSaving)(_this2.job);_job_service.mlJobService.saveNewJob(job).then(function(resp){resp.success?resolve(_this2.job):reject(resp)})})}},{key:"startDatafeed",value:function startDatafeed(formConfig){var datafeedId=_job_service.mlJobService.getDatafeedId(formConfig.jobId);return _job_service.mlJobService.startDatafeed(datafeedId,formConfig.jobId,formConfig.start,formConfig.end)}},{key:"stopDatafeed",value:function stopDatafeed(formConfig){var datafeedId=_job_service.mlJobService.getDatafeedId(formConfig.jobId);return _job_service.mlJobService.stopDatafeed(datafeedId,formConfig.jobId)}},{key:"checkDatafeedState",value:function checkDatafeedState(formConfig){return _job_service.mlJobService.updateSingleJobDatafeedState(formConfig.jobId)}},{key:"loadModelData",value:function loadModelData(formConfig){var _this3=this;return new Promise(function(resolve,reject){var start=formConfig.start;if(_this3.chartData.model.length>5){start=_this3.chartData.model[_this3.chartData.model.length-5].time;for(var i=0;i<5;i++)_this3.chartData.model.pop()}_results_service.mlResultsService.getModelPlotOutput(formConfig.jobId,0,[],start,formConfig.end,formConfig.resultsIntervalSeconds+"s",formConfig.agg.type.mlModelPlotAgg).then(function(data){var scale=1;if(formConfig&&("count"===formConfig.agg.type.mlName||"high_count"===formConfig.agg.type.mlName||"low_count"===formConfig.agg.type.mlName||"distinct_count"===formConfig.agg.type.mlName)){var chartIntervalSeconds=formConfig.chartInterval.getInterval().asSeconds();var bucketSpan=(0,_parse_interval.parseInterval)(formConfig.bucketSpan);null!==bucketSpan&&(scale=chartIntervalSeconds/bucketSpan.asSeconds())}_this3.chartData.model=_this3.chartData.model.concat(processLineChartResults(data.results,scale));var lastBucket=_this3.chartData.model[_this3.chartData.model.length-1];var time=void 0!==lastBucket?lastBucket.time:formConfig.start;var pcnt=(time-formConfig.start+formConfig.resultsIntervalSeconds)/(formConfig.end-formConfig.start)*100;_this3.chartData.percentComplete=Math.round(pcnt);resolve(_this3.chartData)}).catch(function(){reject(_this3.chartData)})})}},{key:"loadSwimlaneData",value:function loadSwimlaneData(formConfig){var _this4=this;return new Promise(function(resolve){_results_service.mlResultsService.getScoresByBucket([formConfig.jobId],formConfig.start,formConfig.end,formConfig.resultsIntervalSeconds+"s",1).then(function(data){var jobResults=data.results[formConfig.jobId];_this4.chartData.swimlane=processSwimlaneResults(jobResults);_this4.chartData.swimlaneInterval=1e3*formConfig.resultsIntervalSeconds;resolve(_this4.chartData)}).catch(function(){resolve(_this4.chartData)})})}}]);return SingleMetricJobService}();return new SingleMetricJobService}function processLineChartResults(data){var scale=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;var lineData=[];_lodash2.default.each(data,function(dataForTime,t){var time=+t;var date=new Date(time);lineData.push({date:date,time:time,lower:dataForTime.modelLower*scale,value:dataForTime.actual,upper:dataForTime.modelUpper*scale})});return _lodash2.default.sortBy(lineData,"time")}function processSwimlaneResults(bucketScoreData,init){var swimlaneData=[];_lodash2.default.each(bucketScoreData,function(value,t){var time=+t;var date=new Date(time);value=init?0:value;swimlaneData.push({date:date,time:time,value:value,color:""})});return swimlaneData}function getSearchJsonFromConfig(formConfig){var interval=formConfig.chartInterval.getInterval().asMilliseconds()+"ms";var query=_lodash2.default.cloneDeep(formConfig.combinedQuery);var json={index:formConfig.indexPattern.title,size:0,body:{query:{},aggs:{times:{date_histogram:{field:formConfig.timeField,interval:interval,min_doc_count:0,extended_bounds:{min:formConfig.start,max:formConfig.end}}}}}};query.bool.must.push({range:_defineProperty({},formConfig.timeField,{gte:formConfig.start,lte:formConfig.end,format:formConfig.format})});json.body.query=query;null!==formConfig.field&&(json.body.aggs.times.aggs={field_value:_defineProperty({},formConfig.agg.type.dslName,{field:formConfig.field.name})});return json}},1431:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};exports.FieldTypeIcon=FieldTypeIcon;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _field_types=__webpack_require__(322);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function FieldTypeIcon(_ref){var _ref$tooltipEnabled=_ref.tooltipEnabled,tooltipEnabled=void 0!==_ref$tooltipEnabled&&_ref$tooltipEnabled,type=_ref.type;var ariaLabel="";var iconClass="";var iconChar="";switch(type){case _field_types.ML_JOB_FIELD_TYPES.BOOLEAN:ariaLabel="Boolean field";iconClass="fa-adjust";break;case _field_types.ML_JOB_FIELD_TYPES.DATE:ariaLabel="Date field";iconClass="fa-clock-o";break;case _field_types.ML_JOB_FIELD_TYPES.NUMBER:ariaLabel="Metric field";iconChar="#";break;case _field_types.ML_JOB_FIELD_TYPES.GEO_POINT:ariaLabel="Geo-point field";iconClass="fa-globe";break;case _field_types.ML_JOB_FIELD_TYPES.KEYWORD:ariaLabel="Aggregatable string field";iconChar="t";break;case _field_types.ML_JOB_FIELD_TYPES.TEXT:ariaLabel="String field";iconClass="fa-file-text-o";break;case _field_types.ML_JOB_FIELD_TYPES.IP:ariaLabel="IP address field";iconClass="fa-laptop";break;default:return null}var className="field-type-icon";""!==iconClass&&(className+=" kuiIcon "+iconClass);var containerProps={ariaLabel:ariaLabel,className:className,iconChar:iconChar};if(true===tooltipEnabled)return _react2.default.createElement(_eui.EuiToolTip,{position:"left",content:type},_react2.default.createElement(FieldTypeIconContainer,containerProps));return _react2.default.createElement(FieldTypeIconContainer,containerProps)}FieldTypeIcon.propTypes={tooltipEnabled:_propTypes2.default.bool,type:_propTypes2.default.string};function FieldTypeIconContainer(_ref2){var ariaLabel=_ref2.ariaLabel,className=_ref2.className,iconChar=_ref2.iconChar,rest=_objectWithoutProperties(_ref2,["ariaLabel","className","iconChar"]);return _react2.default.createElement("span",_extends({className:"field-type-icon-container"},rest),""===iconChar?_react2.default.createElement("span",{"aria-label":ariaLabel,className:className}):_react2.default.createElement("span",{"aria-label":ariaLabel,className:className},_react2.default.createElement("strong",{"aria-hidden":"true"},iconChar)))}},1432:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ChartDataUtilsProvider=ChartDataUtilsProvider;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _ml_time_buckets=__webpack_require__(277);var _string_utils=__webpack_require__(40);var _results_service=__webpack_require__(426);var _search_service=__webpack_require__(634);var _timefilter=__webpack_require__(14);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ChartDataUtilsProvider(Private){var TimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);function loadDocCountData(formConfig,chartData){return new Promise(function(resolve,reject){var BAR_TARGET=Math.ceil(formConfig.chartInterval.barTarget/10);var MAX_BARS=BAR_TARGET+BAR_TARGET/100*100;var query=formConfig.combinedQuery;var bounds=_timefilter.timefilter.getActiveBounds();var buckets=new TimeBuckets;buckets.setBarTarget(BAR_TARGET);buckets.setMaxBars(MAX_BARS);buckets.setInterval("auto");buckets.setBounds(bounds);var interval=buckets.getInterval().asMilliseconds();var end=formConfig.end;var start=formConfig.start;_results_service.mlResultsService.getEventRateData(formConfig.indexPattern.title,query,formConfig.timeField,start,end,interval+"ms").then(function(resp){var highestValue=0;chartData.job.bars=[];_lodash2.default.each(resp.results,function(value,t){isFinite(value)||(value=0);value>highestValue&&(highestValue=value);var time=+t;var date=new Date(time);chartData.job.barsInterval=interval;chartData.job.bars.push({date:date,time:time,value:value})});chartData.totalResults=resp.total;chartData.eventRateHighestValue=Math.ceil(highestValue);resolve(chartData)}).catch(function(resp){console.log("getEventRate visualization - error getting event rate data from elasticsearch:",resp);reject(resp)})})}function loadJobSwimlaneData(formConfig,chartData){return new Promise(function(resolve){_results_service.mlResultsService.getScoresByBucket([formConfig.jobId],formConfig.start,formConfig.end,formConfig.resultsIntervalSeconds+"s",1).then(function(data){var time=formConfig.start;var jobResults=data.results[formConfig.jobId];chartData.job.swimlane=[];_lodash2.default.each(jobResults,function(value,t){time=+t;var date=new Date(time);chartData.job.swimlane.push({date:date,time:time,value:value,color:""})});var pcnt=(time-formConfig.start+formConfig.resultsIntervalSeconds)/(formConfig.end-formConfig.start)*100;chartData.percentComplete=Math.round(pcnt);chartData.job.percentComplete=chartData.percentComplete;chartData.job.swimlaneInterval=1e3*formConfig.resultsIntervalSeconds;resolve(chartData)}).catch(function(){resolve(chartData)})})}function loadDetectorSwimlaneData(formConfig,chartData){return new Promise(function(resolve){_search_service.mlSimpleJobSearchService.getScoresByRecord(formConfig.jobId,formConfig.start,formConfig.end,formConfig.resultsIntervalSeconds+"s",{name:void 0!==formConfig.splitField?formConfig.splitField.name:void 0,value:formConfig.firstSplitFieldName}).then(function(data){var dtrIndex=0;_lodash2.default.each(formConfig.fields,function(field,key){var dtr=chartData.detectors[key];var times=data.results[dtrIndex];dtr.swimlane=[];_lodash2.default.each(times,function(timeObj,t){var time=+t;var date=new Date(time);dtr.swimlane.push({date:date,time:time,value:timeObj.recordScore,color:""})});dtr.percentComplete=chartData.percentComplete;dtr.swimlaneInterval=1e3*formConfig.resultsIntervalSeconds;dtrIndex++});resolve(chartData)}).catch(function(){resolve(chartData)})})}function getSplitFields(formConfig,splitFieldName,size){var query=formConfig.combinedQuery;return _search_service.mlSimpleJobSearchService.getCategoryFields(formConfig.indexPattern.title,splitFieldName,size,query)}function updateChartMargin(chartData){var longestTextWidth=(0,_string_utils.calculateTextWidth)(chartData.eventRateHighestValue,true);var textCheckMultiplier=1+Math.sqrt(2)/100;_lodash2.default.each(chartData.detectors,function(detector){var longestWidthForDetector=0;if(void 0!==detector.fieldFormat){var longestTextForDetector=detector.fieldFormat.convert(detector.highestValue,"text");longestWidthForDetector=(0,_string_utils.calculateTextWidth)(longestTextForDetector,false);var longestTextCheck=detector.fieldFormat.convert(detector.highestValue*textCheckMultiplier,"text");var longestWidthCheck=(0,_string_utils.calculateTextWidth)(longestTextCheck,false);longestWidthForDetector=Math.max(longestWidthForDetector,longestWidthCheck)}else longestWidthForDetector=(0,_string_utils.calculateTextWidth)(detector.highestValue,true);longestTextWidth=Math.max(longestTextWidth,longestWidthForDetector)});chartData.chartTicksMargin.width=longestTextWidth+10}return{loadDocCountData:loadDocCountData,loadJobSwimlaneData:loadJobSwimlaneData,loadDetectorSwimlaneData:loadDetectorSwimlaneData,getSplitFields:getSplitFields,updateChartMargin:updateChartMargin}}},1433:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();exports.MultiMetricJobServiceProvider=MultiMetricJobServiceProvider;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _general=__webpack_require__(300);var _job_utils=__webpack_require__(41);var _field_format_service=__webpack_require__(255);var _job_service=__webpack_require__(24);var _new_job_utils=__webpack_require__(144);var _ml_api_service=__webpack_require__(23);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true}):obj[key]=value;return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function MultiMetricJobServiceProvider(){var MultiMetricJobService=function(){function MultiMetricJobService(){_classCallCheck(this,MultiMetricJobService);this.chartData={job:{swimlane:[],line:[],bars:[],earliestTime:Number.MAX_SAFE_INTEGER},detectors:{},percentComplete:0,loadingDifference:0,lastLoadTimestamp:null,eventRateHighestValue:0,chartTicksMargin:{width:30},totalResults:0};this.job={}}_createClass(MultiMetricJobService,[{key:"clearChartData",value:function clearChartData(){this.chartData.job.swimlane=[];this.chartData.job.line=[];this.chartData.job.bars=[];this.chartData.detectors={};this.chartData.percentComplete=0;this.chartData.loadingDifference=0;this.chartData.eventRateHighestValue=0;this.chartData.totalResults=0;this.job={}}},{key:"getLineChartResults",value:function getLineChartResults(formConfig,thisLoadTimestamp){var _this=this;return new Promise(function(resolve,reject){var fieldIds=Object.keys(formConfig.fields).sort();_this.chartData.job.earliestTime=formConfig.start;var idx=_lodash2.default.findIndex(fieldIds,function(id){return id===_general.EVENT_RATE_COUNT_FIELD});if(-1!==idx){fieldIds.splice(idx,1);fieldIds.splice(0,0,_general.EVENT_RATE_COUNT_FIELD)}_lodash2.default.each(fieldIds,function(fieldId){_this.chartData.detectors[fieldId]={line:[],swimlane:[],highestValue:0}});var searchJson=getSearchJsonFromConfig(formConfig);_ml_api_service.ml.esSearch(searchJson).then(function(resp){thisLoadTimestamp===_this.chartData.lastLoadTimestamp?_lodash2.default.each(fieldIds,function(fieldId){_this.chartData.detectors[fieldId]={line:[],swimlane:[],highestValue:0};if(fieldId!==_general.EVENT_RATE_COUNT_FIELD){var field=formConfig.fields[fieldId];var aggType=field.agg.type.dslName;_this.chartData.detectors[fieldId].fieldFormat=_field_format_service.mlFieldFormatService.getFieldFormatFromIndexPattern(formConfig.indexPattern,fieldId,aggType)}}):resolve(_this.chartData);var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]);_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=+dataForTime.key;var date=new Date(time);var docCount=+dataForTime.doc_count;_this.chartData.job.swimlane.push({date:date,time:time,value:0,color:"",percentComplete:0});_this.chartData.job.earliestTime=time<_this.chartData.job.earliestTime?time:_this.chartData.job.earliestTime;_this.chartData.job.line.push({date:date,time:time,value:null});_lodash2.default.each(fieldIds,function(fieldId){var value=void 0;fieldId===_general.EVENT_RATE_COUNT_FIELD?value=docCount:"undefined"!==typeof dataForTime[fieldId].value?value=dataForTime[fieldId].value:"undefined"!==typeof dataForTime[fieldId].values&&(value=dataForTime[fieldId].values[_job_utils.ML_MEDIAN_PERCENTS]);isFinite(value)&&0!==docCount||(value=null);if(_this.chartData.detectors[fieldId]){_this.chartData.detectors[fieldId].line.push({date:date,time:time,value:value});_this.chartData.detectors[fieldId].swimlane.push({date:date,time:time,value:0,color:"",percentComplete:0});null!==value&&(_this.chartData.detectors[fieldId].highestValue=Math.ceil(Math.max(_this.chartData.detectors[fieldId].highestValue,Math.abs(value))))}})});resolve(_this.chartData)}).catch(function(resp){reject(resp)})})}},{key:"getJobFromConfig",value:function getJobFromConfig(formConfig){var job=_job_service.mlJobService.getBlankJob();job.data_description.time_field=formConfig.timeField;_lodash2.default.each(formConfig.fields,function(field,key){var func=field.agg.type.mlName;formConfig.isSparseData&&("count"===field.agg.type.dslName?func=func.replace(/count/,"non_zero_count"):"sum"===field.agg.type.dslName&&(func=func.replace(/sum/,"non_null_sum")));var dtr={function:func};dtr.detector_description=func;if(key!==_general.EVENT_RATE_COUNT_FIELD){dtr.field_name=field.name;dtr.detector_description+="("+field.name+")"}void 0!==formConfig.splitField&&(dtr.partition_field_name=formConfig.splitField.name);job.analysis_config.detectors.push(dtr)});var influencerFields=formConfig.influencerFields.map(function(f){return f.name});influencerFields&&influencerFields.length&&(job.analysis_config.influencers=influencerFields);var query={match_all:{}};("*"!==formConfig.query.query_string.query||formConfig.filters.length)&&(query=formConfig.combinedQuery);job.analysis_config.bucket_span=formConfig.bucketSpan;job.analysis_limits={model_memory_limit:formConfig.modelMemoryLimit};delete job.data_description.field_delimiter;delete job.data_description.quote_character;delete job.data_description.time_format;delete job.data_description.format;var indices=formConfig.indexPattern.title.split(",").map(function(i){return i.trim()});job.datafeed_config={query:query,indices:indices};job.job_id=formConfig.jobId;job.description=formConfig.description;job.groups=formConfig.jobGroups;formConfig.useDedicatedIndex&&(job.results_index_name=job.job_id);job.custom_settings={created_by:_general.WIZARD_TYPE.MULTI_METRIC};return job}},{key:"createJob",value:function createJob(formConfig){var _this2=this;return new Promise(function(resolve,reject){_this2.job=_this2.getJobFromConfig(formConfig);var job=(0,_new_job_utils.createJobForSaving)(_this2.job);_job_service.mlJobService.saveNewJob(job).then(function(resp){resp.success?resolve(_this2.job):reject(resp)})})}},{key:"startDatafeed",value:function startDatafeed(formConfig){var datafeedId=_job_service.mlJobService.getDatafeedId(formConfig.jobId);return _job_service.mlJobService.startDatafeed(datafeedId,formConfig.jobId,formConfig.start,formConfig.end)}},{key:"stopDatafeed",value:function stopDatafeed(formConfig){var datafeedId=_job_service.mlJobService.getDatafeedId(formConfig.jobId);return _job_service.mlJobService.stopDatafeed(datafeedId,formConfig.jobId)}}]);return MultiMetricJobService}();return new MultiMetricJobService}function getSearchJsonFromConfig(formConfig){var interval=formConfig.chartInterval.getInterval().asMilliseconds()+"ms";var query=_lodash2.default.cloneDeep(formConfig.combinedQuery);var json={index:formConfig.indexPattern.title,size:0,body:{query:{},aggs:{times:{date_histogram:{field:formConfig.timeField,interval:interval,min_doc_count:0,extended_bounds:{min:formConfig.start,max:formConfig.end}}}}}};query.bool.must.push({range:_defineProperty({},formConfig.timeField,{gte:formConfig.start,lte:formConfig.end,format:formConfig.format})});void 0!==formConfig.firstSplitFieldName&&query.bool.must.push({term:_defineProperty({},formConfig.splitField.name,formConfig.firstSplitFieldName)});json.body.query=query;if(Object.keys(formConfig.fields).length){json.body.aggs.times.aggs={};_lodash2.default.each(formConfig.fields,function(field){if(field.id!==_general.EVENT_RATE_COUNT_FIELD){json.body.aggs.times.aggs[field.id]=_defineProperty({},field.agg.type.dslName,{field:field.name});"percentiles"===field.agg.type.dslName&&(json.body.aggs.times.aggs[field.id][field.agg.type.dslName].percents=[_job_utils.ML_MEDIAN_PERCENTS])}})}return json}},1434:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3784);__webpack_require__(3785)},1435:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3790);__webpack_require__(3792);__webpack_require__(370)},1436:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3793);__webpack_require__(3795)},1437:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3796);__webpack_require__(3798)},1438:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3799)},1439:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();exports.PopulationJobServiceProvider=PopulationJobServiceProvider;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _general=__webpack_require__(300);var _job_utils=__webpack_require__(41);var _ml_time_buckets=__webpack_require__(277);var _field_format_service=__webpack_require__(255);var _job_service=__webpack_require__(24);var _new_job_utils=__webpack_require__(144);var _ml_api_service=__webpack_require__(23);var _timefilter=__webpack_require__(14);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true}):obj[key]=value;return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function PopulationJobServiceProvider(Private){var TimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);var OVER_FIELD_EXAMPLES_COUNT=40;var PopulationJobService=function(){function PopulationJobService(){_classCallCheck(this,PopulationJobService);this.chartData={job:{swimlane:[],line:[],bars:[],earliestTime:Number.MAX_SAFE_INTEGER},detectors:{},percentComplete:0,loadingDifference:0,lastLoadTimestamp:null,eventRateHighestValue:0,chartTicksMargin:{width:30},totalResults:0};this.job={}}_createClass(PopulationJobService,[{key:"clearChartData",value:function clearChartData(){this.chartData.job.swimlane=[];this.chartData.job.line=[];this.chartData.job.bars=[];this.chartData.detectors={};this.chartData.percentComplete=0;this.chartData.loadingDifference=0;this.chartData.eventRateHighestValue=0;this.chartData.totalResults=0;this.job={}}},{key:"getLineChartResults",value:function getLineChartResults(formConfig,thisLoadTimestamp){var _this=this;return new Promise(function(resolve,reject){var fieldIds=formConfig.fields.map(function(f){return f.id});_this.chartData.job.earliestTime=formConfig.start;var idx=_lodash2.default.findIndex(fieldIds,function(id){return id===_general.EVENT_RATE_COUNT_FIELD});if(-1!==idx){fieldIds.splice(idx,1);fieldIds.splice(0,0,_general.EVENT_RATE_COUNT_FIELD)}fieldIds.forEach(function(fieldId,i){_this.chartData.detectors[i]={line:[],swimlane:[],highestValue:0}});var searchJson=getSearchJsonFromConfig(formConfig,_timefilter.timefilter,TimeBuckets);_ml_api_service.ml.esSearch(searchJson).then(function(resp){thisLoadTimestamp===_this.chartData.lastLoadTimestamp?fieldIds.forEach(function(fieldId,i){_this.chartData.detectors[i]={line:[],swimlane:[],highestValue:0};if(fieldId!==_general.EVENT_RATE_COUNT_FIELD){var field=formConfig.fields[i];var aggType=field.agg.type.dslName;_this.chartData.detectors[i].fieldFormat=_field_format_service.mlFieldFormatService.getFieldFormatFromIndexPattern(formConfig.indexPattern,fieldId,aggType)}}):resolve(_this.chartData);var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]);_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=+dataForTime.key;var date=new Date(time);_this.chartData.job.swimlane.push({date:date,time:time,value:0,color:"",percentComplete:0});_this.chartData.job.earliestTime=time<_this.chartData.job.earliestTime?time:_this.chartData.job.earliestTime;_this.chartData.job.line.push({date:date,time:time,value:null});fieldIds.forEach(function(fieldId,i){var populationBuckets=_lodash2.default.get(dataForTime,["population","buckets"],[]);var values=[];fieldId===_general.EVENT_RATE_COUNT_FIELD?populationBuckets.forEach(function(b){void 0===b[i]?values.push({label:b.key,value:b.doc_count}):values.push({label:b.key,value:b[i].doc_count})}):"undefined"!==typeof dataForTime.population&&populationBuckets.forEach(function(b){var tempBucket=b[i];var value=null;var tempValue=void 0===tempBucket.value&&void 0!==tempBucket.splitValue?tempBucket.splitValue:tempBucket;value=void 0===tempValue.value&&void 0!==tempValue.values?tempValue.values[_job_utils.ML_MEDIAN_PERCENTS]:tempValue.value;values.push({label:b.key,value:isFinite(value)?value:null})});var highestValueField=_lodash2.default.reduce(values,function(p,c){return c.value>p.value?c:p},{value:0});if(_this.chartData.detectors[i]){_this.chartData.detectors[i].line.push({date:date,time:time,values:values});_this.chartData.detectors[i].swimlane.push({date:date,time:time,value:0,color:"",percentComplete:0});_this.chartData.detectors[i].highestValue=Math.ceil(Math.max(_this.chartData.detectors[i].highestValue,Math.abs(highestValueField.value)))}})});resolve(_this.chartData)}).catch(function(resp){reject(resp)})})}},{key:"getJobFromConfig",value:function getJobFromConfig(formConfig){var job=_job_service.mlJobService.getBlankJob();job.data_description.time_field=formConfig.timeField;formConfig.fields.forEach(function(field){var func=field.agg.type.mlName;formConfig.isSparseData&&("count"===field.agg.type.dslName?func=func.replace(/count/,"non_zero_count"):"sum"===field.agg.type.dslName&&(func=func.replace(/sum/,"non_null_sum")));var dtr={function:func};dtr.detector_description=func;if(field.id!==_general.EVENT_RATE_COUNT_FIELD){dtr.field_name=field.name;dtr.detector_description+="("+field.name+")"}if(void 0!==field.splitField){dtr.by_field_name=field.splitField.name;dtr.detector_description+=" by "+dtr.by_field_name}if(void 0!==formConfig.overField){dtr.over_field_name=formConfig.overField.name;dtr.detector_description+=" over "+dtr.over_field_name}job.analysis_config.detectors.push(dtr)});var influencerFields=formConfig.influencerFields.map(function(f){return f.name});influencerFields&&influencerFields.length&&(job.analysis_config.influencers=influencerFields);var query={match_all:{}};("*"!==formConfig.query.query_string.query||formConfig.filters.length)&&(query=formConfig.combinedQuery);job.analysis_config.bucket_span=formConfig.bucketSpan;job.analysis_limits={model_memory_limit:formConfig.modelMemoryLimit};delete job.data_description.field_delimiter;delete job.data_description.quote_character;delete job.data_description.time_format;delete job.data_description.format;var indices=formConfig.indexPattern.title.split(",").map(function(i){return i.trim()});job.datafeed_config={query:query,indices:indices};job.job_id=formConfig.jobId;job.description=formConfig.description;job.groups=formConfig.jobGroups;formConfig.useDedicatedIndex&&(job.results_index_name=job.job_id);job.custom_settings={created_by:_general.WIZARD_TYPE.POPULATION};return job}},{key:"createJob",value:function createJob(formConfig){var _this2=this;return new Promise(function(resolve,reject){_this2.job=_this2.getJobFromConfig(formConfig);var job=(0,_new_job_utils.createJobForSaving)(_this2.job);_job_service.mlJobService.saveNewJob(job).then(function(resp){resp.success?resolve(_this2.job):reject(resp)})})}},{key:"startDatafeed",value:function startDatafeed(formConfig){var datafeedId=_job_service.mlJobService.getDatafeedId(formConfig.jobId);return _job_service.mlJobService.startDatafeed(datafeedId,formConfig.jobId,formConfig.start,formConfig.end)}},{key:"stopDatafeed",value:function stopDatafeed(formConfig){var datafeedId=_job_service.mlJobService.getDatafeedId(formConfig.jobId);return _job_service.mlJobService.stopDatafeed(datafeedId,formConfig.jobId)}}]);return PopulationJobService}();function getSearchJsonFromConfig(formConfig){var bounds=_timefilter.timefilter.getActiveBounds();var buckets=new TimeBuckets;buckets.setInterval("auto");buckets.setBounds(bounds);var interval=buckets.getInterval().asMilliseconds();var query=_lodash2.default.cloneDeep(formConfig.combinedQuery);var json={index:formConfig.indexPattern.title,size:0,body:{query:{},aggs:{times:{date_histogram:{field:formConfig.timeField,interval:interval,min_doc_count:0,extended_bounds:{min:formConfig.start,max:formConfig.end}}}}}};query.bool.must.push({range:_defineProperty({},formConfig.timeField,{gte:formConfig.start,lte:formConfig.end,format:formConfig.format})});json.body.query=query;if(formConfig.fields.length){var aggs={};formConfig.fields.forEach(function(field,i){if(field.id===_general.EVENT_RATE_COUNT_FIELD)void 0!==field.splitField&&void 0!==field.firstSplitFieldName&&(aggs[i]={filter:{term:_defineProperty({},field.splitField.name,field.firstSplitFieldName)}});else if(void 0!==field.splitField&&void 0!==field.firstSplitFieldName){aggs[i]={filter:{term:_defineProperty({},field.splitField.name,field.firstSplitFieldName)},aggs:{splitValue:_defineProperty({},field.agg.type.dslName,{field:field.name})}};"percentiles"===field.agg.type.dslName&&(aggs[i].aggs.splitValue[field.agg.type.dslName].percents=[_job_utils.ML_MEDIAN_PERCENTS])}else{aggs[i]=_defineProperty({},field.agg.type.dslName,{field:field.name});"percentiles"===field.agg.type.dslName&&(aggs[i][field.agg.type.dslName].percents=[_job_utils.ML_MEDIAN_PERCENTS])}});void 0!==formConfig.overField?json.body.aggs.times.aggs={population:{terms:{field:formConfig.overField.name,size:OVER_FIELD_EXAMPLES_COUNT},aggs:aggs}}:json.body.aggs.times.aggs=aggs}return json}return new PopulationJobService}},144:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.getQueryFromSavedSearch=getQueryFromSavedSearch;exports.createSearchItems=createSearchItems;exports.createJobForSaving=createJobForSaving;exports.addNewJobToRecentlyAccessed=addNewJobToRecentlyAccessed;exports.moveToAdvancedJobCreationProvider=moveToAdvancedJobCreationProvider;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _courier=__webpack_require__(94);var _recently_accessed=__webpack_require__(500);var _job_service=__webpack_require__(24);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getQueryFromSavedSearch(formConfig){var must=[];var mustNot=[];must.push(formConfig.query);formConfig.filters.forEach(function(f){var query=f.query||f;query=_lodash2.default.omit(query,["meta","$state"]);query=(0,_courier.migrateFilter)(query);false===f.meta.disabled&&(f.meta.negate?mustNot.push(query):must.push(query))});return{bool:{must:must,must_not:mustNot}}}function createSearchItems($route){var indexPattern=$route.current.locals.indexPattern;var query={query_string:{analyze_wildcard:true,query:"*"}};var filters=[];var savedSearch=$route.current.locals.savedSearch;var searchSource=savedSearch.searchSource;if(void 0===indexPattern.id&&void 0!==savedSearch.id){indexPattern=searchSource.getField("index");var q=searchSource.getField("query");void 0!==q&&"lucene"===q.language&&void 0!==q.query&&("string"===typeof q.query&&""!==q.query?query.query_string.query=q.query:"object"===_typeof(q.query)&&"object"===_typeof(q.query.query_string)&&""!==q.query.query_string.query&&(query.query_string.query=q.query.query_string.query));var fs=searchSource.getField("filter");fs.length&&(filters=fs)}var combinedQuery=getQueryFromSavedSearch({query:query,filters:filters});return{indexPattern:indexPattern,savedSearch:savedSearch,filters:filters,query:query,combinedQuery:combinedQuery}}function createJobForSaving(job){var newJob=_lodash2.default.cloneDeep(job);delete newJob.datafeed_config;return newJob}function addNewJobToRecentlyAccessed(jobId,resultsUrl){var urlParts=resultsUrl.match(/ml#\/(.+?)(\?.+)/);(0,_recently_accessed.addItemToRecentlyAccessed)(urlParts[1],jobId,urlParts[2])}function moveToAdvancedJobCreationProvider($location){return function moveToAdvancedJobCreation(job){_job_service.mlJobService.currentJob=job;$location.path("jobs/new_job/advanced")}}},1440:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();exports.CreateRecognizerJobsServiceProvider=CreateRecognizerJobsServiceProvider;var _new_job_utils=__webpack_require__(144);var _saved_objects=__webpack_require__(57);var _job_service=__webpack_require__(24);var _ml_api_service=__webpack_require__(23);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function CreateRecognizerJobsServiceProvider(Private){var savedObjectsClient=Private(_saved_objects.SavedObjectsClientProvider);var CreateRecognizerJobsService=function(){function CreateRecognizerJobsService(){_classCallCheck(this,CreateRecognizerJobsService)}_createClass(CreateRecognizerJobsService,[{key:"createDatafeed",value:function createDatafeed(job,formConfig){return new Promise(function(resolve,reject){var jobId=formConfig.jobLabel+job.id;_job_service.mlJobService.saveNewDatafeed(job.datafeedConfig,jobId).then(function(resp){resolve(resp)}).catch(function(resp){reject(resp)})})}},{key:"startDatafeed",value:function startDatafeed(datafeedId,jobId,start,end){return _job_service.mlJobService.startDatafeed(datafeedId,jobId,start,end)}},{key:"loadExistingSavedObjects",value:function loadExistingSavedObjects(type){return savedObjectsClient.find({type:type,perPage:1e3})}},{key:"indexTimeRange",value:function indexTimeRange(indexPattern,formConfig){var query=(0,_new_job_utils.getQueryFromSavedSearch)(formConfig);return _ml_api_service.ml.getTimeFieldRange({index:indexPattern.title,timeFieldName:indexPattern.timeFieldName,query:query})}}]);return CreateRecognizerJobsService}();return new CreateRecognizerJobsService}},1442:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3827);__webpack_require__(1443);__webpack_require__(3829)},1443:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DataRecognizer=void 0;var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _recognized_result=__webpack_require__(3828);var _ml_api_service=__webpack_require__(23);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var DataRecognizer=exports.DataRecognizer=function(_Component){_inherits(DataRecognizer,_Component);function DataRecognizer(props){_classCallCheck(this,DataRecognizer);var _this=_possibleConstructorReturn(this,(DataRecognizer.__proto__||Object.getPrototypeOf(DataRecognizer)).call(this,props));_this.state={results:[]};_this.indexPattern=props.indexPattern;_this.savedSearch=props.savedSearch;_this.className=props.className;_this.results=props.results;return _this}_createClass(DataRecognizer,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;_ml_api_service.ml.recognizeIndex({indexPatternTitle:this.indexPattern.title}).then(function(resp){var results=resp.map(function(r){return _react2.default.createElement(_recognized_result.RecognizedResult,{key:r.id,config:r,indexPattern:_this2.indexPattern,savedSearch:_this2.savedSearch})});"object"===_typeof(_this2.results)&&(_this2.results.count=results.length);_this2.setState({results:results})})}},{key:"render",value:function render(){return _react2.default.createElement("div",{className:this.className},this.state.results)}}]);return DataRecognizer}(_react.Component);DataRecognizer.propTypes={indexPattern:_propTypes2.default.object,savedSearch:_propTypes2.default.object,className:_propTypes2.default.string,results:_propTypes2.default.object}},1444:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3853);__webpack_require__(876);__webpack_require__(3875)},1445:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EntityCell=EntityCell;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EntityCell(_ref){var entityName=_ref.entityName,entityValue=_ref.entityValue,filter=_ref.filter;var valueText="mlcategory"!==entityName?entityValue:"mlcategory "+entityValue;return _react2.default.createElement(_react2.default.Fragment,null,valueText,void 0!==filter&&void 0!==entityName&&void 0!==entityValue&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiToolTip,{content:"Add filter"},_react2.default.createElement(_eui.EuiButtonIcon,{size:"xs",className:"filter-button",onClick:function onClick(){return filter(entityName,entityValue,"+")},iconType:"plusInCircle","aria-label":"Add filter"})),_react2.default.createElement(_eui.EuiToolTip,{content:"Remove filter"},_react2.default.createElement(_eui.EuiButtonIcon,{size:"xs",className:"filter-button",onClick:function onClick(){return filter(entityName,entityValue,"-")},iconType:"minusInCircle","aria-label":"Remove filter"}))))}EntityCell.propTypes={entityName:_propTypes2.default.string,entityValue:_propTypes2.default.any,filter:_propTypes2.default.func}},1446:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _detector_description_list=__webpack_require__(3863);Object.defineProperty(exports,"DetectorDescriptionList",{enumerable:true,get:function get(){return _detector_description_list.DetectorDescriptionList}})},1447:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3876);__webpack_require__(3877);__webpack_require__(1448);__webpack_require__(3883);__webpack_require__(3886)},1448:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3880);__webpack_require__(3881)},1449:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.refreshIntervalWatcher=refreshIntervalWatcher;var _timefilter=__webpack_require__(14);function refreshIntervalWatcher($timeout){var refresher=void 0;var listener=void 0;var onRefreshIntervalChange=function onRefreshIntervalChange(){refresher&&$timeout.cancel(refresher);var interval=_timefilter.timefilter.getRefreshInterval();if(interval.value>0&&!interval.pause){var startRefresh=function startRefresh(){refresher=$timeout(function(){startRefresh();listener()},interval.value)};startRefresh()}};function init(listenerCallback){listener=listenerCallback;_timefilter.timefilter.on("refreshIntervalUpdate",onRefreshIntervalChange)}function cancel(){$timeout.cancel(refresher);_timefilter.timefilter.off("refreshIntervalUpdate",onRefreshIntervalChange)}return{init:init,cancel:cancel}}},145:function(module,exports,__webpack_require__){(function(Buffer){var format_value=__webpack_require__(505).format_value;var schema=exports.schema={};var properties=exports.properties={CALSCALE:{type:"TEXT"},METHOD:{type:"TEXT"},PRODID:{type:"TEXT"},VERSION:{type:"TEXT"},ATTACH:{type:"URI"},CATEGORIES:{type:"TEXT",list:true},CLASS:{type:"TEXT"},COMMENT:{type:"TEXT"},DESCRIPTION:{type:"TEXT"},GEO:{type:"FLOAT",list:true},LOCATION:{type:"TEXT"},"PERCENT-COMPLETE":{type:"INTEGER"},PRIORITY:{type:"INTEGER"},RESOURCES:{type:"TEXT"},STATUS:{type:"TEXT"},SUMMARY:{type:"TEXT"},COMPLETED:{type:"DATE-TIME"},DTEND:{type:"DATE-TIME"},DUE:{type:"DATE-TIME"},DTSTART:{type:"DATE-TIME"},DURATION:{type:"DURATION"},FREEBUSY:{type:"PERIOD"},TRANSP:{type:"TEXT"},TZID:{type:"TEXT"},TZNAME:{type:"TEXT"},TZOFFSETFROM:{type:"UTC-OFFSET"},TZOFFSETTO:{type:"UTC-OFFSET"},TZURL:{type:"URI"},ATTENDEE:{type:"CAL-ADDRESS"},CONTACT:{type:"TEXT"},ORGANIZER:{type:"CAL-ADDRESS"},"RECURRENCE-ID":{type:"DATE-TIME"},"RELATED-TO":{type:"TEXT"},URL:{type:"URI"},UID:{type:"TEXT"},EXDATE:{type:"DATE-TIME",list:true},RDATE:{type:"DATE-TIME",list:true},RRULE:{type:"RECUR"},ACTION:{type:"TEXT"},REPEAT:{type:"INTEGER"},TRIGGER:{type:"DURATION"},CREATED:{type:"DATE-TIME"},DTSTAMP:{type:"DATE-TIME"},"LAST-MODIFIED":{type:"DATE-TIME"},SEQUENCE:{type:"INTEGER"},"REQUEST-STATUS":{type:"TEXT"}};var MAX_LINE=75;var CalendarObject=exports.CalendarObject=function(calendar,element){this.calendar=calendar;this.element=element;this.components={};this.properties={}};CalendarObject.create=function(element,calendar){var factory=(schema[element]||{}).factory;return void 0!==factory?new factory(calendar):new CalendarObject(calendar,element)};CalendarObject.prototype.clone=function(){var obj=CalendarObject.create(this.element,this.calendar);for(var prop in this.properties)obj.addProperties(this.properties[prop]);var comp=this.getComponents();for(var i=0;i<comp.length;++i)obj.addComponent(comp[i]);return obj};CalendarObject.prototype.addProperties=function(props){props.forEach(this.addProperty.bind(this))};CalendarObject.prototype.addProperty=function(prop,value,parameters){if(prop instanceof CalendarProperty)prop=prop.clone();else{if(void 0===value)return;prop=new CalendarProperty(prop,value,parameters)}this.properties[prop.name]=this.properties[prop.name]||[];this.properties[prop.name].push(prop);return prop};CalendarObject.prototype.setProperty=function(prop,value,parameters){this.removeProperty(prop instanceof CalendarProperty?prop.name:prop);this.addProperty(prop,value,parameters)};CalendarObject.prototype.addComponent=function(comp){if(!(comp instanceof CalendarObject)){var factory=(schema[comp]||{}).factory;comp=void 0!==factory?new factory(this.calendar):new CalendarObject(this.calendar,comp)}comp.calendar&&comp.calendar!==this.calendar&&(comp=comp.clone());this.components[comp.element]=this.components[comp.element]||[];this.components[comp.element].push(comp);comp.calendar=this.calendar;return comp};CalendarObject.prototype.addComponents=function(comps){comps.forEach(this.addComponent.bind(this))};CalendarObject.prototype.getComponents=function(type){if(void 0===type){var all=[];for(var c in this.components)all=all.concat(this.components[c]);return all}return this.components[type]||[]};CalendarObject.prototype.getProperty=function(prop,i){return(this.properties[prop]||[])[i||0]};CalendarObject.prototype.getProperties=function(prop){return this.properties[prop]||[]};CalendarObject.prototype.getPropertyValue=function(prop,i){return(this.getProperty(prop,i)||{}).value};CalendarObject.prototype.removeProperty=function(prop){delete this.properties[prop]};CalendarObject.prototype.validate=function(){var self=this;var _schema=schema[self.element];_schema&&_schema.required_properties&&_schema.required_properties.forEach(function(req){if(!self.getPropertyValue(req))throw new Error(req+" is a required property of "+self.element)});for(var type in self.components)self.components[type].forEach(function(comp){comp.validate()})};CalendarObject.prototype.toString=function(){var output;if("VCALENDAR"==this.element)output=this.format();else{var ical=new(__webpack_require__(639).iCalendar);ical.addComponent(this);output=ical.format()}output.push("");return output.join("\r\n")};CalendarObject.prototype.format=function(){var lines=["BEGIN:"+this.element];for(var i in this.properties)this.properties[i].forEach(function(prop){lines.push.apply(lines,prop.format())});for(var comp in this.components){comp=this.components[comp];for(i=0;i<comp.length;++i)lines.push.apply(lines,comp[i].format())}lines.push("END:"+this.element);return lines};var CalendarProperty=exports.CalendarProperty=function(name,value,parameters){var propdef=properties[name];this.type=propdef&&propdef.type?propdef.type:"TEXT";this.name=name;this.value=value;this.parameters=parameters||{}};CalendarProperty.prototype.clone=function(){var obj=new CalendarProperty(this.name,this.value);obj.type=this.type;for(var param in this.parameters)obj.parameters[param]=this.parameters[param];return obj};CalendarProperty.prototype.getParameter=function(param){return this.parameters[param]};CalendarProperty.prototype.setParameter=function(param,value){this.parameters[param]=value};CalendarProperty.prototype.format=function(){var params=[];for(var k in this.parameters)params.push(k+"="+this.parameters[k]);params.length&&(params=";"+params.join(";"));var data=new Buffer(this.name+params+":"+format_value(this.type,this.value,this.parameters));var len,pos=0;var output=[];while(true){len=MAX_LINE;pos+len>=data.length&&(len=data.length-pos);while(128==(192&data[pos+len]))len--;output.push(data.toString("utf8",pos,pos+len));if(pos+len>=data.length)break;pos+=len-1;data[pos]=32}return output}}).call(exports,__webpack_require__(243).Buffer)},1450:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.buildConfigFromDetector=buildConfigFromDetector;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _job_utils=__webpack_require__(41);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function buildConfigFromDetector(job,detectorIndex){var analysisConfig=job.analysis_config;var detector=analysisConfig.detectors[detectorIndex];var config={jobId:job.job_id,detectorIndex:detectorIndex,metricFunction:(0,_job_utils.mlFunctionToESAggregation)(detector.function),timeField:job.data_description.time_field,interval:job.analysis_config.bucket_span,datafeedConfig:job.datafeed_config};void 0!==detector.field_name&&(config.metricFieldName=detector.field_name);var summaryCountFieldName=analysisConfig.summary_count_field_name;if("count"===config.metricFunction&&void 0!==summaryCountFieldName&&"doc_count"!==summaryCountFieldName){var cardinalityField=void 0;var topAgg=_lodash2.default.get(job.datafeed_config,"aggregations")||_lodash2.default.get(job.datafeed_config,"aggs");void 0!==topAgg&&_lodash2.default.values(topAgg).length>0&&(cardinalityField=_lodash2.default.get(_lodash2.default.values(topAgg)[0],["aggregations",summaryCountFieldName,"cardinality","field"])||_lodash2.default.get(_lodash2.default.values(topAgg)[0],["aggs",summaryCountFieldName,"cardinality","field"]));if("non_zero_count"===detector.function&&void 0!==cardinalityField){config.metricFunction="cardinality";config.metricFieldName=cardinalityField}else{config.metricFunction="sum";config.metricFieldName=summaryCountFieldName}}return config}},1451:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MESSAGE_LEVEL={ERROR:"error",INFO:"info",SUCCESS:"success",WARNING:"warning"}},1452:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.createTimeSeriesJobData=createTimeSeriesJobData;exports.processMetricPlotResults=processMetricPlotResults;exports.processForecastResults=processForecastResults;exports.processRecordScoreResults=processRecordScoreResults;exports.processDataForFocusAnomalies=processDataForFocusAnomalies;exports.processScheduledEventsForChart=processScheduledEventsForChart;exports.findNearestChartPointToTime=findNearestChartPointToTime;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _parse_interval=__webpack_require__(117);var _job_utils=__webpack_require__(41);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function createTimeSeriesJobData(jobs){var singleTimeSeriesJobs=jobs.filter(_job_utils.isTimeSeriesViewJob);return singleTimeSeriesJobs.map(function(job){var bucketSpan=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span);return{id:job.job_id,selected:false,bucketSpanSeconds:bucketSpan.asSeconds()}})}function processMetricPlotResults(metricPlotData,modelPlotEnabled){var metricPlotChartData=[];true===modelPlotEnabled?_lodash2.default.each(metricPlotData,function(dataForTime,time){metricPlotChartData.push({date:new Date(+time),lower:dataForTime.modelLower,value:dataForTime.actual,upper:dataForTime.modelUpper})}):_lodash2.default.each(metricPlotData,function(dataForTime,time){metricPlotChartData.push({date:new Date(+time),value:dataForTime.actual})});return metricPlotChartData}function processForecastResults(forecastData){var forecastPlotChartData=[];_lodash2.default.each(forecastData,function(dataForTime,time){forecastPlotChartData.push({date:new Date(+time),isForecast:true,lower:dataForTime.forecastLower,value:dataForTime.prediction,upper:dataForTime.forecastUpper})});return forecastPlotChartData}function processRecordScoreResults(scoreData){var bucketScoreData=[];_lodash2.default.each(scoreData,function(dataForTime,time){bucketScoreData.push({date:new Date(+time),score:dataForTime.score})});return bucketScoreData}function processDataForFocusAnomalies(chartData,anomalyRecords,timeFieldName){_lodash2.default.each(anomalyRecords,function(record){var recordTime=record[timeFieldName];var chartPoint=findNearestChartPointToTime(chartData,recordTime);if(void 0===chartPoint&&void 0!==chartData&&chartData.length){var lastChartPoint=chartData[chartData.length-1];var lastChartPointScore=lastChartPoint.anomalyScore||0;record.record_score>lastChartPointScore&&(chartPoint=lastChartPoint)}if(void 0!==chartPoint){chartPoint.anomalyScore=Math.max(_lodash2.default.get(chartPoint,"anomalyScore",0),record.record_score);chartPoint.function=record.function;if(_lodash2.default.has(record,"actual")){chartPoint.actual=record.actual;chartPoint.typical=record.typical}else{var causes=_lodash2.default.get(record,"causes",[]);if(causes.length>0){chartPoint.byFieldName=record.by_field_name;chartPoint.numberOfCauses=causes.length;if(1===causes.length){var cause=_lodash2.default.first(record.causes);chartPoint.actual=cause.actual;chartPoint.typical=cause.typical}}}}});return chartData}function processScheduledEventsForChart(chartData,scheduledEvents){void 0!==scheduledEvents&&_lodash2.default.each(scheduledEvents,function(events,time){var chartPoint=findNearestChartPointToTime(chartData,time);void 0!==chartPoint&&(chartPoint.scheduledEvents=events)});return chartData}function findNearestChartPointToTime(chartData,time){var chartPoint=void 0;if(void 0===chartData)return chartPoint;for(var i=0;i<chartData.length;i++)if(chartData[i].date.getTime()===time){chartPoint=chartData[i];break}if(void 0===chartPoint){var foundItem=void 0;for(var _i=0;_i<chartData.length;_i++){var itemTime=chartData[_i].date.getTime();if(itemTime>time){var item=chartData[_i];var previousItem=chartData[_i-1];var diff1=Math.abs(time-previousItem.date.getTime());var diff2=Math.abs(time-itemTime);foundItem=void 0===previousItem||diff1>diff2?item:previousItem;break}}chartPoint=foundItem}return chartPoint}},1453:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlTimeSeriesSearchService=void 0;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _ml_api_service=__webpack_require__(23);var _job_utils=__webpack_require__(41);var _chart_config_builder=__webpack_require__(1450);var _results_service=__webpack_require__(426);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getMetricData(job,detectorIndex,entityFields,earliestMs,latestMs,interval){if((0,_job_utils.isModelPlotEnabled)(job,detectorIndex,entityFields)){var criteriaFields=[];var detector=job.analysis_config.detectors[detectorIndex];if(_lodash2.default.has(detector,"partition_field_name")){var partitionEntity=_lodash2.default.find(entityFields,{fieldName:detector.partition_field_name});void 0!==partitionEntity&&criteriaFields.push({fieldName:"partition_field_name",fieldValue:partitionEntity.fieldName},{fieldName:"partition_field_value",fieldValue:partitionEntity.fieldValue})}if(_lodash2.default.has(detector,"over_field_name")){var overEntity=_lodash2.default.find(entityFields,{fieldName:detector.over_field_name});void 0!==overEntity&&criteriaFields.push({fieldName:"over_field_name",fieldValue:overEntity.fieldName},{fieldName:"over_field_value",fieldValue:overEntity.fieldValue})}if(_lodash2.default.has(detector,"by_field_name")){var byEntity=_lodash2.default.find(entityFields,{fieldName:detector.by_field_name});void 0!==byEntity&&criteriaFields.push({fieldName:"by_field_name",fieldValue:byEntity.fieldName},{fieldName:"by_field_value",fieldValue:byEntity.fieldValue})}return _results_service.mlResultsService.getModelPlotOutput(job.job_id,detectorIndex,criteriaFields,earliestMs,latestMs,interval)}return new Promise(function(resolve,reject){var obj={success:true,results:{}};var chartConfig=(0,_chart_config_builder.buildConfigFromDetector)(job,detectorIndex);_results_service.mlResultsService.getMetricData(chartConfig.datafeedConfig.indices,chartConfig.datafeedConfig.types,entityFields,chartConfig.datafeedConfig.query,chartConfig.metricFunction,chartConfig.metricFieldName,chartConfig.timeField,earliestMs,latestMs,interval).then(function(resp){_lodash2.default.each(resp.results,function(value,time){obj.results[time]={actual:value}});resolve(obj)}).catch(function(resp){reject(resp)})})}function getChartDetails(job,detectorIndex,entityFields,earliestMs,latestMs){return new Promise(function(resolve,reject){var obj={success:true,results:{functionLabel:"",entityData:{entities:[]}}};var chartConfig=(0,_chart_config_builder.buildConfigFromDetector)(job,detectorIndex);var functionLabel=chartConfig.metricFunction;if(void 0!==chartConfig.metricFieldName){functionLabel+=" ";functionLabel+=chartConfig.metricFieldName}obj.results.functionLabel=functionLabel;var blankEntityFields=_lodash2.default.filter(entityFields,function(entity){return 0===entity.fieldValue.length});if(0===blankEntityFields.length){obj.results.entityData.count=1;obj.results.entityData.entities=entityFields;resolve(obj)}else{var entityFieldNames=_lodash2.default.map(blankEntityFields,"fieldName");_ml_api_service.ml.getCardinalityOfFields({index:chartConfig.datafeedConfig.indices,types:chartConfig.datafeedConfig.types,fieldNames:entityFieldNames,query:chartConfig.datafeedConfig.query,timeFieldName:chartConfig.timeField,earliestMs:earliestMs,latestMs:latestMs}).then(function(results){_lodash2.default.each(blankEntityFields,function(field){obj.results.entityData.entities.push({fieldName:field.fieldName,cardinality:_lodash2.default.get(results,field.fieldName,0)})});resolve(obj)}).catch(function(resp){reject(resp)})}})}exports.mlTimeSeriesSearchService={getMetricData:getMetricData,getChartDetails:getChartDetails}},1454:function(module,exports){},1455:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JsonTooltip=void 0;var _tooltips=__webpack_require__(3936);var _tooltips2=_interopRequireDefault(_tooltips);__webpack_require__(3937);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var JsonTooltip=exports.JsonTooltip=function JsonTooltip(_ref){var id=_ref.id,position=_ref.position;var text=_tooltips2.default[id]?_tooltips2.default[id].text:"";return _react2.default.createElement("span",{"aria-hidden":"true",className:"ml-info-icon"},_react2.default.createElement(_eui.EuiIconTip,{content:text,position:position}),_react2.default.createElement("span",{id:"ml_aria_description_"+id,className:"ml-info-tooltip-text"},text))};JsonTooltip.propTypes={id:_propTypes2.default.string,position:_propTypes2.default.string}},1457:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3975);__webpack_require__(3976)},1458:function(module,exports,__webpack_require__){exports.format_value=__webpack_require__(505).format_value;exports.parse_value=__webpack_require__(505).parse_value;exports.RRule=__webpack_require__(638).RRule;exports.parse_calendar=__webpack_require__(1459).parse_calendar;exports.ParseError=__webpack_require__(1459).ParseError;exports.CalendarObject=__webpack_require__(145).CalendarObject;exports.CalendarProperty=__webpack_require__(145).CalendarProperty;exports.iCalendar=__webpack_require__(639).iCalendar;exports.VEvent=__webpack_require__(3989).VEvent;exports.VTimezone=__webpack_require__(3990).VTimezone;exports.PRODID="-//Tri Tech Computers//node-icalendar//EN"},1459:function(module,exports,__webpack_require__){__webpack_require__(881);var util=__webpack_require__(428);var types=__webpack_require__(505);var CalendarObject=__webpack_require__(145).CalendarObject;var schema=__webpack_require__(145).schema;var properties=__webpack_require__(145).properties;var iCalendar=__webpack_require__(639).iCalendar;var parse_value=types.parse_value;types.format_value;var ParseError=exports.ParseError=function(){Error.apply(this,arguments)};util.inherits(ParseError,Error);function expect(expect_element,expect_value,next_state){return function(element,value,parameters){if(element!=expect_element)throw new ParseError("Expected "+expect_element+" got "+element);if(expect_value&&expect_value!=value)throw new ParseError("Expected "+expect_value+" got "+value);return next_state}}function parse_component(component,next_state){var cal=component.calendar;return function this_state(element,value,parameters){if("BEGIN"==element){var factory=(schema[value]||{}).factory;var child=void 0!==factory?new factory(cal):new CalendarObject(cal,value);return parse_component(child,function(){component.addComponent(child);return this_state.apply(this,arguments)})}if("END"==element)return next_state;var prop=properties[element]||{};value=parse_value(prop.type,value,parameters,cal,prop.list);component.addProperty(element,value,parameters);return this_state}}PROP_NAME=0;PARAM_NAME=1;PARAM_VALUE=2;MAYBE_QUOTED_PARAM=3;QUOTED_PARAM_VALUE=4;PARAM_OR_VALUE=5;PROP_VALUE=6;function parse_record(rec){var propname;var params={};var state=PROP_NAME;var lastpos=0;var current_param;function newstate(s){state=s;lastpos=i+1}function str(){return rec.substr(lastpos,i-lastpos)}var i=0,j=rec.length;for(;i<j;++i){var ch=rec[i];switch(state){case PROP_NAME:if(":"==ch||";"==ch){propname=str();state=PARAM_OR_VALUE;--i}break;case PARAM_OR_VALUE:if(":"==ch)newstate(PROP_VALUE);else{if(";"!=ch)throw new Error("Parse error");newstate(PARAM_NAME)}break;case PARAM_NAME:if("="==ch){current_param=str();newstate(MAYBE_QUOTED_PARAM)}break;case MAYBE_QUOTED_PARAM:'"'==ch?newstate(QUOTED_PARAM_VALUE):state=PARAM_VALUE;break;case PARAM_VALUE:if(":"==ch||";"==ch){params[current_param]=str();state=PARAM_OR_VALUE;--i}break;case QUOTED_PARAM_VALUE:if('"'==ch){params[current_param]=str();state=PARAM_OR_VALUE}break;case PROP_VALUE:i=j;break;default:throw new Error("Invalid parser state")}}return[propname,str(),params]}exports.parse_calendar=function(data,timezone){data=data.split(/\r?\n/);var calendar=new iCalendar(true);if(timezone){"string"===typeof timezone&&(timezone=exports.parse_calendar(timezone));if(timezone instanceof iCalendar){var tzs=timezone.getComponents("VTIMEZONE");for(var i=0;i<tzs.length;++i)calendar.addComponent(tzs[i])}else calendar.addComponent(tzs[i])}var state=expect("BEGIN","VCALENDAR",parse_component(calendar));for(i=0;i<data.length-1;++i){if(!data[i].length)continue;if(void 0===state)throw new ParseError("Mismatched BEGIN/END tags");var j=i;while(j+1<data.length&&(" "===data[j+1][0]||"\t"===data[j+1][0]))++j;var record=data[i];if(j!=i){var d=data.slice(i,j+1);for(var k=1;k<d.length;++k)d[k]=d[k].substr(1);record=d.join("");i=j}state=state.apply(null,parse_record(record))}if(void 0!==state)throw new ParseError("Unable to parse calendar data; END:VCALENDAR not found!");return calendar}},1772:function(module,exports,__webpack_require__){"use strict";__webpack_require__(153);__webpack_require__(155);__webpack_require__(156);__webpack_require__(157);__webpack_require__(158);__webpack_require__(159);__webpack_require__(160);__webpack_require__(161);__webpack_require__(162);__webpack_require__(163);__webpack_require__(164);__webpack_require__(165);__webpack_require__(166);__webpack_require__(167);__webpack_require__(168);__webpack_require__(169);__webpack_require__(170);__webpack_require__(171);__webpack_require__(172);__webpack_require__(173);__webpack_require__(174);__webpack_require__(175);__webpack_require__(176);__webpack_require__(177);__webpack_require__(178);__webpack_require__(179);__webpack_require__(180);__webpack_require__(181);__webpack_require__(182);__webpack_require__(183);__webpack_require__(184);__webpack_require__(185);__webpack_require__(186);__webpack_require__(187);__webpack_require__(188);__webpack_require__(189);__webpack_require__(190);__webpack_require__(191);__webpack_require__(192);__webpack_require__(193);__webpack_require__(194);__webpack_require__(195);__webpack_require__(196);__webpack_require__(197);__webpack_require__(198);__webpack_require__(199);__webpack_require__(200);__webpack_require__(201);__webpack_require__(202);__webpack_require__(203);__webpack_require__(204);__webpack_require__(124);__webpack_require__(205);__webpack_require__(206);__webpack_require__(207);__webpack_require__(208);__webpack_require__(209);__webpack_require__(210);__webpack_require__(211);__webpack_require__(212);__webpack_require__(213);__webpack_require__(214);__webpack_require__(215);__webpack_require__(216);__webpack_require__(217);__webpack_require__(218);__webpack_require__(219);__webpack_require__(220);__webpack_require__(221);__webpack_require__(222);__webpack_require__(223);__webpack_require__(224);__webpack_require__(225);__webpack_require__(226);__webpack_require__(227);__webpack_require__(228);__webpack_require__(229);__webpack_require__(230);__webpack_require__(231);__webpack_require__(232);__webpack_require__(233);__webpack_require__(234);__webpack_require__(235);__webpack_require__(236);__webpack_require__(237);__webpack_require__(238);__webpack_require__(239);__webpack_require__(134);__webpack_require__(240);__webpack_require__(241);var _kibanaCore__=__webpack_require__(242);new _kibanaCore__.CoreSystem({injectedMetadata:JSON.parse(document.querySelector("kbn-injected-metadata").getAttribute("data")),rootDomElement:document.body,requireLegacyFiles:function requireLegacyFiles(){__webpack_require__(2964)}}).start()},23:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ml=void 0;var _lodash=__webpack_require__(1);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _http_service=__webpack_require__(499);var _filters=__webpack_require__(3596);var _results=__webpack_require__(3597);var _jobs=__webpack_require__(3598);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var basePath=_chrome2.default.addBasePath("/api/ml");exports.ml={getJobs:function getJobs(obj){var jobId=obj&&obj.jobId?"/"+obj.jobId:"";return(0,_http_service.http)({url:basePath+"/anomaly_detectors"+jobId})},getJobStats:function getJobStats(obj){var jobId=obj&&obj.jobId?"/"+obj.jobId:"";return(0,_http_service.http)({url:basePath+"/anomaly_detectors"+jobId+"/_stats"})},addJob:function addJob(obj){return(0,_http_service.http)({url:basePath+"/anomaly_detectors/"+obj.jobId,method:"PUT",data:obj.job})},openJob:function openJob(obj){return(0,_http_service.http)({url:basePath+"/anomaly_detectors/"+obj.jobId+"/_open",method:"POST"})},closeJob:function closeJob(obj){return(0,_http_service.http)({url:basePath+"/anomaly_detectors/"+obj.jobId+"/_close",method:"POST"})},forceCloseJob:function forceCloseJob(obj){return(0,_http_service.http)({url:basePath+"/anomaly_detectors/"+obj.jobId+"/_close?force=true",method:"POST"})},deleteJob:function deleteJob(obj){return(0,_http_service.http)({url:basePath+"/anomaly_detectors/"+obj.jobId,method:"DELETE"})},forceDeleteJob:function forceDeleteJob(obj){return(0,_http_service.http)({url:basePath+"/anomaly_detectors/"+obj.jobId+"?force=true",method:"DELETE"})},updateJob:function updateJob(obj){return(0,_http_service.http)({url:basePath+"/anomaly_detectors/"+obj.jobId+"/_update",method:"POST",data:obj.job})},estimateBucketSpan:function estimateBucketSpan(obj){return(0,_http_service.http)({url:basePath+"/validate/estimate_bucket_span",method:"POST",data:obj})},validateJob:function validateJob(obj){return(0,_http_service.http)({url:basePath+"/validate/job",method:"POST",data:obj})},getDatafeeds:function getDatafeeds(obj){var datafeedId=obj&&obj.datafeedId?"/"+obj.datafeedId:"";return(0,_http_service.http)({url:basePath+"/datafeeds"+datafeedId})},getDatafeedStats:function getDatafeedStats(obj){var datafeedId=obj&&obj.datafeedId?"/"+obj.datafeedId:"";return(0,_http_service.http)({url:basePath+"/datafeeds"+datafeedId+"/_stats"})},addDatafeed:function addDatafeed(obj){return(0,_http_service.http)({url:basePath+"/datafeeds/"+obj.datafeedId,method:"PUT",data:obj.datafeedConfig})},updateDatafeed:function updateDatafeed(obj){return(0,_http_service.http)({url:basePath+"/datafeeds/"+obj.datafeedId+"/_update",method:"POST",data:obj.datafeedConfig})},deleteDatafeed:function deleteDatafeed(obj){return(0,_http_service.http)({url:basePath+"/datafeeds/"+obj.datafeedId,method:"DELETE"})},forceDeleteDatafeed:function forceDeleteDatafeed(obj){return(0,_http_service.http)({url:basePath+"/datafeeds/"+obj.datafeedId+"?force=true",method:"DELETE"})},startDatafeed:function startDatafeed(obj){var data={};void 0!==obj.start&&(data.start=obj.start);void 0!==obj.end&&(data.end=obj.end);return(0,_http_service.http)({url:basePath+"/datafeeds/"+obj.datafeedId+"/_start",method:"POST",data:data})},stopDatafeed:function stopDatafeed(obj){return(0,_http_service.http)({url:basePath+"/datafeeds/"+obj.datafeedId+"/_stop",method:"POST"})},datafeedPreview:function datafeedPreview(obj){return(0,_http_service.http)({url:basePath+"/datafeeds/"+obj.datafeedId+"/_preview",method:"GET"})},validateDetector:function validateDetector(obj){return(0,_http_service.http)({url:basePath+"/anomaly_detectors/_validate/detector",method:"POST",data:obj.detector})},forecast:function forecast(obj){var data={};void 0!==obj.duration&&(data.duration=obj.duration);return(0,_http_service.http)({url:basePath+"/anomaly_detectors/"+obj.jobId+"/_forecast",method:"POST",data:data})},overallBuckets:function overallBuckets(obj){var data=(0,_lodash.pick)(obj,["topN","bucketSpan","start","end"]);return(0,_http_service.http)({url:basePath+"/anomaly_detectors/"+obj.jobId+"/results/overall_buckets",method:"POST",data:data})},checkPrivilege:function checkPrivilege(obj){return(0,_http_service.http)({url:basePath+"/_has_privileges",method:"POST",data:obj})},getNotificationSettings:function getNotificationSettings(){return(0,_http_service.http)({url:basePath+"/notification_settings",method:"GET"})},getFieldCaps:function getFieldCaps(obj){var data={};void 0!==obj.index&&(data.index=obj.index);void 0!==obj.fields&&(data.fields=obj.fields);return(0,_http_service.http)({url:basePath+"/indices/field_caps",method:"POST",data:data})},recognizeIndex:function recognizeIndex(obj){return(0,_http_service.http)({url:basePath+"/modules/recognize/"+obj.indexPatternTitle,method:"GET"})},getDataRecognizerModule:function getDataRecognizerModule(obj){return(0,_http_service.http)({url:basePath+"/modules/get_module/"+obj.moduleId,method:"GET"})},setupDataRecognizerConfig:function setupDataRecognizerConfig(obj){var data=(0,_lodash.pick)(obj,["prefix","groups","indexPatternName","query"]);return(0,_http_service.http)({url:basePath+"/modules/setup/"+obj.moduleId,method:"POST",data:data})},getVisualizerFieldStats:function getVisualizerFieldStats(obj){var data=(0,_lodash.pick)(obj,["query","timeFieldName","earliest","latest","samplerShardSize","interval","fields","maxExamples"]);return(0,_http_service.http)({url:basePath+"/data_visualizer/get_field_stats/"+obj.indexPatternTitle,method:"POST",data:data})},getVisualizerOverallStats:function getVisualizerOverallStats(obj){var data=(0,_lodash.pick)(obj,["query","timeFieldName","earliest","latest","samplerShardSize","aggregatableFields","nonAggregatableFields"]);return(0,_http_service.http)({url:basePath+"/data_visualizer/get_overall_stats/"+obj.indexPatternTitle,method:"POST",data:data})},calendars:function calendars(obj){var calendarId=obj&&obj.calendarId?"/"+obj.calendarId:"";return(0,_http_service.http)({url:basePath+"/calendars"+calendarId,method:"GET"})},addCalendar:function addCalendar(obj){return(0,_http_service.http)({url:basePath+"/calendars",method:"PUT",data:obj})},updateCalendar:function updateCalendar(obj){var calendarId=obj&&obj.calendarId?"/"+obj.calendarId:"";return(0,_http_service.http)({url:basePath+"/calendars"+calendarId,method:"PUT",data:obj})},deleteCalendar:function deleteCalendar(obj){return(0,_http_service.http)({url:basePath+"/calendars/"+obj.calendarId,method:"DELETE"})},mlNodeCount:function mlNodeCount(){return(0,_http_service.http)({url:basePath+"/ml_node_count",method:"GET"})},mlInfo:function mlInfo(){return(0,_http_service.http)({url:basePath+"/info",method:"GET"})},calculateModelMemoryLimit:function calculateModelMemoryLimit(obj){var data=(0,_lodash.pick)(obj,["indexPattern","splitFieldName","query","fieldNames","influencerNames","timeFieldName","earliestMs","latestMs"]);return(0,_http_service.http)({url:basePath+"/validate/calculate_model_memory_limit",method:"POST",data:data})},getCardinalityOfFields:function getCardinalityOfFields(obj){var data=(0,_lodash.pick)(obj,["index","types","fieldNames","query","timeFieldName","earliestMs","latestMs"]);return(0,_http_service.http)({url:basePath+"/fields_service/field_cardinality",method:"POST",data:data})},getTimeFieldRange:function getTimeFieldRange(obj){var data=(0,_lodash.pick)(obj,["index","timeFieldName","query"]);return(0,_http_service.http)({url:basePath+"/fields_service/time_field_range",method:"POST",data:data})},esSearch:function esSearch(obj){return(0,_http_service.http)({url:basePath+"/es_search",method:"POST",data:obj})},filters:_filters.filters,results:_results.results,jobs:_jobs.jobs}},24:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlJobService=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _parse_interval=__webpack_require__(117);var _ml_api_service=__webpack_require__(23);var _anomaly_utils=__webpack_require__(299);var _messagebar_service=__webpack_require__(79);var _string_utils=__webpack_require__(40);var _job_utils=__webpack_require__(41);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true}):obj[key]=value;return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var msgs=_messagebar_service.mlMessageBarService;var jobs=[];var datafeedIds={};var JobService=function(){function JobService(){_classCallCheck(this,JobService);this.currentJob=void 0;this.jobs=[];this.basicJobs={};this.jobDescriptions={};this.detectorsByJob={};this.customUrlsByJob={};this.jobStats={activeNodes:{label:"Active ML Nodes",value:0,show:true},total:{label:"Total jobs",value:0,show:true},open:{label:"Open jobs",value:0,show:true},closed:{label:"Closed jobs",value:0,show:true},failed:{label:"Failed jobs",value:0,show:false},activeDatafeeds:{label:"Active datafeeds",value:0,show:true}};this.jobUrls={}}_createClass(JobService,[{key:"getBlankJob",value:function getBlankJob(){return{job_id:"",description:"",groups:[],analysis_config:{bucket_span:"15m",influencers:[],detectors:[]},data_description:{time_field:"",time_format:"",field_delimiter:"",quote_character:'"',format:"delimited"}}}},{key:"loadJobs",value:function loadJobs(){var _this=this;return new Promise(function(resolve,reject){jobs=[];datafeedIds={};_ml_api_service.ml.getJobs().then(function(resp){_angular2.default.copy(resp.jobs,jobs);_ml_api_service.ml.getJobStats().then(function(statsResp){for(var i=0;i<jobs.length;i++){var job=jobs[i];job.data_counts={};job.model_size_stats={};job.datafeed_config={};for(var j=0;j<statsResp.jobs.length;j++)if(job.job_id===statsResp.jobs[j].job_id){var jobStats=_angular2.default.copy(statsResp.jobs[j]);job.state=jobStats.state;job.data_counts=jobStats.data_counts;job.model_size_stats=jobStats.model_size_stats;jobStats.node&&(job.node=jobStats.node);jobStats.open_time&&(job.open_time=jobStats.open_time)}}_this.loadDatafeeds().then(function(datafeedsResp){for(var _i=0;_i<jobs.length;_i++)for(var _j=0;_j<datafeedsResp.datafeeds.length;_j++)if(jobs[_i].job_id===datafeedsResp.datafeeds[_j].job_id){jobs[_i].datafeed_config=datafeedsResp.datafeeds[_j];datafeedIds[jobs[_i].job_id]=datafeedsResp.datafeeds[_j].datafeed_id}processBasicJobInfo(_this,jobs);_this.jobs=jobs;createJobStats(_this.jobs,_this.jobStats);createJobUrls(_this.jobs,_this.jobUrls);resolve({jobs:_this.jobs})})}).catch(function(err){error(err)})}).catch(function(err){error(err)});function error(err){console.log("jobService error getting list of jobs:",err);msgs.error("Jobs list could not be retrieved");msgs.error("",err);reject({jobs:jobs,err:err})}})}},{key:"refreshJob",value:function refreshJob(jobId){var _this2=this;return new Promise(function(resolve,reject){_ml_api_service.ml.getJobs({jobId:jobId}).then(function(resp){var newJob={};if(resp.jobs&&resp.jobs.length){_angular2.default.copy(resp.jobs[0],newJob);_ml_api_service.ml.getJobStats({jobId:jobId}).then(function(statsResp){for(var j=0;j<statsResp.jobs.length;j++)if(newJob.job_id===statsResp.jobs[j].job_id){var statsJob=statsResp.jobs[j];newJob.state=statsJob.state;newJob.data_counts={};newJob.model_size_stats={};_angular2.default.copy(statsJob.data_counts,newJob.data_counts);_angular2.default.copy(statsJob.model_size_stats,newJob.model_size_stats);newJob.node&&_angular2.default.copy(statsJob.node,newJob.node);statsJob.open_time&&(newJob.open_time=statsJob.open_time)}for(var i=0;i<jobs.length;i++)jobs[i].job_id===newJob.job_id&&(jobs[i]=newJob);var datafeedId=_this2.getDatafeedId(jobId);_this2.loadDatafeeds(datafeedId).then(function(datafeedsResp){for(var _i2=0;_i2<jobs.length;_i2++)for(var _j2=0;_j2<datafeedsResp.datafeeds.length;_j2++)if(jobs[_i2].job_id===datafeedsResp.datafeeds[_j2].job_id){jobs[_i2].datafeed_config=datafeedsResp.datafeeds[_j2];datafeedIds[jobs[_i2].job_id]=datafeedsResp.datafeeds[_j2].datafeed_id}_this2.jobs=jobs;createJobStats(_this2.jobs,_this2.jobStats);createJobUrls(_this2.jobs,_this2.jobUrls);resolve({jobs:_this2.jobs})})}).catch(function(err){error(err)})}}).catch(function(err){error(err)});function error(err){console.log("JobService error getting list of jobs:",err);msgs.error("Jobs list could not be retrieved");msgs.error("",err);reject({jobs:jobs,err:err})}})}},{key:"loadDatafeeds",value:function loadDatafeeds(datafeedId){return new Promise(function(resolve,reject){var datafeeds=[];var sId=void 0!==datafeedId?{datafeed_id:datafeedId}:void 0;_ml_api_service.ml.getDatafeeds(sId).then(function(resp){_angular2.default.copy(resp.datafeeds,datafeeds);_ml_api_service.ml.getDatafeedStats().then(function(statsResp){for(var i=0;i<datafeeds.length;i++){var datafeed=datafeeds[i];for(var j=0;j<statsResp.datafeeds.length;j++)datafeed.datafeed_id===statsResp.datafeeds[j].datafeed_id&&(datafeed.state=statsResp.datafeeds[j].state)}resolve({datafeeds:datafeeds})}).catch(function(err){error(err)})}).catch(function(err){error(err)});function error(err){console.log("loadDatafeeds error getting list of datafeeds:",err);msgs.error("datafeeds list could not be retrieved");msgs.error("",err);reject({jobs:jobs,err:err})}})}},{key:"updateSingleJobCounts",value:function updateSingleJobCounts(jobId){var _this3=this;return new Promise(function(resolve,reject){console.log("jobService: update job counts and state for "+jobId);_ml_api_service.ml.getJobStats({jobId:jobId}).then(function(resp){console.log("updateSingleJobCounts controller query response:",resp);if(resp.jobs&&resp.jobs.length){var newJob={};_angular2.default.copy(resp.jobs[0],newJob);for(var i=0;i<jobs.length;i++)if(jobs[i].job_id===jobId){var job=jobs[i];job.state=newJob.state;job.data_counts=newJob.data_counts;newJob.model_size_stats&&(job.model_size_stats=newJob.model_size_stats);newJob.node&&(job.node=newJob.node);newJob.open_time&&(job.open_time=newJob.open_time)}var datafeedId=_this3.getDatafeedId(jobId);_this3.loadDatafeeds(datafeedId).then(function(datafeedsResp){for(var _i3=0;_i3<jobs.length;_i3++)for(var j=0;j<datafeedsResp.datafeeds.length;j++)if(jobs[_i3].job_id===datafeedsResp.datafeeds[j].job_id){jobs[_i3].datafeed_config=datafeedsResp.datafeeds[j];datafeedIds[jobs[_i3].job_id]=datafeedsResp.datafeeds[j].datafeed_id}createJobStats(_this3.jobs,_this3.jobStats);createJobUrls(_this3.jobs,_this3.jobUrls);resolve({jobs:_this3.jobs})}).catch(function(err){error(err)})}else resolve({jobs:_this3.jobs})}).catch(function(err){error(err)});function error(err){console.log("updateSingleJobCounts error getting job details:",err);msgs.error("Job details could not be retrieved for "+jobId);msgs.error("",err);reject({jobs:jobs,err:err})}})}},{key:"updateAllJobStats",value:function updateAllJobStats(){var _this4=this;return new Promise(function(resolve,reject){console.log("jobService: update all jobs counts and state");_ml_api_service.ml.getJobStats().then(function(resp){console.log("updateAllJobStats controller query response:",resp);var newJobsAdded=false;for(var d=0;d<resp.jobs.length;d++){var newJobStats={};var jobExists=false;_angular2.default.copy(resp.jobs[d],newJobStats);for(var i=0;i<jobs.length;i++){var job=jobs[i];if(job.job_id===newJobStats.job_id){jobExists=true;job.state=newJobStats.state;job.data_counts=newJobStats.data_counts;newJobStats.model_size_stats&&(job.model_size_stats=newJobStats.model_size_stats);newJobStats.node&&(job.node=newJobStats.node);newJobStats.open_time&&(job.open_time=newJobStats.open_time)}}if(!jobExists){jobs.splice(d,0,newJobStats);newJobsAdded=true}}_ml_api_service.ml.getDatafeedStats().then(function(datafeedsResp){for(var _i4=0;_i4<jobs.length;_i4++){var datafeed=jobs[_i4].datafeed_config;if(datafeed)for(var j=0;j<datafeedsResp.datafeeds.length;j++){var newDatafeedStats={};_angular2.default.copy(datafeedsResp.datafeeds[j],newDatafeedStats);if(datafeed.datafeed_id===newDatafeedStats.datafeed_id){datafeed.state=newDatafeedStats.state;newDatafeedStats.node&&(datafeed.node=newDatafeedStats.node)}}}_this4.jobs=jobs;if(newJobsAdded||resp.jobs.length!==jobs.length){console.log("updateAllJobStats: number of jobs differs. reloading all jobs");_this4.loadJobs().then(function(){resolve({jobs:_this4.jobs,listChanged:true})}).catch(function(err){error(err)})}else{createJobStats(_this4.jobs,_this4.jobStats);createJobUrls(_this4.jobs,_this4.jobUrls);resolve({jobs:_this4.jobs,listChanged:false})}}).catch(function(err){error(err)})}).catch(function(err){error(err)});function error(err){console.log("updateAllJobStats error getting list job details:",err);msgs.error("Job details could not be retrieved");msgs.error("",err);reject({jobs:jobs,err:err})}})}},{key:"getRunningJobs",value:function getRunningJobs(){var runningJobs=[];_lodash2.default.each(jobs,function(job){job.datafeed_config&&"started"===job.datafeed_config.state&&runningJobs.push(job)});return runningJobs}},{key:"updateSingleJobDatafeedState",value:function updateSingleJobDatafeedState(jobId){var _this5=this;return new Promise(function(resolve,reject){var datafeedId=_this5.getDatafeedId(jobId);_ml_api_service.ml.getDatafeedStats({datafeedId:datafeedId}).then(function(resp){var datafeeds=resp.datafeeds;var state="UNKNOWN";datafeeds&&datafeeds.length&&(state=datafeeds[0].state);resolve(state)}).catch(function(resp){reject(resp)})})}},{key:"saveNewJob",value:function saveNewJob(job){function func(resp){console.log("Response for job query:",resp);var success=checkSaveResponse(resp,job);return{success:success,job:job,resp:resp}}return _ml_api_service.ml.addJob({jobId:job.job_id,job:job}).then(func).catch(func)}},{key:"deleteJob",value:function deleteJob(job,statusIn){var _this6=this;return new Promise(function(resolve,reject){var status=statusIn||{deleteDatafeed:0,deleteJob:0,errorMessage:""};if(job.datafeed_config&&Object.keys(job.datafeed_config).length){var datafeedId=_this6.getDatafeedId(job.job_id);_ml_api_service.ml.forceDeleteDatafeed({datafeedId:datafeedId}).then(function(){status.deleteDatafeed=1;deleteJob()}).catch(function(resp){status.deleteDatafeed=-1;status.deleteJob=-1;deleteFailed(resp,"Delete datafeed")})}else deleteJob();function deleteJob(){_ml_api_service.ml.forceDeleteJob({jobId:job.job_id}).then(function(){status.deleteJob=1;resolve({success:true})}).catch(function(resp){status.deleteJob=-1;deleteFailed(resp,"Delete job")})}function deleteFailed(resp,txt){500===resp.statusCode&&(status.errorMessage=txt);reject({success:false})}})}},{key:"cloneJob",value:function cloneJob(job){var tempJob=_angular2.default.copy(job);delete tempJob.state;delete tempJob.job_version;delete tempJob.data_counts;delete tempJob.create_time;delete tempJob.finished_time;delete tempJob.last_data_time;delete tempJob.model_size_stats;delete tempJob.node;delete tempJob.average_bucket_processing_time_ms;delete tempJob.model_snapshot_id;delete tempJob.open_time;delete tempJob.established_model_memory;delete tempJob.calendars;delete tempJob.analysis_config.use_per_partition_normalization;_lodash2.default.each(tempJob.analysis_config.detectors,function(d){delete d.detector_index});if(tempJob.datafeed_config){delete tempJob.datafeed_config.datafeed_id;delete tempJob.datafeed_config.job_id;delete tempJob.datafeed_config.state;delete tempJob.datafeed_config.node;if(tempJob.datafeed_config.query_delay){var interval=(0,_parse_interval.parseInterval)(tempJob.datafeed_config.query_delay);if(null!==interval){var queryDelay=interval.asSeconds();queryDelay>60&&queryDelay<120&&delete tempJob.datafeed_config.query_delay}}}return tempJob}},{key:"updateJob",value:function updateJob(jobId,job){return _ml_api_service.ml.updateJob({jobId:jobId,job:job}).then(function(resp){console.log("update job",resp);return{success:true}}).catch(function(err){msgs.error("Could not update job: "+jobId);console.log("update job",err);return{success:false,message:err.message}})}},{key:"validateJob",value:function validateJob(obj){return _ml_api_service.ml.validateJob(obj).then(function(messages){console.log("validate job",messages);return{success:true,messages:messages}}).catch(function(err){msgs.error("Job Validation Error: "+err.message);console.log("validate job",err);return{success:false,messages:[{status:"error",text:err.message}]}})}},{key:"getJob",value:function getJob(jobId){var job=_lodash2.default.find(jobs,function(j){return j.job_id===jobId});return job}},{key:"getBasicJobInfo",value:function getBasicJobInfo(){var _this7=this;return new Promise(function(resolve,reject){var obj={success:true,jobs:[]};_ml_api_service.ml.getJobs().then(function(resp){resp.jobs&&resp.jobs.length>0&&(obj.jobs=processBasicJobInfo(_this7,resp.jobs));resolve(obj)}).catch(function(resp){console.log("getBasicJobInfo error getting list of jobs:",resp);reject(resp)})})}},{key:"getJobViewByFields",value:function getJobViewByFields(){return new Promise(function(resolve,reject){var obj={success:true,fieldsByJob:{"*":[]}};_ml_api_service.ml.getJobs().then(function(resp){if(resp.jobs&&resp.jobs.length>0){_lodash2.default.each(resp.jobs,function(jobObj){var fieldsForJob=[];var analysisConfig=jobObj.analysis_config;var detectors=analysisConfig.detectors||[];_lodash2.default.each(detectors,function(detector){_lodash2.default.has(detector,"partition_field_name")&&fieldsForJob.push(detector.partition_field_name);_lodash2.default.has(detector,"over_field_name")&&fieldsForJob.push(detector.over_field_name);_lodash2.default.has(detector,"by_field_name")&&!_lodash2.default.has(detector,"over_field_name")&&fieldsForJob.push(detector.by_field_name)});obj.fieldsByJob[jobObj.job_id]=_lodash2.default.uniq(fieldsForJob);obj.fieldsByJob["*"]=_lodash2.default.union(obj.fieldsByJob["*"],obj.fieldsByJob[jobObj.job_id])});_lodash2.default.each(obj.fieldsByJob,function(fields,jobId){obj.fieldsByJob[jobId]=_lodash2.default.sortBy(fields,function(field){return field.toLowerCase()})})}resolve(obj)}).catch(function(resp){console.log("getJobViewByFields error getting list of viewBy fields:",resp);reject(resp)})})}},{key:"searchPreview",value:function searchPreview(job){return new Promise(function(resolve,reject){if(job.datafeed_config){var query={match_all:{}};job.datafeed_config.query&&(query=job.datafeed_config.query);_ml_api_service.ml.getTimeFieldRange({index:job.datafeed_config.indices,timeFieldName:job.data_description.time_field,query:query}).then(function(timeRange){var bucketSpan=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span);var earliestMs=timeRange.start.epoch;var latestMs=+timeRange.start.epoch+10*bucketSpan.asMilliseconds();var body={query:{bool:{must:[{range:_defineProperty({},job.data_description.time_field,{gte:earliestMs,lt:latestMs,format:"epoch_millis"})},query]}}};var aggregations=job.datafeed_config.aggs||job.datafeed_config.aggregations;if(aggregations&&Object.keys(aggregations).length){body.size=0;body.aggregations=aggregations;var scriptFields=job.datafeed_config.script_fields;scriptFields&&Object.keys(scriptFields).length&&(body.script_fields=scriptFields)}else{body.size=_job_utils.ML_DATA_PREVIEW_COUNT;var _scriptFields=job.datafeed_config.script_fields;_scriptFields&&Object.keys(_scriptFields).length&&(body.script_fields=_scriptFields);var fields={};job.analysis_config.detectors&&_lodash2.default.each(job.analysis_config.detectors,function(dtr){dtr.by_field_name&&(fields[dtr.by_field_name]={});dtr.field_name&&(fields[dtr.field_name]={});dtr.over_field_name&&(fields[dtr.over_field_name]={});dtr.partition_field_name&&(fields[dtr.partition_field_name]={})});job.analysis_config.influencers&&_lodash2.default.each(job.analysis_config.influencers,function(inf){fields[inf]={}});job.analysis_config.categorization_field_name&&(fields[job.analysis_config.categorization_field_name]={});job.analysis_config.summary_count_field_name&&(fields[job.analysis_config.summary_count_field_name]={});job.data_description.time_field&&(fields[job.data_description.time_field]={});var fieldsList=Object.keys(fields);fieldsList.length&&(body._source=fieldsList)}var data={index:job.datafeed_config.indices,body:body};_ml_api_service.ml.esSearch(data).then(function(resp){resolve(resp)}).catch(function(resp){reject(resp)})}).catch(function(resp){reject(resp)})}})}},{key:"openJob",value:function openJob(jobId){return _ml_api_service.ml.openJob({jobId:jobId})}},{key:"closeJob",value:function closeJob(jobId){return _ml_api_service.ml.closeJob({jobId:jobId})}},{key:"forceCloseJob",value:function forceCloseJob(jobId){return _ml_api_service.ml.forceCloseJob({jobId:jobId})}},{key:"saveNewDatafeed",value:function saveNewDatafeed(datafeedConfig,jobId){var datafeedId="datafeed-"+jobId;datafeedConfig.job_id=jobId;return _ml_api_service.ml.addDatafeed({datafeedId:datafeedId,datafeedConfig:datafeedConfig})}},{key:"updateDatafeed",value:function updateDatafeed(datafeedId,datafeedConfig){return _ml_api_service.ml.updateDatafeed({datafeedId:datafeedId,datafeedConfig:datafeedConfig}).then(function(resp){console.log("update datafeed",resp);return{success:true}}).catch(function(err){msgs.error("Could not update datafeed: "+datafeedId);console.log("update datafeed",err);return{success:false,message:err.message}})}},{key:"deleteDatafeed",value:function deleteDatafeed(){}},{key:"startDatafeed",value:function startDatafeed(datafeedId,jobId,start,end){return new Promise(function(resolve,reject){_lodash2.default.isNumber(end)&&end++;_ml_api_service.ml.startDatafeed({datafeedId:datafeedId,start:start,end:end}).then(function(resp){resolve(resp)}).catch(function(err){console.log("jobService error starting datafeed:",err);msgs.error("Could not start datafeed for "+jobId,err);reject(err)})})}},{key:"stopDatafeed",value:function stopDatafeed(datafeedId,jobId){return new Promise(function(resolve,reject){_ml_api_service.ml.stopDatafeed({datafeedId:datafeedId}).then(function(resp){resolve(resp)}).catch(function(err){console.log("jobService error stopping datafeed:",err);if(500===err.statusCode){msgs.error("Could not stop datafeed for "+jobId);msgs.error("Request may have timed out and may still be running in the background.")}else msgs.error("Could not stop datafeed for "+jobId,err);reject(err)})})}},{key:"forceStartDatafeeds",value:function forceStartDatafeeds(dIds,start,end){return _ml_api_service.ml.jobs.forceStartDatafeeds(dIds,start,end)}},{key:"stopDatafeeds",value:function stopDatafeeds(dIds){return _ml_api_service.ml.jobs.stopDatafeeds(dIds)}},{key:"deleteJobs",value:function deleteJobs(jIds){return _ml_api_service.ml.jobs.deleteJobs(jIds)}},{key:"closeJobs",value:function closeJobs(jIds){return _ml_api_service.ml.jobs.closeJobs(jIds)}},{key:"validateDetector",value:function validateDetector(detector){return new Promise(function(resolve,reject){detector?_ml_api_service.ml.validateDetector({detector:detector}).then(function(resp){resolve(resp)}).catch(function(resp){reject(resp)}):reject({})})}},{key:"getDatafeedId",value:function getDatafeedId(jobId){var datafeedId=datafeedIds[jobId];void 0===datafeedId&&(datafeedId="datafeed-"+jobId);return datafeedId}},{key:"getDatafeedPreview",value:function getDatafeedPreview(jobId){var datafeedId=this.getDatafeedId(jobId);return _ml_api_service.ml.datafeedPreview({datafeedId:datafeedId})}},{key:"getJobGroups",value:function getJobGroups(){var groups=[];var tempGroups={};this.jobs.forEach(function(job){Array.isArray(job.groups)&&job.groups.forEach(function(group){void 0===tempGroups[group]?tempGroups[group]=[job]:tempGroups[group].push(job)})});_lodash2.default.each(tempGroups,function(js,id){groups.push({id:id,jobs:js})});return groups}},{key:"createResultsUrl",value:function createResultsUrl(jobIds,from,to,resultsPage){return _createResultsUrl(jobIds,from,to,resultsPage)}}]);return JobService}();function checkSaveResponse(resp,origJob){if(!resp){console.log("checkSaveResponse(): response is empty");return false}if(resp.job_id){if(resp.job_id===origJob.job_id){console.log("checkSaveResponse(): save successful");return true}}else if(resp.errorCode){console.log("checkSaveResponse(): save failed",resp);return false}}function processBasicJobInfo(localJobService,jobsList){var processedJobsList=[];var detectorDescriptionsByJob={};var detectorsByJob={};var customUrlsByJob={};var jobsListCopy=_lodash2.default.cloneDeep(jobsList);_lodash2.default.each(jobsListCopy,function(jobObj){var analysisConfig=jobObj.analysis_config;var bucketSpan=(0,_parse_interval.parseInterval)(analysisConfig.bucket_span);var job={id:jobObj.job_id,bucketSpanSeconds:bucketSpan.asSeconds()};_lodash2.default.has(jobObj,"description")&&false===/^\s*$/.test(jobObj.description)?job.description=jobObj.description:job.description=jobObj.job_id;job.detectorDescriptions=[];job.detectors=[];var detectors=_lodash2.default.get(analysisConfig,"detectors",[]);_lodash2.default.each(detectors,function(detector){if(_lodash2.default.has(detector,"detector_description")){job.detectorDescriptions.push(detector.detector_description);job.detectors.push(detector)}});if(_lodash2.default.has(jobObj,"custom_settings.custom_urls")){job.customUrls=[];_lodash2.default.each(jobObj.custom_settings.custom_urls,function(url){_lodash2.default.has(url,"url_name")&&_lodash2.default.has(url,"url_value")&&(0,_string_utils.isWebUrl)(url.url_value)&&job.customUrls.push(url)});job.customUrls.length>0&&(customUrlsByJob[job.id]=job.customUrls)}localJobService.jobDescriptions[job.id]=job.description;detectorDescriptionsByJob[job.id]=job.detectorDescriptions;detectorsByJob[job.id]=job.detectors;localJobService.basicJobs[job.id]=job;processedJobsList.push(job)});detectorDescriptionsByJob=(0,_anomaly_utils.labelDuplicateDetectorDescriptions)(detectorDescriptionsByJob);_lodash2.default.each(detectorsByJob,function(dtrs,jobId){_lodash2.default.each(dtrs,function(dtr,i){dtr.detector_description=detectorDescriptionsByJob[jobId][i]})});localJobService.detectorsByJob=detectorsByJob;localJobService.customUrlsByJob=customUrlsByJob;return processedJobsList}function createJobStats(jobsList,jobStats){jobStats.activeNodes.value=0;jobStats.total.value=0;jobStats.open.value=0;jobStats.closed.value=0;jobStats.failed.value=0;jobStats.activeDatafeeds.value=0;var mlNodes={};var failedJobs=0;_lodash2.default.each(jobsList,function(job){"opened"===job.state?jobStats.open.value++:"closed"===job.state?jobStats.closed.value++:"failed"===job.state&&failedJobs++;job.datafeed_config&&"started"===job.datafeed_config.state&&jobStats.activeDatafeeds.value++;job.node&&job.node.name&&(mlNodes[job.node.name]={})});jobStats.total.value=jobsList.length;if(failedJobs){jobStats.failed.value=failedJobs;jobStats.failed.show=true}else jobStats.failed.show=false;jobStats.activeNodes.value=Object.keys(mlNodes).length}function createJobUrls(jobsList,jobUrls){_lodash2.default.each(jobsList,function(job){if(job.data_counts){var from=(0,_moment2.default)(job.data_counts.earliest_record_timestamp).toISOString();var to=(0,_moment2.default)(job.data_counts.latest_record_timestamp).toISOString();var path=_createResultsUrl([job.job_id],to,from);jobUrls[job.job_id]?jobUrls[job.job_id].url=path:jobUrls[job.job_id]={url:path}}})}function _createResultsUrl(jobIds,start,end,resultsPage){var idString=jobIds.map(function(j){return"'"+j+"'"}).join(",");var from=(0,_moment2.default)(start).toISOString();var to=(0,_moment2.default)(end).toISOString();var path="";if(void 0!==resultsPage){path+="ml#/";path+=resultsPage}path+="?_g=(ml:(jobIds:!("+idString+"))";path+=",refreshInterval:(display:Off,pause:!f,value:0),time:(from:'"+from+"'";path+=",mode:absolute,to:'"+to+"'";path+="))&_a=(filters:!(),query:(query_string:(analyze_wildcard:!t,query:'*')))";return path}exports.mlJobService=new JobService},253:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.loadNewJobDefaults=loadNewJobDefaults;exports.newJobDefaults=newJobDefaults;exports.newJobLimits=newJobLimits;var _ml_api_service=__webpack_require__(23);var defaults={anomaly_detectors:{},datafeeds:{}};var limits={};function loadNewJobDefaults(){return new Promise(function(resolve){_ml_api_service.ml.mlInfo().then(function(resp){defaults=resp.defaults;limits=resp.limits;resolve({defaults:defaults,limits:limits})}).catch(function(){resolve({defaults:defaults,limits:limits})})})}function newJobDefaults(){return defaults}function newJobLimits(){return limits}},255:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlFieldFormatService=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _job_utils=__webpack_require__(41);var _index_utils=__webpack_require__(128);var _job_service=__webpack_require__(24);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var FieldFormatService=function(){function FieldFormatService(){_classCallCheck(this,FieldFormatService);this.indexPatternIdsByJob={};this.formatsByJob={}}_createClass(FieldFormatService,[{key:"populateFormats",value:function populateFormats(jobIds,indexPatterns){var _this=this;return new Promise(function(resolve,reject){_lodash2.default.each(jobIds,function(jobId){var jobObj=_job_service.mlJobService.getJob(jobId);var datafeedIndices=jobObj.datafeed_config.indices;var indexPattern=_lodash2.default.find(indexPatterns,function(index){return _lodash2.default.find(datafeedIndices,function(datafeedIndex){return index.get("title")===datafeedIndex})});void 0!==indexPattern&&(_this.indexPatternIdsByJob[jobId]=indexPattern.id)});var promises=jobIds.map(function(jobId){return Promise.all([_this.getFormatsForJob(jobId)])});Promise.all(promises).then(function(fmtsByJobByDetector){_lodash2.default.each(fmtsByJobByDetector,function(formatsByDetector,index){_this.formatsByJob[jobIds[index]]=formatsByDetector[0]});resolve(_this.formatsByJob)}).catch(function(err){console.log("fieldFormatService error populating formats:",err);reject({formats:{},err:err})})})}},{key:"getFieldFormat",value:function getFieldFormat(jobId,detectorIndex){return _lodash2.default.get(this.formatsByJob,[jobId,detectorIndex])}},{key:"getFieldFormatFromIndexPattern",value:function getFieldFormatFromIndexPattern(fullIndexPattern,fieldName,esAggName){var fieldFormat=void 0;if("cardinality"!==esAggName){var indexPatternFields=_lodash2.default.get(fullIndexPattern,"fields.byName",[]);fieldFormat=_lodash2.default.get(indexPatternFields,[fieldName,"format"])}return fieldFormat}},{key:"getFormatsForJob",value:function getFormatsForJob(jobId){var _this2=this;return new Promise(function(resolve,reject){var jobObj=_job_service.mlJobService.getJob(jobId);var detectors=jobObj.analysis_config.detectors||[];var formatsByDetector={};var indexPatternId=_this2.indexPatternIdsByJob[jobId];void 0!==indexPatternId?(0,_index_utils.getIndexPatternById)(indexPatternId).then(function(indexPatternData){var fieldsByName=_lodash2.default.get(indexPatternData,"fields.byName",[]);_lodash2.default.each(detectors,function(dtr){var esAgg=(0,_job_utils.mlFunctionToESAggregation)(dtr.function);void 0!==dtr.field_name&&"cardinality"!==esAgg&&(formatsByDetector[dtr.detector_index]=_lodash2.default.get(fieldsByName,[dtr.field_name,"format"]))});resolve(formatsByDetector)}).catch(function(err){reject(err)}):resolve(formatsByDetector)})}}]);return FieldFormatService}();exports.mlFieldFormatService=new FieldFormatService},256:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.chartLimits=chartLimits;exports.drawLineChartDots=drawLineChartDots;exports.filterAxisLabels=filterAxisLabels;exports.numTicks=numTicks;exports.numTicksForDateFormat=numTicksForDateFormat;var _d=__webpack_require__(19);var _d2=_interopRequireDefault(_d);var _string_utils=__webpack_require__(40);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var MAX_LABEL_WIDTH=100;function chartLimits(){var data=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];var limits={max:0,min:0};limits.max=_d2.default.max(data,function(d){return d.value});limits.min=_d2.default.min(data,function(d){return d.value});if(limits.max===limits.min){limits.max=_d2.default.max(data,function(d){return d.typical?Math.max(d.value,d.typical):d.value});limits.min=_d2.default.min(data,function(d){return d.typical?Math.min(d.value,d.typical):d.value})}if(limits.max===limits.min){var padding=.05*limits.max;limits.max+=padding;limits.min-=padding}return limits}function drawLineChartDots(data,lineChartGroup,lineChartValuesLine){var radius=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5;var dotsData=data.reduce(function(p,c,i){var previous=data[i-1];var next=data[i+1];("undefined"===typeof previous||previous&&null===previous.value)&&null!==c.value&&("undefined"===typeof next||next&&null===next.value)&&p.push(c);return p},[]);var dotGroup=lineChartGroup.select(".values-dots").empty()?lineChartGroup.append("g").classed("values-dots",true):lineChartGroup.select(".values-dots");var dots=dotGroup.selectAll("circle").data(dotsData);dots.enter().append("circle").attr("r",radius);dots.attr("cx",lineChartValuesLine.x()).attr("cy",lineChartValuesLine.y());dots.exit().remove()}function filterAxisLabels(selection,chartWidth){if(void 0===selection||void 0===selection.selectAll)throw new Error("Missing selection parameter");selection.selectAll(".tick text").text(function(){var parent=_d2.default.select(this.parentNode);var labelWidth=parent.node().getBBox().width;var labelXPos=_d2.default.transform(parent.attr("transform")).translate[0];var minThreshold=labelXPos-labelWidth/2;var maxThreshold=labelXPos+labelWidth/2;if(minThreshold>=0&&maxThreshold<=chartWidth)return this.textContent;parent.remove()})}function numTicks(axisWidth){return axisWidth/MAX_LABEL_WIDTH}function numTicksForDateFormat(axisWidth,dateFormat){var tickWidth=(0,_string_utils.calculateTextWidth)((0,_moment2.default)().format(dateFormat),false);return axisWidth/(1.75*tickWidth)}},277:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.IntervalHelperProvider=IntervalHelperProvider;exports.getBoundsRoundedToInterval=getBoundsRoundedToInterval;exports.calcEsInterval=calcEsInterval;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _datemath=__webpack_require__(83);var _datemath2=_interopRequireDefault(_datemath);var _ml_calc_auto_interval=__webpack_require__(3761);var _inherits=__webpack_require__(3762);var _time_buckets=__webpack_require__(273);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var unitsDesc=_datemath2.default.unitsDesc;var largeMax=unitsDesc.indexOf("w");function IntervalHelperProvider(Private,config){var calcAuto=Private(_ml_calc_auto_interval.TimeBucketsCalcAutoIntervalProvider);(0,_inherits.inherits)(TimeBuckets,_time_buckets.TimeBuckets);function TimeBuckets(){this.barTarget=config.get("histogram:barTarget");this.maxBars=config.get("histogram:maxBars")}TimeBuckets.prototype.setBarTarget=function(bt){this.barTarget=bt};TimeBuckets.prototype.setMaxBars=function(mb){this.maxBars=mb};TimeBuckets.prototype.getInterval=function(){var self=this;var duration=self.getDuration();return decorateInterval(maybeScaleInterval(readInterval()),duration);function readInterval(){var interval=self._i;if(_moment2.default.isDuration(interval))return interval;return calcAuto.near(self.barTarget,duration)}function maybeScaleInterval(interval){if(!self.hasBounds())return interval;var maxLength=self.maxBars;var approxLen=duration/interval;var scaled=void 0;if(!(approxLen>maxLength))return interval;scaled=calcAuto.lessThan(maxLength,duration);if(+scaled===+interval)return interval;decorateInterval(interval,duration);return _lodash2.default.assign(scaled,{preScaled:interval,scale:interval/scaled,scaled:true})}};TimeBuckets.prototype.getIntervalToNearestMultiple=function(divisorSecs){var interval=this.getInterval();var intervalSecs=interval.asSeconds();var remainder=intervalSecs%divisorSecs;if(0===remainder)return interval;var nearestMultiple=remainder>divisorSecs/2?intervalSecs+divisorSecs-remainder:intervalSecs-remainder;nearestMultiple=0===nearestMultiple?divisorSecs:nearestMultiple;var nearestMultipleInt=_moment2.default.duration(nearestMultiple,"seconds");decorateInterval(nearestMultipleInt,this.getDuration());var preScaled=_lodash2.default.get(interval,"preScaled");if(void 0!==preScaled&&preScaled<nearestMultipleInt){nearestMultipleInt.preScaled=preScaled;nearestMultipleInt.scale=preScaled/nearestMultipleInt;nearestMultipleInt.scaled=true}return nearestMultipleInt};function decorateInterval(interval,originalDuration){var esInterval=calcEsInterval(interval);interval.esValue=esInterval.value;interval.esUnit=esInterval.unit;interval.expression=esInterval.expression;interval.overflow=originalDuration>interval&&_moment2.default.duration(interval-originalDuration);var prettyUnits=_moment2.default.normalizeUnits(esInterval.unit);1===esInterval.value?interval.description=prettyUnits:interval.description=esInterval.value+" "+prettyUnits+"s";return interval}return TimeBuckets}function getBoundsRoundedToInterval(bounds,interval){var inclusiveEnd=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var intervalMs=interval.asMilliseconds();var adjustedMinMs=Math.floor(bounds.min.valueOf()/intervalMs)*intervalMs;var adjustedMaxMs=Math.ceil(bounds.max.valueOf()/intervalMs)*intervalMs;false===inclusiveEnd&&(adjustedMaxMs-=1);return{min:(0,_moment2.default)(adjustedMinMs),max:(0,_moment2.default)(adjustedMaxMs)}}function calcEsInterval(duration){for(var i=0;i<unitsDesc.length;i++){var unit=unitsDesc[i];var val=duration.as(unit);if(val>=1&&Math.floor(val)===val){if(i<=largeMax&&1!==val)continue;return{value:val,unit:unit,expression:val+unit}}}var ms=duration.as("ms");return{value:ms,unit:"ms",expression:ms+"ms"}}},2964:function(module,exports,__webpack_require__){"use strict";__webpack_require__(479);__webpack_require__(480);__webpack_require__(94);__webpack_require__(832);__webpack_require__(250);__webpack_require__(297);__webpack_require__(3587);__webpack_require__(3588);__webpack_require__(626);__webpack_require__(498);__webpack_require__(3590);__webpack_require__(3591);__webpack_require__(630);__webpack_require__(3830);__webpack_require__(3834);__webpack_require__(3850);__webpack_require__(3914);__webpack_require__(3933);__webpack_require__(3938);__webpack_require__(3940);__webpack_require__(3943);__webpack_require__(3948);__webpack_require__(3951);__webpack_require__(3955);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _momentTimezone=__webpack_require__(126);var _momentTimezone2=_interopRequireDefault(_momentTimezone);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var uiModule=_modules.uiModules.get("kibana");uiModule.run(function(config){_momentTimezone2.default.tz.setDefault(config.get("dateFormat:tz"))});"function"===typeof _routes2.default.enable&&_routes2.default.enable();_routes2.default.otherwise({redirectTo:"/jobs"})},299:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.aggregationTypeTransform=void 0;exports.getSeverity=getSeverity;exports.getSeverityWithLow=getSeverityWithLow;exports.getSeverityColor=getSeverityColor;exports.labelDuplicateDetectorDescriptions=labelDuplicateDetectorDescriptions;exports.getEntityFieldName=getEntityFieldName;exports.getEntityFieldValue=getEntityFieldValue;exports.showActualForFunction=showActualForFunction;exports.showTypicalForFunction=showTypicalForFunction;exports.isRuleSupported=isRuleSupported;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _detector_rule=__webpack_require__(423);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var DISPLAY_ACTUAL_FUNCTIONS=["count","distinct_count","lat_long","mean","max","min","sum","median","varp","info_content","time"];var DISPLAY_TYPICAL_FUNCTIONS=["count","distinct_count","lat_long","mean","max","min","sum","median","varp","info_content","time"];function getSeverity(normalizedScore){return normalizedScore>=75?"critical":normalizedScore>=50?"major":normalizedScore>=25?"minor":normalizedScore>=0?"warning":"unknown"}function getSeverityWithLow(normalizedScore){return normalizedScore>=75?"critical":normalizedScore>=50?"major":normalizedScore>=25?"minor":normalizedScore>=3?"warning":normalizedScore>=0?"low":"unknown"}function getSeverityColor(normalizedScore){return normalizedScore>=75?"#fe5050":normalizedScore>=50?"#fba740":normalizedScore>=25?"#fdec25":normalizedScore>=3?"#8bc8fb":normalizedScore>=0?"#d2e9f7":"#ffffff"}function labelDuplicateDetectorDescriptions(detectorsByJob){var checkedJobIds=[];_lodash2.default.each(detectorsByJob,function(detectors,jobId){checkedJobIds.push(jobId);var otherJobs=_lodash2.default.omit(detectorsByJob,checkedJobIds);_lodash2.default.each(detectors,function(description,i){_lodash2.default.each(otherJobs,function(otherJobDetectors,otherJobId){_lodash2.default.each(otherJobDetectors,function(otherDescription,j){if(description===otherDescription){detectors[i]=description+" ("+jobId+")";otherJobDetectors[j]=description+" ("+otherJobId+")"}})})})});return detectorsByJob}function getEntityFieldName(record){if(_lodash2.default.has(record,"by_field_name")&&_lodash2.default.has(record,"by_field_value"))return record.by_field_name;if(_lodash2.default.has(record,"over_field_name"))return record.over_field_name;if(_lodash2.default.has(record,"partition_field_name"))return record.partition_field_name;return}function getEntityFieldValue(record){if(_lodash2.default.has(record,"by_field_value"))return record.by_field_value;if(_lodash2.default.has(record,"over_field_value"))return record.over_field_value;if(_lodash2.default.has(record,"partition_field_value"))return record.partition_field_value;return}function showActualForFunction(functionDescription){return _lodash2.default.indexOf(DISPLAY_ACTUAL_FUNCTIONS,functionDescription)>-1}function showTypicalForFunction(functionDescription){return _lodash2.default.indexOf(DISPLAY_TYPICAL_FUNCTIONS,functionDescription)>-1}function isRuleSupported(record){return-1===_detector_rule.CONDITIONS_NOT_SUPPORTED_FUNCTIONS.indexOf(record.function)||void 0!==getEntityFieldName(record)}exports.aggregationTypeTransform={toES:function toES(oldAggType){var newAggType=oldAggType;"mean"===newAggType?newAggType="avg":"distinct_count"===newAggType?newAggType="cardinality":"median"===newAggType&&(newAggType="percentiles");return newAggType},toML:function toML(oldAggType){var newAggType=oldAggType;"avg"===newAggType?newAggType="mean":"cardinality"===newAggType?newAggType="distinct_count":"percentiles"===newAggType&&(newAggType="median");return newAggType}}},300:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EVENT_RATE_COUNT_FIELD="__ml_event_rate_count__";exports.WIZARD_TYPE={SINGLE_METRIC:"single-metric-wizard",MULTI_METRIC:"multi-metric-wizard",POPULATION:"population-wizard"}},321:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DATAFEED_STATE={STARTED:"started",STARTING:"starting",STOPPED:"stopped",STOPPING:"stopping",DELETED:"deleted"};exports.FORECAST_REQUEST_STATE={FAILED:"failed",FINISHED:"finished",SCHEDULED:"scheduled",STARTED:"started"};exports.JOB_STATE={CLOSED:"closed",CLOSING:"closing",FAILED:"failed",OPENED:"opened",OPENING:"opening"}},322:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ES_FIELD_TYPES={ATTACHMENT:"attachment",BOOLEAN:"boolean",BYTE:"byte",DATE:"date",DOUBLE:"double",FLOAT:"float",GEO_POINT:"geo_point",GEO_SHAPE:"geo_shape",HALF_FLOAT:"half_float",INTEGER:"integer",IP:"ip",KEYWORD:"keyword",LONG:"long",MURMUR3:"murmur3",SCALED_FLOAT:"scaled_float",SHORT:"short",TEXT:"text",TOKEN_COUNT:"token_count",_ID:"_id",_SOURCE:"_source",_TYPE:"_type"};exports.KBN_FIELD_TYPES={ATTACHMENT:"attachment",BOOLEAN:"boolean",DATE:"date",GEO_POINT:"geo_point",GEO_SHAPE:"geo_shape",IP:"ip",MURMUR3:"murmur3",NUMBER:"number",STRING:"string",_SOURCE:"_source",UNKNOWN:"unknown",CONFLICT:"conflict"};exports.ML_JOB_FIELD_TYPES={BOOLEAN:"boolean",DATE:"date",GEO_POINT:"geo_point",IP:"ip",KEYWORD:"keyword",NUMBER:"number",TEXT:"text"}},323:function(module,exports,__webpack_require__){false;module.exports=__webpack_require__(3751)()},35:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.checkGetJobsPrivilege=checkGetJobsPrivilege;exports.checkCreateJobsPrivilege=checkCreateJobsPrivilege;exports.checkPermission=checkPermission;exports.createPermissionFailureMessage=createPermissionFailureMessage;var _get_privileges=__webpack_require__(3595);var _check_license=__webpack_require__(68);var privileges={};function checkGetJobsPrivilege(Private,Promise,kbnUrl){return new Promise(function(resolve,reject){(0,_get_privileges.getPrivileges)().then(function(priv){privileges=priv;if(privileges.canGetJobs)return resolve(privileges);kbnUrl.redirect("/access-denied");return reject()})})}function checkCreateJobsPrivilege(Private,Promise,kbnUrl){return new Promise(function(resolve,reject){(0,_get_privileges.getPrivileges)().then(function(priv){privileges=priv;if(privileges.canCreateJob)return resolve(privileges);kbnUrl.redirect("/jobs");return reject()})})}function checkPermission(privilegeType){var licenseHasExpired=(0,_check_license.getLicenseHasExpired)();return true===privileges[privilegeType]&&true!==licenseHasExpired}function createPermissionFailureMessage(privilegeType){var message="";var licenseHasExpired=(0,_check_license.getLicenseHasExpired)();licenseHasExpired?message="Your license has expired.":"canCreateJob"===privilegeType?message="You do not have permission to create Machine Learning jobs.":"canStartStopDatafeed"===privilegeType?message="You do not have permission to start or stop datafeeds.":"canUpdateJob"===privilegeType?message="You do not have permission to edit jobs.":"canDeleteJob"===privilegeType?message="You do not have permission to delete jobs.":"canCreateCalendar"===privilegeType?message="You do not have permission to create calendars.":"canDeleteCalendar"===privilegeType?message="You do not have permission to delete calendars.":"canForecastJob"===privilegeType&&(message="You do not have permission to run forecasts.");return message+" Please contact your administrator."}},3587:function(module,exports){},3588:function(module,exports,__webpack_require__){"use strict";var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _index=__webpack_require__(3589);var _index2=_interopRequireDefault(_index);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/access-denied",{template:_index2.default,controllerAs:"accessDenied",controller:function controller($window,kbnUrl,kbnBaseUrl){this.goToKibana=function(){$window.location.href=_chrome2.default.getBasePath()+kbnBaseUrl};this.retry=function(){return kbnUrl.redirect("/jobs")}}})},3589:function(module,exports){module.exports='<ml-nav-menu name="access-denied"></ml-nav-menu>\n<div class="col-md-12">\n  <div class="euiSpacer euiSpacer--m"></div>\n  <div class="euiCallOut euiCallOut--danger">\n    <div class="euiCallOutHeader">\n      <svg class="euiIcon euiIcon--medium euiCallOutHeader__icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n        width="16" height="16" viewBox="0 0 16 16">\n        <defs>\n          <path id="cross-a" d="M7.293 8l-4.147 4.146a.5.5 0 0 0 .708.708L8 8.707l4.146 4.147a.5.5 0 0 0 .708-.708L8.707 8l4.147-4.146a.5.5 0 0 0-.708-.708L8 7.293 3.854 3.146a.5.5 0 1 0-.708.708L7.293 8z"></path>\n        </defs>\n        <use fill-rule="nonzero" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#cross-a"></use>\n      </svg>\n      <span class="euiCallOutHeader__title">You need permission to access Machine Learning</span>\n    </div>\n    <div class="euiText euiText--small">\n      <p>You must have the privileges granted in the <span class="text-monospace">kibana_user</span> and <span class="text-monospace">machine_learning_user</span> roles.<br/>\n      Your system admin can set these roles on the Management User page.\n      </p>\n    </div>\n  </div>\n\n  <div style=\'margin-top:20px;\'>\n    <button ng-click="accessDenied.goToKibana();" class="kuiButton kuiButton--primary">Back to Kibana home</button>\n    <button ng-click="accessDenied.retry();" class="kuiButton kuiButton--basic">Retry</button>\n  </div>\n</div>\n'},3590:function(module,exports,__webpack_require__){"use strict";__webpack_require__(832);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_angular2.default.module("ui.bootstrap.popover").directive("popoverHtmlUnsafePopup",function($compile){var template='<div class="popover {{placement}}" ng-class="{ in: isOpen(), fade: animation() }">';template+='<div class="arrow"></div>';template+='<div class="popover-inner">';template+='<h3 class="popover-title" bind-html-unsafe="title" ng-show="title"></h3>';template+='<div class="popover-content" bind-html-unsafe="content" ></div>';template+="</div></div>";return{restrict:"EA",replace:true,scope:{title:"@",content:"@",placement:"@",animation:"&",isOpen:"&"},template:template,link:function link(scope,element){scope.$apply();var cont=$compile(scope.content)(scope);element.find(".popover-content").html(cont);scope.closePopover=function(){scope.$parent.$parent.isOpen=false;scope.$parent.$parent.$applyAsync();element.remove()}}}}).directive("popoverHtmlUnsafe",["$tooltip",function($tooltip){return $tooltip("popoverHtmlUnsafe","popover","click")}]);_angular2.default.module("ui.bootstrap.dropdown",["ui.bootstrap.position"]).constant("dropdownConfig",{openClass:"open"}).service("dropdownService",["$document","$rootScope",function($document,$rootScope){var openScope=null;var closeDropdown=function closeDropdown(evt){if(!openScope)return;if(evt&&"disabled"===openScope.getAutoClose())return;var toggleElement=openScope.getToggleElement();if(evt&&toggleElement&&toggleElement[0].contains(evt.target))return;var $element=openScope.getElement();if(evt&&"outsideClick"===openScope.getAutoClose()&&$element&&$element[0].contains(evt.target))return;openScope.isOpen=false;$rootScope.$$phase||openScope.$apply()};var escapeKeyBind=function escapeKeyBind(evt){if(27===evt.which){openScope.focusToggleElement();closeDropdown()}};this.open=function(dropdownScope){if(!openScope){$document.bind("click",closeDropdown);$document.bind("keydown",escapeKeyBind)}openScope&&openScope!==dropdownScope&&(openScope.isOpen=false);openScope=dropdownScope};this.close=function(dropdownScope){if(openScope===dropdownScope){openScope=null;$document.unbind("click",closeDropdown);$document.unbind("keydown",escapeKeyBind)}}}]).controller("DropdownController",["$scope","$attrs","$parse","dropdownConfig","dropdownService","$animate","$position","$document",function($scope,$attrs,$parse,dropdownConfig,dropdownService,$animate,$position,$document){var self=this;var scope=$scope.$new();var openClass=dropdownConfig.openClass;var getIsOpen=void 0;var setIsOpen=_angular2.default.noop;var toggleInvoker=$attrs.onToggle?$parse($attrs.onToggle):_angular2.default.noop;var appendToBody=false;this.init=function(element){self.$element=element;if($attrs.isOpen){getIsOpen=$parse($attrs.isOpen);setIsOpen=getIsOpen.assign;$scope.$watch(getIsOpen,function(value){scope.isOpen=!!value})}appendToBody=_angular2.default.isDefined($attrs.dropdownAppendToBody);if(appendToBody&&self.dropdownMenu){$document.find("body").append(self.dropdownMenu);element.on("$destroy",function handleDestroyEvent(){self.dropdownMenu.remove()})}};this.toggle=function(open){return scope.isOpen=arguments.length?!!open:!scope.isOpen};this.isOpen=function(){return scope.isOpen};scope.getToggleElement=function(){return self.toggleElement};scope.getAutoClose=function(){return $attrs.autoClose||"always"};scope.getElement=function(){return self.$element};scope.focusToggleElement=function(){self.toggleElement&&self.toggleElement[0].focus()};scope.$watch("isOpen",function(isOpen,wasOpen){if(appendToBody&&self.dropdownMenu){var pos=$position.positionElements(self.$element,self.dropdownMenu,"bottom-left",true);var css={top:pos.top+"px",display:isOpen?"block":"none"};var rightalign=self.dropdownMenu.hasClass("dropdown-menu-right");if(rightalign){css.left="auto";css.right=window.innerWidth-(pos.left+self.$element.prop("offsetWidth"))+"px"}else{css.left=pos.left+"px";css.right="auto"}self.dropdownMenu.css(css)}$animate[isOpen?"addClass":"removeClass"](self.$element,openClass);if(isOpen){scope.focusToggleElement();dropdownService.open(scope)}else dropdownService.close(scope);setIsOpen($scope,isOpen);_angular2.default.isDefined(isOpen)&&isOpen!==wasOpen&&toggleInvoker($scope,{open:!!isOpen})});$scope.$on("$locationChangeSuccess",function(){scope.isOpen=false});$scope.$on("$destroy",function(){scope.$destroy()})}]).directive("dropdown",function(){return{controller:"DropdownController",link:function link(scope,element,attrs,dropdownCtrl){dropdownCtrl.init(element)}}}).directive("dropdownMenu",function(){return{restrict:"AC",require:"?^dropdown",link:function link(scope,element,attrs,dropdownCtrl){if(!dropdownCtrl)return;dropdownCtrl.dropdownMenu=element}}}).directive("dropdownToggle",function(){return{require:"?^dropdown",link:function link(scope,element,attrs,dropdownCtrl){if(!dropdownCtrl)return;dropdownCtrl.toggleElement=element;var toggleDropdown=function toggleDropdown(event){event.preventDefault();element.hasClass("disabled")||attrs.disabled||scope.$apply(function(){dropdownCtrl.toggle()})};element.bind("click",toggleDropdown);element.attr({"aria-haspopup":true,"aria-expanded":false});scope.$watch(dropdownCtrl.isOpen,function(isOpen){element.attr("aria-expanded",!!isOpen)});scope.$on("$destroy",function(){element.unbind("click",toggleDropdown)})}}})},3591:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3592);__webpack_require__(3593);__webpack_require__(3668);__webpack_require__(3740);__webpack_require__(3757);__webpack_require__(3778);__webpack_require__(3800);__webpack_require__(3813);__webpack_require__(3818);__webpack_require__(1419)},3592:function(module,exports){},3593:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3594)},3594:function(module,exports,__webpack_require__){"use strict";var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _modules=__webpack_require__(2);var _check_license=__webpack_require__(68);var _check_privilege=__webpack_require__(35);var _check_ml_nodes=__webpack_require__(69);var _new_job_defaults=__webpack_require__(253);var _promise=__webpack_require__(89);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _jobs=__webpack_require__(3599);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml",["react"]);var template='<ml-nav-menu name="jobs" /><jobs-page />';_routes2.default.when("/jobs/?",{template:template,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,mlNodeCount:_check_ml_nodes.getMlNodeCount,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults,initPromise:(0,_promise.initPromise)(false)}});_module.directive("jobsPage",function(){return{scope:{},restrict:"E",link:function link(scope,element){_reactDom2.default.render(_react2.default.createElement(_jobs.JobsPage),element[0])}}})},3595:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getPrivileges=getPrivileges;var _ml_api_service=__webpack_require__(23);function getPrivileges(){var privileges={canGetJobs:false,canCreateJob:false,canDeleteJob:false,canOpenJob:false,canCloseJob:false,canForecastJob:false,canGetDatafeeds:false,canStartStopDatafeed:false,canUpdateJob:false,canUpdateDatafeed:false,canPreviewDatafeed:false,canGetCalendars:false,canCreateCalendar:false,canDeleteCalendar:false,canGetFilters:false,canCreateFilter:false,canDeleteFilter:false};return new Promise(function(resolve,reject){var priv={cluster:["cluster:monitor/xpack/ml/job/get","cluster:monitor/xpack/ml/job/stats/get","cluster:monitor/xpack/ml/datafeeds/get","cluster:monitor/xpack/ml/datafeeds/stats/get","cluster:monitor/xpack/ml/calendars/get","cluster:admin/xpack/ml/job/put","cluster:admin/xpack/ml/job/delete","cluster:admin/xpack/ml/job/update","cluster:admin/xpack/ml/job/open","cluster:admin/xpack/ml/job/close","cluster:admin/xpack/ml/job/forecast","cluster:admin/xpack/ml/datafeeds/put","cluster:admin/xpack/ml/datafeeds/delete","cluster:admin/xpack/ml/datafeeds/start","cluster:admin/xpack/ml/datafeeds/stop","cluster:admin/xpack/ml/datafeeds/update","cluster:admin/xpack/ml/datafeeds/preview","cluster:admin/xpack/ml/calendars/put","cluster:admin/xpack/ml/calendars/delete","cluster:admin/xpack/ml/calendars/jobs/update","cluster:admin/xpack/ml/calendars/events/post","cluster:admin/xpack/ml/calendars/events/delete","cluster:admin/xpack/ml/filters/put","cluster:admin/xpack/ml/filters/get","cluster:admin/xpack/ml/filters/update","cluster:admin/xpack/ml/filters/delete"]};_ml_api_service.ml.checkPrivilege(priv).then(function(resp){if(resp.securityDisabled)Object.keys(privileges).forEach(function(k){return privileges[k]=true});else{resp.cluster["cluster:monitor/xpack/ml/job/get"]&&resp.cluster["cluster:monitor/xpack/ml/job/stats/get"]&&(privileges.canGetJobs=true);resp.cluster["cluster:monitor/xpack/ml/datafeeds/get"]&&resp.cluster["cluster:monitor/xpack/ml/datafeeds/stats/get"]&&(privileges.canGetDatafeeds=true);resp.cluster["cluster:admin/xpack/ml/job/put"]&&resp.cluster["cluster:admin/xpack/ml/job/open"]&&resp.cluster["cluster:admin/xpack/ml/datafeeds/put"]&&(privileges.canCreateJob=true);resp.cluster["cluster:admin/xpack/ml/job/update"]&&(privileges.canUpdateJob=true);resp.cluster["cluster:admin/xpack/ml/job/open"]&&(privileges.canOpenJob=true);resp.cluster["cluster:admin/xpack/ml/job/close"]&&(privileges.canCloseJob=true);resp.cluster["cluster:admin/xpack/ml/job/forecast"]&&(privileges.canForecastJob=true);resp.cluster["cluster:admin/xpack/ml/job/delete"]&&resp.cluster["cluster:admin/xpack/ml/datafeeds/delete"]&&(privileges.canDeleteJob=true);resp.cluster["cluster:admin/xpack/ml/job/open"]&&resp.cluster["cluster:admin/xpack/ml/datafeeds/start"]&&resp.cluster["cluster:admin/xpack/ml/datafeeds/stop"]&&(privileges.canStartStopDatafeed=true);resp.cluster["cluster:admin/xpack/ml/datafeeds/update"]&&(privileges.canUpdateDatafeed=true);resp.cluster["cluster:admin/xpack/ml/datafeeds/preview"]&&(privileges.canPreviewDatafeed=true);resp.cluster["cluster:monitor/xpack/ml/calendars/get"]&&(privileges.canGetCalendars=true);resp.cluster["cluster:admin/xpack/ml/calendars/put"]&&resp.cluster["cluster:admin/xpack/ml/calendars/jobs/update"]&&resp.cluster["cluster:admin/xpack/ml/calendars/events/post"]&&(privileges.canCreateCalendar=true);resp.cluster["cluster:admin/xpack/ml/calendars/delete"]&&resp.cluster["cluster:admin/xpack/ml/calendars/events/delete"]&&(privileges.canDeleteCalendar=true);resp.cluster["cluster:admin/xpack/ml/filters/get"]&&(privileges.canGetFilters=true);resp.cluster["cluster:admin/xpack/ml/filters/put"]&&resp.cluster["cluster:admin/xpack/ml/filters/update"]&&(privileges.canCreateFilter=true);resp.cluster["cluster:admin/xpack/ml/filters/delete"]&&(privileges.canDeleteFilter=true)}resolve(privileges)}).catch(function(){reject(privileges)})})}},3596:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.filters=void 0;var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _http_service=__webpack_require__(499);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var basePath=_chrome2.default.addBasePath("/api/ml");exports.filters={filters:function filters(obj){var filterId=obj&&obj.filterId?"/"+obj.filterId:"";return(0,_http_service.http)({url:basePath+"/filters"+filterId,method:"GET"})},filtersStats:function filtersStats(){return(0,_http_service.http)({url:basePath+"/filters/_stats",method:"GET"})},addFilter:function addFilter(filterId,description,items){return(0,_http_service.http)({url:basePath+"/filters",method:"PUT",data:{filterId:filterId,description:description,items:items}})},updateFilter:function updateFilter(filterId,description,addItems,removeItems){return(0,_http_service.http)({url:basePath+"/filters/"+filterId,method:"PUT",data:{description:description,addItems:addItems,removeItems:removeItems}})},deleteFilter:function deleteFilter(filterId){return(0,_http_service.http)({url:basePath+"/filters/"+filterId,method:"DELETE"})}}},3597:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.results=void 0;var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _http_service=__webpack_require__(499);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var basePath=_chrome2.default.addBasePath("/api/ml");exports.results={getAnomaliesTableData:function getAnomaliesTableData(jobIds,criteriaFields,influencers,aggregationInterval,threshold,earliestMs,latestMs,maxRecords,maxExamples){return(0,_http_service.http)({url:basePath+"/results/anomalies_table_data",method:"POST",data:{jobIds:jobIds,criteriaFields:criteriaFields,influencers:influencers,aggregationInterval:aggregationInterval,threshold:threshold,earliestMs:earliestMs,latestMs:latestMs,maxRecords:maxRecords,maxExamples:maxExamples}})},getCategoryDefinition:function getCategoryDefinition(jobId,categoryId){return(0,_http_service.http)({url:basePath+"/results/category_definition",method:"POST",data:{jobId:jobId,categoryId:categoryId}})},getCategoryExamples:function getCategoryExamples(jobId,categoryIds,maxExamples){return(0,_http_service.http)({url:basePath+"/results/category_examples",method:"POST",data:{jobId:jobId,categoryIds:categoryIds,maxExamples:maxExamples}})}}},3598:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.jobs=void 0;var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _http_service=__webpack_require__(499);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var basePath=_chrome2.default.addBasePath("/api/ml");exports.jobs={jobsSummary:function jobsSummary(jobIds){return(0,_http_service.http)({url:basePath+"/jobs/jobs_summary",method:"POST",data:{jobIds:jobIds}})},jobs:function jobs(jobIds){return(0,_http_service.http)({url:basePath+"/jobs/jobs",method:"POST",data:{jobIds:jobIds}})},groups:function groups(){return(0,_http_service.http)({url:basePath+"/jobs/groups",method:"GET"})},forceStartDatafeeds:function forceStartDatafeeds(datafeedIds,start,end){return(0,_http_service.http)({url:basePath+"/jobs/force_start_datafeeds",method:"POST",data:{datafeedIds:datafeedIds,start:start,end:end}})},stopDatafeeds:function stopDatafeeds(datafeedIds){return(0,_http_service.http)({url:basePath+"/jobs/stop_datafeeds",method:"POST",data:{datafeedIds:datafeedIds}})},deleteJobs:function deleteJobs(jobIds){return(0,_http_service.http)({url:basePath+"/jobs/delete_jobs",method:"POST",data:{jobIds:jobIds}})},closeJobs:function closeJobs(jobIds){return(0,_http_service.http)({url:basePath+"/jobs/close_jobs",method:"POST",data:{jobIds:jobIds}})},jobAuditMessages:function jobAuditMessages(jobId,from){var jobIdString=void 0!==jobId?"/"+jobId:"";var fromString=void 0!==from?"?from="+from:"";return(0,_http_service.http)({url:basePath+"/job_audit_messages/messages"+jobIdString+fromString,method:"GET"})},jobAuditSummary:function jobAuditSummary(){return(0,_http_service.http)({url:basePath+"/job_audit_messages/summary",method:"GET"})}}},3599:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobsPage=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();__webpack_require__(3600);var _new_job_button=__webpack_require__(3601);var _jobs_list_view=__webpack_require__(3604);var _jobs_stats_bar=__webpack_require__(3663);var _node_available_warning=__webpack_require__(3666);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}exports.JobsPage=function(_Component){_inherits(JobsPage,_Component);function JobsPage(props){_classCallCheck(this,JobsPage);var _this=_possibleConstructorReturn(this,(JobsPage.__proto__||Object.getPrototypeOf(JobsPage)).call(this,props));_this.setUpdateJobStats=function(updateJobStats){_this.setState({updateJobStats:updateJobStats})};_this.unsetUpdateJobStats=function(){_this.setUpdateJobStats(function(){})};_this.state={jobsSummaryList:[],updateJobStats:function updateJobStats(){}};return _this}_createClass(JobsPage,[{key:"render",value:function render(){return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_jobs_stats_bar.JobStatsBar,{setUpdateJobStats:this.setUpdateJobStats,unsetUpdateJobStats:this.unsetUpdateJobStats}),_react2.default.createElement("div",{className:"job-management"},_react2.default.createElement(_node_available_warning.NodeAvailableWarning,null),_react2.default.createElement("header",null,_react2.default.createElement("div",{className:"new-job-button-container"},_react2.default.createElement(_new_job_button.NewJobButton,null))),_react2.default.createElement("div",{className:"clear"}),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_jobs_list_view.JobsListView,{updateJobStats:this.state.updateJobStats})))}}]);return JobsPage}(_react.Component)},3600:function(module,exports){},3601:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _new_job_button=__webpack_require__(3602);Object.defineProperty(exports,"NewJobButton",{enumerable:true,get:function get(){return _new_job_button.NewJobButton}})},3602:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.NewJobButton=NewJobButton;var _check_privilege=__webpack_require__(35);var _check_ml_nodes=__webpack_require__(69);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);__webpack_require__(3603);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function newJob(){window.location.href="#/jobs/new_job"}function NewJobButton(){var buttonEnabled=(0,_check_privilege.checkPermission)("canCreateJob")&&(0,_check_ml_nodes.mlNodesAvailable)();return _react2.default.createElement(_eui.EuiButton,{onClick:newJob,size:"s",disabled:false===buttonEnabled,fill:true},_react2.default.createElement("i",{className:"new-job-button fa fa-plus"}),"Create new job")}},3603:function(module,exports){},3604:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _jobs_list_view=__webpack_require__(3605);Object.defineProperty(exports,"JobsListView",{enumerable:true,get:function get(){return _jobs_list_view.JobsListView}})},3605:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobsListView=void 0;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();__webpack_require__(3606);var _timefilter=__webpack_require__(14);var _ml_api_service=__webpack_require__(23);var _utils=__webpack_require__(367);var _jobs_list=__webpack_require__(3608);var _job_details=__webpack_require__(3617);var _job_filter_bar=__webpack_require__(3630);var _edit_job_flyout=__webpack_require__(3633);var _delete_job_modal=__webpack_require__(3645);var _start_datafeed_modal=__webpack_require__(3647);var _create_watch_flyout=__webpack_require__(3652);var _multi_job_actions=__webpack_require__(3659);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var DEFAULT_REFRESH_INTERVAL_MS=3e4;var MINIMUM_REFRESH_INTERVAL_MS=5e3;var jobsRefreshInterval=null;var JobsListView=exports.JobsListView=function(_Component){_inherits(JobsListView,_Component);function JobsListView(props){_classCallCheck(this,JobsListView);var _this=_possibleConstructorReturn(this,(JobsListView.__proto__||Object.getPrototypeOf(JobsListView)).call(this,props));_this.toggleRow=function(jobId){if(_this.state.itemIdToExpandedRowMap[jobId]){var itemIdToExpandedRowMap=_extends({},_this.state.itemIdToExpandedRowMap);delete itemIdToExpandedRowMap[jobId];_this.setState({itemIdToExpandedRowMap:itemIdToExpandedRowMap})}else{var _itemIdToExpandedRowMap=_extends({},_this.state.itemIdToExpandedRowMap);void 0!==_this.state.fullJobsList[jobId]?_itemIdToExpandedRowMap[jobId]=_react2.default.createElement(_job_details.JobDetails,{jobId:jobId,job:_this.state.fullJobsList[jobId],addYourself:_this.addUpdateFunction,removeYourself:_this.removeUpdateFunction}):_itemIdToExpandedRowMap[jobId]=_react2.default.createElement(_job_details.JobDetails,{jobId:jobId,addYourself:_this.addUpdateFunction,removeYourself:_this.removeUpdateFunction});_this.setState({itemIdToExpandedRowMap:_itemIdToExpandedRowMap},function(){(0,_utils.loadFullJob)(jobId).then(function(job){var fullJobsList=_extends({},_this.state.fullJobsList);fullJobsList[jobId]=job;_this.setState({fullJobsList:fullJobsList},function(){_itemIdToExpandedRowMap=_extends({},_this.state.itemIdToExpandedRowMap);void 0!==_itemIdToExpandedRowMap[jobId]&&(_itemIdToExpandedRowMap[jobId]=_react2.default.createElement(_job_details.JobDetails,{jobId:jobId,job:job,addYourself:_this.addUpdateFunction,removeYourself:_this.removeUpdateFunction}));_this.setState({itemIdToExpandedRowMap:_itemIdToExpandedRowMap})})}).catch(function(error){console.error(error)})})}};_this.addUpdateFunction=function(id,f){_this.updateFunctions[id]=f};_this.removeUpdateFunction=function(id){delete _this.updateFunctions[id]};_this.setShowEditJobFlyoutFunction=function(func){_this.showEditJobFlyout=func};_this.unsetShowEditJobFlyoutFunction=function(){_this.showEditJobFlyout=function(){}};_this.setShowDeleteJobModalFunction=function(func){_this.showDeleteJobModal=func};_this.unsetShowDeleteJobModalFunction=function(){_this.showDeleteJobModal=function(){}};_this.setShowStartDatafeedModalFunction=function(func){_this.showStartDatafeedModal=func};_this.unsetShowStartDatafeedModalFunction=function(){_this.showStartDatafeedModal=function(){}};_this.setShowCreateWatchFlyoutFunction=function(func){_this.showCreateWatchFlyout=func};_this.unsetShowCreateWatchFlyoutFunction=function(){_this.showCreateWatchFlyout=function(){}};_this.getShowCreateWatchFlyoutFunction=function(){return _this.showCreateWatchFlyout};_this.selectJobChange=function(selectedJobs){_this.setState({selectedJobs:selectedJobs})};_this.setFilters=function(filterClauses){var filteredJobsSummaryList=(0,_utils.filterJobs)(_this.state.jobsSummaryList,filterClauses);_this.setState({filteredJobsSummaryList:filteredJobsSummaryList,filterClauses:filterClauses},function(){_this.refreshSelectedJobs()})};_this.state={jobsSummaryList:[],filteredJobsSummaryList:[],fullJobsList:{},selectedJobs:[],itemIdToExpandedRowMap:{},filterClauses:[]};_this.updateFunctions={};_this.showEditJobFlyout=function(){};_this.showDeleteJobModal=function(){};_this.showStartDatafeedModal=function(){};_this.showCreateWatchFlyout=function(){};_this.blockRefresh=false;return _this}_createClass(JobsListView,[{key:"componentDidMount",value:function componentDidMount(){_timefilter.timefilter.disableTimeRangeSelector();_timefilter.timefilter.enableAutoRefreshSelector();this.initAutoRefresh();this.initAutoRefreshUpdate()}},{key:"componentWillUnmount",value:function componentWillUnmount(){_timefilter.timefilter.off("refreshIntervalUpdate");this.clearRefreshInterval()}},{key:"initAutoRefresh",value:function initAutoRefresh(){var _timefilter$getRefres=_timefilter.timefilter.getRefreshInterval(),value=_timefilter$getRefres.value;0===value&&_timefilter.timefilter.setRefreshInterval({pause:false,value:DEFAULT_REFRESH_INTERVAL_MS});this.setAutoRefresh()}},{key:"initAutoRefreshUpdate",value:function initAutoRefreshUpdate(){var _this2=this;_timefilter.timefilter.on("refreshIntervalUpdate",function(){_this2.setAutoRefresh()})}},{key:"setAutoRefresh",value:function setAutoRefresh(){var _timefilter$getRefres2=_timefilter.timefilter.getRefreshInterval(),value=_timefilter$getRefres2.value,pause=_timefilter$getRefres2.pause;pause?this.clearRefreshInterval():this.setRefreshInterval(value);this.refreshJobSummaryList(true)}},{key:"setRefreshInterval",value:function setRefreshInterval(interval){var _this3=this;this.clearRefreshInterval();if(interval>=MINIMUM_REFRESH_INTERVAL_MS){this.blockRefresh=false;jobsRefreshInterval=setInterval(function(){return _this3.refreshJobSummaryList()},interval)}}},{key:"clearRefreshInterval",value:function clearRefreshInterval(){this.blockRefresh=true;clearInterval(jobsRefreshInterval)}},{key:"refreshSelectedJobs",value:function refreshSelectedJobs(){var selectedJobsIds=this.state.selectedJobs.map(function(j){return j.id});var filteredJobIds=this.state.filteredJobsSummaryList.map(function(j){return j.id});var selectedJobs=this.state.jobsSummaryList.filter(function(j){return selectedJobsIds.find(function(id){return id===j.id})}).filter(function(j){return filteredJobIds.find(function(id){return id===j.id})});this.setState({selectedJobs:selectedJobs})}},{key:"refreshJobSummaryList",value:function refreshJobSummaryList(){var _this4=this;var forceRefresh=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(true===forceRefresh||false===this.blockRefresh){var expandedJobsIds=Object.keys(this.state.itemIdToExpandedRowMap);_ml_api_service.ml.jobs.jobsSummary(expandedJobsIds).then(function(jobs){var fullJobsList={};var jobsSummaryList=jobs.map(function(job){if(void 0!==job.fullJob){fullJobsList[job.id]=job.fullJob;delete job.fullJob}job.latestTimeStampSortValue=job.latestTimeStampMs||0;return job});var filteredJobsSummaryList=(0,_utils.filterJobs)(jobsSummaryList,_this4.state.filterClauses);_this4.setState({jobsSummaryList:jobsSummaryList,filteredJobsSummaryList:filteredJobsSummaryList,fullJobsList:fullJobsList},function(){_this4.refreshSelectedJobs();_this4.props.updateJobStats(jobsSummaryList)});Object.keys(_this4.updateFunctions).forEach(function(j){_this4.updateFunctions[j].setState({job:fullJobsList[j]})})}).catch(function(error){console.error(error)})}}},{key:"render",value:function render(){var _this5=this;var jobIds=this.state.jobsSummaryList.map(function(j){return j.id});return _react2.default.createElement("div",null,_react2.default.createElement("div",{className:"actions-bar"},_react2.default.createElement(_multi_job_actions.MultiJobActions,{selectedJobs:this.state.selectedJobs,showStartDatafeedModal:this.showStartDatafeedModal,showDeleteJobModal:this.showDeleteJobModal,refreshJobs:function refreshJobs(){return _this5.refreshJobSummaryList(true)}}),_react2.default.createElement(_job_filter_bar.JobFilterBar,{setFilters:this.setFilters})),_react2.default.createElement(_jobs_list.JobsList,{jobsSummaryList:this.state.filteredJobsSummaryList,fullJobsList:this.state.fullJobsList,itemIdToExpandedRowMap:this.state.itemIdToExpandedRowMap,toggleRow:this.toggleRow,selectJobChange:this.selectJobChange,showEditJobFlyout:this.showEditJobFlyout,showDeleteJobModal:this.showDeleteJobModal,showStartDatafeedModal:this.showStartDatafeedModal,refreshJobs:function refreshJobs(){return _this5.refreshJobSummaryList(true)},selectedJobsCount:this.state.selectedJobs.length}),_react2.default.createElement(_edit_job_flyout.EditJobFlyout,{setShowFunction:this.setShowEditJobFlyoutFunction,unsetShowFunction:this.unsetShowEditJobFlyoutFunction,refreshJobs:function refreshJobs(){return _this5.refreshJobSummaryList(true)},allJobIds:jobIds}),_react2.default.createElement(_delete_job_modal.DeleteJobModal,{setShowFunction:this.setShowDeleteJobModalFunction,unsetShowFunction:this.unsetShowDeleteJobModalFunction,refreshJobs:function refreshJobs(){return _this5.refreshJobSummaryList(true)}}),_react2.default.createElement(_start_datafeed_modal.StartDatafeedModal,{setShowFunction:this.setShowStartDatafeedModalFunction,unsetShowFunction:this.unsetShowDeleteJobModalFunction,getShowCreateWatchFlyoutFunction:this.getShowCreateWatchFlyoutFunction,refreshJobs:function refreshJobs(){return _this5.refreshJobSummaryList(true)}}),_react2.default.createElement(_create_watch_flyout.CreateWatchFlyout,{setShowFunction:this.setShowCreateWatchFlyoutFunction,unsetShowFunction:this.unsetShowCreateWatchFlyoutFunction,compile:this.props.compile}))}}]);return JobsListView}(_react.Component);JobsListView.propTypes={updateJobStats:_propTypes2.default.func.isRequired}},3606:function(module,exports){},3607:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MLRequestFailure=void 0;var _errors=__webpack_require__(56);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}exports.MLRequestFailure=function(_KbnError){_inherits(MLRequestFailure,_KbnError);function MLRequestFailure(error,resp){_classCallCheck(this,MLRequestFailure);error=error||{};var _this=_possibleConstructorReturn(this,(MLRequestFailure.__proto__||Object.getPrototypeOf(MLRequestFailure)).call(this,error.message||JSON.stringify(resp),MLRequestFailure));_this.origError=error;_this.resp="string"===typeof resp?JSON.parse(resp):resp;return _this}return MLRequestFailure}(_errors.KbnError)},3608:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _jobs_list=__webpack_require__(3609);Object.defineProperty(exports,"JobsList",{enumerable:true,get:function get(){return _jobs_list.JobsList}})},3609:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobsList=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _lodash=__webpack_require__(1);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _string_utils=__webpack_require__(40);var _job_actions=__webpack_require__(1410);var _job_description=__webpack_require__(3612);var _job_message_icon=__webpack_require__(1412);__webpack_require__(3616);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var PAGE_SIZE=10;var PAGE_SIZE_OPTIONS=[10,25,50];var TIME_FORMAT="YYYY-MM-DD HH:mm:ss";var JobsList=exports.JobsList=function(_Component){_inherits(JobsList,_Component);function JobsList(props){_classCallCheck(this,JobsList);var _this=_possibleConstructorReturn(this,(JobsList.__proto__||Object.getPrototypeOf(JobsList)).call(this,props));_this.onTableChange=function(_ref){var _ref$page=_ref.page,page=void 0===_ref$page?{}:_ref$page,_ref$sort=_ref.sort,sort=void 0===_ref$sort?{}:_ref$sort;var pageIndex=page.index,pageSize=page.size;var sortField=sort.field,sortDirection=sort.direction;_this.setState({pageIndex:pageIndex,pageSize:pageSize,sortField:sortField,sortDirection:sortDirection})};_this.toggleRow=function(item){_this.props.toggleRow(item.id)};_this.state={jobsSummaryList:props.jobsSummaryList,pageIndex:0,pageSize:PAGE_SIZE,itemIdToExpandedRowMap:{},sortField:"id",sortDirection:"asc"};return _this}_createClass(JobsList,[{key:"getPageOfJobs",value:function getPageOfJobs(index,size,sortField,sortDirection){var _this2=this;var list=this.state.jobsSummaryList;list=(0,_lodash.sortBy)(this.state.jobsSummaryList,function(item){return item[sortField]});list="asc"===sortDirection?list:list.reverse();var pageStart=index*size;if(pageStart>=list.length){pageStart=Math.floor(list.length/size)*size;setTimeout(function(){_this2.setState({pageIndex:pageStart/size})},0)}return{pageOfItems:list.slice(pageStart,pageStart+size),totalItemCount:list.length}}},{key:"render",value:function render(){var _this3=this;var selectionControls={selectable:function selectable(){return true},selectableMessage:function selectableMessage(selectable){return selectable?void 0:"Cannot select job"},onSelectionChange:this.props.selectJobChange};var columns=[{name:"",render:function render(item){return _react2.default.createElement(_eui.EuiButtonIcon,{onClick:function onClick(){return _this3.toggleRow(item)},iconType:_this3.state.itemIdToExpandedRowMap[item.id]?"arrowDown":"arrowRight","aria-label":_this3.state.itemIdToExpandedRowMap[item.id]?"Hide details":"Show details","data-row-id":item.id})}},{field:"id",name:"ID",sortable:true,truncateText:false},{field:"auditMessage",name:"",render:function render(item){return _react2.default.createElement(_job_message_icon.JobIcon,{message:item,showTooltip:true})}},{name:"Description",sortable:true,field:"description",render:function render(description,item){return _react2.default.createElement(_job_description.JobDescription,{job:item})}},{field:"processed_record_count",name:"Processed records",sortable:true,truncateText:false,dataType:"number",render:function render(count){return(0,_string_utils.toLocaleString)(count)}},{field:"memory_status",name:"Memory status",sortable:true,truncateText:false},{field:"jobState",name:"Job state",sortable:true,truncateText:false},{field:"datafeedState",name:"Datafeed state",sortable:true,truncateText:false},{name:"Latest timestamp",truncateText:false,field:"latestTimeStampSortValue",sortable:true,render:function render(time,item){return _react2.default.createElement("span",{className:"euiTableCellContent__text"},void 0===item.latestTimestampMs?"":(0,_moment2.default)(item.latestTimestampMs).format(TIME_FORMAT))}},{name:"Actions",render:function render(item){return _react2.default.createElement(_job_actions.ResultLinks,{jobs:[item]})}},{name:"",actions:(0,_job_actions.actionsMenuContent)(this.props.showEditJobFlyout,this.props.showDeleteJobModal,this.props.showStartDatafeedModal,this.props.refreshJobs)}];var _state=this.state,pageIndex=_state.pageIndex,pageSize=_state.pageSize,sortField=_state.sortField,sortDirection=_state.sortDirection;var _getPageOfJobs=this.getPageOfJobs(pageIndex,pageSize,sortField,sortDirection),pageOfItems=_getPageOfJobs.pageOfItems,totalItemCount=_getPageOfJobs.totalItemCount;var pagination={pageIndex:pageIndex,pageSize:pageSize,totalItemCount:totalItemCount,pageSizeOptions:PAGE_SIZE_OPTIONS};var sorting={sort:{field:sortField,direction:sortDirection}};var selectedJobsClass=this.props.selectedJobsCount?"jobs-selected":"";return _react2.default.createElement(_eui.EuiBasicTable,{itemId:"id",className:"jobs-list-table "+selectedJobsClass,items:pageOfItems,columns:columns,pagination:pagination,onChange:this.onTableChange,selection:selectionControls,itemIdToExpandedRowMap:this.state.itemIdToExpandedRowMap,isExpandable:true,sorting:sorting,hasActions:true})}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props){var itemIdToExpandedRowMap=props.itemIdToExpandedRowMap;var jobsSummaryList=props.jobsSummaryList;return{itemIdToExpandedRowMap:itemIdToExpandedRowMap,jobsSummaryList:jobsSummaryList}}}]);return JobsList}(_react.Component);JobsList.propTypes={jobsSummaryList:_propTypes2.default.array.isRequired,fullJobsList:_propTypes2.default.object.isRequired,itemIdToExpandedRowMap:_propTypes2.default.object.isRequired,toggleRow:_propTypes2.default.func.isRequired,selectJobChange:_propTypes2.default.func.isRequired,showEditJobFlyout:_propTypes2.default.func.isRequired,showDeleteJobModal:_propTypes2.default.func.isRequired,showStartDatafeedModal:_propTypes2.default.func.isRequired,refreshJobs:_propTypes2.default.func.isRequired,selectedJobsCount:_propTypes2.default.number.isRequired}},3610:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.actionsMenuContent=actionsMenuContent;var _check_privilege=__webpack_require__(35);var _check_ml_nodes=__webpack_require__(69);var _utils=__webpack_require__(367);function actionsMenuContent(showEditJobFlyout,showDeleteJobModal,showStartDatafeedModal,refreshJobs){var canCreateJob=(0,_check_privilege.checkPermission)("canCreateJob")&&(0,_check_ml_nodes.mlNodesAvailable)();var canUpdateJob=(0,_check_privilege.checkPermission)("canUpdateJob");var canDeleteJob=(0,_check_privilege.checkPermission)("canDeleteJob");var canUpdateDatafeed=(0,_check_privilege.checkPermission)("canUpdateDatafeed");var canStartStopDatafeed=(0,_check_privilege.checkPermission)("canStartStopDatafeed")&&(0,_check_ml_nodes.mlNodesAvailable)();var canCloseJob=(0,_check_privilege.checkPermission)("canCloseJob")&&(0,_check_ml_nodes.mlNodesAvailable)();return[{name:"Start datafeed",description:"Start datafeed",icon:"play",enabled:function enabled(){return canStartStopDatafeed},available:function available(item){return(0,_utils.isStartable)([item])},onClick:function onClick(item){showStartDatafeedModal([item]);closeMenu()}},{name:"Stop datafeed",description:"Stop datafeed",icon:"stop",enabled:function enabled(){return canStartStopDatafeed},available:function available(item){return(0,_utils.isStoppable)([item])},onClick:function onClick(item){(0,_utils.stopDatafeeds)([item],refreshJobs);closeMenu(true)}},{name:"Close job",description:"Close job",icon:"cross",enabled:function enabled(){return canCloseJob},available:function available(item){return(0,_utils.isClosable)([item])},onClick:function onClick(item){(0,_utils.closeJobs)([item],refreshJobs);closeMenu(true)}},{name:"Clone job",description:"Clone job",icon:"copy",enabled:function enabled(){return canCreateJob},onClick:function onClick(item){(0,_utils.cloneJob)(item.id);closeMenu(true)}},{name:"Edit job",description:"Edit job",icon:"pencil",enabled:function enabled(){return canUpdateJob&&canUpdateDatafeed},onClick:function onClick(item){showEditJobFlyout(item);closeMenu()}},{name:"Delete job",description:"Delete job",icon:"trash",color:"danger",enabled:function enabled(){return canDeleteJob},onClick:function onClick(item){showDeleteJobModal([item]);closeMenu()}}]}function closeMenu(){var now=arguments.length>0&&void 0!==arguments[0]&&arguments[0];now?document.querySelector(".euiTable").click():window.setTimeout(function(){var modalBody=document.querySelector(".euiModalBody");modalBody?modalBody.click():document.querySelector(".euiTable").click()},500)}},3611:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ResultLinks=ResultLinks;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _job_service=__webpack_require__(24);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}var TIME_FORMAT="YYYY-MM-DD HH:mm:ss";function getLink(location,jobs){var from=0;var to=0;if(1===jobs.length){from=jobs[0].earliestTimestampMs;to=jobs[0].latestTimestampMs}else{from=Math.min.apply(Math,_toConsumableArray(jobs.map(function(j){return j.earliestTimestampMs})));to=Math.max.apply(Math,_toConsumableArray(jobs.map(function(j){return j.latestTimestampMs})))}var fromString=(0,_moment2.default)(from).format(TIME_FORMAT);var toString=(0,_moment2.default)(to).format(TIME_FORMAT);var jobIds=jobs.map(function(j){return j.id});var url=_job_service.mlJobService.createResultsUrl(jobIds,fromString,toString,location);return _chrome2.default.getBasePath()+"/app/"+url}function ResultLinks(_ref){var jobs=_ref.jobs;var tooltipJobs=1===jobs.length?jobs[0].id:jobs.length+" jobs";var singleMetricVisible=jobs.length<2;var singleMetricEnabled=1===jobs.length&&jobs[0].isSingleMetricViewerJob;return _react2.default.createElement(_react2.default.Fragment,null,singleMetricVisible&&_react2.default.createElement(_eui.EuiToolTip,{position:"bottom",content:"Open "+tooltipJobs+" in Single Metric Viewer"},_react2.default.createElement(_eui.EuiButtonIcon,{href:getLink("timeseriesexplorer",jobs),iconType:"stats","aria-label":"View results in single metric viewer",className:"results-button",isDisabled:false===singleMetricEnabled})),_react2.default.createElement(_eui.EuiToolTip,{position:"bottom",content:"Open "+tooltipJobs+" in Anomaly Explorer"},_react2.default.createElement(_eui.EuiButtonIcon,{href:getLink("explorer",jobs),iconType:"tableOfContents","aria-label":"View results in anomaly explorer",className:"results-button"})),_react2.default.createElement("div",{className:"actions-border"}))}ResultLinks.propTypes={jobs:_propTypes2.default.array.isRequired}},3612:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobDescription=JobDescription;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _job_group=__webpack_require__(1411);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function JobDescription(_ref){var job=_ref.job;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement("div",{className:"job-description"},job.description,"  ",job.groups.map(function(group){return _react2.default.createElement(_job_group.JobGroup,{key:group,name:group})})))}JobDescription.propTypes={job:_propTypes2.default.object.isRequired}},3613:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobGroup=JobGroup;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);__webpack_require__(3614);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var COLORS=["#00B3A4","#3185FC","#DB1374","#490092","#E6C220","#BFA180","#F98510","#461A0A","#920000","#666666","#0079A5"];var colorMap={};function JobGroup(_ref){var name=_ref.name;return _react2.default.createElement("div",{className:"inline-group",style:{backgroundColor:tabColor(name)}},name)}JobGroup.propTypes={name:_propTypes2.default.string.isRequired};function tabColor(name){if(void 0===colorMap[name]){var n=stringHash(name);var color=COLORS[n%COLORS.length];colorMap[name]=color;return color}return colorMap[name]}function stringHash(str){var hash=0;var chr="";if(0===str.length)return hash;for(var i=0;i<str.length;i++){chr=str.charCodeAt(i);hash=(hash<<5)-hash+chr;hash|=0}return hash<0?-2*hash:hash}},3614:function(module,exports){},3615:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobIcon=JobIcon;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var INFO="info",WARNING="warning",ERROR="error";function JobIcon(_ref){var message=_ref.message,_ref$showTooltip=_ref.showTooltip,showTooltip=void 0!==_ref$showTooltip&&_ref$showTooltip;if(void 0!==message){var color="primary";var icon="alert";message.level===INFO?color="primary":message.level===WARNING?color="warning":message.level===ERROR&&(color="danger");return showTooltip?_react2.default.createElement(_eui.EuiToolTip,{position:"bottom",content:message.text},_react2.default.createElement(_eui.EuiIcon,{type:icon,color:color})):_react2.default.createElement(_eui.EuiIcon,{type:icon,color:color})}return _react2.default.createElement("span",null)}JobIcon.propTypes={message:_propTypes2.default.object,showTooltip:_propTypes2.default.bool}},3616:function(module,exports){},3617:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _job_details=__webpack_require__(3618);Object.defineProperty(exports,"JobDetails",{enumerable:true,get:function get(){return _job_details.JobDetails}})},3618:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobDetails=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);__webpack_require__(3619);var _extract_job_details=__webpack_require__(3620);var _json_tab=__webpack_require__(3622);var _datafeed_preview_tab=__webpack_require__(3624);var _forecasts_table=__webpack_require__(3625);var _job_details_pane=__webpack_require__(3628);var _job_messages_pane=__webpack_require__(3629);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var JobDetails=exports.JobDetails=function(_Component){_inherits(JobDetails,_Component);function JobDetails(props){_classCallCheck(this,JobDetails);var _this=_possibleConstructorReturn(this,(JobDetails.__proto__||Object.getPrototypeOf(JobDetails)).call(this,props));_this.state={};_this.props.addYourself&&_this.props.addYourself(props.jobId,_this);return _this}_createClass(JobDetails,[{key:"componentWillUnmount",value:function componentWillUnmount(){this.props.removeYourself(this.props.jobId)}},{key:"render",value:function render(){var job=this.state.job;if(void 0===job)return _react2.default.createElement("div",{className:"job-loading-spinner"},_react2.default.createElement(_eui.EuiLoadingSpinner,{size:"l"}));var _extractJobDetails=(0,_extract_job_details.extractJobDetails)(job),general=_extractJobDetails.general,customUrl=_extractJobDetails.customUrl,node=_extractJobDetails.node,detectors=_extractJobDetails.detectors,influencers=_extractJobDetails.influencers,analysisConfig=_extractJobDetails.analysisConfig,analysisLimits=_extractJobDetails.analysisLimits,dataDescription=_extractJobDetails.dataDescription,datafeed=_extractJobDetails.datafeed,counts=_extractJobDetails.counts,modelSizeStats=_extractJobDetails.modelSizeStats;var tabs=[{id:"job-settings",name:"Job settings",content:_react2.default.createElement(_job_details_pane.JobDetailsPane,{sections:[general,customUrl,node]}),time:job.open_time},{id:"job-config",name:"Job config",content:_react2.default.createElement(_job_details_pane.JobDetailsPane,{sections:[detectors,influencers,analysisConfig,analysisLimits,dataDescription]})},{id:"datafeed",name:"Datafeed",content:_react2.default.createElement(_job_details_pane.JobDetailsPane,{sections:[datafeed]})},{id:"counts",name:"Counts",content:_react2.default.createElement(_job_details_pane.JobDetailsPane,{sections:[counts,modelSizeStats]})},{id:"json",name:"JSON",content:_react2.default.createElement(_json_tab.JsonPane,{job:job})},{id:"job-messages",name:"Job messages",content:_react2.default.createElement(_job_messages_pane.JobMessagesPane,{job:job})},{id:"datafeed-preview",name:"Datafeed preview",content:_react2.default.createElement(_datafeed_preview_tab.DatafeedPreviewPane,{job:job})},{id:"forecasts",name:"Forecasts",content:_react2.default.createElement(_forecasts_table.ForecastsTable,{job:job})}];return _react2.default.createElement("div",{className:"tab-contents"},_react2.default.createElement(_eui.EuiTabbedContent,{tabs:tabs,initialSelectedTab:tabs[0],onTabClick:function onTabClick(){}}))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props){var job=props.job,loading=props.loading;return{job:job,loading:loading}}}]);return JobDetails}(_react.Component);JobDetails.propTypes={jobId:_propTypes2.default.string.isRequired,job:_propTypes2.default.object,addYourself:_propTypes2.default.func.isRequired,removeYourself:_propTypes2.default.func.isRequired}},3619:function(module,exports){},3620:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.extractJobDetails=extractJobDetails;var _string_utils=__webpack_require__(40);var _format_values=__webpack_require__(3621);function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function extractJobDetails(job){if(0===Object.keys(job).length)return{};var general={title:"General",position:"left",items:(0,_format_values.filterObjects)(job,true).map(_format_values.formatValues)};var customUrl={title:"Custom URLs",position:"right",items:[]};if(job.custom_settings&&job.custom_settings.custom_urls){var _customUrl$items;(_customUrl$items=customUrl.items).push.apply(_customUrl$items,_toConsumableArray(job.custom_settings.custom_urls.map(function(cu){return[cu.url_name,cu.url_value,cu.time_range]})))}var node={title:"Node",position:"right",items:[]};job.node&&node.items.push(["name",job.node.name]);var detectors={title:"Detectors",position:"left",items:[]};if(job.analysis_config&&job.analysis_config.detectors){var _detectors$items;(_detectors$items=detectors.items).push.apply(_detectors$items,_toConsumableArray(job.analysis_config.detectors.map(function(d){var stringifiedDtr=(0,_string_utils.detectorToString)(d);return[stringifiedDtr,stringifiedDtr!==d.detector_description?d.detector_description:""]})))}var influencers={title:"Influencers",position:"left",items:job.analysis_config.influencers.map(function(i){return["",i]})};var analysisConfig={title:"Analysis config",position:"left",items:(0,_format_values.filterObjects)(job.analysis_config)};var analysisLimits={title:"Analysis limits",position:"left",items:(0,_format_values.filterObjects)(job.analysis_limits)};var dataDescription={title:"Data description",position:"right",items:(0,_format_values.filterObjects)(job.data_description)};var datafeed={title:"Datafeed",position:"left",items:(0,_format_values.filterObjects)(job.datafeed_config,true,true)};job.node&&datafeed.items.push(["node",JSON.stringify(job.node)]);var counts={title:"Counts",position:"left",items:(0,_format_values.filterObjects)(job.data_counts).map(_format_values.formatValues)};var modelSizeStats={title:"Model size stats",position:"right",items:(0,_format_values.filterObjects)(job.model_size_stats).map(_format_values.formatValues)};return{general:general,customUrl:customUrl,node:node,detectors:detectors,influencers:influencers,analysisConfig:analysisConfig,analysisLimits:analysisLimits,dataDescription:dataDescription,datafeed:datafeed,counts:counts,modelSizeStats:modelSizeStats}}},3621:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{!_n&&_i["return"]&&_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();exports.formatValues=formatValues;exports.filterObjects=filterObjects;var _numeral=__webpack_require__(88);var _numeral2=_interopRequireDefault(_numeral);var _format=__webpack_require__(286);var _string_utils=__webpack_require__(40);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var TIME_FORMAT="YYYY-MM-DD HH:mm:ss";var DATA_FORMAT="0.0 b";function formatData(txt){return(0,_numeral2.default)(txt).format(DATA_FORMAT)}function formatValues(_ref){var _ref2=_slicedToArray(_ref,2),key=_ref2[0],value=_ref2[1];switch(key){case"finished_time":case"create_time":case"log_time":case"timestamp":case"earliest_record_timestamp":case"latest_record_timestamp":case"last_data_time":case"latest_empty_bucket_timestamp":case"latest_sparse_bucket_timestamp":value=(0,_format.formatDate)(value,TIME_FORMAT);break;case"established_model_memory":case"input_bytes":case"model_bytes":value=formatData(value);break;case"processed_record_count":case"processed_field_count":case"input_field_count":case"invalid_date_count":case"missing_field_count":case"out_of_order_timestamp_count":case"empty_bucket_count":case"sparse_bucket_count":case"bucket_count":case"input_record_count":case"total_by_field_count":case"total_over_field_count":case"total_partition_field_count":case"bucket_allocation_failures_count":value=(0,_string_utils.toLocaleString)(value)}return[key,value]}function filterObjects(obj,allowArrays,allowObjects){return Object.keys(obj).filter(function(k){return allowObjects||"object"!==_typeof(obj[k])||allowArrays&&Array.isArray(obj[k])}).map(function(k){var item=obj[k];Array.isArray(item)?item=item.join(", "):"object"===_typeof(obj[k])&&(item=JSON.stringify(item));return[k,item]})}},3622:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JsonPane=JsonPane;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _ml_job_editor=__webpack_require__(864);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function JsonPane(_ref){var job=_ref.job;var json=JSON.stringify(job,null,2);return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_ml_job_editor.MLJobEditor,{value:json,readOnly:true}))}JsonPane.propTypes={job:_propTypes2.default.object.isRequired}},3623:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MLJobEditor=MLJobEditor;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function MLJobEditor(_ref){var value=_ref.value,_ref$height=_ref.height,height=void 0===_ref$height?"500px":_ref$height,_ref$width=_ref.width,width=void 0===_ref$width?"100%":_ref$width,_ref$mode=_ref.mode,mode=void 0===_ref$mode?"json":_ref$mode,_ref$readOnly=_ref.readOnly,readOnly=void 0!==_ref$readOnly&&_ref$readOnly,_ref$onChange=_ref.onChange,onChange=void 0===_ref$onChange?function(){}:_ref$onChange;return _react2.default.createElement(_eui.EuiCodeEditor,{value:value,width:width,height:height,mode:mode,readOnly:readOnly,wrapEnabled:true,showPrintMargin:false,editorProps:{$blockScrolling:true},onChange:onChange})}MLJobEditor.propTypes={value:_propTypes2.default.string.isRequired,height:_propTypes2.default.string,width:_propTypes2.default.string,mode:_propTypes2.default.string,readOnly:_propTypes2.default.bool,onChange:_propTypes2.default.func}},3624:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DatafeedPreviewPane=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _job_service=__webpack_require__(24);var _check_privilege=__webpack_require__(35);var _job_utils=__webpack_require__(41);var _ml_job_editor=__webpack_require__(864);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var DatafeedPreviewPane=exports.DatafeedPreviewPane=function(_Component){_inherits(DatafeedPreviewPane,_Component);function DatafeedPreviewPane(props){_classCallCheck(this,DatafeedPreviewPane);var _this=_possibleConstructorReturn(this,(DatafeedPreviewPane.__proto__||Object.getPrototypeOf(DatafeedPreviewPane)).call(this,props));_this.state={previewJson:""};return _this}_createClass(DatafeedPreviewPane,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;updateDatafeedPreview(this.props.job).then(function(previewJson){_this2.setState({previewJson:previewJson})}).catch(function(error){console.log("Datafeed preview could not be loaded",error)})}},{key:"render",value:function render(){return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_ml_job_editor.MLJobEditor,{value:this.state.previewJson,readOnly:true}))}}]);return DatafeedPreviewPane}(_react.Component);DatafeedPreviewPane.propTypes={job:_propTypes2.default.object.isRequired};function updateDatafeedPreview(job){return new Promise(function(resolve,reject){var canPreviewDatafeed=(0,_check_privilege.checkPermission)("canPreviewDatafeed");canPreviewDatafeed&&_job_service.mlJobService.getDatafeedPreview(job.job_id).then(function(resp){if(Array.isArray(resp))resolve(JSON.stringify(resp.slice(0,_job_utils.ML_DATA_PREVIEW_COUNT),null,2));else{resolve("");console.log("Datafeed preview could not be loaded",resp)}}).catch(function(error){reject(error)})})}},3625:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _forecasts_table=__webpack_require__(3626);Object.defineProperty(exports,"ForecastsTable",{enumerable:true,get:function get(){return _forecasts_table.ForecastsTable}})},3626:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ForecastsTable=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _risonNode=__webpack_require__(254);var _risonNode2=_interopRequireDefault(_risonNode);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);__webpack_require__(3627);var _format=__webpack_require__(286);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _states=__webpack_require__(321);var _recently_accessed=__webpack_require__(500);var _forecast_service=__webpack_require__(627);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var MAX_FORECASTS=500;var TIME_FORMAT="YYYY-MM-DD HH:mm:ss";var ForecastsTable=function(_Component){_inherits(ForecastsTable,_Component);function ForecastsTable(props){_classCallCheck(this,ForecastsTable);var _this=_possibleConstructorReturn(this,(ForecastsTable.__proto__||Object.getPrototypeOf(ForecastsTable)).call(this,props));_this.state={isLoading:0!==props.job.data_counts.processed_record_count,forecasts:[]};return _this}_createClass(ForecastsTable,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;var dataCounts=this.props.job.data_counts;dataCounts.processed_record_count>0&&_forecast_service.mlForecastService.getForecastsSummary(this.props.job,null,dataCounts.earliest_record_timestamp,MAX_FORECASTS).then(function(resp){_this2.setState({isLoading:false,forecasts:resp.forecasts})}).catch(function(resp){console.log("Error loading list of forecasts for jobs list:",resp);_this2.setState({isLoading:false,errorMessage:"Error loading the list of forecasts run on this job",forecasts:[]})})}},{key:"openSingleMetricView",value:function openSingleMetricView(forecast){var dataCounts=this.props.job.data_counts;var jobEarliest=dataCounts.earliest_record_timestamp;var from=new Date(dataCounts.earliest_record_timestamp).toISOString();var to=void 0!==forecast?new Date(forecast.forecast_end_timestamp).toISOString():new Date(dataCounts.latest_record_timestamp).toISOString();var _g=_risonNode2.default.encode({ml:{jobIds:[this.props.job.job_id]},refreshInterval:{display:"Off",pause:false,value:0},time:{from:from,to:to,mode:"absolute"}});var appState={filters:[],query:{query_string:{analyze_wildcard:true,query:"*"}}};if(void 0!==forecast){var forecastDurationMs=forecast.forecast_end_timestamp-forecast.forecast_start_timestamp;var zoomFrom=Math.max(forecast.forecast_start_timestamp-forecastDurationMs,jobEarliest);appState.mlTimeSeriesExplorer={forecastId:forecast.forecast_id,zoom:{from:new Date(zoomFrom).toISOString(),to:new Date(forecast.forecast_end_timestamp).toISOString()}}}var _a=_risonNode2.default.encode(appState);var url="?_g="+_g+"&_a="+_a;(0,_recently_accessed.addItemToRecentlyAccessed)("timeseriesexplorer",this.props.job.job_id,url);window.open(_chrome2.default.getBasePath()+"/app/ml#/timeseriesexplorer"+url,"_self")}},{key:"render",value:function render(){var _this3=this;if(true===this.state.isLoading)return _react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceAround"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiLoadingSpinner,{size:"l"})));if(void 0!==this.state.errorMessage)return _react2.default.createElement(_eui.EuiCallOut,{title:this.state.errorMessage,color:"danger",iconType:"cross"});var forecasts=this.state.forecasts;if(0===forecasts.length)return _react2.default.createElement(_eui.EuiCallOut,{title:"No forecasts have been run for this job",iconType:"iInCircle"},_react2.default.createElement("p",null,"To run a forecast, open the ",_react2.default.createElement(_eui.EuiLink,{onClick:function onClick(){return _this3.openSingleMetricView()}},"Single Metric Viewer")));var columns=[{field:"forecast_create_timestamp",name:"Created",dataType:"date",render:function render(date){return(0,_format.formatDate)(date,TIME_FORMAT)},sortable:true},{field:"forecast_start_timestamp",name:"From",dataType:"date",render:function render(date){return(0,_format.formatDate)(date,TIME_FORMAT)},sortable:true},{field:"forecast_end_timestamp",name:"To",dataType:"date",render:function render(date){return(0,_format.formatDate)(date,TIME_FORMAT)},sortable:true},{field:"forecast_status",name:"Status",sortable:true},{field:"forecast_memory_bytes",name:"Memory size",render:function render(bytes){return(0,_format.formatNumber)(bytes,"0b")},sortable:true},{field:"processing_time_ms",name:"Processing time",render:function render(ms){return ms+" ms"},sortable:true},{field:"forecast_expiry_timestamp",name:"Expires",render:function render(date){return(0,_format.formatDate)(date,TIME_FORMAT)},sortable:true},{field:"forecast_messages",name:"Messages",sortable:false,render:function render(messages){return _react2.default.createElement("div",null,messages.map(function(message,index){return _react2.default.createElement("p",{key:index},message)}))}},{name:"View",render:function render(forecast){return _react2.default.createElement(_eui.EuiButton,{onClick:function onClick(){return _this3.openSingleMetricView(forecast)},className:"view-forecast-btn",isDisabled:forecast.forecast_status!==_states.FORECAST_REQUEST_STATE.FINISHED},_react2.default.createElement("i",{"aria-hidden":"true",className:"fa fa-line-chart"}))}}];return _react2.default.createElement(_eui.EuiInMemoryTable,{className:"forecasts-table",items:forecasts,columns:columns,pagination:{pageSizeOptions:[5,10,25]},sorting:true})}}]);return ForecastsTable}(_react.Component);ForecastsTable.propTypes={job:_propTypes2.default.object.isRequired};exports.ForecastsTable=ForecastsTable},3627:function(module,exports){},3628:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobDetailsPane=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function SectionItem(_ref){var item=_ref.item;return _react2.default.createElement(_eui.EuiTableRow,null,""!==item[0]&&_react2.default.createElement(_eui.EuiTableRowCell,null,_react2.default.createElement("span",{className:"job-item header"},item[0])),_react2.default.createElement(_eui.EuiTableRowCell,null,_react2.default.createElement("span",{className:"job-item"},item[1])))}SectionItem.propTypes={item:_propTypes2.default.array.isRequired};function Section(_ref2){var section=_ref2.section;if(0===section.items.length)return _react2.default.createElement("div",null);return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiTitle,{size:"xs"},_react2.default.createElement("h4",null,section.title)),_react2.default.createElement("div",{className:"job-section"},_react2.default.createElement(_eui.EuiTable,{compressed:true},_react2.default.createElement(_eui.EuiTableBody,null,section.items.map(function(item,i){return _react2.default.createElement(SectionItem,{item:item,key:i})})))))}Section.propTypes={section:_propTypes2.default.object.isRequired};var JobDetailsPane=exports.JobDetailsPane=function(_Component){_inherits(JobDetailsPane,_Component);function JobDetailsPane(props){_classCallCheck(this,JobDetailsPane);var _this=_possibleConstructorReturn(this,(JobDetailsPane.__proto__||Object.getPrototypeOf(JobDetailsPane)).call(this,props));_this.state={};return _this}_createClass(JobDetailsPane,[{key:"render",value:function render(){var _state=this.state,sections=_state.sections,time=_state.time;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement("div",{className:"row",time:time},_react2.default.createElement("div",{className:"col-md-6"},sections.filter(function(s){return"left"===s.position}).map(function(s,i){return _react2.default.createElement(Section,{section:s,key:i})})),_react2.default.createElement("div",{className:"col-md-6"},sections.filter(function(s){return"right"===s.position}).map(function(s,i){return _react2.default.createElement(Section,{section:s,key:i})}))))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props){var sections=props.sections,time=props.time;return{sections:sections,time:time}}}]);return JobDetailsPane}(_react.Component);JobDetailsPane.propTypes={sections:_propTypes2.default.array.isRequired}},3629:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobMessagesPane=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _format=__webpack_require__(286);var _ml_api_service=__webpack_require__(23);var _job_message_icon=__webpack_require__(1412);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var TIME_FORMAT="YYYY-MM-DD HH:mm:ss";var JobMessagesPane=exports.JobMessagesPane=function(_Component){_inherits(JobMessagesPane,_Component);function JobMessagesPane(props){_classCallCheck(this,JobMessagesPane);var _this=_possibleConstructorReturn(this,(JobMessagesPane.__proto__||Object.getPrototypeOf(JobMessagesPane)).call(this,props));_this.state={messages:[]};_this.jobId=props.job.job_id;return _this}_createClass(JobMessagesPane,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;_ml_api_service.ml.jobs.jobAuditMessages(this.jobId).then(function(messages){_this2.setState({messages:messages})}).catch(function(error){console.log("Job messages could not be loaded",error)})}},{key:"render",value:function render(){var messages=this.state.messages;var columns=[{name:"",render:function render(item){return _react2.default.createElement(_job_message_icon.JobIcon,{message:item})}},{name:"Time",render:function render(item){return(0,_format.formatDate)(item.timestamp,TIME_FORMAT)}},{field:"node_name",name:"Node"},{field:"message",name:"Message"}];return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement("div",{className:"job-messages-table"},_react2.default.createElement(_eui.EuiBasicTable,{items:messages,columns:columns})))}}]);return JobMessagesPane}(_react.Component);JobMessagesPane.propTypes={job:_propTypes2.default.object.isRequired}},3630:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _job_filter_bar=__webpack_require__(3631);Object.defineProperty(exports,"JobFilterBar",{enumerable:true,get:function get(){return _job_filter_bar.JobFilterBar}})},3631:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobFilterBar=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _ml_api_service=__webpack_require__(23);var _job_group=__webpack_require__(1411);__webpack_require__(3632);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function loadGroups(){return _ml_api_service.ml.jobs.groups().then(function(groups){return groups.map(function(g){return{value:g.id,view:_react2.default.createElement("div",{className:"group-item"},_react2.default.createElement(_job_group.JobGroup,{name:g.id})," ",_react2.default.createElement("span",null,"(",g.jobIds.length," job",1===g.jobIds.length?"":"s",")"))}})}).catch(function(error){console.log(error);return[]})}var JobFilterBar=exports.JobFilterBar=function(_Component){_inherits(JobFilterBar,_Component);function JobFilterBar(props){_classCallCheck(this,JobFilterBar);var _this=_possibleConstructorReturn(this,(JobFilterBar.__proto__||Object.getPrototypeOf(JobFilterBar)).call(this,props));_this.onChange=function(_ref){var query=_ref.query;var clauses=query.ast.clauses;_this.setFilters(clauses)};_this.setFilters=props.setFilters;return _this}_createClass(JobFilterBar,[{key:"render",value:function render(){var filters=[{type:"field_value_toggle_group",field:"job_state",items:[{value:"opened",name:"Opened"},{value:"closed",name:"Closed"},{value:"failed",name:"Failed"}]},{type:"field_value_toggle_group",field:"datafeed_state",items:[{value:"started",name:"Started"},{value:"stopped",name:"Stopped"}]},{type:"field_value_selection",field:"groups",name:"Group",multiSelect:"or",cache:1e4,options:function options(){return loadGroups()}}];return _react2.default.createElement(_eui.EuiSearchBar,{box:{incremental:true},filters:filters,onChange:this.onChange})}}]);return JobFilterBar}(_react.Component);JobFilterBar.propTypes={setFilters:_propTypes2.default.func.isRequired}},3632:function(module,exports){},3633:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _edit_job_flyout=__webpack_require__(3634);Object.defineProperty(exports,"EditJobFlyout",{enumerable:true,get:function get(){return _edit_job_flyout.EditJobFlyout}})},3634:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EditJobFlyout=void 0;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _tabs=__webpack_require__(3635);var _edit_utils=__webpack_require__(1413);var _utils=__webpack_require__(367);var _validate_job=__webpack_require__(3644);var _messagebar_service=__webpack_require__(79);var _notify=__webpack_require__(9);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var EditJobFlyout=exports.EditJobFlyout=function(_Component){_inherits(EditJobFlyout,_Component);function EditJobFlyout(props){_classCallCheck(this,EditJobFlyout);var _this=_possibleConstructorReturn(this,(EditJobFlyout.__proto__||Object.getPrototypeOf(EditJobFlyout)).call(this,props));_this.closeFlyout=function(){_this.setState({isFlyoutVisible:false})};_this.showFlyout=function(jobLite){var hasDatafeed=jobLite.hasDatafeed;(0,_utils.loadFullJob)(jobLite.id).then(function(job){_this.extractJob(job,hasDatafeed);_this.setState({job:job,isFlyoutVisible:true})}).catch(function(error){console.error(error)})};_this.setJobDetails=function(jobDetails){var _this$state=_this.state,jobModelMemoryLimitValidationError=_this$state.jobModelMemoryLimitValidationError,jobGroupsValidationError=_this$state.jobGroupsValidationError;void 0!==jobDetails.jobModelMemoryLimit&&(jobModelMemoryLimitValidationError=(0,_validate_job.validateModelMemoryLimit)(jobDetails.jobModelMemoryLimit).message);void 0!==jobDetails.jobGroups&&(jobGroupsValidationError=jobDetails.jobGroups.some(function(j){return _this.props.allJobIds.includes(j)})?"A job with this ID already exists. Groups and jobs cannot use the same ID.":(0,_validate_job.validateGroupNames)(jobDetails.jobGroups).message);var valid=""===jobModelMemoryLimitValidationError&&""===jobGroupsValidationError;_this.setState(_extends({},jobDetails,{jobModelMemoryLimitValidationError:jobModelMemoryLimitValidationError,jobGroupsValidationError:jobGroupsValidationError,valid:valid}))};_this.setDetectorDescriptions=function(jobDetectorDescriptions){_this.setState(_extends({},jobDetectorDescriptions))};_this.setDatafeed=function(datafeed){_this.setState(_extends({},datafeed))};_this.setCustomUrls=function(jobCustomUrls){_this.setState({jobCustomUrls:jobCustomUrls})};_this.save=function(){var newJobData={description:_this.state.jobDescription,groups:_this.state.jobGroups,mml:_this.state.jobModelMemoryLimit,detectorDescriptions:_this.state.jobDetectorDescriptions,datafeedQuery:_this.state.datafeedQuery,datafeedQueryDelay:_this.state.datafeedQueryDelay,datafeedFrequency:_this.state.datafeedFrequency,datafeedScrollSize:_this.state.datafeedScrollSize,customUrls:_this.state.jobCustomUrls};(0,_edit_utils.saveJob)(_this.state.job,newJobData).then(function(){_notify.toastNotifications.addSuccess("Changes to "+_this.state.job.job_id+" saved");_this.refreshJobs();_this.closeFlyout()}).catch(function(error){console.error(error);_notify.toastNotifications.addDanger("Could not save changes to "+_this.state.job.job_id);_messagebar_service.mlMessageBarService.notify.error(error)})};_this.state={job:{},hasDatafeed:false,isFlyoutVisible:false,jobDescription:"",jobGroups:[],jobModelMemoryLimit:"",jobDetectors:[],jobDetectorDescriptions:[],jobCustomUrls:[],datafeedQuery:"",datafeedQueryDelay:"",datafeedFrequency:"",datafeedScrollSize:"",jobModelMemoryLimitValidationError:"",jobGroupsValidationError:"",valid:true};_this.refreshJobs=_this.props.refreshJobs;return _this}_createClass(EditJobFlyout,[{key:"componentDidMount",value:function componentDidMount(){"function"===typeof this.props.setShowFunction&&this.props.setShowFunction(this.showFlyout)}},{key:"componentWillUnmount",value:function componentWillUnmount(){"function"===typeof this.props.unsetShowFunction&&this.props.unsetShowFunction()}},{key:"extractJob",value:function extractJob(job,hasDatafeed){var mml=job.analysis_limits&&job.analysis_limits.model_memory_limit?job.analysis_limits.model_memory_limit:"";var detectors=job.analysis_config&&job.analysis_config.detectors?job.analysis_config.detectors:"";var bucketSpan=job.analysis_config?job.analysis_config.bucket_span:"";var datafeedConfig=job.datafeed_config;var frequency=void 0!==datafeedConfig.frequency?datafeedConfig.frequency:"";var customUrls=job.custom_settings&&job.custom_settings.custom_urls?job.custom_settings.custom_urls:[];this.setState({job:job,hasDatafeed:hasDatafeed,jobDescription:job.description,jobGroups:void 0!==job.groups?job.groups:[],jobModelMemoryLimit:mml,jobDetectors:detectors,jobDetectorDescriptions:detectors.map(function(d){return d.detector_description}),jobBucketSpan:bucketSpan,jobCustomUrls:customUrls,datafeedQuery:hasDatafeed?JSON.stringify(datafeedConfig.query,null,2):"",datafeedQueryDelay:hasDatafeed?datafeedConfig.query_delay:"",datafeedFrequency:hasDatafeed?frequency:"",datafeedScrollSize:hasDatafeed?+datafeedConfig.scroll_size:"",jobModelMemoryLimitValidationError:"",jobGroupsValidationError:""})}},{key:"render",value:function render(){var flyout=void 0;if(this.state.isFlyoutVisible){var _state=this.state,job=_state.job,jobDescription=_state.jobDescription,jobGroups=_state.jobGroups,jobModelMemoryLimit=_state.jobModelMemoryLimit,jobDetectors=_state.jobDetectors,jobDetectorDescriptions=_state.jobDetectorDescriptions,jobBucketSpan=_state.jobBucketSpan,jobCustomUrls=_state.jobCustomUrls,datafeedQuery=_state.datafeedQuery,datafeedQueryDelay=_state.datafeedQueryDelay,datafeedFrequency=_state.datafeedFrequency,datafeedScrollSize=_state.datafeedScrollSize,jobGroupsValidationError=_state.jobGroupsValidationError,jobModelMemoryLimitValidationError=_state.jobModelMemoryLimitValidationError,valid=_state.valid;var tabs=[{id:"job-details",name:"Job details",content:_react2.default.createElement(_tabs.JobDetails,{jobDescription:jobDescription,jobGroups:jobGroups,jobModelMemoryLimit:jobModelMemoryLimit,setJobDetails:this.setJobDetails,jobGroupsValidationError:jobGroupsValidationError,jobModelMemoryLimitValidationError:jobModelMemoryLimitValidationError})},{id:"detectors",name:"Detectors",content:_react2.default.createElement(_tabs.Detectors,{jobDetectors:jobDetectors,jobDetectorDescriptions:jobDetectorDescriptions,setDetectorDescriptions:this.setDetectorDescriptions})},{id:"datafeed",name:"Datafeed",content:_react2.default.createElement(_tabs.Datafeed,{datafeedQuery:datafeedQuery,datafeedQueryDelay:datafeedQueryDelay,datafeedFrequency:datafeedFrequency,datafeedScrollSize:datafeedScrollSize,jobBucketSpan:jobBucketSpan,setDatafeed:this.setDatafeed})},{id:"custom-urls",name:"Custom URLs",content:_react2.default.createElement(_tabs.CustomUrls,{job:job,jobCustomUrls:jobCustomUrls,setCustomUrls:this.setCustomUrls})}];flyout=_react2.default.createElement(_eui.EuiFlyout,{onClose:this.closeFlyout,size:"m"},_react2.default.createElement(_eui.EuiFlyoutHeader,null,_react2.default.createElement(_eui.EuiTitle,null,_react2.default.createElement("h2",null,"Edit ",job.id))),_react2.default.createElement(_eui.EuiFlyoutBody,null,_react2.default.createElement(_eui.EuiTabbedContent,{tabs:tabs,initialSelectedTab:tabs[0],onTabClick:function onTabClick(){}})),_react2.default.createElement(_eui.EuiFlyoutFooter,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{iconType:"cross",onClick:this.closeFlyout,flush:"left"},"Close")),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{onClick:this.save,fill:true,isDisabled:false===valid},"Save")))))}return _react2.default.createElement("div",null,flyout)}}]);return EditJobFlyout}(_react.Component);EditJobFlyout.propTypes={setShowFunction:_propTypes2.default.func.isRequired,unsetShowFunction:_propTypes2.default.func.isRequired,refreshJobs:_propTypes2.default.func.isRequired,allJobIds:_propTypes2.default.array.isRequired}},3635:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _job_details=__webpack_require__(3636);Object.defineProperty(exports,"JobDetails",{enumerable:true,get:function get(){return _job_details.JobDetails}});var _detectors=__webpack_require__(3637);Object.defineProperty(exports,"Detectors",{enumerable:true,get:function get(){return _detectors.Detectors}});var _datafeed=__webpack_require__(3638);Object.defineProperty(exports,"Datafeed",{enumerable:true,get:function get(){return _datafeed.Datafeed}});var _custom_urls=__webpack_require__(3639);Object.defineProperty(exports,"CustomUrls",{enumerable:true,get:function get(){return _custom_urls.CustomUrls}})},3636:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobDetails=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);__webpack_require__(628);var _ml_api_service=__webpack_require__(23);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var JobDetails=exports.JobDetails=function(_Component){_inherits(JobDetails,_Component);function JobDetails(props){_classCallCheck(this,JobDetails);var _this=_possibleConstructorReturn(this,(JobDetails.__proto__||Object.getPrototypeOf(JobDetails)).call(this,props));_this.onDescriptionChange=function(e){_this.setJobDetails({jobDescription:e.target.value})};_this.onMmlChange=function(e){_this.setJobDetails({jobModelMemoryLimit:e.target.value})};_this.onGroupsChange=function(selectedGroups){_this.setJobDetails({jobGroups:selectedGroups.map(function(g){return g.label})})};_this.onCreateGroup=function(input,flattenedOptions){var normalizedSearchValue=input.trim().toLowerCase();if(!normalizedSearchValue)return;var newGroup={label:input};var groups=_this.state.groups;-1===flattenedOptions.findIndex(function(option){return option.label.trim().toLowerCase()===normalizedSearchValue})&&groups.push(newGroup);var selectedGroups=_this.state.selectedGroups.concat(newGroup);_this.setState({groups:groups},function(){return _this.onGroupsChange(selectedGroups)})};_this.state={description:"",groups:[],selectedGroups:[],mml:"",mmlValidationError:"",groupsValidationError:""};_this.setJobDetails=props.setJobDetails;return _this}_createClass(JobDetails,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;_ml_api_service.ml.jobs.groups().then(function(resp){var groups=resp.map(function(g){return{label:g.id}});_this2.setState({groups:groups})}).catch(function(error){console.error("Could not load groups",error)})}},{key:"render",value:function render(){var _state=this.state,description=_state.description,selectedGroups=_state.selectedGroups,mml=_state.mml,groups=_state.groups,mmlValidationError=_state.mmlValidationError,groupsValidationError=_state.groupsValidationError;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiForm,null,_react2.default.createElement(_eui.EuiFormRow,{label:"Job description"},_react2.default.createElement(_eui.EuiFieldText,{value:description,onChange:this.onDescriptionChange})),_react2.default.createElement(_eui.EuiFormRow,{label:"Job groups",isInvalid:""!==groupsValidationError,error:groupsValidationError},_react2.default.createElement(_eui.EuiComboBox,{placeholder:"Select or create groups",options:groups,selectedOptions:selectedGroups,onChange:this.onGroupsChange,onCreateOption:this.onCreateGroup,isClearable:true,isInvalid:""!==groupsValidationError,error:groupsValidationError})),_react2.default.createElement(_eui.EuiFormRow,{label:"Model memory limit",isInvalid:""!==mmlValidationError,error:mmlValidationError},_react2.default.createElement(_eui.EuiFieldText,{value:mml,onChange:this.onMmlChange,isInvalid:""!==mmlValidationError,error:mmlValidationError}))))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props){var selectedGroups=void 0!==props.jobGroups?props.jobGroups.map(function(g){return{label:g}}):[];return{description:props.jobDescription,selectedGroups:selectedGroups,mml:props.jobModelMemoryLimit,mmlValidationError:props.jobModelMemoryLimitValidationError,groupsValidationError:props.jobGroupsValidationError}}}]);return JobDetails}(_react.Component);JobDetails.propTypes={jobDescription:_propTypes2.default.string.isRequired,jobGroups:_propTypes2.default.array.isRequired,jobModelMemoryLimit:_propTypes2.default.string.isRequired,setJobDetails:_propTypes2.default.func.isRequired}},3637:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Detectors=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);__webpack_require__(628);var _job_service=__webpack_require__(24);var _string_utils=__webpack_require__(40);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var Detectors=exports.Detectors=function(_Component){_inherits(Detectors,_Component);function Detectors(props){_classCallCheck(this,Detectors);var _this=_possibleConstructorReturn(this,(Detectors.__proto__||Object.getPrototypeOf(Detectors)).call(this,props));_this.onDescriptionChange=function(e,i){var jobDetectorDescriptions=_this.state.detectorDescriptions;jobDetectorDescriptions[i]=e.target.value;_this.setDetectorDescriptions({jobDetectorDescriptions:jobDetectorDescriptions})};_this.detectors=_job_service.mlJobService.getJobGroups().map(function(g){return{label:g.id}});_this.state={detectors:[],detectorDescriptions:[]};_this.setDetectorDescriptions=props.setDetectorDescriptions;return _this}_createClass(Detectors,[{key:"render",value:function render(){var _this2=this;var _state=this.state,detectors=_state.detectors,detectorDescriptions=_state.detectorDescriptions;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiForm,null,detectorDescriptions.map(function(d,i){return _react2.default.createElement(_eui.EuiFormRow,{label:(0,_string_utils.detectorToString)(detectors[i]),key:i},_react2.default.createElement(_eui.EuiFieldText,{value:d,onChange:function onChange(e){return _this2.onDescriptionChange(e,i)}}))})))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props){return{detectors:props.jobDetectors,detectorDescriptions:props.jobDetectorDescriptions}}}]);return Detectors}(_react.Component);Detectors.propTypes={jobDetectors:_propTypes2.default.array.isRequired,jobDetectorDescriptions:_propTypes2.default.array.isRequired,setDetectorDescriptions:_propTypes2.default.func.isRequired}},3638:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Datafeed=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);__webpack_require__(628);var _job_utils=__webpack_require__(41);var _new_job_defaults=__webpack_require__(253);var _parse_interval=__webpack_require__(127);var _ml_job_editor=__webpack_require__(864);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function getDefaults(bucketSpan,jobDefaults){var bucketSpanSeconds=void 0!==bucketSpan?(0,_parse_interval.parseInterval)(bucketSpan).asSeconds():"";return{queryDelay:"60s",frequency:(0,_job_utils.calculateDatafeedFrequencyDefaultSeconds)(bucketSpanSeconds)+"s",scrollSize:jobDefaults.datafeeds.scroll_size}}var Datafeed=exports.Datafeed=function(_Component){_inherits(Datafeed,_Component);function Datafeed(props){_classCallCheck(this,Datafeed);var _this=_possibleConstructorReturn(this,(Datafeed.__proto__||Object.getPrototypeOf(Datafeed)).call(this,props));_this.onQueryChange=function(query){_this.setDatafeed({datafeedQuery:query})};_this.onQueryDelayChange=function(e){_this.setDatafeed({datafeedQueryDelay:e.target.value})};_this.onFrequencyChange=function(e){_this.setDatafeed({datafeedFrequency:e.target.value})};_this.onScrollSizeChange=function(e){_this.setDatafeed({datafeedScrollSize:+e.target.value})};_this.state={query:"",queryDelay:"",frequency:"",scrollSize:"",defaults:{queryDelay:"",frequency:"",scrollSize:0},jobDefaults:(0,_new_job_defaults.newJobDefaults)()};_this.setDatafeed=props.setDatafeed;return _this}_createClass(Datafeed,[{key:"render",value:function render(){var _state=this.state,query=_state.query,queryDelay=_state.queryDelay,frequency=_state.frequency,scrollSize=_state.scrollSize,defaults=_state.defaults;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiForm,null,_react2.default.createElement(_eui.EuiFormRow,{label:"Query",style:{maxWidth:"inherit"}},_react2.default.createElement(_ml_job_editor.MLJobEditor,{value:query,onChange:this.onQueryChange,height:"200px"})),_react2.default.createElement(_eui.EuiFormRow,{label:"Query delay"},_react2.default.createElement(_eui.EuiFieldText,{value:queryDelay,placeholder:defaults.queryDelay,onChange:this.onQueryDelayChange})),_react2.default.createElement(_eui.EuiFormRow,{label:"Frequency"},_react2.default.createElement(_eui.EuiFieldText,{value:frequency,placeholder:defaults.frequency,onChange:this.onFrequencyChange})),_react2.default.createElement(_eui.EuiFormRow,{label:"Scroll size"},_react2.default.createElement(_eui.EuiFieldNumber,{value:scrollSize,placeholder:defaults.scrollSize,onChange:this.onScrollSizeChange}))))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props,state){return{query:props.datafeedQuery,queryDelay:props.datafeedQueryDelay,frequency:props.datafeedFrequency,scrollSize:props.datafeedScrollSize,defaults:getDefaults(props.jobBucketSpan,state.jobDefaults)}}}]);return Datafeed}(_react.Component);Datafeed.propTypes={datafeedQuery:_propTypes2.default.string.isRequired,datafeedQueryDelay:_propTypes2.default.string.isRequired,datafeedFrequency:_propTypes2.default.string.isRequired,datafeedScrollSize:_propTypes2.default.number.isRequired,jobBucketSpan:_propTypes2.default.string.isRequired,setDatafeed:_propTypes2.default.func.isRequired}},3639:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CustomUrls=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _notify=__webpack_require__(9);var _custom_url_editor=__webpack_require__(3640);var _utils=__webpack_require__(865);var _edit_utils=__webpack_require__(1413);__webpack_require__(628);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var MAX_NUMBER_DASHBOARDS=1e3;var MAX_NUMBER_INDEX_PATTERNS=1e3;var CustomUrls=exports.CustomUrls=function(_Component){_inherits(CustomUrls,_Component);function CustomUrls(props){_classCallCheck(this,CustomUrls);var _this=_possibleConstructorReturn(this,(CustomUrls.__proto__||Object.getPrototypeOf(CustomUrls)).call(this,props));_this.editNewCustomUrl=function(){_this.setState(function(prevState){var dashboards=prevState.dashboards,indexPatterns=prevState.indexPatterns;return{editorOpen:true,editorSettings:(0,_utils.getNewCustomUrlDefaults)(_this.props.job,dashboards,indexPatterns)}})};_this.setEditCustomUrl=function(customUrl){_this.setState({editorSettings:customUrl})};_this.addNewCustomUrl=function(){(0,_utils.buildCustomUrlFromSettings)(_this.state.editorSettings,_this.props.job).then(function(customUrl){var customUrls=[].concat(_toConsumableArray(_this.state.customUrls),[customUrl]);_this.setCustomUrls(customUrls);_this.setState({editorOpen:false})}).catch(function(resp){console.log("Error building custom URL from settings:",resp);_notify.toastNotifications.addDanger("An error occurred building the new custom URL from the supplied settings")})};_this.state={customUrls:[],dashboards:[],indexPatterns:[],queryEntityFieldNames:[],editorOpen:false};_this.setCustomUrls=props.setCustomUrls;_this.angularApply=props.angularApply;return _this}_createClass(CustomUrls,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;(0,_edit_utils.loadSavedDashboards)(MAX_NUMBER_DASHBOARDS).then(function(dashboards){_this2.setState({dashboards:dashboards})}).catch(function(resp){console.log("Error loading list of dashboards:",resp);_notify.toastNotifications.addDanger("An error occurred loading the list of saved Kibana dashboards")});(0,_edit_utils.loadIndexPatterns)(MAX_NUMBER_INDEX_PATTERNS).then(function(indexPatterns){_this2.setState({indexPatterns:indexPatterns})}).catch(function(resp){console.log("Error loading list of dashboards:",resp);_notify.toastNotifications.addDanger("An error occurred loading the list of saved index patterns")})}},{key:"render",value:function render(){var _this3=this;var _state=this.state,customUrls=_state.customUrls,editorOpen=_state.editorOpen,editorSettings=_state.editorSettings,dashboards=_state.dashboards,indexPatterns=_state.indexPatterns,queryEntityFieldNames=_state.queryEntityFieldNames;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_custom_url_editor.CustomUrlList,{job:this.props.job,customUrls:customUrls,setCustomUrls:this.setCustomUrls}),false===editorOpen?_react2.default.createElement(_eui.EuiButtonEmpty,{onClick:function onClick(){return _this3.editNewCustomUrl()}},"Add custom URL"):_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"l"}),_react2.default.createElement(_eui.EuiPanel,{className:"ml-custom-url-editor"},_react2.default.createElement(_custom_url_editor.CustomUrlEditor,{customUrl:editorSettings,setEditCustomUrl:this.setEditCustomUrl,dashboards:dashboards,indexPatterns:indexPatterns,queryEntityFieldNames:queryEntityFieldNames}),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiButton,{onClick:function onClick(){return _this3.addNewCustomUrl()},isDisabled:!(0,_utils.isValidCustomUrlSettings)(editorSettings)},"Add"))))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(props){return{job:props.job,customUrls:props.jobCustomUrls,queryEntityFieldNames:(0,_utils.getQueryEntityFieldNames)(props.job)}}}]);return CustomUrls}(_react.Component);CustomUrls.propTypes={job:_propTypes2.default.object.isRequired,jobCustomUrls:_propTypes2.default.array.isRequired,setCustomUrls:_propTypes2.default.func.isRequired}},3640:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _list=__webpack_require__(3641);Object.defineProperty(exports,"CustomUrlList",{enumerable:true,get:function get(){return _list.CustomUrlList}});var _editor=__webpack_require__(3642);Object.defineProperty(exports,"CustomUrlEditor",{enumerable:true,get:function get(){return _editor.CustomUrlEditor}})},3641:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};exports.CustomUrlList=CustomUrlList;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _notify=__webpack_require__(9);var _utils=__webpack_require__(865);var _parse_interval=__webpack_require__(127);var _constants=__webpack_require__(866);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function onLabelChange(e,index,customUrls,setCustomUrls){if(index<customUrls.length){customUrls[index]=_extends({},customUrls[index],{url_name:e.target.value});setCustomUrls(customUrls)}}function onUrlValueChange(e,index,customUrls,setCustomUrls){if(index<customUrls.length){customUrls[index]=_extends({},customUrls[index],{url_value:e.target.value});setCustomUrls(customUrls)}}function onTimeRangeChange(e,index,customUrls,setCustomUrls){if(index<customUrls.length){customUrls[index]=_extends({},customUrls[index],{time_range:e.target.value});setCustomUrls(customUrls)}}function onDeleteButtonClick(index,customUrls,setCustomUrls){if(index<customUrls.length){customUrls.splice(index,1);setCustomUrls(customUrls)}}function onTestButtonClick(index,customUrls,job){index<customUrls.length&&(0,_utils.getTestUrl)(job,customUrls[index]).then(function(testUrl){window.open(testUrl,"_blank")}).catch(function(resp){console.log("onTestButtonClick() - error obtaining URL for test:",resp);_notify.toastNotifications.addDanger("An error occurred obtaining the URL to test the configuration")})}function isValidTimeRange(timeRange){if(void 0===timeRange||0===timeRange.length||timeRange===_constants.TIME_RANGE_TYPE.AUTO)return true;var interval=(0,_parse_interval.parseInterval)(timeRange);return null!==interval}function CustomUrlList(_ref){var job=_ref.job,customUrls=_ref.customUrls,setCustomUrls=_ref.setCustomUrls;var customUrlRows=customUrls.map(function(customUrl,index){var timeRange=customUrl.time_range;var isInvalidTimeRange=!isValidTimeRange(timeRange);var invalidIntervalError=true===isInvalidTimeRange?["Invalid format"]:[];return _react2.default.createElement(_eui.EuiFlexGroup,{key:"url_"+index},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFormRow,{label:"Label"},_react2.default.createElement(_eui.EuiFieldText,{value:customUrl.url_name,onChange:function onChange(e){return onLabelChange(e,index,customUrls,setCustomUrls)}}))),_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiFormRow,{label:"URL"},_react2.default.createElement(_eui.EuiFieldText,{value:customUrl.url_value,onChange:function onChange(e){return onUrlValueChange(e,index,customUrls,setCustomUrls)}}))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFormRow,{label:"Time range",error:invalidIntervalError,isInvalid:isInvalidTimeRange},_react2.default.createElement(_eui.EuiFieldText,{value:customUrl.time_range,isInvalid:isInvalidTimeRange,placeholder:_constants.TIME_RANGE_TYPE.AUTO,onChange:function onChange(e){return onTimeRangeChange(e,index,customUrls,setCustomUrls)}}))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFormRow,{hasEmptyLabelSpace:true},_react2.default.createElement(_eui.EuiToolTip,{content:"Test custom URL"},_react2.default.createElement(_eui.EuiButtonIcon,{size:"s",color:"primary",onClick:function onClick(){return onTestButtonClick(index,customUrls,job)},iconType:"popout","aria-label":"Test custom URL"})))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFormRow,{hasEmptyLabelSpace:true},_react2.default.createElement(_eui.EuiToolTip,{content:"Delete custom URL"},_react2.default.createElement(_eui.EuiButtonIcon,{size:"s",color:"danger",onClick:function onClick(){return onDeleteButtonClick(index,customUrls,setCustomUrls)},iconType:"trash","aria-label":"Delete custom URL"})))))});return _react2.default.createElement(_react2.default.Fragment,null,customUrlRows)}CustomUrlList.propTypes={job:_propTypes2.default.object.isRequired,customUrls:_propTypes2.default.array.isRequired,setCustomUrls:_propTypes2.default.func.isRequired}},3642:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};exports.CustomUrlEditor=CustomUrlEditor;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _utils=__webpack_require__(865);__webpack_require__(3643);var _constants=__webpack_require__(866);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getLinkToOptions(){return[{id:_constants.URL_TYPE.KIBANA_DASHBOARD,label:"Kibana dashboard"},{id:_constants.URL_TYPE.KIBANA_DISCOVER,label:"Discover"},{id:_constants.URL_TYPE.OTHER,label:"Other"}]}function onLabelChange(e,customUrl,setEditCustomUrl){setEditCustomUrl(_extends({},customUrl,{label:e.target.value}))}function onTypeChange(linkType,customUrl,setEditCustomUrl){setEditCustomUrl(_extends({},customUrl,{type:linkType}))}function onDashboardChange(e,customUrl,setEditCustomUrl){var kibanaSettings=customUrl.kibanaSettings;setEditCustomUrl(_extends({},customUrl,{kibanaSettings:_extends({},kibanaSettings,{dashboardId:e.target.value})}))}function onDiscoverIndexPatternChange(e,customUrl,setEditCustomUrl){var kibanaSettings=customUrl.kibanaSettings;setEditCustomUrl(_extends({},customUrl,{kibanaSettings:_extends({},kibanaSettings,{discoverIndexPatternId:e.target.value})}))}function onQueryEntitiesChange(selectedOptions,customUrl,setEditCustomUrl){var selectedFieldNames=selectedOptions.map(function(option){return option.label});var kibanaSettings=customUrl.kibanaSettings;setEditCustomUrl(_extends({},customUrl,{kibanaSettings:_extends({},kibanaSettings,{queryFieldNames:selectedFieldNames})}))}function onOtherUrlValueChange(e,customUrl,setEditCustomUrl){setEditCustomUrl(_extends({},customUrl,{otherUrlSettings:{urlValue:e.target.value}}))}function onTimeRangeTypeChange(e,customUrl,setEditCustomUrl){var timeRange=customUrl.timeRange;setEditCustomUrl(_extends({},customUrl,{timeRange:_extends({},timeRange,{type:e.target.value})}))}function onTimeRangeIntervalChange(e,customUrl,setEditCustomUrl){var timeRange=customUrl.timeRange;setEditCustomUrl(_extends({},customUrl,{timeRange:_extends({},timeRange,{interval:e.target.value})}))}function CustomUrlEditor(_ref){var customUrl=_ref.customUrl,setEditCustomUrl=_ref.setEditCustomUrl,dashboards=_ref.dashboards,indexPatterns=_ref.indexPatterns,queryEntityFieldNames=_ref.queryEntityFieldNames;if(void 0===customUrl)return;var label=customUrl.label,type=customUrl.type,timeRange=customUrl.timeRange,kibanaSettings=customUrl.kibanaSettings,otherUrlSettings=customUrl.otherUrlSettings;var dashboardOptions=dashboards.map(function(dashboard){return{value:dashboard.id,text:dashboard.title}});var indexPatternOptions=indexPatterns.map(function(indexPattern){return{value:indexPattern.id,text:indexPattern.title}});var entityOptions=queryEntityFieldNames.map(function(fieldName){return{label:fieldName}});var queryFieldNames=kibanaSettings.queryFieldNames;var selectedEntityOptions=[];void 0!==queryFieldNames&&(selectedEntityOptions=queryFieldNames.map(function(fieldName){return{label:fieldName}}));var timeRangeOptions=Object.keys(_constants.TIME_RANGE_TYPE).map(function(timeRangeType){return{value:_constants.TIME_RANGE_TYPE[timeRangeType],text:_constants.TIME_RANGE_TYPE[timeRangeType]}});var isInvalidTimeRange=!(0,_utils.isValidCustomUrlSettingsTimeRange)(timeRange);var invalidIntervalError=true===isInvalidTimeRange?["Invalid interval format"]:[];return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiTitle,{size:"xs"},_react2.default.createElement("h4",null,"Create new custom URL")),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiForm,null,_react2.default.createElement(_eui.EuiFormRow,{label:"Label",className:"url-label",compressed:true},_react2.default.createElement(_eui.EuiFieldText,{value:label,onChange:function onChange(e){return onLabelChange(e,customUrl,setEditCustomUrl)},isInvalid:!(0,_utils.isValidCustomUrlLabel)(label),compressed:true})),_react2.default.createElement(_eui.EuiFormRow,{label:"Link to",compressed:true},_react2.default.createElement(_eui.EuiRadioGroup,{options:getLinkToOptions(),idSelected:type,onChange:function onChange(linkType){return onTypeChange(linkType,customUrl,setEditCustomUrl)},className:"url-link-to-radio"})),type===_constants.URL_TYPE.KIBANA_DASHBOARD&&_react2.default.createElement(_eui.EuiFormRow,{label:"Dashboard name",compressed:true},_react2.default.createElement(_eui.EuiSelect,{options:dashboardOptions,value:kibanaSettings.dashboardId,onChange:function onChange(e){return onDashboardChange(e,customUrl,setEditCustomUrl)},compressed:true})),type===_constants.URL_TYPE.KIBANA_DISCOVER&&_react2.default.createElement(_eui.EuiFormRow,{label:"Index pattern",compressed:true},_react2.default.createElement(_eui.EuiSelect,{options:indexPatternOptions,value:kibanaSettings.discoverIndexPatternId,onChange:function onChange(e){return onDiscoverIndexPatternChange(e,customUrl,setEditCustomUrl)},compressed:true})),(type===_constants.URL_TYPE.KIBANA_DASHBOARD||type===_constants.URL_TYPE.KIBANA_DISCOVER)&&entityOptions.length>0&&_react2.default.createElement(_eui.EuiFormRow,{label:"Query entities"},_react2.default.createElement(_eui.EuiComboBox,{placeholder:"Select entities",options:entityOptions,selectedOptions:selectedEntityOptions,onChange:function onChange(e){return onQueryEntitiesChange(e,customUrl,setEditCustomUrl)},isClearable:true})),(type===_constants.URL_TYPE.KIBANA_DASHBOARD||type===_constants.URL_TYPE.KIBANA_DISCOVER)&&_react2.default.createElement(_eui.EuiFlexGroup,null,_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFormRow,{label:"Time range",className:"url-time-range",compressed:true},_react2.default.createElement(_eui.EuiSelect,{options:timeRangeOptions,value:timeRange.type,onChange:function onChange(e){return onTimeRangeTypeChange(e,customUrl,setEditCustomUrl)},compressed:true}))),timeRange.type===_constants.TIME_RANGE_TYPE.INTERVAL&&_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiFormRow,{label:"Interval",className:"url-time-range",error:invalidIntervalError,isInvalid:isInvalidTimeRange,compressed:true},_react2.default.createElement(_eui.EuiFieldText,{value:timeRange.interval,onChange:function onChange(e){return onTimeRangeIntervalChange(e,customUrl,setEditCustomUrl)},isInvalid:isInvalidTimeRange,compressed:true})))),type===_constants.URL_TYPE.OTHER&&_react2.default.createElement(_eui.EuiFormRow,{label:"URL",compressed:true,fullWidth:true},_react2.default.createElement(_eui.EuiTextArea,{fullWidth:true,rows:2,value:otherUrlSettings.urlValue,onChange:function onChange(e){return onOtherUrlValueChange(e,customUrl,setEditCustomUrl)},compressed:true}))))}CustomUrlEditor.propTypes={customUrl:_propTypes2.default.object,setEditCustomUrl:_propTypes2.default.func.isRequired,dashboards:_propTypes2.default.array.isRequired,indexPatterns:_propTypes2.default.array.isRequired,queryEntityFieldNames:_propTypes2.default.array.isRequired}},3643:function(module,exports){},3644:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.validateModelMemoryLimit=validateModelMemoryLimit;exports.validateGroupNames=validateGroupNames;var _new_job_defaults=__webpack_require__(253);var _validate_job=__webpack_require__(629);var _job_utils=__webpack_require__(41);function validateModelMemoryLimit(mml){var limits=(0,_new_job_defaults.newJobLimits)();var tempJob={analysis_limits:{model_memory_limit:mml}};var validationResults=(0,_job_utils.validateModelMemoryLimit)(tempJob,limits);var valid=validationResults.valid;var modelMemoryLimit={valid:valid,message:""};(0,_validate_job.populateValidationMessages)(validationResults,{modelMemoryLimit:modelMemoryLimit});return modelMemoryLimit}function validateGroupNames(groups){var tempJob={groups:groups};var validationResults=(0,_job_utils.validateGroupNames)(tempJob);var valid=validationResults.valid;var groupIds={valid:valid,message:""};(0,_validate_job.populateValidationMessages)(validationResults,{groupIds:groupIds});return groupIds}},3645:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _delete_job_modal=__webpack_require__(3646);Object.defineProperty(exports,"DeleteJobModal",{enumerable:true,get:function get(){return _delete_job_modal.DeleteJobModal}})},3646:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DeleteJobModal=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _utils=__webpack_require__(367);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var DeleteJobModal=exports.DeleteJobModal=function(_Component){_inherits(DeleteJobModal,_Component);function DeleteJobModal(props){_classCallCheck(this,DeleteJobModal);var _this=_possibleConstructorReturn(this,(DeleteJobModal.__proto__||Object.getPrototypeOf(DeleteJobModal)).call(this,props));_this.closeModal=function(){_this.setState({isModalVisible:false})};_this.showModal=function(jobs){_this.setState({jobs:jobs,isModalVisible:true,deleting:false})};_this.deleteJob=function(){_this.setState({deleting:true});(0,_utils.deleteJobs)(_this.state.jobs,function(){_this.refreshJobs();_this.closeModal()})};_this.setEL=function(el){el&&(_this.el=el)};_this.state={jobs:[],isModalVisible:false,deleting:false};_this.refreshJobs=_this.props.refreshJobs;return _this}_createClass(DeleteJobModal,[{key:"componentDidMount",value:function componentDidMount(){"function"===typeof this.props.setShowFunction&&this.props.setShowFunction(this.showModal)}},{key:"componentWillUnmount",value:function componentWillUnmount(){"function"===typeof this.props.unsetShowFunction&&this.props.unsetShowFunction()}},{key:"render",value:function render(){var modal=void 0;if(this.state.isModalVisible){if(this.el&&true===this.state.deleting){this.el.confirmButton.style.display="none";this.el.cancelButton.textContent="Close"}var title="Delete "+(this.state.jobs.length>1?this.state.jobs.length+" jobs":this.state.jobs[0].id);modal=_react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_eui.EuiConfirmModal,{ref:this.setEL,title:title,onCancel:this.closeModal,onConfirm:this.deleteJob,cancelButtonText:"Cancel",confirmButtonText:"Delete",buttonColor:"danger",defaultFocusedButton:_eui.EUI_MODAL_CONFIRM_BUTTON,className:"eui-textBreakWord"},true===this.state.deleting&&_react2.default.createElement("div",null,"Deleting jobs",_react2.default.createElement(_eui.EuiSpacer,null),_react2.default.createElement("div",{style:{textAlign:"center"}},_react2.default.createElement(_eui.EuiLoadingSpinner,{size:"l"}))),false===this.state.deleting&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement("p",null,"Are you sure you want to delete ",this.state.jobs.length>1?"these jobs":"this job","?"),this.state.jobs.length>1&&_react2.default.createElement("p",null,"Deleting multiple jobs can be time consuming. They will be deleted in the background and may not disappear from the jobs list instantly"))))}return _react2.default.createElement("div",null,modal)}}]);return DeleteJobModal}(_react.Component);DeleteJobModal.propTypes={setShowFunction:_propTypes2.default.func.isRequired,unsetShowFunction:_propTypes2.default.func.isRequired,refreshJobs:_propTypes2.default.func.isRequired}},3647:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _start_datafeed_modal=__webpack_require__(3648);Object.defineProperty(exports,"StartDatafeedModal",{enumerable:true,get:function get(){return _start_datafeed_modal.StartDatafeedModal}})},3648:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.StartDatafeedModal=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _utils=__webpack_require__(367);var _time_range_selector=__webpack_require__(3649);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var StartDatafeedModal=exports.StartDatafeedModal=function(_Component){_inherits(StartDatafeedModal,_Component);function StartDatafeedModal(props){_classCallCheck(this,StartDatafeedModal);var _this=_possibleConstructorReturn(this,(StartDatafeedModal.__proto__||Object.getPrototypeOf(StartDatafeedModal)).call(this,props));_initialiseProps.call(_this);var now=(0,_moment2.default)();_this.state={jobs:_this.props.jobs,isModalVisible:false,startTime:now,endTime:now,createWatch:false,allowCreateWatch:false,initialSpecifiedStartTime:now,now:now};_this.initialSpecifiedStartTime=now;_this.refreshJobs=_this.props.refreshJobs;_this.getShowCreateWatchFlyoutFunction=_this.props.getShowCreateWatchFlyoutFunction;return _this}_createClass(StartDatafeedModal,[{key:"componentDidMount",value:function componentDidMount(){"function"===typeof this.props.setShowFunction&&this.props.setShowFunction(this.showModal)}},{key:"componentWillUnmount",value:function componentWillUnmount(){"function"===typeof this.props.unsetShowFunction&&this.props.unsetShowFunction()}},{key:"render",value:function render(){var _state=this.state,jobs=_state.jobs,initialSpecifiedStartTime=_state.initialSpecifiedStartTime,startTime=_state.startTime,endTime=_state.endTime,createWatch=_state.createWatch,now=_state.now;var startableJobs=void 0!==jobs?jobs.filter(function(j){return j.hasDatafeed}):[];var startDisabled=void 0!==startTime&&startTime===endTime;var modal=void 0;this.state.isModalVisible&&(modal=_react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_eui.EuiModal,{onClose:this.closeModal,style:{width:"850px"}},_react2.default.createElement(_eui.EuiModalHeader,null,_react2.default.createElement(_eui.EuiModalHeaderTitle,null,"Start ",startableJobs.length>1?startableJobs.length+" jobs":startableJobs[0].id)),_react2.default.createElement(_eui.EuiModalBody,null,_react2.default.createElement(_time_range_selector.TimeRangeSelector,{startTime:void 0===startTime?initialSpecifiedStartTime:startTime,endTime:endTime,setStartTime:this.setStartTime,setEndTime:this.setEndTime,now:now}),void 0===this.state.endTime&&_react2.default.createElement("div",{className:"create-watch"},_react2.default.createElement(_eui.EuiHorizontalRule,null),_react2.default.createElement(_eui.EuiCheckbox,{id:"createWatch",label:"Create watch after datafeed has started",checked:createWatch,onChange:this.setCreateWatch}))),_react2.default.createElement(_eui.EuiModalFooter,null,_react2.default.createElement(_eui.EuiButtonEmpty,{onClick:this.closeModal},"Cancel"),_react2.default.createElement(_eui.EuiButton,{onClick:this.save,isDisabled:startDisabled,fill:true},"Start")))));return _react2.default.createElement("div",null,modal)}}]);return StartDatafeedModal}(_react.Component);var _initialiseProps=function _initialiseProps(){var _this2=this;this.setStartTime=function(time){_this2.setState({startTime:time})};this.setEndTime=function(time){_this2.setState({endTime:time})};this.setCreateWatch=function(e){_this2.setState({createWatch:e.target.checked})};this.closeModal=function(){_this2.setState({isModalVisible:false})};this.showModal=function(jobs,showCreateWatchFlyout){var startTime=void 0;var now=(0,_moment2.default)();var endTime=now;var initialSpecifiedStartTime=getLowestLatestTime(jobs);var allowCreateWatch=1===jobs.length;_this2.setState({jobs:jobs,isModalVisible:true,startTime:startTime,endTime:endTime,initialSpecifiedStartTime:initialSpecifiedStartTime,showCreateWatchFlyout:showCreateWatchFlyout,allowCreateWatch:allowCreateWatch,createWatch:false,now:now})};this.save=function(){var jobs=_this2.state.jobs;var start=_moment2.default.isMoment(_this2.state.startTime)?_this2.state.startTime.valueOf():_this2.state.startTime;var end=_moment2.default.isMoment(_this2.state.endTime)?_this2.state.endTime.valueOf():_this2.state.endTime;(0,_utils.forceStartDatafeeds)(jobs,start,end,function(){if(_this2.state.createWatch&&1===jobs.length){var jobId=jobs[0].id;_this2.getShowCreateWatchFlyoutFunction()(jobId)}_this2.refreshJobs()});_this2.closeModal()}};StartDatafeedModal.propTypes={setShowFunction:_propTypes2.default.func.isRequired,unsetShowFunction:_propTypes2.default.func.isRequired,refreshJobs:_propTypes2.default.func.isRequired};function getLowestLatestTime(jobs){var times=jobs.map(function(j){return j.latestTimeStampSortValue});return(0,_moment2.default)(Math.min.apply(Math,_toConsumableArray(times)))}},3649:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _time_range_selector=__webpack_require__(3650);Object.defineProperty(exports,"TimeRangeSelector",{enumerable:true,get:function get(){return _time_range_selector.TimeRangeSelector}})},3650:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TimeRangeSelector=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);__webpack_require__(3651);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var TIME_FORMAT="YYYY-MM-DD HH:mm:ss";var TimeRangeSelector=exports.TimeRangeSelector=function(_Component){_inherits(TimeRangeSelector,_Component);function TimeRangeSelector(props){_classCallCheck(this,TimeRangeSelector);var _this=_possibleConstructorReturn(this,(TimeRangeSelector.__proto__||Object.getPrototypeOf(TimeRangeSelector)).call(this,props));_this.setStartTab=function(tab){_this.setState({startTab:tab});switch(tab){case 0:_this.setStartTime(void 0);break;case 1:_this.setStartTime(_this.now)}};_this.setEndTab=function(tab){_this.setState({endTab:tab});switch(tab){case 0:_this.setEndTime(void 0);break;case 1:_this.setEndTime(_this.now)}};_this.setStartTime=function(time){_this.props.setStartTime(time)};_this.setEndTime=function(time){_this.props.setEndTime(time)};_this.state={startTab:0,endTab:1};_this.latestTimeStamp=_this.props.startTime;_this.now=_this.props.now;return _this}_createClass(TimeRangeSelector,[{key:"getTabItems",value:function getTabItems(){var datePickerTimes={start:_moment2.default.isMoment(this.props.startTime)?this.props.startTime:this.latestTimeStamp,end:_moment2.default.isMoment(this.props.endTime)?this.props.endTime:this.now};var formattedStartTime=this.latestTimeStamp.format(TIME_FORMAT);var startItems=[{index:0,label:"Continue from "+formattedStartTime},{index:1,label:"Continue from now"},{index:2,label:"Continue from specified time",body:_react2.default.createElement(_eui.EuiDatePicker,{selected:datePickerTimes.start,onChange:this.setStartTime,maxDate:datePickerTimes.end,inline:true,showTimeSelect:true})}];var endItems=[{index:0,label:"No end time (Real-time search)"},{index:1,label:"Specify end time",body:_react2.default.createElement(_eui.EuiDatePicker,{selected:datePickerTimes.end,onChange:this.setEndTime,minDate:datePickerTimes.start,inline:true,showTimeSelect:true})}];return{startItems:startItems,endItems:endItems}}},{key:"render",value:function render(){var _getTabItems=this.getTabItems(),startItems=_getTabItems.startItems,endItems=_getTabItems.endItems;return _react2.default.createElement("div",{className:"time-range-selector"},_react2.default.createElement("div",{className:"time-range-section-container"},_react2.default.createElement(TabStack,{title:"Search start time",items:startItems,switchState:this.state.startTab,switchFunc:this.setStartTab}),_react2.default.createElement(TabStack,{title:"Search end time",items:endItems,switchState:this.state.endTab,switchFunc:this.setEndTab})))}}]);return TimeRangeSelector}(_react.Component);function TabStack(_ref){var title=_ref.title,items=_ref.items,switchState=_ref.switchState,switchFunc=_ref.switchFunc;return _react2.default.createElement("div",{className:"time-range-section"},_react2.default.createElement("div",{className:"time-range-section-title"},title),_react2.default.createElement("ul",{className:"tab-stack"},items.map(function(item,i){var className="";switchState===item.index&&(className+="active ");void 0!==item.body&&(className+="has-body ");return _react2.default.createElement("li",{key:i,className:className},_react2.default.createElement("a",{onClick:function onClick(){return switchFunc(item.index)}},item.label),void 0!==item.body&&_react2.default.createElement("div",{className:"body"},item.body))})))}TimeRangeSelector.propTypes={startTime:_propTypes2.default.object.isRequired,endTime:_propTypes2.default.object,setStartTime:_propTypes2.default.func.isRequired,setEndTime:_propTypes2.default.func.isRequired}},3651:function(module,exports){},3652:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _create_watch_flyout=__webpack_require__(3653);Object.defineProperty(exports,"CreateWatchFlyout",{enumerable:true,get:function get(){return _create_watch_flyout.CreateWatchFlyout}})},3653:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CreateWatchFlyout=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _notify=__webpack_require__(9);var _utils=__webpack_require__(367);var _create_watch_service=__webpack_require__(369);var _create_watch_view=__webpack_require__(3657);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function getSuccessToast(id,url){return{title:"Watch "+id+" created successfully",text:_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"flexEnd",gutterSize:"s"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{size:"s",href:url,target:"_blank",iconType:"link"},"Edit watch"))))}}var CreateWatchFlyout=exports.CreateWatchFlyout=function(_Component){_inherits(CreateWatchFlyout,_Component);function CreateWatchFlyout(props){_classCallCheck(this,CreateWatchFlyout);var _this=_possibleConstructorReturn(this,(CreateWatchFlyout.__proto__||Object.getPrototypeOf(CreateWatchFlyout)).call(this,props));_this.closeFlyout=function(){_this.setState({isFlyoutVisible:false})};_this.showFlyout=function(jobId){(0,_utils.loadFullJob)(jobId).then(function(job){var bucketSpan=job.analysis_config.bucket_span;_create_watch_service.mlCreateWatchService.config.includeInfluencers=job.analysis_config.influencers.length>0;_this.setState({job:job,jobId:jobId,bucketSpan:bucketSpan,isFlyoutVisible:true})}).catch(function(error){console.error(error)})};_this.save=function(){_create_watch_service.mlCreateWatchService.createNewWatch(_this.state.jobId).then(function(resp){_notify.toastNotifications.addSuccess(getSuccessToast(resp.id,resp.url));_this.closeFlyout()}).catch(function(error){_notify.toastNotifications.addDanger("Could not save watch");console.error(error)})};_this.state={jobId:null,bucketSpan:null};return _this}_createClass(CreateWatchFlyout,[{key:"componentDidMount",value:function componentDidMount(){"function"===typeof this.props.setShowFunction&&this.props.setShowFunction(this.showFlyout)}},{key:"componentWillUnmount",value:function componentWillUnmount(){"function"===typeof this.props.unsetShowFunction&&this.props.unsetShowFunction()}},{key:"render",value:function render(){var _state=this.state,jobId=_state.jobId,bucketSpan=_state.bucketSpan;var flyout=void 0;this.state.isFlyoutVisible&&(flyout=_react2.default.createElement(_eui.EuiFlyout,{onClose:this.closeFlyout,size:"s"},_react2.default.createElement(_eui.EuiFlyoutHeader,null,_react2.default.createElement(_eui.EuiTitle,null,_react2.default.createElement("h2",null,"Create watch for ",jobId))),_react2.default.createElement(_eui.EuiFlyoutBody,null,_react2.default.createElement(_create_watch_view.CreateWatch,{jobId:jobId,bucketSpan:bucketSpan})),_react2.default.createElement(_eui.EuiFlyoutFooter,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{iconType:"cross",onClick:this.closeFlyout,flush:"left"},"Close")),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{onClick:this.save,fill:true},"Save"))))));return _react2.default.createElement("div",null,flyout)}}]);return CreateWatchFlyout}(_react.Component);CreateWatchFlyout.propTypes={setShowFunction:_propTypes2.default.func.isRequired,unsetShowFunction:_propTypes2.default.func.isRequired}},3654:function(module,exports){module.exports="<html>\n  <body>\n    <strong>Elastic Stack Machine Learning Alert</strong>\n    <br />\n    <br />\n\n    <strong>Job</strong>: {{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0._source.job_id}}\n    <br />\n\n    <strong>Time</strong>: {{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.timestamp_iso8601.0}}\n    <br />\n\n    <strong>Anomaly score</strong>: {{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.score.0}}\n    <br />\n    <br />\n\n    <a href=\"<%= serverAddress %>#/explorer/?_g=(ml:(jobIds:!('{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0._source.job_id}}')),refreshInterval:(display:Off,pause:!f,value:0),time:(from:'{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.start.0}}',mode:absolute,to:'{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.end.0}}'))&_a=(filters:!(),mlAnomaliesTable:(intervalValue:auto,thresholdValue:0),mlExplorerSwimlane:(selectedLane:Overall,selectedTime:{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.timestamp_epoch.0}},selectedType:overall),query:(query_string:(analyze_wildcard:!t,query:'*')))\">\n    Click here to open in Anomaly Explorer</a>.\n    <br />\n    <br />\n\n    <%= influencersSection %>\n\n    <strong>Top records:</strong>\n    <br />\n    {{#ctx.payload.aggregations.record_results.top_record_hits.hits.hits}}\n      {{_source.function}}({{_source.field_name}}) {{_source.by_field_value}} {{_source.over_field_value}} {{_source.partition_field_value}} [{{fields.score.0}}]\n      <br />\n    {{/ctx.payload.aggregations.record_results.top_record_hits.hits.hits}}\n\n  </body>\n</html>\n"},3655:function(module,exports){module.exports="<strong>Top influencers:</strong>\n<br />\n  {{#ctx.payload.aggregations.influencer_results.top_influencer_hits.hits.hits}}\n    {{_source.influencer_field_name}} = {{_source.influencer_field_value}} [{{fields.score.0}}]\n    <br />\n  {{/ctx.payload.aggregations.influencer_results.top_influencer_hits.hits.hits}}\n<br />\n"},3656:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.watch=void 0;var _index_patterns=__webpack_require__(368);var watch=exports.watch={trigger:{schedule:{interval:"60s"}},input:{search:{request:{search_type:"query_then_fetch",indices:[_index_patterns.ML_RESULTS_INDEX_PATTERN],types:[],body:{size:0,query:{bool:{filter:[{term:{job_id:null}},{range:{timestamp:{gte:null}}},{terms:{result_type:["bucket","record","influencer"]}}]}},aggs:{bucket_results:{filter:{range:{anomaly_score:{gte:null}}},aggs:{top_bucket_hits:{top_hits:{sort:[{anomaly_score:{order:"desc"}}],_source:{includes:["job_id","result_type","timestamp","anomaly_score","is_interim"]},size:1,script_fields:{start:{script:{lang:"painless",inline:'LocalDateTime.ofEpochSecond((doc["timestamp"].date.getMillis()-((doc["bucket_span"].value * 1000)\n * params.padding)) / 1000, 0, ZoneOffset.UTC).toString()+":00.000Z"',params:{padding:10}}},end:{script:{lang:"painless",inline:'LocalDateTime.ofEpochSecond((doc["timestamp"].date.getMillis()+((doc["bucket_span"].value * 1000)\n * params.padding)) / 1000, 0, ZoneOffset.UTC).toString()+":00.000Z"',params:{padding:10}}},timestamp_epoch:{script:{lang:"painless",inline:'doc["timestamp"].date.getMillis()/1000'}},timestamp_iso8601:{script:{lang:"painless",inline:'doc["timestamp"].date'}},score:{script:{lang:"painless",inline:'Math.round(doc["anomaly_score"].value)'}}}}}}},influencer_results:{filter:{range:{influencer_score:{gte:3}}},aggs:{top_influencer_hits:{top_hits:{sort:[{influencer_score:{order:"desc"}}],_source:{includes:["result_type","timestamp","influencer_field_name","influencer_field_value","influencer_score","isInterim"]},size:3,script_fields:{score:{script:{lang:"painless",inline:'Math.round(doc["influencer_score"].value)'}}}}}}},record_results:{filter:{range:{record_score:{gte:3}}},aggs:{top_record_hits:{top_hits:{sort:[{record_score:{order:"desc"}}],_source:{includes:["result_type","timestamp","record_score","is_interim","function","field_name","by_field_value","over_field_value","partition_field_value"]},size:3,script_fields:{score:{script:{lang:"painless",inline:'Math.round(doc["record_score"].value)'}}}}}}}}}}}},condition:{compare:{"ctx.payload.aggregations.bucket_results.doc_count":{gt:0}}},actions:{log:{logging:{level:"info",text:""}}}};var txt="Alert for job [{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0._source.job_id}}] at ";txt+="[{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.timestamp_iso8601.0}}] score ";txt+="[{{ctx.payload.aggregations.bucket_results.top_bucket_hits.hits.hits.0.fields.score.0}}]";watch.actions.log.logging.text=txt},3657:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CreateWatch=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _lodash=__webpack_require__(1);var _parse_interval=__webpack_require__(117);var _ml_api_service=__webpack_require__(23);var _select_severity=__webpack_require__(1414);var _create_watch_service=__webpack_require__(369);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var STATUS=_create_watch_service.mlCreateWatchService.STATUS;var CreateWatch=exports.CreateWatch=function(_Component){_inherits(CreateWatch,_Component);function CreateWatch(props){_classCallCheck(this,CreateWatch);var _this=_possibleConstructorReturn(this,(CreateWatch.__proto__||Object.getPrototypeOf(CreateWatch)).call(this,props));_this.onThresholdChange=function(threshold){_this.setState({threshold:threshold},function(){_this.config.threshold=threshold})};_this.onIntervalChange=function(e){var interval=e.target.value;_this.setState({interval:interval},function(){_this.config.interval=interval})};_this.onIncludeEmailChanged=function(e){var includeEmail=e.target.checked;_this.setState({includeEmail:includeEmail},function(){_this.config.includeEmail=includeEmail})};_this.onEmailChange=function(e){var email=e.target.value;_this.setState({email:email},function(){_this.config.email=email})};_create_watch_service.mlCreateWatchService.reset();_this.config=_create_watch_service.mlCreateWatchService.config;_this.state={jobId:_this.props.jobId,bucketSpan:_this.props.bucketSpan,interval:_this.config.interval,threshold:_this.config.threshold,includeEmail:_this.config.emailIncluded,email:_this.config.email,emailEnabled:false,status:null,watchAlreadyExists:false};return _this}_createClass(CreateWatch,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;if(this.state.bucketSpan){var intervalObject=(0,_parse_interval.parseInterval)(this.state.bucketSpan);var bs=2*intervalObject.asMinutes();bs<1&&(bs=1);var interval=bs+"m";this.setState({interval:interval},function(){_this2.config.interval=interval})}_ml_api_service.ml.getNotificationSettings().then(function(resp){(0,_lodash.has)(resp,"defaults.xpack.notification.email")&&_this2.setState({emailEnabled:true})});_create_watch_service.mlCreateWatchService.loadWatch(this.state.jobId).then(function(){_this2.setState({watchAlreadyExists:true})}).catch(function(){_this2.setState({watchAlreadyExists:false})})}},{key:"render",value:function render(){var _this3=this;var mlSelectSeverityService={state:{set:function set(name,threshold){_this3.onThresholdChange(threshold);return{changed:function changed(){}}},get:function get(){return _this3.config.threshold}}};var status=this.state.status;return null===status||status===STATUS.SAVING||status===STATUS.SAVE_FAILED?_react2.default.createElement("div",{className:"create-watch"},_react2.default.createElement("div",{className:"form-group form-group-flex"},_react2.default.createElement("div",{className:"sub-form-group"},_react2.default.createElement("div",null,_react2.default.createElement("label",{htmlFor:"selectInterval",className:"euiFormLabel"},"Time range")),"Now - ",_react2.default.createElement(_eui.EuiFieldText,{id:"selectInterval",value:this.state.interval,onChange:this.onIntervalChange})),_react2.default.createElement("div",{className:"sub-form-group"},_react2.default.createElement("div",null,_react2.default.createElement("label",{htmlFor:"selectSeverity",className:"euiFormLabel"},"Severity threshold")),_react2.default.createElement("div",{className:"dropdown-group"},_react2.default.createElement(_select_severity.SelectSeverity,{id:"selectSeverity",mlSelectSeverityService:mlSelectSeverityService})))),this.state.emailEnabled&&_react2.default.createElement("div",{className:"form-group"},_react2.default.createElement(_eui.EuiCheckbox,{id:"includeEmail",label:"Send email",checked:this.state.includeEmail,onChange:this.onIncludeEmailChanged}),this.state.includeEmail&&_react2.default.createElement("div",{className:"email-section"},_react2.default.createElement(_eui.EuiFieldText,{value:this.state.email,onChange:this.onEmailChange,placeholder:"email address","aria-label":"Watch email address"}))),this.state.watchAlreadyExists&&_react2.default.createElement(_eui.EuiCallOut,{title:"Warning, watch ml-"+this.state.jobId+" already exists, clicking apply will overwrite the original."})):status===STATUS.SAVED?_react2.default.createElement("div",null,"Success"):_react2.default.createElement("div",null)}}]);return CreateWatch}(_react.Component);CreateWatch.propTypes={jobId:_propTypes2.default.string.isRequired,bucketSpan:_propTypes2.default.string.isRequired}},3658:function(module,exports){},3659:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _multi_job_actions=__webpack_require__(3660);Object.defineProperty(exports,"MultiJobActions",{enumerable:true,get:function get(){return _multi_job_actions.MultiJobActions}})},3660:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MultiJobActions=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _job_actions=__webpack_require__(1410);var _actions_menu=__webpack_require__(3661);__webpack_require__(3662);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var MultiJobActions=exports.MultiJobActions=function(_Component){_inherits(MultiJobActions,_Component);function MultiJobActions(props){_classCallCheck(this,MultiJobActions);var _this=_possibleConstructorReturn(this,(MultiJobActions.__proto__||Object.getPrototypeOf(MultiJobActions)).call(this,props));_this.state={};return _this}_createClass(MultiJobActions,[{key:"render",value:function render(){var s=this.props.selectedJobs.length>1?"s":"";return _react2.default.createElement("div",{className:"multi-select-actions"},this.props.selectedJobs.length>0&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement("span",{className:"jobs-selected-title"},this.props.selectedJobs.length," job",s," selected"),_react2.default.createElement("div",{className:"actions-border-large"}),_react2.default.createElement(_job_actions.ResultLinks,{jobs:this.props.selectedJobs}),_react2.default.createElement(_actions_menu.MultiJobActionsMenu,{jobs:this.props.selectedJobs,showStartDatafeedModal:this.props.showStartDatafeedModal,showDeleteJobModal:this.props.showDeleteJobModal,refreshJobs:this.props.refreshJobs})))}}]);return MultiJobActions}(_react.Component);MultiJobActions.propTypes={selectedJobs:_propTypes2.default.array.isRequired,showStartDatafeedModal:_propTypes2.default.func.isRequired,showDeleteJobModal:_propTypes2.default.func.isRequired,refreshJobs:_propTypes2.default.func.isRequired}},3661:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.MultiJobActionsMenu=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _check_privilege=__webpack_require__(35);var _check_ml_nodes=__webpack_require__(69);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _utils=__webpack_require__(367);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var MultiJobActionsMenu=exports.MultiJobActionsMenu=function(_Component){_inherits(MultiJobActionsMenu,_Component);function MultiJobActionsMenu(props){_classCallCheck(this,MultiJobActionsMenu);var _this=_possibleConstructorReturn(this,(MultiJobActionsMenu.__proto__||Object.getPrototypeOf(MultiJobActionsMenu)).call(this,props));_this.onButtonClick=function(){_this.setState(function(prevState){return{isOpen:!prevState.isOpen}})};_this.closePopover=function(){_this.setState({isOpen:false})};_this.state={isOpen:false};_this.canDeleteJob=(0,_check_privilege.checkPermission)("canDeleteJob");_this.canStartStopDatafeed=(0,_check_privilege.checkPermission)("canStartStopDatafeed")&&(0,_check_ml_nodes.mlNodesAvailable)();_this.canCloseJob=(0,_check_privilege.checkPermission)("canCloseJob")&&(0,_check_ml_nodes.mlNodesAvailable)();return _this}_createClass(MultiJobActionsMenu,[{key:"render",value:function render(){var _this2=this;var button=_react2.default.createElement(_eui.EuiButtonIcon,{size:"s",onClick:this.onButtonClick,iconType:"gear","aria-label":"Management actions",color:"text",disabled:false===this.canDeleteJob&&false===this.canStartStopDatafeed});var s=this.props.jobs.length>1?"s":"";var items=[_react2.default.createElement(_eui.EuiContextMenuItem,{key:"delete",icon:"trash",disabled:false===this.canDeleteJob,onClick:function onClick(){_this2.props.showDeleteJobModal(_this2.props.jobs);_this2.closePopover()}},"Delete job",s)];(0,_utils.isClosable)(this.props.jobs)&&items.push(_react2.default.createElement(_eui.EuiContextMenuItem,{key:"close job",icon:"cross",disabled:false===this.canCloseJob,onClick:function onClick(){(0,_utils.closeJobs)(_this2.props.jobs);_this2.closePopover()}},"Close job",s));(0,_utils.isStoppable)(this.props.jobs)&&items.push(_react2.default.createElement(_eui.EuiContextMenuItem,{key:"stop datafeed",icon:"stop",disabled:false===this.canStartStopDatafeed,onClick:function onClick(){(0,_utils.stopDatafeeds)(_this2.props.jobs,_this2.props.refreshJobs);_this2.closePopover()}},"Stop datafeed",s));(0,_utils.isStartable)(this.props.jobs)&&items.push(_react2.default.createElement(_eui.EuiContextMenuItem,{key:"start datafeed",icon:"play",disabled:false===this.canStartStopDatafeed,onClick:function onClick(){_this2.props.showStartDatafeedModal(_this2.props.jobs);_this2.closePopover()}},"Start datafeed",s));return _react2.default.createElement(_eui.EuiPopover,{button:button,isOpen:this.state.isOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downCenter"},_react2.default.createElement(_eui.EuiContextMenuPanel,{items:items.reverse()}))}}]);return MultiJobActionsMenu}(_react.Component);MultiJobActionsMenu.propTypes={jobs:_propTypes2.default.array.isRequired,showStartDatafeedModal:_propTypes2.default.func.isRequired,showDeleteJobModal:_propTypes2.default.func.isRequired,refreshJobs:_propTypes2.default.func.isRequired}},3662:function(module,exports){},3663:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _jobs_stats_bar=__webpack_require__(3664);Object.defineProperty(exports,"JobStatsBar",{enumerable:true,get:function get(){return _jobs_stats_bar.JobStatsBar}})},3664:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.JobStatsBar=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();__webpack_require__(3665);var _states=__webpack_require__(321);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function createJobStats(jobsSummaryList){var jobStats={activeNodes:{label:"Active ML Nodes",value:0,show:true},total:{label:"Total jobs",value:0,show:true},open:{label:"Open jobs",value:0,show:true},closed:{label:"Closed jobs",value:0,show:true},failed:{label:"Failed jobs",value:0,show:false},activeDatafeeds:{label:"Active datafeeds",value:0,show:true}};if(void 0===jobsSummaryList)return jobStats;var mlNodes={};var failedJobs=0;jobsSummaryList.forEach(function(job){job.jobState===_states.JOB_STATE.OPENED?jobStats.open.value++:job.jobState===_states.JOB_STATE.CLOSED?jobStats.closed.value++:job.jobState===_states.JOB_STATE.FAILED&&failedJobs++;job.hasDatafeed&&job.datafeedState===_states.DATAFEED_STATE.STARTED&&jobStats.activeDatafeeds.value++;void 0!==job.nodeName&&(mlNodes[job.nodeName]={})});jobStats.total.value=jobsSummaryList.length;if(failedJobs){jobStats.failed.value=failedJobs;jobStats.failed.show=true}else jobStats.failed.show=false;jobStats.activeNodes.value=Object.keys(mlNodes).length;return jobStats}function Stat(_ref){var stat=_ref.stat;return _react2.default.createElement("span",{className:"stat"},_react2.default.createElement("span",{className:"stat-label"},stat.label),": ",_react2.default.createElement("span",{className:"stat-value"},stat.value))}Stat.propTypes={stat:_propTypes2.default.object.isRequired};var JobStatsBar=exports.JobStatsBar=function(_Component){_inherits(JobStatsBar,_Component);function JobStatsBar(props){_classCallCheck(this,JobStatsBar);var _this=_possibleConstructorReturn(this,(JobStatsBar.__proto__||Object.getPrototypeOf(JobStatsBar)).call(this,props));_this.updateJobStats=function(jobsSummaryList){var jobStats=createJobStats(jobsSummaryList);_this.setState({jobsSummaryList:jobsSummaryList,jobStats:jobStats})};_this.state={jobsSummaryList:[],jobStats:{}};return _this}_createClass(JobStatsBar,[{key:"componentDidMount",value:function componentDidMount(){this.props.setUpdateJobStats(this.updateJobStats)}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.props.unsetUpdateJobStats()}},{key:"render",value:function render(){var jobStats=this.state.jobStats;var stats=Object.keys(jobStats).map(function(k){return jobStats[k]});return _react2.default.createElement("div",{className:"jobs-stats-bar"},stats.filter(function(s){return s.show}).map(function(s){return _react2.default.createElement(Stat,{key:s.label,stat:s})}))}}]);return JobStatsBar}(_react.Component);JobStatsBar.propTypes={setUpdateJobStats:_propTypes2.default.func.isRequired,unsetUpdateJobStats:_propTypes2.default.func.isRequired}},3665:function(module,exports){},3666:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _node_available_warning=__webpack_require__(3667);Object.defineProperty(exports,"NodeAvailableWarning",{enumerable:true,get:function get(){return _node_available_warning.NodeAvailableWarning}})},3667:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.NodeAvailableWarning=NodeAvailableWarning;var _check_ml_nodes=__webpack_require__(69);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function NodeAvailableWarning(){var isCloud=false;return true===(0,_check_ml_nodes.mlNodesAvailable)()||false===(0,_check_ml_nodes.permissionToViewMlNodeCount)()?_react2.default.createElement("span",null):_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiCallOut,{title:"No ML nodes available",color:"warning",iconType:"alert"},_react2.default.createElement("p",null,"There are no ML nodes available.",_react2.default.createElement("br",null),"You will not be able to create or run jobs.",isCloud&&_react2.default.createElement("span",{"ng-if":"isCloud"}," This can be configured in Cloud ",_react2.default.createElement(_eui.EuiLink,{href:"#"},"here"),"."))),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}))}},3668:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3669);__webpack_require__(3670);__webpack_require__(3683);__webpack_require__(3710);__webpack_require__(3718);__webpack_require__(3721);__webpack_require__(3724);__webpack_require__(843);__webpack_require__(3733);__webpack_require__(1419)},3669:function(module,exports){},367:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.loadFullJob=loadFullJob;exports.isStartable=isStartable;exports.isStoppable=isStoppable;exports.isClosable=isClosable;exports.forceStartDatafeeds=forceStartDatafeeds;exports.stopDatafeeds=stopDatafeeds;exports.cloneJob=cloneJob;exports.closeJobs=closeJobs;exports.deleteJobs=deleteJobs;exports.filterJobs=filterJobs;var _lodash=__webpack_require__(1);var _notify=__webpack_require__(9);var _messagebar_service=__webpack_require__(79);var _job_service=__webpack_require__(24);var _ml_api_service=__webpack_require__(23);var _states=__webpack_require__(321);function loadFullJob(jobId){return new Promise(function(resolve,reject){_ml_api_service.ml.jobs.jobs(jobId).then(function(jobs){if(!jobs.length)throw new Error("Could not find job "+jobId);resolve(jobs[0])}).catch(function(error){reject(error)})})}function isStartable(jobs){return jobs.some(function(j){return j.datafeedState===_states.DATAFEED_STATE.STOPPED})}function isStoppable(jobs){return jobs.some(function(j){return j.datafeedState===_states.DATAFEED_STATE.STARTED})}function isClosable(jobs){return jobs.some(function(j){return j.datafeedState===_states.DATAFEED_STATE.STOPPED&&j.jobState!==_states.JOB_STATE.CLOSED})}function forceStartDatafeeds(jobs,start,end){var finish=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};var datafeedIds=jobs.filter(function(j){return j.hasDatafeed}).map(function(j){return j.datafeedId});_job_service.mlJobService.forceStartDatafeeds(datafeedIds,start,end).then(function(resp){showResults(resp,_states.DATAFEED_STATE.STARTED);finish()}).catch(function(error){_messagebar_service.mlMessageBarService.notify.error(error);_notify.toastNotifications.addDanger("Jobs failed to start",error);finish()})}function stopDatafeeds(jobs){var finish=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};var datafeedIds=jobs.filter(function(j){return j.hasDatafeed}).map(function(j){return j.datafeedId});_job_service.mlJobService.stopDatafeeds(datafeedIds).then(function(resp){showResults(resp,_states.DATAFEED_STATE.STOPPED);finish()}).catch(function(error){_messagebar_service.mlMessageBarService.notify.error(error);_notify.toastNotifications.addDanger("Jobs failed to stop",error);finish()})}function showResults(resp,action){var successes=[];var failures=[];for(var d in resp)true===resp[d][action]||false===resp[d][action]&&409===resp[d].error.statusCode&&action===_states.DATAFEED_STATE.STARTED?successes.push(d):failures.push({id:d,result:resp[d]});var actionText="";var actionTextPT="";if(action===_states.DATAFEED_STATE.STARTED){actionText="start";actionTextPT="started"}else if(action===_states.DATAFEED_STATE.STOPPED){actionText="stop";actionTextPT="stopped"}else if(action===_states.DATAFEED_STATE.DELETED){actionText="delete";actionTextPT="deleted"}else if(action===_states.JOB_STATE.CLOSED){actionText="close";actionTextPT="closed"}successes.length>1?_notify.toastNotifications.addSuccess(successes.length+" jobs "+actionTextPT+" successfully"):1===successes.length&&_notify.toastNotifications.addSuccess(successes[0]+" "+actionTextPT+" successfully");failures.length>0&&failures.forEach(function(f){_messagebar_service.mlMessageBarService.notify.error(f.result.error);_notify.toastNotifications.addDanger(f.id+" failed to "+actionText)})}function cloneJob(jobId){loadFullJob(jobId).then(function(job){_job_service.mlJobService.currentJob=job;window.location.href="#/jobs/new_job"}).catch(function(error){_messagebar_service.mlMessageBarService.notify.error(error);_notify.toastNotifications.addDanger("Could not clone "+jobId+". Job could not be found")})}function closeJobs(jobs){var finish=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};var jobIds=jobs.map(function(j){return j.id});_job_service.mlJobService.closeJobs(jobIds).then(function(resp){showResults(resp,_states.JOB_STATE.CLOSED);finish()}).catch(function(error){_messagebar_service.mlMessageBarService.notify.error(error);_notify.toastNotifications.addDanger("Jobs failed to close",error);finish()})}function deleteJobs(jobs){var finish=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};var jobIds=jobs.map(function(j){return j.id});_job_service.mlJobService.deleteJobs(jobIds).then(function(resp){showResults(resp,_states.DATAFEED_STATE.DELETED);finish()}).catch(function(error){_messagebar_service.mlMessageBarService.notify.error(error);_notify.toastNotifications.addDanger("Jobs failed to delete",error);finish()})}function filterJobs(jobs,clauses){if(0===clauses.length)return jobs;var matches=jobs.reduce(function(p,c){p[c.id]={job:c,count:0};return p},{});clauses.forEach(function(c){var bool="must"===c.match;var js=[];js="term"===c.type?true===bool?jobs.filter(function(job){return stringMatch(job.id,c.value)===bool||stringMatch(job.description,c.value)===bool||stringMatch(job.memory_status,c.value)===bool}):jobs.filter(function(job){return stringMatch(job.id,c.value)===bool&&stringMatch(job.description,c.value)===bool&&stringMatch(job.memory_status,c.value)===bool}):Array.isArray(c.value)?jobs.filter(function(job){return jobProperty(job,c.field).some(function(g){return c.value.indexOf(g)>=0})}):jobs.filter(function(job){return jobProperty(job,c.field)===c.value});js.forEach(function(j){return matches[j.id].count++})});var filteredJobs=[];(0,_lodash.each)(matches,function(m){m.count>=clauses.length&&filteredJobs.push(m.job)});return filteredJobs}function stringMatch(str,substr){return"string"===typeof str&&"string"===typeof substr&&null===str.toLowerCase().match(substr.toLowerCase())===false}function jobProperty(job,prop){var propMap={job_state:"jobState",datafeed_state:"datafeedState",groups:"groups"};return job[propMap[prop]]}},3670:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);__webpack_require__(1415);var _jobs_list_controls=__webpack_require__(3674);var _jobs_list_controls2=_interopRequireDefault(_jobs_list_controls);var _open=__webpack_require__(3675);var _open2=_interopRequireDefault(_open);var _job_utils=__webpack_require__(41);var _string_utils=__webpack_require__(40);var _clipboard_utils=__webpack_require__(1416);var _timefilter=__webpack_require__(14);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(68);var _check_privilege=__webpack_require__(35);var _recently_accessed=__webpack_require__(500);var _check_ml_nodes=__webpack_require__(69);var _jobs_list=__webpack_require__(3676);var _jobs_list2=_interopRequireDefault(_jobs_list);var _delete_job_modal=__webpack_require__(3677);var _delete_job_modal2=_interopRequireDefault(_delete_job_modal);var _edit_job_modal=__webpack_require__(3678);var _edit_job_modal2=_interopRequireDefault(_edit_job_modal);var _create_watch_modal=__webpack_require__(3679);var _create_watch_modal2=_interopRequireDefault(_create_watch_modal);var _buttons_enabled_checks=__webpack_require__(3680);var _cloud_service=__webpack_require__(3681);var _new_job_defaults=__webpack_require__(253);var _job_service=__webpack_require__(24);var _calendar_service=__webpack_require__(630);var _job_messages_service=__webpack_require__(3682);var _messagebar_service=__webpack_require__(79);var _promise=__webpack_require__(89);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/jobs_old/?",{template:_jobs_list2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,mlNodeCount:_check_ml_nodes.getMlNodeCount,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults,initPromise:(0,_promise.initPromise)(true)}});var _module=_modules.uiModules.get("apps/ml",["ui.bootstrap"]);_module.controller("MlJobsList",function($scope,$location,$timeout,$compile,$modal,kbnUrl,Private,mlDatafeedService){_timefilter.timefilter.disableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();var rowScopes=[];var msgs=_messagebar_service.mlMessageBarService;var TIME_FORMAT="YYYY-MM-DD HH:mm:ss";var refreshCounter=0;var refreshJobsTimeout=null;var auditMessages={};$scope.noJobsCreated;$scope.toLocaleString=_string_utils.toLocaleString;$scope.filterText="";$scope.filterIcon=0;var filterRegexp=void 0;var jobFilterTimeout=void 0;$scope.kbnUrl=kbnUrl;$scope.mlNodesAvailable=(0,_check_ml_nodes.mlNodesAvailable)();$scope.permissionToViewMlNodeCount=(0,_check_ml_nodes.permissionToViewMlNodeCount)();var _Private=Private(_cloud_service.cloudServiceProvider),isRunningOnCloud=_Private.isRunningOnCloud,getCloudId=_Private.getCloudId;$scope.isCloud=isRunningOnCloud();$scope.cloudId=getCloudId();$scope.createPermissionFailureMessage=_check_privilege.createPermissionFailureMessage;$scope.permissions={canCreateJob:(0,_check_privilege.checkPermission)("canCreateJob"),canUpdateJob:(0,_check_privilege.checkPermission)("canUpdateJob"),canDeleteJob:(0,_check_privilege.checkPermission)("canDeleteJob"),canCloseJob:(0,_check_privilege.checkPermission)("canCloseJob"),canUpdateDatafeed:(0,_check_privilege.checkPermission)("canUpdateDatafeed"),canStartStopDatafeed:(0,_check_privilege.checkPermission)("canStartStopDatafeed")};$scope.jobStats=_job_service.mlJobService.jobStats;$scope.deleteJob=function(job){var status={deleteLock:false,deleteDatafeed:0,deleteJob:0,errorMessage:""};$modal.open({template:_delete_job_modal2.default,controller:"MlDeleteJobModal",backdrop:"static",keyboard:false,size:"sm",resolve:{params:function params(){return{doDelete:doDelete,status:status,jobId:job.job_id,isDatafeed:!(!job.datafeed_config||!Object.keys(job.datafeed_config).length)}}}});function doDelete(){status.deleteLock=true;_job_service.mlJobService.deleteJob(job,status).then(function(deleteResp){if(deleteResp.success){status.deleteLock=false;msgs.clear();msgs.info("Job '"+job.job_id+"' deleted");status.deleteLock=false;refreshJobs()}})}};$scope.newJob=function(){$location.path("jobs/new_job")};$scope.editJob=function(job){openEditJobWindow(job)};$scope.cloneJob=function(job){_job_service.mlJobService.currentJob=job;$location.path("jobs/new_job")};$scope.closeJob=function(job){var closeFunc=_job_service.mlJobService.closeJob;"failed"===job.state&&(closeFunc=_job_service.mlJobService.forceCloseJob);closeFunc(job.job_id).then(function(){$scope.refreshJob(job.job_id)}).catch(function(resp){msgs.error("Job could not be closed",resp);refreshJobs()})};$scope.copyToClipboard=function(job){var success=(0,_clipboard_utils.copyTextToClipboard)(_angular2.default.toJson(job));if(success){msgs.clear();msgs.info(job.job_id+" JSON copied to clipboard")}else msgs.error("Job could not be copied to the clipboard")};$scope.startDatafeed=function(job){mlDatafeedService.openJobTimepickerWindow(job,$scope)};$scope.stopDatafeed=function(job){job.datafeed_config&&(job.datafeed_config.state="stopping");var datafeedId=_job_service.mlJobService.getDatafeedId(job.job_id);_job_service.mlJobService.stopDatafeed(datafeedId,job.job_id).then(function(){$scope.refreshJob(job.job_id)})};function latestTimeStamp(dataCounts){var obj={string:"",unix:0};if(dataCounts.latest_record_timestamp){var ts=(0,_moment2.default)(dataCounts.latest_record_timestamp);obj.string=ts.format(TIME_FORMAT);obj.unix=ts}return obj}function displayJobs(jobs){var rowStates={};_lodash2.default.each(rowScopes,function(rs){rowStates[rs.job.job_id]={open:rs.open,$expandElement:rs.$expandElement,currentTab:rs.currentTab}});_lodash2.default.invoke(rowScopes,"$destroy");rowScopes.length=0;$scope.jobs=jobs;$scope.table={};$scope.table.perPage=10;$scope.table.columns=[{title:"",sortable:false,class:"col-expand-arrow"},{title:"Job ID"},{title:"",sortable:false,class:"col-info"},{title:"Description"},{title:"Processed records",class:"col-align-right"},{title:"Memory status"},{title:"Job state"},{title:"Datafeed state"},{title:"Latest timestamp"},{title:"Actions",sortable:false,class:"col-action"}];var jobCalendars=_calendar_service.mlCalendarService.jobCalendars;var rows=jobs.map(function(job){var rowScope=$scope.$new();var calendars=jobCalendars[job.job_id];calendars&&calendars.length&&(rowScope.calendars=calendars);rowScope.job=job;rowScope.closeJob=$scope.closeJob;rowScope.canCloseJob=$scope.permissions.canCloseJob&&$scope.mlNodesAvailable;rowScope.currentTab={index:0};rowScope.jobAudit={messages:"",update:function update(){return loadAuditMessages(jobs,[rowScope],rowScope.job.job_id)},jobWarningClass:"",jobWarningText:""};rowScope.expandable=true;rowScope.expandElement="ml-job-list-expanded-row-container";rowScope.initRow=function(){if(rowScope.$expandElement&&0===rowScope.$expandElement.children().length){var $el=(0,_jquery2.default)("<ml-job-list-expanded-row>",{job:"job",calendars:"calendars","current-tab":"currentTab","job-audit":"jobAudit","close-job":"closeJob","can-close-job":"canCloseJob"});$el.appendTo(this.$expandElement);$compile($el)(this)}};rowScope.time=latestTimeStamp;rowScope.jobUrl=_job_service.mlJobService.jobUrls[job.job_id];rowScope.enableTimeSeries=(0,_job_utils.isTimeSeriesViewJob)(job);rowScope.addItemToRecentlyAccessed=_recently_accessed.addItemToRecentlyAccessed;rowScope.checks=(0,_buttons_enabled_checks.buttonsEnabledChecks)($scope.permissions,job,$scope.mlNodesAvailable);rowScopes.push(rowScope);var jobDescription=job.description||"";if(void 0===$scope.filterText||""===$scope.filterText||job.job_id.match(filterRegexp)||jobDescription.match(filterRegexp)){var iconTxt="<i ng-show=\"tab.jobWarningClass !== ''\" ";iconTxt+='tooltip="{{jobAudit.jobWarningText}}" class="{{jobAudit.jobWarningClass}}"></i>';var tableRow=[{markup:_open2.default,scope:rowScope},{markup:filterHighlight(job.job_id),value:job.job_id},{markup:iconTxt,scope:rowScope},{markup:filterHighlight((0,_string_utils.mlEscape)(jobDescription)),value:jobDescription},{markup:'<div class="col-align-right">{{toLocaleString(job.data_counts.processed_record_count)}}</div>',value:job.data_counts.processed_record_count,scope:rowScope},{markup:"{{job.model_size_stats.memory_status}}",value:function value(){return job.model_size_stats?job.model_size_stats.memory_status:""},scope:rowScope},{markup:"{{job.state}}",value:job.state,scope:rowScope},{markup:"{{job.datafeed_config.state}}",value:function value(){return job.datafeed_config.state?job.datafeed_config.state:""},scope:rowScope},{markup:"{{ time(job.data_counts).string }}",value:function value(){return rowScope.time(job.data_counts).unix},scope:rowScope},{markup:_jobs_list_controls2.default,scope:rowScope}];return tableRow}});rows=_lodash2.default.filter(rows,function(row){if(void 0!==row)return row});$scope.table.rows=rows;loadAuditSummary(jobs,rowScopes);_lodash2.default.each(rowScopes,function(rs){if(rowStates[rs.job.job_id]){rs.open=rowStates[rs.job.job_id].open;rs.$expandElement=rowStates[rs.job.job_id].$expandElement;rs.currentTab=rowStates[rs.job.job_id].currentTab}});clearTimeout(refreshJobsTimeout);refreshCounts();$scope.filterIcon=0}function refreshCounts(){var timeout=5e3;function refresh(){_job_service.mlJobService.updateAllJobStats().then(function(resp){resp.listChanged&&jobsUpdated(resp.jobs)})}refreshJobsTimeout=setTimeout(function(){if(refreshCounter%5===0){refresh();loadAuditSummary($scope.jobs,rowScopes)}else{var runningJobs=_job_service.mlJobService.getRunningJobs();runningJobs.length&&refresh()}clearTimeout(refreshJobsTimeout);refreshCounter++;"/jobs"===$location.$$path&&refreshCounts()},timeout)}function loadAuditMessages(jobs,rowScopesIn,jobId){var createTimes={};var fromRange="1M";var aDayAgo=(0,_moment2.default)().subtract(1,"days");_lodash2.default.each(jobs,function(job){void 0===auditMessages[job.job_id]&&(auditMessages[job.job_id]=[]);createTimes[job.job_id]=(0,_moment2.default)(job.create_time).valueOf()});function addMessage(id,msg){void 0!==auditMessages[id]&&msg.timeMs>=createTimes[id]&&(_lodash2.default.findWhere(auditMessages[id],{timeMs:msg.timeMs,message:msg.message,node_name:msg.node_name})||auditMessages[id].push(msg))}return _job_messages_service.jobMessagesService.getJobAuditMessages(fromRange,jobId).then(function(resp){var messages=resp.messages;_lodash2.default.each(messages,function(msg){var time=(0,_moment2.default)(msg.timestamp);msg.time=time.format(TIME_FORMAT);msg.timeMs=time.valueOf();msg.isRecent=time>aDayAgo;if(""===msg.job_id){msg.level="system_info";addMessage(jobId,msg)}else addMessage(msg.job_id,msg)});auditMessages[jobId]=_lodash2.default.sortBy(auditMessages[jobId],"timeMs");_lodash2.default.each(rowScopesIn,function(rs){rs.job.job_id===jobId&&(rs.jobAudit.messages=auditMessages[jobId])})}).catch(function(resp){console.log("loadAuditMessages: audit messages for "+jobId+" could not be loaded");resp.message&&msgs.error(resp.message)})}function loadAuditSummary(jobs,rowScopesIn){var levels={system_info:-1,info:0,warning:1,error:2};var jobMessages={};var createTimes={};_lodash2.default.each(jobs,function(job){createTimes[job.job_id]=(0,_moment2.default)(job.create_time).valueOf()});_job_messages_service.jobMessagesService.getAuditMessagesSummary().then(function(resp){var messagesPerJob=resp.messagesPerJob;_lodash2.default.each(messagesPerJob,function(job){if(""!==job.key&&job.levels&&job.levels.buckets&&job.levels.buckets.length){var highestLevel=0;var highestLevelText="";var msgTime=0;_lodash2.default.each(job.levels.buckets,function(level){var label=level.key;if(levels[label]>highestLevel){highestLevel=levels[label];level.latestMessage&&level.latestMessage.buckets&&level.latestMessage.buckets.length&&_lodash2.default.each(level.latestMessage.buckets,function(msg){highestLevelText=msg.key;if(msg.latestMessage&&msg.latestMessage.value_as_string){var time=(0,_moment2.default)(msg.latestMessage.value_as_string);msgTime=time.valueOf()}})}});jobMessages[job.key]={job_id:job.key,highestLevelText:highestLevelText,highestLevel:highestLevel,msgTime:msgTime}}});_lodash2.default.each(rowScopesIn,function(rs){var job=jobMessages[rs.job.job_id];if(job&&job.msgTime>=createTimes[job.job_id]){rs.jobAudit.jobWarningClass="";rs.jobAudit.jobWarningText=(0,_string_utils.mlEscape)(job.highestLevelText);1===job.highestLevel?rs.jobAudit.jobWarningClass="job-warning fa fa-exclamation-circle":2===job.highestLevel&&(rs.jobAudit.jobWarningClass="job-error fa fa-exclamation-triangle")}})}).catch(function(resp){console.log("loadAuditSummary: audit messages for all jobs could not be loaded");resp.message&&msgs.error(resp.message)})}function openEditJobWindow(job){$modal.open({template:_edit_job_modal2.default,controller:"MlEditJobModal",backdrop:"static",keyboard:false,size:"lg",resolve:{params:function params(){return{pscope:$scope,job:job}}}})}$scope.openCreateWatchWindow=function(job){$modal.open({template:_create_watch_modal2.default,controller:"MlCreateWatchModal",backdrop:"static",keyboard:false,resolve:{params:function params(){return{job:job}}}})};$scope.applyFilter=function(){$timeout.cancel(jobFilterTimeout);jobFilterTimeout=$timeout(function(){filterRegexp=$scope.filterText?new RegExp("("+$scope.filterText+")","gi"):void 0;displayJobs($scope.jobs);jobFilterTimeout=void 0},1e3);$timeout(function(){$scope.filterIcon=1},250)};$scope.clearFilter=function(){$scope.filterText="";$scope.filterRegexp=void 0;$scope.applyFilter()};function filterHighlight(txt){$scope.filterText&&filterRegexp&&(txt=txt.replace(filterRegexp,'<span class="ml-mark">$1</span>'));return txt}function jobsUpdated(jobs){$scope.noJobsCreated=0===jobs.length;displayJobs(jobs)}$scope.refreshJob=function(jobId){_job_service.mlJobService.refreshJob(jobId).then(function(resp){jobsUpdated(resp.jobs)}).catch(function(resp){jobsUpdated(resp.jobs)})};function refreshJobs(){_job_service.mlJobService.loadJobs().then(function(resp){_calendar_service.mlCalendarService.loadCalendars(resp.jobs).then(function(){jobsUpdated(resp.jobs)})}).catch(function(resp){jobsUpdated(resp.jobs)})}refreshJobs();$scope.$on("jobsUpdated",function(){refreshJobs()});$scope.$on("openCreateWatchWindow",function(e,job){$scope.openCreateWatchWindow(job)});$scope.$on("$destroy",function(){clearTimeout(refreshJobsTimeout)})})},3671:function(module,exports){},3672:function(module,exports,__webpack_require__){"use strict";var _form_filter_input=__webpack_require__(3673);var _form_filter_input2=_interopRequireDefault(_form_filter_input);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlFormFilterInput",function(){return{scope:{placeholder:"@?",filter:"=",filterIcon:"=",filterChanged:"=",clearFilter:"="},restrict:"E",replace:false,template:_form_filter_input2.default,link:function link(scope){scope.placeholder=_angular2.default.isDefined(scope.placeholder)?scope.placeholder:"Filter"}}})},3673:function(module,exports){module.exports='<div class="fa fa-search"></div>\n<input\n  class="form-control ml-filter-input-left-icon"\n  type="text"\n  aria-label="{{placeholder}}"\n  placeholder="{{placeholder}}"\n  ng-model="filter"\n  ng-change="filterChanged()" />\n<div class="ml-filter-progress-icon">\n  <div ng-show="filterIcon===1">\n    <i class=\'fa fa-spinner fa-spin\'></i>\n  </div>\n  <div ng-show="filterIcon===0">\n    <a aria-label="Clear filter" ng-click="clearFilter()">\n      <i class="fa fa-times-circle"></i>\n    </a>\n  </div>\n</div>\n'},3674:function(module,exports){module.exports='<div class="actions">\n\n  \x3c!-- start --\x3e\n  <div ng-class="checks.startButtonWrapperClass()" data-placement="right" data-toggle="tooltip"\n    ng-attr-tooltip="{{checks.startButtonWrapperTooltip()}}">\n    <button\n      ng-show="checks.startButtonVisible()"\n      ng-click="((job.datafeed_config && job.datafeed_config.state===\'started\')?stopDatafeed(job):startDatafeed(job))"\n      class="kuiButton kuiButton--basic kuiButton--small"\n      data-toggle="tooltip"\n      aria-label="{{check.startButtonAriaLabel()}}}"\n      ng-disabled="checks.startButtonDisabled()"\n      tooltip="{{checks.startButtonTooltip()}}">\n        <i aria-hidden="true" ng-class="checks.buttonIcon()"></i>\n    </button>\n  </div>\n\n  \x3c!-- loading --\x3e\n  <button\n    disabled\n    ng-show="checks.loadingButtonVisible()"\n    class="kuiButton kuiButton--basic kuiButton--small"\n    data-toggle="tooltip"\n    tooltip="No datafeed settings for {{job.job_id}}">\n      <i aria-hidden="true" class="fa fa-clock-o"></i>\n  </button>\n\n  \x3c!-- anomaly explorer --\x3e\n  <a\n    href=\'ml#/explorer/{{jobUrl.url}}\'\n    ng-click="addItemToRecentlyAccessed(\'explorer\',job.job_id,  jobUrl.url)"\n    class="kuiButton kuiButton--basic kuiButton--small"\n    data-toggle="tooltip"\n    aria-label="Open Anomaly Explorer"\n    tooltip="Open {{job.job_id}} in Anomaly Explorer">\n      <i aria-hidden="true" class="fa fa-table"></i>\n  </a>\n\n  \x3c!-- time series explorer --\x3e\n  \x3c!-- if time series job, show the link. otherwise show a disabled button --\x3e\n  <a\n    ng-if=\'enableTimeSeries\'\n    href=\'ml#/timeseriesexplorer/{{jobUrl.url}}\'\n    ng-click="addItemToRecentlyAccessed(\'timeseriesexplorer\', job.job_id, jobUrl.url)"\n    class="kuiButton kuiButton--basic kuiButton--small"\n    data-toggle="tooltip"\n    aria-label="Open Single Metric Viewer"\n    tooltip="Open {{job.job_id}} in Single Metric Viewer">\n      <i aria-hidden="true" class="fa fa-line-chart"></i>\n  </a>\n  <button\n    ng-if=\'!enableTimeSeries\'\n    disabled\n    class="kuiButton kuiButton--basic kuiButton--small"\n    aria-label="Open single metric viewer"\n    data-toggle="tooltip">\n      <i aria-hidden="true" class="fa fa-line-chart"></i>\n  </button>\n\n  \x3c!-- edit job --\x3e\n  <div ng-class="checks.editButtonWrapperClass()" data-placement="right" data-toggle="tooltip"\n    ng-attr-tooltip="{{checks.editButtonWrapperTooltip()}}">\n    <button\n      ng-click="editJob(job)"\n      ng-disabled="checks.editButtonDisabled()"\n      class="kuiButton kuiButton--basic kuiButton--small"\n      aria-label="Edit job"\n      data-toggle="tooltip"\n      tooltip="Edit job" >\n        <i aria-hidden="true" class="fa fa-pencil-square-o"></i>\n    </button>\n  </div>\n\n  \x3c!-- clone job --\x3e\n  <div ng-class="checks.cloneButtonWrapperClass()" data-placement="right" data-toggle="tooltip"\n    ng-attr-tooltip="{{checks.cloneButtonWrapperTooltip()}}">\n    <button\n      ng-click="cloneJob(job)"\n      class="kuiButton kuiButton--basic kuiButton--small"\n      data-toggle="tooltip"\n      ng-disabled=\'checks.cloneButtonDisabled()\'\n      aria-label="Clone job"\n      tooltip="Clone job" >\n        <i aria-hidden="true" class="fa fa-clone"></i>\n    </button>\n  </div>\n\n  \x3c!-- delete job --\x3e\n  <div ng-class="checks.deleteButtonWrapperClass()" data-placement="right" data-toggle="tooltip"\n    ng-attr-tooltip="{{checks.deleteButtonWrapperTooltip()}}">\n    <button\n      ng-click="deleteJob(job)"\n      class="kuiButton kuiButton--danger kuiButton--small"\n      data-toggle="tooltip"\n      ng-disabled=\'checks.deleteButtonDisabled()\'\n      aria-label="Delete job"\n      tooltip="Delete job">\n        <i aria-hidden="true" class="fa fa-trash"></i>\n    </button>\n  </div>\n</div>\n'},3675:function(module,exports){module.exports='<td ng-click="toggleRow()" data-test-subj="docTableExpandToggleColumn">\n  <button class="discover-table-open-button kuiButton--hollow"\n  \taria-label="{{open ? \'Collapse row\' : \'Expand row\'}}" aria-expanded="{{open}}">\n    <span\n      class="kuiIcon"\n      ng-class="{ \'fa-caret-down\': open, \'fa-caret-right\': !open }"\n    ></span>\n  </button>\n</td>\n'},3676:function(module,exports){module.exports='<ml-nav-menu name="jobs"></ml-nav-menu>\n<ml-config-jobs ng-controller="MlJobsList">\n  <div class=\'jobs-stats-bar\'>\n    <span ng-if=\'js.show\' class=\'stat\' ng-repeat=\'js in jobStats\'>\n      <span class=\'stat-label\'>{{js.label}}</span>: <span class=\'stat-value\'>{{js.value}}</span>\n    </span>\n  </div>\n  <ml-message-bar ></ml-message-bar>\n\n  <div class="jobs-container">\n    <div ng-if="mlNodesAvailable === false && permissionToViewMlNodeCount === true" class="euiCallOut euiCallOut--warning">\n      <div class="euiCallOutHeader">\n        <svg class="euiIcon euiCallOutHeader__icon euiIcon--medium" xmlns="http://www.w3.org/2000/svg"\n            width="16" height="16" viewBox="0 0 16 16">\n          <g fill-rule="evenodd">\n            <path d="M7.5 2.236L1.618 14h11.764L7.5 2.236zm.894-.447l5.882 11.764A1 1 0 0 1 13.382 15H1.618a1 1 0 0 1-.894-1.447L6.606 1.789a1 1 0 0 1 1.788 0z"\n            />\n            <path d="M7 6h1v5H7zM7 12h1v1H7z" />\n          </g>\n        </svg>\n        <span class="euiCallOutHeader__title">No ML Nodes available</span>\n      </div>\n      <div class="euiText euiText--small">\n        <p>\n          There are no ML nodes available.\n          <span ng-if="isCloud">\n            This can be configured in Cloud\n            <a class="euiLink euiLink--primary" href="#">here</a>.\n          </span>\n        </p>\n      </div>\n    </div>\n\n    <div>\n      <header>\n        <div class="row" >\n        <div class="col-xs-6 col-md-9">\n          <div ng-class="permissions.canCreateJob ? \'button-wrapper\' : [\'button-wrapper\', \'disabled\'] " data-placement="right" data-toggle="tooltip"\n            ng-attr-tooltip="{{permissions.canCreateJob ? undefined : createPermissionFailureMessage(\'canCreateJob\')}}">\n            <button\n              ng-click=\'newJob()\'\n              class="kuiButton kuiButton--primary"\n              ng-disabled=\'permissions.canCreateJob===false || mlNodesAvailable === false\'\n              aria-label="Create new job">\n              <i aria-hidden="true" class="fa fa-plus"></i>\n              Create new job\n            </button>\n          </div>\n\n        </div>\n\n\n        <div class="col-xs-6 col-md-3">\n          <ml-form-filter-input\n            placeholder="Job filter"\n            filter="filterText"\n            filter-icon="filterIcon"\n            filter-changed="applyFilter"\n            clear-filter="clearFilter" />\n        </div>\n      </div>\n\n      </header>\n      <ml-paginated-table\n        columns="table.columns"\n        rows="table.rows"\n        per-page="table.perPage">\n      </ml-paginated-table>\n\n      <div class="no-jobs-warning" ng-show="filterText && table.rows.length===0">No jobs found</div>\n      <div class="no-jobs-warning" ng-show="noJobsCreated===true">No jobs configured</div>\n      <ml-loading-indicator\n        label="Loading jobs"\n        is-loading="noJobsCreated===undefined"\n        class="no-jobs-warning"\n      />\n\n    </div>\n  </div>\n</ml-config-jobs>\n'},3677:function(module,exports){module.exports='<div class="delete-job-modal">\n  <h1 tooltip="Delete job {{ui.jobId}}" class="euiTitle euiTitle--small">Delete job {{ui.jobId}}</h1>\n  <div ng-show="ui.stage===1" class="status-item-list">\n    <div class="status-item" ng-show="ui.isDatafeed">Deleting datafeed...\n      <i ng-show="ui.status.deleteDatafeed === -1" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>\n      <i ng-show="ui.status.deleteDatafeed === 0" aria-hidden="true" class="fa fa-spinner fa-spin"></i>\n      <i ng-show="ui.status.deleteDatafeed === 1" aria-hidden="true" style="color:green;" class="fa fa-check"></i>\n    </div>\n\n    <div class="status-item">Deleting job...\n      <i ng-show="ui.status.deleteJob === -1" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>\n      <i ng-show="ui.status.deleteJob === 0" aria-hidden="true" class="fa fa-spinner fa-spin"></i>\n      <i ng-show="ui.status.deleteJob === 1" aria-hidden="true" style="color:green;" class="fa fa-check"></i>\n    </div>\n  </div>\n  <div ng-if="ui.status.errorMessage!==\'\'" class="validation-error">\n    {{ui.status.errorMessage}} request may have timed out and may still be running in the background.<br />\n    Please check status and retry in a few minutes.\n  </div>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n  <div ng-show= "ui.stage===0">\n    <button\n      ng-disabled="ui.status.deleteLock"\n      ng-click="delete();"\n      class="kuiButton kuiButton--danger"\n      aria-label="delete">\n        Delete job\n    </button>\n\n    <button\n      ng-disabled="ui.status.deleteLock"\n      ng-click="close();"\n      class="kuiButton kuiButton--primary"\n      aria-label="cancel">\n        Cancel\n    </button>\n  </div>\n  <div ng-show= "ui.stage===1">\n    <button\n      ng-click="close();"\n      class="kuiButton kuiButton--primary"\n      aria-label="close">\n        Close\n    </button>\n  </div>\n</div>\n'},3678:function(module,exports){module.exports='<div class="edit-job-modal">\n  <ml-message-bar ></ml-message-bar>\n  <h1 tooltip="{{ui.title}}" class="euiTitle">{{ui.title}}</h1>\n\n  <div class="euiSpacer euiSpacer--m"></div>\n\n  <ul class="nav nav-tabs" >\n    <li\n      class="kbn-settings-tab"\n      ng-class="{ active: ui.currentTab === tab.index }"\n      ng-repeat="tab in ui.tabs"\n      ng-hide="ui.tabs[{{tab.index}}].hidden">\n\n      <a ng-click="ui.changeTab(tab)">\n        {{ tab.title }}\n      </a>\n    </li>\n  </ul>\n\n  \x3c!-- Job Details --\x3e\n  <div class="tab_contents" ng-show="ui.currentTab === 0">\n    <div class="form-group">\n      <ml-form-label label-id="new_job_description">Job description</ml-form-label>\n      <input\n        aria-labelledby="ml_aria_label_new_job_description"\n        aria-describedby="ml_aria_description_new_job_description"\n        ng-model="job.description"\n        class="form-control" />\n    </div>\n\n    <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n    <div class="form-group">\n      <ml-form-label label-id="new_job_group">Job Groups</ml-form-label>\n      <ml-job-group-select\n        aria-labelledby="ml_aria_label_new_job_group"\n        aria-describedby="ml_aria_description_new_job_group"\n        job-groups=\'job.groups\' />\n    </div>\n\n    <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n    <div class="form-group">\n      <ml-form-label label-id="new_job_model_memory_limit">Model memory limit</ml-form-label>\n      <input\n        aria-labelledby="ml_aria_label_new_job_model_memory_limit"\n        aria-describedby="ml_aria_description_new_job_model_memory_limit"\n        placeholder="{{ui.modelMemoryLimitDefault}}"\n        type="text"\n        ng-model=\'job.analysis_limits.model_memory_limit\'\n        class="form-control" />\n        <div ng-hide="ui.validation.tabs[0].checks.modelMemoryLimit.valid" class="validation-error">\n          {{ui.validation.tabs[0].checks.modelMemoryLimit.message}}\n        </div>\n    </div>\n\n    <div class="form-group"\n      ng-show="(job.analysis_config.categorization_field_name !== undefined && job.analysis_config.categorization_field_name !== \'\') ||\n               (job.analysis_config.categorization_filters && job.analysis_config.categorization_filters.length)">\n      <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n      <label aria-describedby="ml_aria_description_new_job_categorizationfilters">Categorization Filters</label>\n      <i ml-info-icon="new_job_categorizationfilters" />\n      <div ng-if="job.analysis_config && job.analysis_config.categorization_filters">\n        <div ng-repeat="item in job.analysis_config.categorization_filters track by $index" class="categorization-filter">\n          <div class="field-cols">\n            <div class="form-group">\n              <input\n                ng-model="job.analysis_config.categorization_filters[$index]"\n                type="text"\n                class="form-control" />\n            </div>\n          </div>\n\n          <button\n            ng-click="removeCategorizationFilter($index)"\n            tooltip-append-to-body="true"\n            type="button"\n            class="kuiButton kuiButton--danger kuiButton--small remove-button">\n              <i aria-hidden="true" class="fa fa-times"></i>\n          </button>\n        </div>\n      </div>\n      <div>\n        <button\n          aria-labelledby="ml_aria_label_add_categorization_filter"\n          ng-click="addCategorizationFilter()"\n          type="button"\n          ng-disabled="job.analysis_config.categorization_field_name === undefined || job.analysis_config.categorization_field_name === \'\'"\n          class="kuiButton kuiButton--primary kuiButton--small">\n          <i aria-hidden="true" class="fa fa-plus"></i>\n          <span id="ml_aria_label_add_categorization_filter">Add Categorization Filter</span>\n        </button>\n      </div>\n    </div>\n\n    <div ng-hide="ui.validation.tabs[0].checks.categorizationFilters.valid" class="validation-error">\n      {{ ( ui.validation.tabs[2].checks.categorizationFilters.message || "Categorization filters must all be valid regular expressions" ) }}\n    </div>\n\n  </div>\n\n  \x3c!-- Detectors --\x3e\n  <div class="tab_contents" ng-show="ui.currentTab === 1">\n    <label class="kuiFormLabel">Edit detector descriptions</label>\n    <div ml-job-detectors-list\n      ml-detectors="job.analysis_config.detectors"\n      ml-indices="indices"\n      ml-properties="properties"\n      ml-edit-mode="\'EDIT\'"\n      ></div>\n  </div>\n\n  \x3c!-- Datafeed --\x3e\n  <div class="tab_contents" ng-show="ui.currentTab === 2">\n\n    <div ng-show="ui.datafeedStopped" >\n      <div class="form-group" >\n        <ml-form-label label-id="new_job_datafeed_query">Query</ml-form-label>\n        <input\n          aria-labelledby="ml_aria_label_new_job_datafeed_query"\n          aria-describedby="ml_aria_description_new_job_datafeed_query"\n          ng-model="ui.datafeed.queryText"\n          placeholder=\'{ "match_all": {}}\'\n          class="form-control" />\n\n      </div>\n      <div class="form-group" >\n        <ml-form-label label-id="new_job_datafeed_query_delay">Query delay</ml-form-label>\n        <input\n          aria-labelledby="ml_aria_label_new_job_datafeed_query_delay"\n          aria-describedby="ml_aria_description_new_job_datafeed_query_delay"\n          ng-model="ui.datafeed.queryDelayText"\n          placeholder="{{ui.datafeed.queryDelayDefault}}"\n          min="0"\n          class="form-control" />\n\n      </div>\n      <div class="form-group" >\n        <ml-form-label label-id="new_job_datafeed_frequency">Frequency</ml-form-label>\n        <input\n          aria-labelledby="ml_aria_label_new_job_datafeed_frequency"\n          aria-describedby="ml_aria_description_new_job_datafeed_frequency"\n          ng-model="ui.datafeed.frequencyText"\n          placeholder="{{ui.datafeed.frequencyDefault}}"\n          min="0"\n          class="form-control" />\n\n      </div>\n      <div class="form-group" >\n        <ml-form-label label-id="new_job_datafeed_scrollsize">scroll_size</ml-form-label>\n        <input\n          aria-labelledby="ml_aria_label_new_job_datafeed_scrollsize"\n          aria-describedby="ml_aria_description_new_job_datafeed_scrollsize"\n          ng-model="ui.datafeed.scrollSizeText"\n          placeholder="{{ui.datafeed.scrollSizeDefault}}"\n          type="number"\n          min="0"\n          class="form-control" />\n      </div>\n    </div>\n    <div ng-hide="ui.datafeedStopped" class="kuiText">\n      <div>Datafeed settings cannot be edited while the datafeed is running.</div>\n      <div ng-show="ui.stoppingDatafeed===false"><a ng-click="stopDatafeed()">Stop datafeed now</a></div>\n      <div ng-show="ui.stoppingDatafeed===true">Stopping...</div>\n    </div>\n  </div>\n\n  \x3c!-- Custom URLs --\x3e\n  <div class="tab_contents" ng-show="ui.currentTab === 3">\n    <div class="form-group">\n      <div ng-if="job.custom_settings && job.custom_settings.custom_urls">\n        <div ng-repeat="item in job.custom_settings.custom_urls track by $index" class="custom-url">\n\n            <div class="form-group label-input">\n              <label id="ml_aria_label_custom_url_label_{{$index}}" class="kuiFormLabel">Label</label>\n              <input\n                aria-labelledby="ml_aria_label_custom_url_label_{{$index}}"\n                ng-model="item.url_name"\n                type="text"\n                class="kuiTextInput form-control" />\n              <div ng-show="item.url_name === \'\'" class="validation-error">Enter a label</div>\n            </div>\n\n\n          <div class="field-cols">\n            <div class="form-group">\n              <label id="ml_aria_label_custom_url_{{$index}}" class="kuiFormLabel">URL</label>\n              <textarea\n                aria-labelledby="ml_aria_label_custom_url_{{$index}}"\n                ng-model="item.url_value"\n                type="text"\n                class="form-control" ></textarea>\n            </div>\n          </div>\n\n          <div class="form-group time-input">\n            <label id="ml_aria_label_custom_url_time_{{$index}}" class="kuiFormLabel">Time range</label>\n            <input\n              aria-labelledby="ml_aria_label_custom_url_time_{{$index}}"\n              ng-model="item.time_range"\n              ng-change="customUrlTimeRangeChanged($index)"\n              type="text"\n              class="form-control" />\n            <div ng-show="item.timeRangeError === true" class="validation-error">Invalid format</div>\n          </div>\n\n          <button\n            ng-if="showTestLinkForCustomUrl($index)"\n            ng-click="testCustomUrl($index)"\n            tooltip="Test custom URL"\n            tooltip-append-to-body="false"\n            aria-label="Test custom URL"\n            data-toggle="tooltip"\n            type="button"\n            class="kuiButton kuiButton--basic kuiButton--small test-url-button">\n              <i aria-hidden="true" class="fa fa-share-square-o"></i>\n          </button>\n\n          <button\n            ng-click="removeCustomUrl($index)"\n            tooltip="Delete custom URL"\n            tooltip-append-to-body="false"\n            aria-label="Delete custom URL"\n            data-toggle="tooltip"\n            type="button"\n            class="kuiButton kuiButton--danger kuiButton--small remove-button">\n              <i aria-hidden="true" class="fa fa-trash"></i>\n          </button>\n        </div>\n      </div>\n      <div ng-hide="ui.editingNewCustomUrl === true">\n        <button\n          aria-labelledby="ml_aria_label_new_job_custom_urls"\n          aria-describedby="ml_aria_description_new_job_custom_urls"\n          ng-click="editNewCustomUrl()"\n          type="button"\n          class="kuiButton kuiButton--primary kuiButton--small">\n          <i aria-hidden="true" class="fa fa-plus" />\n          <span id="ml_aria_label_new_job_custom_urls">Add Custom URL</span>\n        </button>\n      </div>\n      <div ng-show="ui.editingNewCustomUrl === true" class="custom-url-editor">\n        <h3 class="euiTitle">Create new custom URL</h3>\n        <ml-custom-url-editor\n          add-custom-url="addCustomUrl"\n          job="job">\n        </ml-custom-url-editor>\n      </div>\n    </div>\n  </div>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n  <button\n    ng-click="save()"\n    ng-disabled="(saveLock === true)"\n    class="kuiButton kuiButton--primary" >\n    Update\n  </button>\n  <button\n    ng-click="cancel()"\n    ng-disabled="(saveLock === true)"\n    class="kuiButton kuiButton--primary"\n    aria-label="Cancel">\n    Cancel\n  </button>\n</div>\n'},3679:function(module,exports){module.exports='<ml-message-bar ></ml-message-bar>\n<div class="create-watch-modal">\n  <h1 class="euiTitle">Create watch for {{jobId}}</h1>\n  <div class="euiSpacer euiSpacer--s"></div>\n\n  <div ng-if=\'watcherEnabled===true\'>\n    <ml-create-watch\n      job-id=\'jobId\'\n      bucket-span=\'bucketSpan\'\n      include-influencers=\'includeInfluencers\'\n    ></ml-create-watch>\n\n\n    <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n    <div ng-show= "status.watch===null">\n      <button\n        aria-label="Create watch"\n        ng-click="apply()"\n        type="button"\n        class="kuiButton kuiButton--primary">\n          Apply\n      </button>\n\n      <button\n        ng-disabled="status.deleteLock"\n        ng-click="close();"\n        class="kuiButton kuiButton--primary"\n        aria-label="cancel">\n          Cancel\n      </button>\n    </div>\n    <div ng-show= "status.watch === STATUS.SAVED || status.watch === STATUS.SAVE_FAILED">\n      <button\n        ng-click="close();"\n        class="kuiButton kuiButton--primary"\n        aria-label="close">\n          Close\n      </button>\n    </div>\n  </div>\n\n  <div ng-if=\'watcherEnabled===false\'>\n    Watcher is not enabled.\n    <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n    <button\n      ng-click="close();"\n      class="kuiButton kuiButton--primary"\n      aria-label="close">\n        Close\n    </button>\n  </div>\n\n</div>\n'},368:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ML_RESULTS_INDEX_PATTERN=".ml-anomalies-*";exports.ML_NOTIFICATION_INDEX_PATTERN=".ml-notifications"},3680:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.buttonsEnabledChecks=buttonsEnabledChecks;var _states=__webpack_require__(321);var _check_privilege=__webpack_require__(35);function buttonsEnabledChecks(permissions,job,mlNodesAvailable){var NO_ML_NODES_ERROR="No ML nodes available";function startButtonWrapperClass(){return permissions.canStartStopDatafeed&&mlNodesAvailable?"button-wrapper":["button-wrapper","disabled"]}function startButtonWrapperTooltip(){var tooltip=void 0;false===permissions.canStartStopDatafeed?tooltip=(0,_check_privilege.createPermissionFailureMessage)("canStartStopDatafeed"):false===mlNodesAvailable&&(tooltip=NO_ML_NODES_ERROR);return tooltip}function startButtonVisible(){return job.datafeed_config&&job.datafeed_config.state!==_states.DATAFEED_STATE.STOPPING&&job.datafeed_config.state!==_states.DATAFEED_STATE.STARTING}function startButtonTooltip(){return(job.datafeed_config&&job.datafeed_config.state===_states.DATAFEED_STATE.STARTED?"Stop datafeed for":"Start datafeed for")+" job.job_id"}function startButtonAriaLabel(){return(job.datafeed_config&&job.datafeed_config.state===_states.DATAFEED_STATE.STARTED?"Stop":"Start")+" datafeed"}function startButtonDisabled(){return void 0===job.datafeed_config.datafeed_id||false===permissions.canStartStopDatafeed||job.state===_states.JOB_STATE.CLOSING||job.state===_states.JOB_STATE.OPENING||job.state===_states.JOB_STATE.FAILED||false===mlNodesAvailable}function buttonIcon(){if(job.datafeed_config&&job.datafeed_config.state===_states.DATAFEED_STATE.STARTED&&job.state!==_states.JOB_STATE.FAILED)return"fa fa-stop";if(job.datafeed_config&&job.datafeed_config.state===_states.DATAFEED_STATE.STOPPED&&(job.state===_states.JOB_STATE.OPENED||job.state===_states.JOB_STATE.CLOSED))return"fa fa-play";if(job.state===_states.JOB_STATE.FAILED)return"fa fa-play";if(job.datafeed_config&&job.datafeed_config.state===_states.DATAFEED_STATE.STOPPED&&(job.state===_states.JOB_STATE.CLOSING||job.state===_states.JOB_STATE.OPENING))return"fa fa-clock-o";if(job.datafeed_config&&void 0===job.datafeed_config.state)return"fa fa-play"}function loadingButtonVisible(){return!job.datafeed_config||job.datafeed_config.state===_states.DATAFEED_STATE.STOPPING||job.datafeed_config.state===_states.DATAFEED_STATE.STARTING}function editButtonWrapperClass(){return permissions.canUpdateJob?"button-wrapper":["button-wrapper","disabled"]}function editButtonWrapperTooltip(){return permissions.canUpdateJob?void 0:(0,_check_privilege.createPermissionFailureMessage)("canUpdateJob")}function editButtonDisabled(){return false===permissions.canUpdateJob||false===permissions.canUpdateDatafeed}function cloneButtonWrapperClass(){return permissions.canCreateJob&&mlNodesAvailable?"button-wrapper":["button-wrapper","disabled"]}function cloneButtonWrapperTooltip(){var tooltip=void 0;false===permissions.canCreateJob?tooltip=(0,_check_privilege.createPermissionFailureMessage)("canCreateJob"):false===mlNodesAvailable&&(tooltip=NO_ML_NODES_ERROR);return tooltip}function cloneButtonDisabled(){return false===permissions.canCreateJob||false===mlNodesAvailable}function deleteButtonWrapperClass(){return permissions.canDeleteJob?"button-wrapper":["button-wrapper","disabled"]}function deleteButtonWrapperTooltip(){return permissions.canDeleteJob?void 0:(0,_check_privilege.createPermissionFailureMessage)("canDeleteJob")}function deleteButtonDisabled(){return false===permissions.canDeleteJob}return{startButtonWrapperClass:startButtonWrapperClass,startButtonWrapperTooltip:startButtonWrapperTooltip,startButtonVisible:startButtonVisible,startButtonTooltip:startButtonTooltip,startButtonAriaLabel:startButtonAriaLabel,startButtonDisabled:startButtonDisabled,buttonIcon:buttonIcon,loadingButtonVisible:loadingButtonVisible,editButtonWrapperClass:editButtonWrapperClass,editButtonWrapperTooltip:editButtonWrapperTooltip,editButtonDisabled:editButtonDisabled,cloneButtonWrapperClass:cloneButtonWrapperClass,cloneButtonWrapperTooltip:cloneButtonWrapperTooltip,cloneButtonDisabled:cloneButtonDisabled,deleteButtonWrapperClass:deleteButtonWrapperClass,deleteButtonWrapperTooltip:deleteButtonWrapperTooltip,deleteButtonDisabled:deleteButtonDisabled}}},3681:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.cloudServiceProvider=cloudServiceProvider;function cloudServiceProvider(config){function isRunningOnCloud(){try{return config.get("cloud.enabled")}catch(error){return false}}function getCloudId(){try{return config.get("cloud.id")}catch(error){return}}return{isRunningOnCloud:isRunningOnCloud,getCloudId:getCloudId}}},3682:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.jobMessagesService=void 0;var _index_patterns=__webpack_require__(368);var _ml_api_service=__webpack_require__(23);function getJobAuditMessages(fromRange,jobId){return new Promise(function(resolve,reject){var jobFilter={};void 0!==jobId&&(jobFilter={bool:{should:[{term:{job_id:""}},{term:{job_id:jobId}}]}});var timeFilter={};void 0!==fromRange&&""!==fromRange&&(timeFilter={range:{timestamp:{gte:"now-"+fromRange,lte:"now"}}});_ml_api_service.ml.esSearch({index:_index_patterns.ML_NOTIFICATION_INDEX_PATTERN,ignore_unavailable:true,size:1e3,body:{sort:[{timestamp:{order:"asc"}},{job_id:{order:"asc"}}],query:{bool:{filter:[{bool:{must_not:{term:{level:"activity"}}}},jobFilter,timeFilter]}}}}).then(function(resp){var messages=[];0!==resp.hits.total&&(messages=resp.hits.hits.map(function(hit){return hit._source}));resolve({messages:messages})}).catch(function(resp){reject(resp)})})}function getAuditMessagesSummary(){return new Promise(function(resolve,reject){_ml_api_service.ml.esSearch({index:_index_patterns.ML_NOTIFICATION_INDEX_PATTERN,ignore_unavailable:true,size:0,body:{query:{bool:{filter:{range:{timestamp:{gte:"now-1d"}}}}},aggs:{levelsPerJob:{terms:{field:"job_id"},aggs:{levels:{terms:{field:"level"},aggs:{latestMessage:{terms:{field:"message.raw",size:1,order:{latestMessage:"desc"}},aggs:{latestMessage:{max:{field:"timestamp"}}}}}}}}}}}).then(function(resp){var messagesPerJob=[];0!==resp.hits.total&&resp.aggregations&&resp.aggregations.levelsPerJob&&resp.aggregations.levelsPerJob.buckets&&resp.aggregations.levelsPerJob.buckets.length&&(messagesPerJob=resp.aggregations.levelsPerJob.buckets);resolve({messagesPerJob:messagesPerJob})}).catch(function(resp){reject(resp)})})}exports.jobMessagesService={getJobAuditMessages:getJobAuditMessages,getAuditMessagesSummary:getAuditMessagesSummary}},3683:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3684);__webpack_require__(3700);__webpack_require__(424)},3684:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);__webpack_require__(1417);__webpack_require__(3698);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _numeral=__webpack_require__(88);var _numeral2=_interopRequireDefault(_numeral);var _job_utils=__webpack_require__(41);var _parse_interval=__webpack_require__(127);var _custom_url_editor_service=__webpack_require__(3699);var _string_utils=__webpack_require__(40);var _new_job_defaults=__webpack_require__(253);var _job_service=__webpack_require__(24);var _messagebar_service=__webpack_require__(79);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.controller("MlEditJobModal",function($scope,$modalInstance,$modal,$window,params){var msgs=_messagebar_service.mlMessageBarService;msgs.clear();$scope.saveLock=false;var refreshJob=params.pscope.refreshJob;$scope.job=_angular2.default.copy(params.job);var CUSTOM_URL_TIME_RANGE_AUTO="auto";var bucketSpan=(0,_parse_interval.parseInterval)($scope.job.analysis_config.bucket_span);var jobLimits=(0,_new_job_defaults.newJobLimits)();$scope.ui={title:"Edit "+$scope.job.job_id,currentTab:0,tabs:[{index:0,title:"Job Details",hidden:false},{index:1,title:"Detectors",hidden:false},{index:2,title:"Datafeed",hidden:true},{index:3,title:"Custom URLs",hidden:false}],changeTab:function changeTab(tab){$scope.ui.currentTab=tab.index},isDatafeed:false,datafeedStopped:false,datafeed:{scrollSizeDefault:1e3,queryDelayDefault:"60s",frequencyDefault:(0,_job_utils.calculateDatafeedFrequencyDefaultSeconds)(bucketSpan.asSeconds())+"s"},stoppingDatafeed:false,validation:{tabs:[{index:0,valid:true,checks:{categorizationFilters:{valid:true},modelMemoryLimit:{valid:true}}}]},editingNewCustomUrl:false,modelMemoryLimitDefault:null};if($scope.job.datafeed_config){var datafeedConfig=$scope.job.datafeed_config;$scope.ui.isDatafeed=true;$scope.ui.tabs[2].hidden=false;$scope.ui.datafeedStopped=!$scope.job.datafeed_config||"stopped"===$scope.job.datafeed_config.state;$scope.ui.datafeed.queryText=_angular2.default.toJson(datafeedConfig.query,true);$scope.ui.datafeed.queryDelayText=datafeedConfig.query_delay;$scope.ui.datafeed.frequencyText=datafeedConfig.frequency;$scope.ui.datafeed.scrollSizeText=datafeedConfig.scroll_size}$scope.job.custom_settings&&$scope.job.custom_settings.custom_urls&&$scope.job.custom_settings.custom_urls.forEach(function(customUrl){void 0===customUrl.time_range&&(customUrl.time_range=CUSTOM_URL_TIME_RANGE_AUTO)});if(void 0===$scope.job.analysis_limits)$scope.job.analysis_limits={};else if(void 0!==$scope.job.analysis_limits.model_memory_limit){$scope.ui.modelMemoryLimitDefault=$scope.job.analysis_limits.model_memory_limit;if(void 0!==jobLimits.max_model_memory_limit){var maxBytes=(0,_numeral2.default)(jobLimits.max_model_memory_limit.toUpperCase()).value();var mmlBytes=(0,_numeral2.default)($scope.job.analysis_limits.model_memory_limit.toUpperCase()).value();mmlBytes>maxBytes&&($scope.ui.modelMemoryLimitDefault=maxBytes/(0,_numeral2.default)("1MB").value()+"MB")}}$scope.editNewCustomUrl=function(){$scope.ui.editingNewCustomUrl=true};$scope.addCustomUrl=function(customUrl){$scope.job.custom_settings||($scope.job.custom_settings={});$scope.job.custom_settings.custom_urls||($scope.job.custom_settings.custom_urls=[]);$scope.job.custom_settings.custom_urls.push(customUrl);$scope.ui.editingNewCustomUrl=false};$scope.removeCustomUrl=function(index){$scope.job.custom_settings.custom_urls.splice(index,1)};$scope.customUrlTimeRangeChanged=function(index){var customUrl=$scope.job.custom_settings.custom_urls[index];var timeRange=customUrl.time_range;var interval=(0,_parse_interval.parseInterval)(timeRange);customUrl.timeRangeError=null===interval&&timeRange!==CUSTOM_URL_TIME_RANGE_AUTO};$scope.showTestLinkForCustomUrl=function(index){return(0,_string_utils.isWebUrl)($scope.job.custom_settings.custom_urls[index].url_value)};$scope.testCustomUrl=function(index){_custom_url_editor_service.customUrlEditorService.getTestUrl($scope.job,$scope.job.custom_settings.custom_urls[index]).then(function(testUrl){$window.open(testUrl,"_blank")}).catch(function(resp){console.log("testCustomUrl() - error obtaining URL for test:",resp)})};$scope.addCategorizationFilter=function(){if($scope.job.analysis_config){$scope.job.analysis_config.categorization_filters||($scope.job.analysis_config.categorization_filters=[]);$scope.job.analysis_config.categorization_filters.push("")}};$scope.removeCategorizationFilter=function(index){$scope.job.analysis_config&&$scope.job.analysis_config.categorization_filters&&$scope.job.analysis_config.categorization_filters.splice(index,1)};$scope.stopDatafeed=function(){var datafeedId=$scope.job.datafeed_config.datafeed_id;var jobId=$scope.job.job_id;$scope.ui.stoppingDatafeed=true;_job_service.mlJobService.stopDatafeed(datafeedId,jobId).then(function(resp){true===resp.stopped&&($scope.ui.datafeedStopped=true)})};function validateJob(){var valid=true;var tabs=$scope.ui.validation.tabs;_lodash2.default.each(tabs,function(tab){tab.valid=true;_lodash2.default.each(tab.checks,function(check,c){tab.checks[c].valid=true;tab.checks[c].message=""})});if($scope.job.analysis_config.categorization_filters){var v=true;_lodash2.default.each($scope.job.analysis_config.categorization_filters,function(d){try{new RegExp(d)}catch(e){v=false}if(""===d||false===v){tabs[0].checks.categorization_filters.valid=false;valid=false}})}var mml=$scope.job.analysis_limits.model_memory_limit;var maxMml=jobLimits.max_model_memory_limit;if(void 0!==maxMml&&(void 0!==mml||""!==mml)){var _maxBytes=(0,_numeral2.default)(maxMml.toUpperCase()).value();var _mmlBytes=(0,_numeral2.default)(mml.toUpperCase()).value();if(_mmlBytes>_maxBytes){tabs[0].checks.modelMemoryLimit.valid=false;var msg="Model memory limit cannot be higher than the maximum value of "+maxMml;tabs[0].checks.modelMemoryLimit.message=msg;valid=false}}return valid}$scope.save=function(){msgs.clear();if(false===validateJob())return;$scope.saveLock=true;var jobId=$scope.job.job_id;var jobData={};var datafeedData={};$scope.job.description!==params.job.description&&(jobData.description=$scope.job.description);Array.isArray($scope.job.groups)&&(jobData.groups=$scope.job.groups);if(void 0!==$scope.job.analysis_limits.model_memory_limit){var mml=$scope.job.analysis_limits.model_memory_limit;""===mml&&(mml=$scope.ui.modelMemoryLimitDefault);void 0!==params.job.analysis_limits&&mml===params.job.analysis_limits.model_memory_limit||(jobData.analysis_limits={model_memory_limit:mml})}_lodash2.default.each($scope.job.analysis_config.detectors,function(d,i){var changes=0;var obj={detector_index:i};if(d.detector_description!==params.job.analysis_config.detectors[i].detector_description){obj.description=d.detector_description;changes++}if(changes>0){void 0===jobData.detectors&&(jobData.detectors=[]);jobData.detectors.push(obj)}});if($scope.job.analysis_config.categorization_filters){var doUpdate=false;$scope.job.analysis_config.categorization_filters.length!==params.job.analysis_config.categorization_filters.length&&(doUpdate=true);_lodash2.default.each($scope.job.analysis_config.categorization_filters,function(d,i){d!==params.job.analysis_config.categorization_filters[i]&&(doUpdate=true)});doUpdate&&(jobData.categorization_filters=$scope.job.analysis_config.categorization_filters)}if($scope.job.custom_settings)if($scope.job.custom_settings.custom_urls&&$scope.job.custom_settings.custom_urls.length){var _doUpdate=false;params.job.custom_settings&&params.job.custom_settings.custom_urls&&params.job.custom_settings.custom_urls.length?$scope.job.custom_settings.custom_urls.length!==params.job.custom_settings.custom_urls.length?_doUpdate=true:_lodash2.default.each($scope.job.custom_settings.custom_urls,function(url,i){url.url_name===params.job.custom_settings.custom_urls[i].url_name&&url.url_value===params.job.custom_settings.custom_urls[i].url_value&&url.time_range===params.job.custom_settings.custom_urls[i].time_range||(_doUpdate=true)}):_doUpdate=true;if(_doUpdate){jobData.custom_settings=$scope.job.custom_settings;$scope.job.custom_settings.custom_urls.forEach(function(customUrl){delete customUrl.timeRangeError})}}else(params.job.custom_settings||params.job.custom_settings.custom_urls||params.job.custom_settings.custom_urls.length)&&(jobData.custom_settings={});if($scope.job.datafeed_config&&$scope.ui.datafeedStopped){var sch=$scope.ui.datafeed;""===sch.queryText&&(sch.queryText='{"match_all":{}}');var query=sch.queryText;try{query=JSON.parse(query)}catch(e){console.log("save(): could not parse query JSON")}var originalQueryText=_angular2.default.toJson($scope.job.datafeed_config.query,true);originalQueryText!==sch.queryText&&(datafeedData.query=query);sch.queryDelayText!==$scope.job.datafeed_config.query_delay&&(datafeedData.query_delay=""===sch.queryDelayText||null===sch.queryDelayText||void 0===sch.queryDelayText?sch.queryDelayDefault:sch.queryDelayText);sch.frequencyText!==$scope.job.datafeed_config.frequency&&(datafeedData.frequency=""===sch.frequencyText||null===sch.frequencyText||void 0===sch.frequencyText?sch.frequencyDefault:sch.frequencyText);sch.scrollSizeText!==$scope.job.datafeed_config.scroll_size&&(datafeedData.scroll_size=""===sch.scrollSizeText||null===sch.scrollSizeText||void 0===sch.scrollSizeText?sch.scrollSizeDefault:sch.scrollSizeText)}Object.keys(jobData).length?_job_service.mlJobService.updateJob(jobId,jobData).then(function(resp){resp.success?saveDatafeed():saveFail(resp)}):saveDatafeed();function saveDatafeed(){if(Object.keys(datafeedData).length){var datafeedId=$scope.job.datafeed_config.datafeed_id;_job_service.mlJobService.updateDatafeed(datafeedId,datafeedData).then(function(resp){resp.success?saveComplete():saveFail(resp)})}else saveComplete()}function saveComplete(){$scope.saveLock=false;msgs.clear();refreshJob(jobId);$modalInstance.close()}function saveFail(resp){$scope.saveLock=false;msgs.error(resp.message)}};$scope.cancel=function(){msgs.clear();$modalInstance.close()}})},3685:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3686);__webpack_require__(3687);__webpack_require__(3688)},3686:function(module,exports){},3687:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _string_utils=__webpack_require__(40);var _messagebar_service=__webpack_require__(79);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.controller("MlDetectorModal",function($scope,$modalInstance,params){var msgs=_messagebar_service.mlMessageBarService;msgs.clear();$scope.title="Add new detector";$scope.detector={function:""};$scope.saveLock=false;$scope.editMode=false;var index=-1;$scope.functions=[{id:"count",uri:"ml-count-functions.html#ml-count"},{id:"low_count",uri:"ml-count-functions.html#ml-count"},{id:"high_count",uri:"ml-count-functions.html#ml-count"},{id:"non_zero_count",uri:"ml-count-functions.html#ml-nonzero-count"},{id:"low_non_zero_count",uri:"ml-count-functions.html#ml-nonzero-count"},{id:"high_non_zero_count",uri:"ml-count-functions.html#ml-nonzero-count"},{id:"distinct_count",uri:"ml-count-functions.html#ml-distinct-count"},{id:"low_distinct_count",uri:"ml-count-functions.html#ml-distinct-count"},{id:"high_distinct_count",uri:"ml-count-functions.html#ml-distinct-count"},{id:"rare",uri:"ml-rare-functions.html#ml-rare"},{id:"freq_rare",uri:"ml-rare-functions.html#ml-freq-rare"},{id:"info_content",uri:"ml-info-functions.html#ml-info-content"},{id:"low_info_content",uri:"ml-info-functions.html#ml-info-content"},{id:"high_info_content",uri:"ml-info-functions.html#ml-info-content"},{id:"metric",uri:"ml-metric-functions.html#ml-metric-metric"},{id:"median",uri:"ml-metric-functions.html#ml-metric-median"},{id:"low_median",uri:"ml-metric-functions.html#ml-metric-median"},{id:"high_median",uri:"ml-metric-functions.html#ml-metric-median"},{id:"mean",uri:"ml-metric-functions.html#ml-metric-mean"},{id:"low_mean",uri:"ml-metric-functions.html#ml-metric-mean"},{id:"high_mean",uri:"ml-metric-functions.html#ml-metric-mean"},{id:"min",uri:"ml-metric-functions.html#ml-metric-min"},{id:"max",uri:"ml-metric-functions.html#ml-metric-max"},{id:"varp",uri:"ml-metric-functions.html#ml-metric-varp"},{id:"low_varp",uri:"ml-metric-functions.html#ml-metric-varp"},{id:"high_varp",uri:"ml-metric-functions.html#ml-metric-varp"},{id:"sum",uri:"ml-sum-functions.html#ml-sum"},{id:"low_sum",uri:"ml-sum-functions.html#ml-sum"},{id:"high_sum",uri:"ml-sum-functions.html#ml-sum"},{id:"non_null_sum",uri:"ml-sum-functions.html#ml-nonnull-sum"},{id:"low_non_null_sum",uri:"ml-sum-functions.html#ml-nonnull-sum"},{id:"high_non_null_sum",uri:"ml-sum-functions.html#ml-nonnull-sum"},{id:"time_of_day",uri:"ml-time-functions.html#ml-time-of-day"},{id:"time_of_week",uri:"ml-time-functions.html#ml-time-of-week"},{id:"lat_long",uri:"ml-geo-functions.html#ml-lat-long"}];$scope.functionIds={};_lodash2.default.each($scope.functions,function(f){$scope.functionIds[f.id]=""});$scope.fields=params.fields;$scope.fields_byFieldName=_angular2.default.copy($scope.fields);params.catFieldNameSelected&&($scope.fields_byFieldName.mlcategory="mlcategory");var validate=params.validate;var add=params.add;if(params.detector){$scope.detector=params.detector;index=params.index;$scope.title="Edit detector";$scope.editMode=true}$scope.detectorToString=_string_utils.detectorToString;$scope.helpLink={};$scope.functionChange=function(){var func=_lodash2.default.findWhere($scope.functions,{id:$scope.detector.function});$scope.helpLink.label="Help for analytical functions";$scope.helpLink.uri="ml-functions.html";if(func){$scope.helpLink.uri=func.uri;$scope.helpLink.label="Help for "+func.id}};$scope.functionChange();$scope.setDetectorProperty=function(value,field){""===value||void 0===value?delete $scope.detector[field]:$scope.detector[field]=value;"function"===field&&$scope.functionChange()};$scope.save=function(){$scope.saveLock=true;validate($scope.detector).then(function(resp){$scope.saveLock=false;if(resp.success){""===$scope.detector.detector_description&&delete $scope.detector.detector_description;add($scope.detector,index);$modalInstance.close($scope.detector);msgs.clear()}else msgs.error(resp.message)})};$scope.cancel=function(){msgs.clear();$modalInstance.close()}})},3688:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3689)},3689:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);__webpack_require__(3690);var _metadata=__webpack_require__(91);var _modules=__webpack_require__(2);var _documentation_help_link_view=__webpack_require__(3691);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlDocumentationHelpLink",function(){return{scope:{uri:"@mlUri",label:"@mlLabel"},restrict:"AE",replace:true,link:function link(scope,element){var baseUrl="https://www.elastic.co";var version=_metadata.metadata.branch;var props={fullUrl:baseUrl+"/guide/en/x-pack/"+version+"/"+scope.uri,label:scope.label};_reactDom2.default.render(_react2.default.createElement(_documentation_help_link_view.DocumentationHelpLink,props),element[0])}}})},369:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlCreateWatchService=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _http_service=__webpack_require__(499);var _email=__webpack_require__(3654);var _email2=_interopRequireDefault(_email);var _emailInfluencers=__webpack_require__(3655);var _emailInfluencers2=_interopRequireDefault(_emailInfluencers);var _watch=__webpack_require__(3656);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var compiledEmailBody=_lodash2.default.template(_email2.default);var emailSection={send_email:{throttle_period_in_millis:9e5,email:{profile:"standard",to:[],subject:"ML Watcher Alert",body:{html:""}}}};function randomNumber(min,max){return Math.floor(Math.random()*(max-min+1)+min)}function saveWatch(watchModel){var basePath=_chrome2.default.addBasePath("/api/watcher");var url=basePath+"/watch/"+watchModel.id;return(0,_http_service.http)({url:url,method:"PUT",data:watchModel.upstreamJSON})}var CreateWatchService=function(){function CreateWatchService(){_classCallCheck(this,CreateWatchService);this.createNewWatch=function(jobId){var _this=this;return new Promise(function(resolve,reject){_this.status.watch=_this.STATUS.SAVING;if(void 0!==jobId){var id="ml-"+jobId;_this.config.id=id;_watch.watch.input.search.request.body.query.bool.filter[0].term.job_id=jobId;_watch.watch.input.search.request.body.query.bool.filter[1].range.timestamp.gte="now-"+_this.config.interval;_watch.watch.input.search.request.body.aggs.bucket_results.filter.range.anomaly_score.gte=_this.config.threshold.val;if(_this.config.includeEmail&&""!==_this.config.email){var emails=_this.config.email.split(",");emailSection.send_email.email.to=emails;emailSection.send_email.email.body.html=compiledEmailBody({serverAddress:_chrome2.default.getAppUrl(),influencersSection:true===_this.config.includeInfluencers?_emailInfluencers2.default:""});_watch.watch.actions.send_email=emailSection.send_email}var triggerInterval=randomNumber(60,120);_watch.watch.trigger.schedule.interval=triggerInterval+"s";var watchModel={id:id,upstreamJSON:{id:id,type:"json",watch:_watch.watch}};""!==id&&saveWatch(watchModel).then(function(){_this.status.watch=_this.STATUS.SAVED;_this.config.watcherEditURL=_chrome2.default.getBasePath()+"/app/kibana#/management/elasticsearch/watcher/watches/watch/"+id+"/edit?_g=()";resolve({id:id,url:_this.config.watcherEditURL})}).catch(function(resp){_this.status.watch=_this.STATUS.SAVE_FAILED;reject(resp)})}else{_this.status.watch=_this.STATUS.SAVE_FAILED;reject()}})};this.config={};this.STATUS={SAVE_FAILED:-1,SAVING:0,SAVED:1};this.status={realtimeJob:null,watch:null}}_createClass(CreateWatchService,[{key:"reset",value:function reset(){this.status.realtimeJob=null;this.status.watch=null;this.config.id="";this.config.includeEmail=false;this.config.email="";this.config.interval="20m";this.config.watcherEditURL="";this.config.includeInfluencers=false;this.config.threshold={display:"critical",val:75}}},{key:"loadWatch",value:function loadWatch(jobId){var id="ml-"+jobId;var basePath=_chrome2.default.addBasePath("/api/watcher");var url=basePath+"/watch/"+id;return(0,_http_service.http)({url:url,method:"GET"})}}]);return CreateWatchService}();exports.mlCreateWatchService=new CreateWatchService},3690:function(module,exports){},3691:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DocumentationHelpLink=DocumentationHelpLink;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DocumentationHelpLink(_ref){var fullUrl=_ref.fullUrl,label=_ref.label;return _react2.default.createElement("a",{href:fullUrl,rel:"noopener noreferrer",target:"_blank",className:"documentation-help-link"},label," ",_react2.default.createElement(_eui.EuiIcon,{type:"popout"}))}DocumentationHelpLink.propTypes={fullUrl:_propTypes2.default.string.isRequired,label:_propTypes2.default.string.isRequired}},3692:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3693);__webpack_require__(3694)},3693:function(module,exports){},3694:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _messagebar_service=__webpack_require__(79);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.controller("MlDetectorFilterModal",function($scope,$modalInstance,params){var msgs=_messagebar_service.mlMessageBarService;msgs.clear();$scope.title="Add new filter";$scope.detector=params.detector;$scope.saveLock=false;$scope.editMode=false;var index=-1;var add=params.add;var validate=params.validate;$scope.fields=[];$scope.detector.field_name&&$scope.fields.push($scope.detector.field_name);$scope.detector.by_field_name&&$scope.fields.push($scope.detector.by_field_name);$scope.detector.over_field_name&&$scope.fields.push($scope.detector.over_field_name);$scope.detector.partition_field_name&&$scope.fields.push($scope.detector.partition_field_name);if(void 0===params.filter)$scope.filter={ruleAction:"filter_results",target_field_name:"",target_field_value:"",conditions_connective:"or",conditions:[],value_list:[]};else{$scope.editMode=true;$scope.filter=params.filter;$scope.title="Edit filter";index=params.index}$scope.ui={ruleAction:["filter_results"],target_field_name:"",target_field_value:"",conditions_connective:["or","and"],ruleCondition:{condition_type:[{label:"actual",value:"numerical_actual"},{label:"typical",value:"numerical_typical"},{label:"|actual - typical|",value:"numerical_diff_abs"}],field_name:"",field_value:"",condition:{operator:[{label:"<",value:"lt"},{label:">",value:"gt"},{label:"<=",value:"lte"},{label:">=",value:"gte"}]},value_list:[]}};$scope.addNewCondition=function(){$scope.filter.conditions.push({condition_type:"numerical_actual",field_name:"",field_value:"",condition:{operator:"lt",value:""}})};$scope.removeCondition=function(idx){$scope.filter.conditions.splice(idx,1)};$scope.helpLink={};$scope.save=function(){var filter=_angular2.default.copy($scope.filter);if(!filter.conditions.length)return;$scope.saveLock=true;""===filter.target_field_name&&delete filter.target_field_name;""===filter.target_field_value&&delete filter.target_field_value;_lodash2.default.each(filter.conditions,function(cond){delete cond.$$hashKey;""===cond.field_name&&delete cond.field_vname;""===cond.fieldValue&&delete cond.fieldValue});filter.value_list&&0===filter.value_list.length&&delete filter.value_list;var dtr=_angular2.default.copy($scope.detector);void 0===dtr.rules&&(dtr.rules=[]);index>=0?dtr.rules[index]=filter:dtr.rules.push(filter);validate(dtr).then(function(resp){msgs.clear();$scope.saveLock=false;if(resp.success){add($scope.detector,filter,index);$modalInstance.close()}else msgs.error(resp.message)})};$scope.cancel=function(){msgs.clear();$modalInstance.close()}})},3695:function(module,exports){module.exports='<div>\n  <div class="form-group">\n    <div ng-repeat="detector in detectors track by $index">\n      <div class="detector" ng-class="{\'detector-edit-mode\':(editMode===\'EDIT\')}">\n        <div class="detector-fields">\n          <label ng-show="editMode===\'EDIT\'">Detector:</label>\n          <div aria-label="Customised description" ng-hide="editMode===\'EDIT\' || detector.detector_description === \'\' || detector.detector_description === detectorToString(detector) ">{{ detector.detector_description }}</div>\n          <div aria-label="Default description" style="font-style:italic;" >{{ detectorToString(detector) }}</div>\n\n          <div ng-show="editMode===\'EDIT\'">\n            <label class="kuiFormLabel">Description:</label>\n            <input\n              ng-model="detector.detector_description"\n              class="form-control" />\n          </div>\n\n        </div>\n\n        <div class="button-container" ng-show="editMode===\'NEW\'">\n          <button\n            ng-click="editDetector($index)"\n            aria-label="Edit"\n            class="kuiButton kuiButton--basic kuiButton--small"\n            data-toggle="tooltip"\n            tooltip="Edit Detector">\n              <i aria-hidden="true" class="fa fa-pencil"></i>\n          </button>\n\n          <button\n            aria-label="Remove Detector"\n            ng-click="removeDetector($index)"\n            tooltip-append-to-body="true"\n            type="button"\n            class="kuiButton kuiButton--danger kuiButton--small remove-button">\n              <i aria-hidden="true" class="fa fa-trash"></i>\n          </button>\n        </div>\n\n      </div>\n\n    </div>\n\n    <div ng-show="editMode===\'NEW\'">\n      <button\n        aria-labelledby="ml_aria_description_new_job_detectors"\n        aria-describedby="ml_aria_label_new_job_add_detector"\n        ng-click="openNewWindow()"\n        type="button"\n        class="kuiButton kuiButton--primary kuiButton--small">\n          <i aria-hidden="true" class="fa fa-plus"></i>\n          <span id="ml_aria_label_new_job_add_detector">Add Detector</span>\n      </button>\n    </div>\n  </div>\n\n</div>\n'},3696:function(module,exports){module.exports='<div class="detector-modal">\n  <ml-message-bar ></ml-message-bar>\n  <h1 class="euiTitle">{{title}}</h1>\n  <div class="euiSpacer euiSpacer--m"></div>\n\n  <div class="form-group">\n    <ml-form-label label-id="new_job_detector_description">Description</ml-form-label>\n    <input\n      aria-labelledby="ml_aria_label_new_job_detector_description"\n      aria-describedby="ml_aria_description_new_job_detector_description"\n      ng-model="detector.detector_description"\n      placeholder="{{ detectorToString(detector) }}"\n      class="form-control" />\n  </div>\n\n  <div class="editor-color detector_field_form">\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_function">function</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_function"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.function\'\n          field=\'"function"\'\n          options=\'functionIds\'>\n        </field-select>\n      </div>\n    </div>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_fieldname">field_name</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_fieldname"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.field_name\'\n          field=\'"field_name"\'\n          options=\'fields\'>\n        </field-select>\n      </div>\n    </div>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_byfieldname">by_field_name</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_byfieldname"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.by_field_name\'\n          field=\'"by_field_name"\'\n          options=\'fields_byFieldName\'>\n        </field-select>\n      </div>\n    </div>\n\n  </div>\n  <div class="editor-color detector_field_form">\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_overfieldname">over_field_name</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_overfieldname"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.over_field_name\'\n          field=\'"over_field_name"\'\n          options=\'fields\'>\n        </field-select>\n      </div>\n    </div>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_partitionfieldname">partition_field_name</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_partitionfieldname"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.partition_field_name\'\n          field=\'"partition_field_name"\'\n          options=\'fields\'>\n        </field-select>\n      </div>\n    </div>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_detector_excludefrequent">exclude_frequent</ml-form-label>\n        <field-select\n          label-id=\'"new_job_detector_excludefrequent"\'\n          on-change=\'setDetectorProperty\'\n          value=\'detector.exclude_frequent\'\n          field=\'"exclude_frequent"\'\n          options=\'{all: "", none: ""}\'>\n        </field-select>\n      </div>\n    </div>\n\n  </div>\n  <small><div class=\'help-pane\'><ml-documentation-help-link ml-uri="{{helpLink.uri}}" ml-label="{{helpLink.label}}"></ml-documentation-help-link></div></small>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n  <button\n    ng-click="save()"\n    ng-disabled="(saveLock === true) || (detector.function === \'\')"\n    class="kuiButton kuiButton--primary"\n    aria-label="Save">\n    {{ (editMode? "Update" : "Add") }}\n  </button>\n  <button\n    ng-click="cancel()"\n    ng-disabled="(saveLock === true)"\n    class="kuiButton kuiButton--primary"\n    aria-label="Cancel">\n    Cancel\n  </button>\n</div>\n'},3697:function(module,exports){module.exports='<div class="detector-filter-modal">\n  <ml-message-bar ></ml-message-bar>\n  <h3 class="euiTitle euiTitle--small">{{title}}</h3>\n  <div class="editor-color filter-field-form target-container">\n\n    <datalist id="fields_datalist">\n      <option ng-repeat="field in fields" >{{field}}</option>\n    </datalist>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_filter_targetfieldname">target_field_name</ml-form-label>\n\n        <input\n          aria-labelledby="ml_aria_label_new_filter_targetfieldname"\n          aria-describedby="ml_aria_description_new_filter_targetfieldname"\n          ng-model="filter.target_field_name"\n          tabindex="2"\n          ng-change="functionChange()"\n          list=\'fields_datalist\'\n          class="form-control" />\n\n        <ml-form-label label-id="new_action_targetfieldvalue">target_field_value</ml-form-label>\n\n        <input\n          aria-labelledby="ml_aria_label_new_action_targetfieldvalue"\n          aria-describedby="ml_aria_description_new_action_targetfieldvalue"\n          ng-model="filter.target_field_value"\n          tabindex="2"\n          ng-change="functionChange()"\n          class="form-control" />\n      </div>\n    </div>\n\n    <div class="field-cols">\n      <div class="form-group">\n        <ml-form-label label-id="new_action_conditionsconnective">conditions_connective</ml-form-label>\n        <select\n          aria-labelledby="ml_aria_label_new_action_conditionsconnective"\n          aria-describedby="ml_aria_description_new_action_conditionsconnective"\n          ng-model="filter.conditions_connective"\n          tabindex="2"\n          placeholder=""\n          class="form-control">\n            <option ng-repeat="index in ui.conditions_connective" value="{{index}}" >{{index}}</option>\n        </select>\n      </div>\n    </div>\n  </div>\n\n  <div class="conditions-list-container" >\n    <div class="title"><span aria-describedby="ml_aria_description_new_action_ruleconditions">Conditions</span><i ml-info-icon="new_action_ruleconditions" /></div>\n    <div class="table-title">\n      <div><span aria-describedby="ml_aria_description_new_action_conditiontype">Type</span><i ml-info-icon="new_action_conditiontype" /></div>\n      <div><span aria-describedby="ml_aria_description_new_action_fieldname">field_name</span><i ml-info-icon="new_action_fieldname" /></div>\n      <div><span aria-describedby="ml_aria_description_new_action_fieldvalue">field_value</span><i ml-info-icon="new_action_fieldvalue" /></div>\n      <div><span aria-describedby="ml_aria_description_new_action_condition">lt/gt</span><i ml-info-icon="new_action_condition" /></div>\n      <div><span aria-describedby="ml_aria_description_new_action_value">value</span><i ml-info-icon="new_action_value" /></div>\n      <div></div>\n    </div>\n    <div ng-repeat="cond in filter.ruleConditions track by $index" class="rule-condition">\n      <div>\n        <select\n          ng-model="cond.conditionType"\n          placeholder=""\n          class="form-control">\n            <option ng-repeat="type in ui.ruleCondition.conditionType" value="{{type.value}}" >{{type.label}}</option>\n        </select>\n        <div ng-hide="$index === filter.ruleConditions.length-1" class=\'conditions-connective\'>-- {{filter.conditions_connective}} --</div>\n      </div>\n      <div>\n        <select\n          ng-model="cond.field_name"\n          placeholder=""\n          class="form-control">\n            <option ng-repeat="field in fields" >{{field}}</option>\n        </select>\n        \x3c!-- <input\n          ng-model="cond.field_name"\n          tabindex="2"\n          list=\'fields_datalist\'\n          class="form-control" /> --\x3e\n      </div>\n      <div>\n        <input\n          ng-model="cond.field_value"\n          tabindex="2"\n          class="form-control" />\n      </div>\n      <div>\n        <select\n          ng-model="cond.condition.operator"\n          placeholder=""\n          class="form-control">\n            <option ng-repeat="op in ui.ruleCondition.condition.operator" value="{{op.value}}" >{{op.label}}</option>\n        </select>\n      </div>\n      <div>\n        <input\n          ng-model="cond.condition.value"\n          tabindex="2"\n          class="form-control" />\n      </div>\n      <div>\n        <button\n          aria-label="Remove Condition"\n          ng-click="removeCondition($index)"\n          tooltip-append-to-body="true"\n          type="button"\n          class="kuiButton kuiButton--danger kuiButton--small remove-button">\n            <i aria-hidden="true" class="fa fa-trash"></i>\n        </button>\n      </div>\n    </div>\n  </div>\n  <button\n    aria-label="Add new condition"\n    ng-click="addNewCondition()"\n    type="button"\n    class="kuiButton kuiButton--primary kuiButton--small add-new">\n      <i aria-hidden="true" class="fa fa-plus"></i> Add new condition\n  </button>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n  <button\n    ng-click="save()"\n    ng-disabled="(saveLock === true || filter.ruleConditions.length === 0)"\n    class="kuiButton kuiButton--primary"\n    aria-label="Save">\n    {{ (editMode? "Update" : "Add") }}\n  </button>\n  <button\n    ng-click="cancel()"\n    ng-disabled="(saveLock === true)"\n    class="kuiButton kuiButton--primary"\n    aria-label="Cancel">\n    Cancel\n  </button>\n</div>\n'},3698:function(module,exports){},3699:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.customUrlEditorService=void 0;var _parse_interval=__webpack_require__(117);var _index_patterns=__webpack_require__(368);var _custom_url_utils=__webpack_require__(867);var _job_service=__webpack_require__(24);var _ml_api_service=__webpack_require__(23);function _defineProperty(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true}):obj[key]=value;return obj}function getTestUrl(job,urlConfig){var urlValue=urlConfig.url_value;var bucketSpanSecs=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span).asSeconds();var testUrl=urlConfig.url_value;var body={query:{bool:{must:[{term:{job_id:job.job_id}},{term:{result_type:"record"}}]}},size:1,_source:{excludes:[]},sort:[{record_score:{order:"desc"}}]};return new Promise(function(resolve,reject){_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,body:body}).then(function(resp){if(resp.hits.total>0){var record=resp.hits.hits[0]._source;testUrl=(0,_custom_url_utils.replaceTokensInUrlValue)(urlConfig,bucketSpanSecs,record,"timestamp");resolve(testUrl)}else _job_service.mlJobService.searchPreview(job).then(function(response){var testDoc=void 0;var docTimeFieldName=job.data_description.time_field;if(response.aggregations){var firstBucket=response.aggregations.buckets.buckets[0];testDoc=_defineProperty({},docTimeFieldName,firstBucket.key);urlValue.replace(/\$([^?&$\'"]{1,40})\$/g,function(match,name){if("earliest"!==name&&"latest"!==name&&void 0!==firstBucket[name]){var tokenBuckets=firstBucket[name];tokenBuckets.buckets&&(testDoc[name]=tokenBuckets.buckets[0].key)}})}else response.hits.total>0&&(testDoc=response.hits.hits[0]._source);void 0!==testDoc&&(testUrl=(0,_custom_url_utils.replaceTokensInUrlValue)(urlConfig,bucketSpanSecs,testDoc,docTimeFieldName));resolve(testUrl)})}).catch(function(resp){reject(resp)})})}exports.customUrlEditorService={getTestUrl:getTestUrl}},370:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FieldTypeIcon=void 0;var _field_type_icon=__webpack_require__(1431);Object.defineProperty(exports,"FieldTypeIcon",{enumerable:true,get:function get(){return _field_type_icon.FieldTypeIcon}});__webpack_require__(3776);__webpack_require__(3777)},3700:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3701);__webpack_require__(3706)},3701:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _risonNode=__webpack_require__(254);var _risonNode2=_interopRequireDefault(_risonNode);var _custom_url_editor=__webpack_require__(3702);var _custom_url_editor2=_interopRequireDefault(_custom_url_editor);__webpack_require__(1418);var _parse_interval=__webpack_require__(127);var _string_utils=__webpack_require__(40);var _saved_objects=__webpack_require__(57);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlCustomUrlEditor",function(Private){return{scope:{addCustomUrl:"&",job:"="},restrict:"AE",replace:true,transclude:true,template:_custom_url_editor2.default,controller:function controller($scope){var URL_TYPE={KIBANA_DASHBOARD:"KIBANA_DASHBOARD",KIBANA_DISCOVER:"KIBANA_DISCOVER",OTHER:"OTHER"};$scope.URL_TYPE=URL_TYPE;var TIME_RANGE_TYPE={AUTO:"auto",INTERVAL:"interval"};$scope.TIME_RANGE_TYPE=TIME_RANGE_TYPE;$scope.newCustomUrl={label:void 0,type:URL_TYPE.OTHER,timeRange:{type:TIME_RANGE_TYPE.AUTO},kibanaSettings:{queryFieldNames:[]},otherUrlSettings:{urlValue:""}};$scope.dashboards=[];$scope.indexPatterns=[];$scope.timeRangeIntervalError=false;$scope.updateQueryFieldNames={};var savedObjectsClient=Private(_saved_objects.SavedObjectsClientProvider);function getSavedDashboards(){return savedObjectsClient.find({type:"dashboard",fields:["title"],perPage:1e3})}function getSavedIndexPatterns(){return savedObjectsClient.find({type:"index-pattern",fields:["title"],perPage:1e3})}Promise.all([getSavedDashboards(),getSavedIndexPatterns()]).then(function(response){$scope.dashboards=_lodash2.default.chain(response[0]).get("savedObjects",[]).map(function(savedObj){return{id:savedObj.id,title:savedObj.attributes.title}}).sortBy(function(obj){return obj.title.toLowerCase()}).value();$scope.indexPatterns=_lodash2.default.chain(response[1]).get("savedObjects",[]).map(function(savedObj){return{id:savedObj.id,title:savedObj.attributes.title}}).sortBy(function(obj){return obj.title.toLowerCase()}).value();initFields()}).catch(function(resp){console.log("Custom URL editor - error loading saved dashboards and index patterns",resp)});var detectors=$scope.job.analysis_config.detectors;var jobFieldNames=_lodash2.default.get($scope.job.analysis_config,"influencers",[]);_lodash2.default.each(detectors,function(detector){_lodash2.default.has(detector,"partition_field_name")&&jobFieldNames.push(detector.partition_field_name);_lodash2.default.has(detector,"by_field_name")&&jobFieldNames.push(detector.by_field_name);_lodash2.default.has(detector,"over_field_name")&&jobFieldNames.push(detector.over_field_name)});$scope.jobFieldNames=_lodash2.default.chain(jobFieldNames).uniq().sortBy(function(fieldName){return fieldName.toLowerCase()}).map(function(fieldName){return{id:fieldName}}).value();$scope.addQueryEntity=function(){$scope.jobFieldNames.length>0&&$scope.newCustomUrl.kibanaSettings.queryFieldNames.push($scope.jobFieldNames[0])};$scope.removeQueryEntity=function(index){$scope.newCustomUrl.kibanaSettings.queryFieldNames.splice(index,1)};$scope.timeRangeIntervalChanged=function(){var interval=(0,_parse_interval.parseInterval)($scope.newCustomUrl.timeRange.interval);$scope.timeRangeIntervalError=null===interval};$scope.addUrl=function(){var settings=$scope.newCustomUrl;if(settings.type===URL_TYPE.KIBANA_DASHBOARD)addDashboardUrl();else if(settings.type===URL_TYPE.KIBANA_DISCOVER)addDiscoverUrl();else{var urlToAdd={url_name:settings.label,url_value:settings.otherUrlSettings.urlValue};$scope.addCustomUrl()(urlToAdd);initFields()}};function addDashboardUrl(){var settings=$scope.newCustomUrl;savedObjectsClient.get("dashboard",settings.kibanaSettings.dashboardId).then(function(response){var filters=[];var query=void 0;var searchSourceJSON=response.get("kibanaSavedObjectMeta.searchSourceJSON");if(void 0!==searchSourceJSON){var searchSourceData=JSON.parse(searchSourceJSON);filters=_lodash2.default.get(searchSourceData,"filter",[]);query=searchSourceData.query}var _g=_risonNode2.default.encode({time:{from:"$earliest$",to:"$latest$",mode:"absolute"}});var appState={filters:filters};if(settings.kibanaSettings.queryFieldNames.length>0){var queryString="";_lodash2.default.each(settings.kibanaSettings.queryFieldNames,function(fieldName,index){index>0&&(queryString+=" AND ");queryString+=(0,_string_utils.escapeForElasticsearchQuery)(fieldName)+':"$'+fieldName+'$"'});query={language:"lucene",query:queryString}}void 0!==query&&(appState.query=query);var _a=_risonNode2.default.encode(appState);var urlValue="kibana#/dashboard/"+settings.kibanaSettings.dashboardId+"?_g="+_g+"&_a="+_a;var urlToAdd={url_name:settings.label,url_value:urlValue,time_range:TIME_RANGE_TYPE.AUTO};settings.timeRange.type===TIME_RANGE_TYPE.INTERVAL&&(urlToAdd.time_range=settings.timeRange.interval);$scope.addCustomUrl()(urlToAdd);initFields()}).catch(function(resp){console.log("Custom URL editor - error getting details on dashboard",resp)})}function addDiscoverUrl(){var settings=$scope.newCustomUrl;var _g=_risonNode2.default.encode({time:{from:"$earliest$",to:"$latest$",mode:"absolute"}});var appState={index:settings.kibanaSettings.discoverIndexPatternId};var query=$scope.job.datafeed_config.query;if(settings.kibanaSettings.queryFieldNames.length>0){var queryString="";_lodash2.default.each(settings.kibanaSettings.queryFieldNames,function(fieldName,i){i>0&&(queryString+=" AND ");queryString+=(0,_string_utils.escapeForElasticsearchQuery)(fieldName)+':"$'+fieldName+'$"'});query={language:"lucene",query:queryString}}void 0!==query&&(appState.query=query);var _a=_risonNode2.default.encode(appState);var urlValue="kibana#/discover?_g="+_g+"&_a="+_a;var urlToAdd={url_name:settings.label,url_value:urlValue};settings.timeRange.type===TIME_RANGE_TYPE.INTERVAL&&(urlToAdd.time_range=settings.timeRange.interval);$scope.addCustomUrl()(urlToAdd);initFields()}function initFields(){$scope.newCustomUrl.label="";$scope.newCustomUrl.otherUrlSettings={urlValue:""};$scope.newCustomUrl.timeRange={type:TIME_RANGE_TYPE.AUTO};$scope.newCustomUrl.kibanaSettings={queryFieldNames:[]};"function"===typeof $scope.updateQueryFieldNames.update&&$scope.updateQueryFieldNames.update([]);if($scope.dashboards.length>0){$scope.newCustomUrl.type=URL_TYPE.KIBANA_DASHBOARD;$scope.newCustomUrl.kibanaSettings.dashboardId=$scope.dashboards[0].id}else $scope.newCustomUrl.type=$scope.indexPatterns.length>0?URL_TYPE.KIBANA_DASHBOARD:URL_TYPE.OTHER;if($scope.indexPatterns.length>0&&void 0!==$scope.job.datafeed_config.indices&&$scope.job.datafeed_config.indices.length>0){var datafeedIndex=$scope.job.datafeed_config.indices[0];var defaultIndexPattern=_lodash2.default.find($scope.indexPatterns,{title:datafeedIndex});void 0===defaultIndexPattern&&(defaultIndexPattern=$scope.indexPatterns[0]);$scope.newCustomUrl.kibanaSettings.discoverIndexPatternId=defaultIndexPattern.id}}}}})},3702:function(module,exports){module.exports='<div class=\'ml-custom-url-manager\'>\n  <div class="add-url-form">\n\n    <div class="form-group">\n      <ml-form-label label-id="new_custom_url_label">Label</ml-form-label>\n      <input\n        type="text"\n        class="kuiTextInput add-url-input"\n        ng-model="newCustomUrl.label"\n        aria-labelledby="ml_aria_label_new_custom_url_label"\n        aria-describedby="ml_aria_description_new_custom_url_label" />\n    </div>\n\n    <div class="form-group">\n      <ml-form-label label-id="new_custom_url_link_to">Link to</ml-form-label>\n      <div class="euiSpacer euiSpacer--s"></div>\n      <div>\n        <label\n          class="kuiFormLabel link-to-label"\n          ng-class="{\'disabled\': dashboards.length === 0}"\n          data-toggle="tooltip"\n          ng-attr-tooltip="{{dashboards.length === 0 ?  \'No Kibana dashboards have been created\' : undefined}}"\n          tooltip-placement="bottom">\n          <input type="radio"\n            name="linkToRadio"\n            ng-disabled="dashboards.length === 0"\n            ng-model="newCustomUrl.type"\n            required\n            value="{{URL_TYPE.KIBANA_DASHBOARD}}" /> Kibana dashboard\n        </label>\n        <label\n        class="kuiFormLabel link-to-label"\n        ng-class="{\'disabled\': indexPatterns.length === 0}"\n        data-toggle="tooltip"\n        ng-attr-tooltip="{{indexPatterns.length === 0 ?  \'No Kibana index patterns have been created\' : undefined}}"\n        tooltip-placement="bottom">\n          <input type="radio"\n            name="linkToRadio"\n            ng-disabled="indexPatterns.length === 0"\n            ng-model="newCustomUrl.type"\n            value="{{URL_TYPE.KIBANA_DISCOVER}}" /> Discover\n        </label>\n        <label class="kuiFormLabel link-to-label">\n          <input type="radio"\n            name="linkToRadio"\n            ng-model="newCustomUrl.type"\n            value="{{URL_TYPE.OTHER}}" /> Other URL\n        </label>\n      </div>\n    </div>\n\n    <div ng-show="newCustomUrl.type === URL_TYPE.KIBANA_DASHBOARD" class="form-group">\n      <ml-form-label label-id="new_custom_url_dashboard">Dashboard name</ml-form-label>\n      <select\n        class="kuiSelect add-url-input"\n        ng-model="newCustomUrl.kibanaSettings.dashboardId"\n        aria-labelledby="ml_aria_label_new_custom_url_dashboard"\n        aria-describedby="ml_aria_description_new_custom_url_dashboard"\n        placeholder="Select dashboard">\n        <option ng-repeat="dashboard in dashboards" value="{{dashboard.id}}">{{dashboard.title}}</option>\n      </select>\n    </div>\n\n    <div ng-show="newCustomUrl.type === URL_TYPE.KIBANA_DISCOVER" class="form-group">\n      <ml-form-label label-id="new_custom_url_discover_index">Index pattern</ml-form-label>\n      <select\n        class="kuiSelect add-url-input"\n        ng-model="newCustomUrl.kibanaSettings.discoverIndexPatternId"\n        aria-labelledby="ml_aria_label_new_custom_url_discover_index"\n        aria-describedby="ml_aria_description_new_custom_url_discover_index"\n        placeholder="Select index pattern">\n        <option ng-repeat="index in indexPatterns" value="{{index.id}}">{{index.title}}</option>\n      </select>\n    </div>\n\n    <div class="form-group" ng-show="(newCustomUrl.type === URL_TYPE.KIBANA_DASHBOARD ||\n      newCustomUrl.type === URL_TYPE.KIBANA_DISCOVER) && jobFieldNames.length > 0">\n      <ml-form-label label-id="new_custom_url_query_entity">Query entities</ml-form-label>\n      <ml-item-select\n        item-ids=\'newCustomUrl.kibanaSettings.queryFieldNames\'\n        all-items=\'jobFieldNames\'\n        external-update-function=\'updateQueryFieldNames\'\n        placeholder=\'"Entities"\'>\n      </ml-item-select>\n    </div>\n\n    \x3c!-- Text area for entering other non-Kibana dashboard URLs --\x3e\n    <div ng-show="newCustomUrl.type === URL_TYPE.OTHER" class="form-group">\n      <ml-form-label label-id="new_custom_url_value">URL</ml-form-label>\n      <textarea\n        aria-labelledby="new_custom_url_value"\n        ng-model="newCustomUrl.otherUrlSettings.urlValue"\n        type="text"\n        class="form-control">\n      </textarea>\n    </div>\n\n    \x3c!-- Control for selecting the drilldown time range --\x3e\n    <div class="add-url-time-range" ng-show="(newCustomUrl.type === URL_TYPE.KIBANA_DASHBOARD ||\n      newCustomUrl.type === URL_TYPE.KIBANA_DISCOVER)">\n      <div class="form-group">\n        <ml-form-label label-id="new_custom_url_time_range">Time range</ml-form-label>\n        <select\n          class="kuiSelect kuiSelect--medium add-url-input"\n          ng-model="newCustomUrl.timeRange.type"\n          aria-labelledby="ml_aria_label_new_custom_url_time_range"\n          aria-describedby="ml_aria_description_new_custom_url_time_range">\n          <option value="{{TIME_RANGE_TYPE.AUTO}}">auto</option>\n          <option value="{{TIME_RANGE_TYPE.INTERVAL}}">interval</option>\n        </select>\n      </div>\n\n      <div ng-show="newCustomUrl.timeRange.type === TIME_RANGE_TYPE.INTERVAL" class="form-group">\n        <label id="ml_aria_label_custom_url_time_range_interval" class="kuiFormLabel">Interval</label>\n        <input\n          aria-labelledby="ml_aria_label_custom_url_time_range_interval"\n          ng-model="newCustomUrl.timeRange.interval"\n          ng-change="timeRangeIntervalChanged()"\n          type="text"\n          class="form-control" />\n        <div ng-show="timeRangeIntervalError === true" class="validation-error">Invalid interval format</div>\n      </div>\n    </div>\n\n    <div>\n      <button\n        aria-labelledby="ml_aria_label_new_job_custom_urls"\n        aria-describedby="ml_aria_description_new_job_custom_urls"\n        ng-click="addUrl()"\n        ng-disabled="newCustomUrl.label === undefined || newCustomUrl.label === \'\' ||\n          (newCustomUrl.timeRange.type === TIME_RANGE_TYPE.INTERVAL && timeRangeIntervalError === true)"\n        type="button"\n        class="kuiButton kuiButton--primary">\n        <span id="ml_aria_label_new_job_custom_urls">Add</span>\n      </button>\n    </div>\n\n  </div>\n\n</div>\n'},3703:function(module,exports,__webpack_require__){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _item_select=__webpack_require__(3704);var _item_select2=_interopRequireDefault(_item_select);var _compat=__webpack_require__(70);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlItemSelect",function(){return{restrict:"E",template:_item_select2.default,scope:{itemIds:"=",allItems:"=",disabled:"=",placeholder:"=",externalUpdateFunction:"=",allowTagging:"=",taggingText:"="},controllerAs:"mlItemSelect",bindToController:true,controller:function(_InitAfterBindingsWor){_inherits(MlItemSelectController,_InitAfterBindingsWor);function MlItemSelectController(){_classCallCheck(this,MlItemSelectController);return _possibleConstructorReturn(this,(MlItemSelectController.__proto__||Object.getPrototypeOf(MlItemSelectController)).apply(this,arguments))}_createClass(MlItemSelectController,[{key:"initAfterBindings",value:function initAfterBindings($scope){var _this2=this;this.$scope=$scope;this.selectedItems=[];this.populateSelectedItems(this.itemIds);void 0!==this.externalUpdateFunction&&(this.externalUpdateFunction.update=function(itemIds){_this2.populateSelectedItems(itemIds)})}},{key:"populateSelectedItems",value:function populateSelectedItems(ids){var _this3=this;this.selectedItems=ids.map(function(id){return _this3.allItems.find(function(i){return i.id===id})})}},{key:"onItemsChanged",value:function onItemsChanged(){this.itemIds.length=0;this.itemIds=this.selectedItems.map(function(i){return i.id})}},{key:"createNewItem",value:function createNewItem(id){return{id:id.toLowerCase(),isTag:true}}},{key:"dontCreateNewItem",value:function dontCreateNewItem(){return false}}]);return MlItemSelectController}(_compat.InitAfterBindingsWorkaround)}})},3704:function(module,exports){module.exports='<div class="ml-item-select">\n  <ui-select\n    ng-model="mlItemSelect.selectedItems"\n    on-select="mlItemSelect.onItemsChanged()"\n    on-remove="mlItemSelect.onItemsChanged()"\n    ng-disabled="mlItemSelect.disabled"\n    multiple\n    append-to-body=true\n    tagging="(mlItemSelect.allowTagging ? mlItemSelect.createNewItem : mlItemSelect.dontCreateNewItem)"\n  >\n    <ui-select-match placeholder="{{mlItemSelect.placeholder}}">\n      {{$item.id}}\n    </ui-select-match>\n    <ui-select-choices\n      repeat="item in mlItemSelect.allItems | filter: { id: $select.search }"\n    >\n      <div ng-if="item.isTag"  class="select-item" ng-bind-html="(item.id | highlight: $select.search) +\' <small>\'+ (mlItemSelect.taggingText === undefined ? \'(new item)\' : mlItemSelect.taggingText) +\'</small>\'"></div>\n      <div ng-if="!item.isTag" class="select-item" >\n        <div ng-bind-html="item.id | highlight: $select.search"></div>\n        <small ng-if="item.extra!==undefined">\n          {{item.extra}}\n        </small>\n      </div>\n    </ui-select-choices>\n  </ui-select>\n</div>\n'},3705:function(module,exports){},3706:function(module,exports){},3707:function(module,exports,__webpack_require__){"use strict";var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _job_group_select=__webpack_require__(3708);var _job_group_select2=_interopRequireDefault(_job_group_select);var _job_service=__webpack_require__(24);var _calendar_service=__webpack_require__(630);var _compat=__webpack_require__(70);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlJobGroupSelect",function(){return{restrict:"E",template:_job_group_select2.default,scope:{jobGroups:"=",disabled:"=",externalUpdateFunction:"="},controllerAs:"mlGroupSelect",bindToController:true,controller:function(_InitAfterBindingsWor){_inherits(MlGroupSelectController,_InitAfterBindingsWor);function MlGroupSelectController(){_classCallCheck(this,MlGroupSelectController);return _possibleConstructorReturn(this,(MlGroupSelectController.__proto__||Object.getPrototypeOf(MlGroupSelectController)).apply(this,arguments))}_createClass(MlGroupSelectController,[{key:"initAfterBindings",value:function initAfterBindings($scope){var _this2=this;this.$scope=$scope;this.selectedGroups=[];this.groups=[];_job_service.mlJobService.loadJobs().then(function(){var tempGroupIds={};var jobGroups=_job_service.mlJobService.getJobGroups();_this2.groups=jobGroups.map(function(g){tempGroupIds[g.id]=null;return{id:g.id,count:g.jobs.length,isTag:false}});false===Array.isArray(_this2.jobGroups)&&(_this2.jobGroups=[]);_calendar_service.mlCalendarService.loadCalendars(_job_service.mlJobService.jobs).then(function(){var calendarGroups=_calendar_service.mlCalendarService.getCalendarGroups();calendarGroups.forEach(function(g){void 0===tempGroupIds[g.id]&&_this2.groups.push({id:g.id,count:0,isTag:false})});_this2.populateSelectedGroups(_this2.jobGroups)}).catch(function(error){console.log("Could not load groups from calendars",error);_this2.populateSelectedGroups(_this2.jobGroups)})});void 0!==this.externalUpdateFunction&&(this.externalUpdateFunction.update=function(groups){_this2.populateSelectedGroups(groups)})}},{key:"populateSelectedGroups",value:function populateSelectedGroups(groups){var _this3=this;this.selectedGroups=[];groups.forEach(function(gId){var tempGroup=_lodash2.default.filter(_this3.groups,{id:gId});tempGroup.length?_this3.selectedGroups.push(tempGroup[0]):_this3.selectedGroups.push(_this3.createNewItem(gId))})}},{key:"onGroupsChanged",value:function onGroupsChanged(){var _this4=this;this.jobGroups.length=0;this.selectedGroups.forEach(function(group){_this4.jobGroups.push(group.id)})}},{key:"createNewItem",value:function createNewItem(groupId){var gId=groupId.toLowerCase();return{id:gId,count:0,isTag:true}}},{key:"groupTypes",value:function groupTypes(group){if(false===group.isTag)return"Existing groups"}}]);return MlGroupSelectController}(_compat.InitAfterBindingsWorkaround)}})},3708:function(module,exports){module.exports='<div class="ml-job-group-select">\n  <ui-select\n    ng-model="mlGroupSelect.selectedGroups"\n    on-select="mlGroupSelect.onGroupsChanged()"\n    on-remove="mlGroupSelect.onGroupsChanged()"\n    ng-disabled="mlGroupSelect.disabled"\n    multiple\n    tagging=\'mlGroupSelect.createNewItem\'\n    append-to-body=true\n  >\n    <ui-select-match placeholder="Job Group">\n      {{$item.id}}\n    </ui-select-match>\n    <ui-select-choices\n      repeat="group in mlGroupSelect.groups | filter: { id: $select.search }"\n      group-by="mlGroupSelect.groupTypes"\n    >\n      <div ng-if="group.isTag"  class="select-item" ng-bind-html="(group.id | highlight: $select.search) +\' <small>(new group)</small>\'"></div>\n      <div ng-if="!group.isTag" class="select-item" >\n        <div ng-bind-html="group.id | highlight: $select.search"></div>\n        <small>\n          Other jobs in this group: {{group.count}}\n        </small>\n      </div>\n    </ui-select-choices>\n  </ui-select>\n</div>\n'},3709:function(module,exports){},3710:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3711);__webpack_require__(3713);__webpack_require__(3714);__webpack_require__(868)},3711:function(module,exports,__webpack_require__){"use strict";var _job_timepicker_modal=__webpack_require__(3712);var _job_timepicker_modal2=_interopRequireDefault(_job_timepicker_modal);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.service("mlDatafeedService",function($modal){this.openJobTimepickerWindow=function(job){$modal.open({template:_job_timepicker_modal2.default,controller:"MlJobTimepickerModal",backdrop:"static",keyboard:false,resolve:{params:function params(){return{job:job}}}})}})},3712:function(module,exports){module.exports='<div class="job-timepicker-modal">\n  <ml-message-bar ></ml-message-bar>\n  <h1 tooltip="Start datafeed for {{jobId}}" class="euiTitle">Start datafeed for {{jobId}}</h1>\n\n  <div class="euiSpacer euiSpacer--s"></div>\n\n  <div class="ml-timepicker-contents" >\n    <div class="row">\n      <div\n        class="ml-timepicker-section"\n        ng-class="{\n          \'ml-timepicker-right-border\':\n            (+ui.startRadio <= 1 && ui.endRadio === \'0\') ||\n            (ui.startRadio === \'2\' && +ui.endRadio <= 1)\n        }">\n        <label class="kuiFormLabel">Search start time</label>\n\n        <div class="ml-timepicker-radios" >\n          <ul class="nav nav-pills nav-stacked">\n            <li ng-class="{ active: ui.startRadio === \'1\' }">\n              <a ng-click="ui.startRadio = \'1\'" >{{ ( isNew?"Start at beginning of data" : "Continue from " + ui.lastTime ) }}</a>\n            </li>\n            <li ng-class="{ active: ui.startRadio === \'0\' }">\n              <a ng-click="ui.startRadio = \'0\'">{{ ( isNew?"Start now" : "Continue from now" ) }}</a>\n            </li>\n            <li ng-class="{ active: ui.startRadio === \'2\' }">\n              <a ng-click="ui.startRadio = \'2\'" ng-class="{\'ml-timepicker-radio-bottom\': ui.startRadio === \'2\'}">{{ ( isNew?"Specify start time" : "Continue from specified time" ) }}</a>\n            </li>\n          </ul>\n        </div>\n        <div class=\'ml-timepicker\' ng-show="ui.startRadio == \'2\'">\n          <div>\n            <input type="text" class="form-control" input-datetime="YYYY-MM-DD HH:mm:ss" ng-model="ui.timepicker.from" >\n          </div>\n          <div>\n            <datepicker\n              offset-timezone\n              ng-model="ui.timepicker.from"\n              show-weeks="false">\n            </datepicker>\n          </div>\n        </div>\n      </div>\n\n      <div class="ml-timepicker-section"\n        ng-class="{\n          \'ml-timepicker-left-border\':\n            (+ui.startRadio <= 1 && ui.endRadio === \'1\')\n        }">\n        <label class="kuiFormLabel">Search end time</label>\n        <div class="ml-timepicker-radios" >\n          <ul class="nav nav-pills nav-stacked">\n            <li ng-class="{ active: ui.endRadio === \'0\' }">\n              <a ng-click="ui.endRadio = \'0\'">No end time (Real-time search)</a>\n            </li>\n            <li ng-class="{ active: ui.endRadio === \'1\' }">\n              <a ng-click="ui.endRadio = \'1\'" ng-class="{\'ml-timepicker-radio-bottom\': ui.endRadio === \'1\'}">Specify end time</a>\n            </li>\n          </ul>\n        </div>\n        <div class=\'ml-timepicker\' ng-show="ui.endRadio == \'1\'">\n          <div>\n            <input type="text" class="form-control" input-datetime="{{format}}" ng-model="ui.timepicker.to">\n          </div>\n          <div>\n            <datepicker\n              offset-timezone\n              ng-model="ui.timepicker.to"\n              show-weeks="false">\n            </datepicker>\n          </div>\n        </div>\n      </div>\n    </div>\n\n  </div>\n\n  <div ng-if="ui.endRadio === \'0\' && watcherEnabled">\n    <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n    <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n      <input ng-model=\'ui.createWatch\' type="checkbox" class=\'kuiCheckBox\'/>\n      <span class="kuiCheckBoxLabel__text">\n        Create watch after datafeed has started\n      </span>\n    </label>\n  </div>\n  <div class="clearfix"></div>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n  <button\n    ng-click="save()"\n    ng-disabled="(\n      saveLock === true ||\n      ( ui.startRadio===\'2\' && ui.timepicker.from===\'\' ) ||\n      ( ui.endRadio===\'1\' && ui.timepicker.to===\'\' )\n    )"\n    class="kuiButton kuiButton--primary" >\n    Start\n  </button>\n  <button\n    ng-click="cancel()"\n    ng-disabled="(saveLock === true)"\n    class="kuiButton kuiButton--primary"\n    aria-label="Cancel">\n    Cancel\n  </button>\n\n</div>\n'},3713:function(module,exports,__webpack_require__){"use strict";var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _job_service=__webpack_require__(24);var _messagebar_service=__webpack_require__(79);var _check_license=__webpack_require__(68);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.controller("MlJobTimepickerModal",function($scope,$rootScope,$modalInstance,params,Private){var msgs=_messagebar_service.mlMessageBarService;$scope.saveLock=false;var xpackFeature=Private(_check_license.xpackFeatureProvider);$scope.watcherEnabled=xpackFeature.isAvailable("watcher");var job=_angular2.default.copy(params.job);$scope.jobId=job.job_id;$scope.datafeedId=_job_service.mlJobService.getDatafeedId(job.job_id);$scope.start="";$scope.end="";var lastTime="";if(job.data_counts&&job.data_counts.latest_record_timestamp){var time=(0,_moment2.default)(job.data_counts.latest_record_timestamp);lastTime=time.format("YYYY-MM-DD HH:mm:ss")}$scope.isNew=!(job.data_counts&&job.data_counts.input_record_count>0);$scope.ui={lastTime:lastTime,startDateText:"",startRadio:"1",endDateText:"",endRadio:"1",timepicker:{from:"",to:(0,_moment2.default)()},setStartRadio:function setStartRadio(i){$scope.ui.startRadio=i},createWatch:false};function extractForm(){"0"===$scope.ui.startRadio?$scope.start="now":"1"===$scope.ui.startRadio?$scope.start="0":"2"===$scope.ui.startRadio&&($scope.start=1e3*(0,_moment2.default)($scope.ui.timepicker.from).unix());"0"===$scope.ui.endRadio?$scope.end=void 0:"1"===$scope.ui.endRadio&&($scope.end=1e3*(0,_moment2.default)($scope.ui.timepicker.to).unix())}$scope.save=function(){$scope.saveLock=true;extractForm();var doStartCalled=false;window.setTimeout(doStart,1e4);_job_service.mlJobService.openJob($scope.jobId).then(function(){doStart()}).catch(function(resp){if(409===resp.statusCode)doStart();else{500===resp.statusCode?false===doStartCalled&&msgs.error("Could not open "+$scope.jobId,resp):msgs.error("Could not open "+$scope.jobId,resp);$scope.saveLock=false}});function doStart(){if(false===doStartCalled){doStartCalled=true;_job_service.mlJobService.startDatafeed($scope.datafeedId,$scope.jobId,$scope.start,$scope.end).then(function(){$rootScope.$broadcast("jobsUpdated");$scope.ui.createWatch&&$rootScope.$broadcast("openCreateWatchWindow",job)}).catch(function(){$scope.saveLock=false})}}$modalInstance.close();window.setTimeout(function(){$rootScope.$broadcast("jobsUpdated")},500)};$scope.cancel=function(){$modalInstance.close()}})},3714:function(module,exports){},3715:function(module,exports){},3716:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _parse_interval=__webpack_require__(117);var _create_watch_service=__webpack_require__(369);var _create_watch=__webpack_require__(3717);var _create_watch2=_interopRequireDefault(_create_watch);var _ml_api_service=__webpack_require__(23);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlCreateWatch",function(){return{restrict:"AE",replace:false,scope:{jobId:"=",bucketSpan:"=",embedded:"="},template:_create_watch2.default,link:function link($scope){$scope.config=_create_watch_service.mlCreateWatchService.config;$scope.status=_create_watch_service.mlCreateWatchService.status;$scope.STATUS=_create_watch_service.mlCreateWatchService.STATUS;$scope.ui={thresholdOptions:[{display:"critical",val:75},{display:"major",val:50},{display:"minor",val:25},{display:"warning",val:0}],setThreshold:function setThreshold(t){$scope.config.threshold=t},emailEnabled:false,embedded:$scope.embedded,watchAlreadyExists:false};if($scope.bucketSpan){var interval=(0,_parse_interval.parseInterval)($scope.bucketSpan);var bs=2*interval.asMinutes();bs<1&&(bs=1);$scope.config.interval=bs+"m"}_ml_api_service.ml.getNotificationSettings().then(function(resp){_lodash2.default.has(resp,"defaults.xpack.notification.email")&&($scope.ui.emailEnabled=true)});_create_watch_service.mlCreateWatchService.loadWatch($scope.jobId).then(function(){$scope.ui.watchAlreadyExists=true}).catch(function(){$scope.ui.watchAlreadyExists=false})}}})},3717:function(module,exports){module.exports='<div class="create-watch" ng-class="{\'create-watch-embedded\': ui.embedded}">\n\t<div ng-show="status.watch===null || status.watch===STATUS.SAVING || status.watch===STATUS.SAVE_FAILED">\n\t\t<div class="form-group">\n\t\t\t<div class="sub-form-group">\n\t\t\t\t<label for="selectInterval" class="kuiFormLabel kuiVerticalRhythm">Time range</label><br />\n\t\t\t\tNow - <input id="selectInterval" ng-model="config.interval" type="text" class="kuiTextInput kuiTextInput--small interval" placeholder="m">\n\t\t\t</div>\n\n\t\t\t<div class="sub-form-group">\n\t\t\t\t<label for="selectSeverity" class="kuiFormLabel kuiVerticalRhythm">Severity threshold</label><br />\n\t\t    <div class="dropdown-group" dropdown>\n\t\t      <button id="selectSeverity" type="button" class="form-control dropdown-toggle" dropdown-toggle ng-disabled="disabled">\n\t\t        <span><i class="fa fa-exclamation-triangle ml-icon-severity-{{config.threshold.display}}"></i> {{config.threshold.display}}</span> <span class="caret"></span>\n\t\t      </button>\n\t\t      <ul class="dropdown-menu" role="menu">\n\t\t        <li ng-repeat="thresholdOption in ui.thresholdOptions">\n\t\t        \t<a href="" ng-click="ui.setThreshold(thresholdOption)"><i class="fa fa-exclamation-triangle ml-icon-severity-{{thresholdOption.display}}"></i> {{thresholdOption.display}}</a>\n\t\t        </li>\n\t\t      </ul>\n\t\t    </div>\n\t    </div>\n\t\t</div>\n\t\t<div ng-show="ui.emailEnabled" class="form-group">\n\t\t\t<label for="sendEmail" class="kuiCheckBoxLabel kuiVerticalRhythm">\n\t\t\t\t<input id="sendEmail" ng-model="config.includeEmail" type="checkbox" class="kuiCheckBox" />\n\t\t\t\t<span class="kuiCheckBoxLabel__text">Send email</span>\n\t\t\t</label>\n\t\t\t<div ng-show="config.includeEmail" class="email-section">\n\t\t\t\t<input type="text" ng-model="config.email" class="kuiTextInput kuiTextInput--large" placeholder="email address">\n\t\t\t</div>\n\t\t</div>\n\n\t\t<div ng-if="ui.watchAlreadyExists" class="watch-exists-warning">\n\t\t\tWarning, watch ml-{{jobId}} already exists, clicking apply will overwrite the original.\n\t\t</div>\n\n\t</div>\n\n\t<div ng-show="status.watch===STATUS.SAVED">\n\t\t<div>Watch: <strong>{{config.id}}</strong> created</div>\n\t\t<br />\n\t\t<div>\n\t\t\t<a href="{{config.watcherEditURL}}" target="_blank" rel="noopener noreferrer">Edit {{config.id}} in Watcher <i class="fa fa-external-link"></i></a>\n\t\t</div>\n\t</div>\n\n</div>\n'},3718:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3719);__webpack_require__(3720)},3719:function(module,exports){},3720:function(module,exports,__webpack_require__){"use strict";var _modules=__webpack_require__(2);var _module=_modules.uiModules.get("apps/ml");_module.controller("MlDeleteJobModal",function($scope,$modalInstance,params){$scope.ui={stage:0,status:params.status,jobId:params.jobId,isDatafeed:params.isDatafeed};$scope.delete=function(){$scope.ui.stage=1;params.doDelete()};$scope.close=function(){$modalInstance.close()}})},3721:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3722);__webpack_require__(3723);__webpack_require__(868)},3722:function(module,exports){},3723:function(module,exports,__webpack_require__){"use strict";var _create_watch_service=__webpack_require__(369);var _check_license=__webpack_require__(68);var _modules=__webpack_require__(2);var _messagebar_service=__webpack_require__(79);var _module=_modules.uiModules.get("apps/ml");_module.controller("MlCreateWatchModal",function($scope,$modalInstance,params,Private){var xpackFeature=Private(_check_license.xpackFeatureProvider);var msgs=_messagebar_service.mlMessageBarService;msgs.clear();$scope.jobId=params.job.job_id;$scope.bucketSpan=params.job.analysis_config.bucket_span;$scope.watcherEnabled=xpackFeature.isAvailable("watcher");$scope.status=_create_watch_service.mlCreateWatchService.status;$scope.STATUS=_create_watch_service.mlCreateWatchService.STATUS;_create_watch_service.mlCreateWatchService.reset();_create_watch_service.mlCreateWatchService.config.includeInfluencers=!!params.job.analysis_config.influencers.length;$scope.apply=function(){_create_watch_service.mlCreateWatchService.createNewWatch($scope.jobId).catch(function(resp){msgs.clear();msgs.error("Watch could not be saved");"string"===typeof resp&&msgs.error(resp);$scope.status.watch=null})};$scope.close=function(){$modalInstance.close()}})},3724:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3725);__webpack_require__(3726);__webpack_require__(3728);__webpack_require__(3732)},3725:function(module,exports){},3726:function(module,exports,__webpack_require__){"use strict";var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);__webpack_require__(118);var _string_utils=__webpack_require__(40);var _clipboard_utils=__webpack_require__(1416);var _states=__webpack_require__(321);var _job_utils=__webpack_require__(41);var _check_privilege=__webpack_require__(35);var _job_service=__webpack_require__(24);var _messagebar_service=__webpack_require__(79);var _numeral=__webpack_require__(88);var _numeral2=_interopRequireDefault(_numeral);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _expanded_row=__webpack_require__(3727);var _expanded_row2=_interopRequireDefault(_expanded_row);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlJobListExpandedRow",function($location){return{restrict:"AE",replace:false,scope:{job:"=",calendars:"=",currentTab:"=",jobAudit:"=",closeJob:"=",canCloseJob:"=",validateJob:"="},template:_expanded_row2.default,link:function link($scope,$element){var msgs=_messagebar_service.mlMessageBarService;var TIME_FORMAT="YYYY-MM-DD HH:mm:ss";var DATA_FORMAT="0.0 b";$scope.urlBasePath=_chrome2.default.getBasePath();$scope.permissions={canPreviewDatafeed:(0,_check_privilege.checkPermission)("canPreviewDatafeed")};$scope.jobJson="";$scope.toLocaleString=_string_utils.toLocaleString;$scope.init=function(){var tempJob=_angular2.default.copy($scope.job);delete tempJob.calendars;$scope.jobJson=_angular2.default.toJson(tempJob,true);$scope.jobAuditText="";$scope.datafeedPreview={update:updateDatafeedPreview,json:""};$scope.detectorToString=_string_utils.detectorToString;$scope.JOB_STATE=_states.JOB_STATE;$scope.DATAFEED_STATE=_states.DATAFEED_STATE;$scope.ui={currentTab:$scope.currentTab,tabs:[{index:0,title:"Job settings"},{index:1,title:"Job config"},{index:3,title:"Counts"},{index:4,title:"JSON"},{index:5,title:"Job messages",showIcon:true},{index:6,title:"Datafeed preview"},{index:7,title:"Forecasts"}],changeTab:function changeTab(tab){this.currentTab.index=tab.index;5===tab.index?$scope.jobAudit.update().then(function(){var div=_angular2.default.element("#ml-job-audit-list-"+$scope.job.job_id);div&&div.length&&window.setTimeout(function(){var table=div.find("table");table&&table.length&&(div[0].scrollTop=table[0].offsetHeight-div[0].offsetHeight+14)},0)}):6===tab.index&&updateDatafeedPreview()},closeJobDisabled:function closeJobDisabled(){return false===$scope.canCloseJob||(!$scope.job.datafeed_config||$scope.job.datafeed_config.state!==_states.DATAFEED_STATE.STOPPED||$scope.job.state!==_states.JOB_STATE.OPENED)&&((void 0!==$scope.job.datafeed_config&&void 0!==$scope.job.datafeed_config.datafeed_id||$scope.job.state!==_states.JOB_STATE.OPENED)&&$scope.job.state!==_states.JOB_STATE.FAILED)},getCloseJobTooltip:function getCloseJobTooltip(){return $scope.job.datafeed_config&&$scope.job.datafeed_config.state===_states.DATAFEED_STATE.STARTED?"Datafeed must be stopped to close job":$scope.job.state===_states.JOB_STATE.CLOSED?"Job already closed":""}};"undefined"!==typeof $scope.job.datafeed_config&&$scope.ui.tabs.splice(2,0,{index:2,title:"Datafeed"});$scope.job.location&&($scope.job.location=replaceHost($scope.job.location));$scope.job.endpoints&&_lodash2.default.each($scope.job.endpoints,function(url,i){$scope.job.endpoints[i]=replaceHost(url)});$scope.ui.changeTab($scope.ui.currentTab)};function updateDatafeedPreview(){$scope.datafeedPreview.json="";$scope.permissions.canPreviewDatafeed&&_job_service.mlJobService.getDatafeedPreview($scope.job.job_id).then(function(resp){Array.isArray(resp)?$scope.datafeedPreview.json=_angular2.default.toJson(resp.slice(0,_job_utils.ML_DATA_PREVIEW_COUNT),true):msgs.error("Datafeed preview could not be loaded",resp)}).catch(function(resp){msgs.error("Datafeed preview could not be loaded",resp)})}$scope.init();$scope.copyToClipboard=function(job){var newJob=_angular2.default.copy(job);var success=(0,_clipboard_utils.copyTextToClipboard)(_angular2.default.toJson(newJob));if(success){var el=$element.find(".ml-pre");el.css("transition","none");el.css("background-color","aliceblue");el.css("color","white");window.setTimeout(function(){el.css("transition","background 0.3s linear, color 0.3s linear");el.css("background-color","white");el.css("color","inherit")},1)}else msgs.error("Job could not be copied to the clipboard")};$scope.formatData=function(txt){return(0,_numeral2.default)(txt).format(DATA_FORMAT)};$scope.formatMS=function(txt){var dur=_moment2.default.duration(txt);var str="";dur._data.days>0&&(str+=" "+dur._data.days+"d");dur._data.hours>0&&(str+=" "+dur._data.hours+"h");dur._data.minutes>0&&(str+=" "+dur._data.minutes+"m");dur._data.seconds>0&&(str+=" "+dur._data.seconds+"s");dur._data.milliseconds>0&&(str+=" "+Math.ceil(dur._data.milliseconds)+"ms");return str};$scope.formatDate=function(txt){return(0,_moment2.default)(txt).format(TIME_FORMAT)};$scope.getDuration=function(){return{start:$scope.job.data_counts.earliest_record_timestamp,end:$scope.job.data_counts.latest_record_timestamp}};$scope.getJobConfig=function(){return $scope.job};function replaceHost(url){url.match("localhost")&&(url=url.replace("localhost",$location.host()));return url}$scope.aceLoaded=function(editor){editor.setReadOnly(true);$scope.$applyAsync()}}}}).filter("filterObjects",function(){return function(input){var allowArrays=arguments.length>1&&void 0!==arguments[1]&&arguments[1];var tempObj={};_lodash2.default.each(input,function(v,i){var isObj="object"===("undefined"===typeof v?"undefined":_typeof(v));(false===isObj||allowArrays&&isObj&&Array.isArray(v))&&(tempObj[i]=v)});return tempObj}})},3727:function(module,exports){module.exports='  <div >\n    <ul class="nav nav-tabs">\n      <li class="kbn-settings-tab" ng-class="{ active: ui.currentTab.index === tab.index }" ng-repeat="tab in ui.tabs">\n        <a ng-click="ui.changeTab(tab)">\n        {{ tab.title }}<i ng-show="tab.showIcon && jobAudit.jobWarningClass !== \'\'" class=\'job-tab-icon job-warning-small {{jobAudit.jobWarningClass}}\'></i>\n      </a>\n      </li>\n    </ul>\n\n    \x3c!-- tab 0 General--\x3e\n    <ml-job-tab-0 ng-show="ui.currentTab.index === 0">\n      <div class="tab_contents">\n        <ng-include src="urlBasePath+\'/plugins/ml/jobs/jobs_list_old/expanded_row/tabs/tab_general.html\'"></ng-include>\n      </div>\n    </ml-job-tab-0>\n\n    \x3c!-- tab 1 Config --\x3e\n    <ml-job-tab-1 ng-show="ui.currentTab.index === 1">\n      <div class="tab_contents">\n        <ng-include src="urlBasePath+\'/plugins/ml/jobs/jobs_list_old/expanded_row/tabs/tab_config.html\'"></ng-include>\n      </div>\n    </ml-job-tab-1>\n\n    \x3c!-- tab 2 Datafeed --\x3e\n    <ml-job-tab-2 ng-show="ui.currentTab.index === 2" >\n      <div class="tab_contents">\n        <ng-include src="urlBasePath+\'/plugins/ml/jobs/jobs_list_old/expanded_row/tabs/tab_datafeed.html\'"></ng-include>\n      </div>\n    </ml-job-tab-2>\n\n  \x3c!-- tab 3 Counts --\x3e\n    <ml-job-tab-3 ng-show="ui.currentTab.index === 3" >\n      <div class="tab_contents">\n        <ng-include src="urlBasePath+\'/plugins/ml/jobs/jobs_list_old/expanded_row/tabs/tab_counts.html\'"></ng-include>\n      </div>\n    </ml-job-tab-3>\n\n    \x3c!-- tab 4 JSON --\x3e\n    <ml-job-tab-4 ng-show="ui.currentTab.index === 4" >\n      <div class="tab_contents">\n        <button ng-click="copyToClipboard(job)" class="kuiButton kuiButton--primary" aria-label="Copy JSON to clipboard">\n          Copy JSON to clipboard\n        </button>\n        <div\n          ng-if="jobJson!==\'\'"\n          class="json-textarea"\n          ui-ace="{\n            mode: \'json\',\n            onLoad: aceLoaded\n          }"\n          ng-model="jobJson"\n        ></div>\n      </div>\n    </ml-job-tab-4>\n\n    \x3c!-- tab 5 Job log --\x3e\n    <ml-job-tab-5 ng-show="ui.currentTab.index === 5" >\n      <div class="tab_contents">\n        <button ng-click="jobAudit.update()" class="kuiButton kuiButton--primary">\n          Refresh\n        </button>\n        <div id="ml-job-audit-list-{{job.job_id}}" class="job-audit-list-container">\n\n          <table class="euiTable euiTable--compressed">\n            <thead>\n              <tr>\n                <th class="euiTableHeaderCell" scope="col" width="25px">\n                  <div class="euiTableCellContent"></div>\n                </th>\n                <th class="euiTableHeaderCell" scope="col">\n                  <div class="euiTableCellContent">Time</div>\n                </th>\n                <th class="euiTableHeaderCell" scope="col">\n                  <div class="euiTableCellContent">Node</div>\n                </th>\n                <th class="euiTableHeaderCell" scope="col" width="60%">\n                  <div class="euiTableCellContent">Message</div>\n                </th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr ng-repeat="msg in jobAudit.messages" class="euiTableRow">\n                <td class="euiTableRowCell">\n                  <div class="euiTableCellContent">\n                    <span class="euiTableCellContent__text">\n                      <i ng-show="msg.level === \'system_info\'" tooltip=\'System Info\' class="job-system-info fa fa-cogs"></i>\n                      <i ng-show="msg.level === \'info\'" tooltip=\'Info\' class="job-info fa fa-info-circle"></i>\n                      <i ng-show="msg.level === \'warning\'" tooltip=\'Warning\' class="job-warning fa fa-exclamation-circle"></i>\n                      <i ng-show="msg.level === \'error\'" tooltip=\'Error\' class="job-error fa fa-exclamation-triangle"></i>\n                    </span>\n                  </div>\n                </td>\n                <td class="euiTableRowCell">\n                  <div class="euiTableCellContent">\n                    <span class="euiTableCellContent__text">{{msg.time}}</span>\n                  </div>\n                </td>\n                <td class="euiTableRowCell">\n                  <div class="euiTableCellContent">\n                    <span class="euiTableCellContent__text">{{msg.node_name}}</span>\n                  </div>\n                </td>\n                <td class="euiTableRowCell">\n                  <div class="euiTableCellContent">\n                    <span class="euiTableCellContent__text">{{msg.message}}</span>\n                  </div>\n                </td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n    </ml-job-tab-5>\n\n    \x3c!-- tab 6 Datafeed Preview --\x3e\n    <ml-job-tab-6 ng-show="ui.currentTab.index === 6" >\n      <div class="tab_contents" ng-if="permissions.canPreviewDatafeed===true">\n        <button ng-click="datafeedPreview.update()" class="kuiButton kuiButton--primary">\n          Refresh\n        </button>\n        <ml-loading-indicator\n          label="Loading datafeed preview"\n          is-loading="(datafeedPreview.json === \'\')"\n        />\n        <div ng-hide="(datafeedPreview.json === \'\')">\n          <div\n            class="json-textarea"\n            ui-ace="{\n              mode: \'json\',\n              onLoad: aceLoaded\n            }"\n            ng-model="datafeedPreview.json"\n            ></div>\n        </div>\n      </div>\n      <div class="tab_contents" ng-if="permissions.canPreviewDatafeed===false">\n        <div class="euiCallOut euiCallOut--warning">\n          <div class="euiCallOutHeader">\n            <svg class="euiIcon euiCallOutHeader__icon euiIcon--medium" xmlns="http://www.w3.org/2000/svg"\n              width="16" height="16" viewBox="0 0 16 16">\n              <g fill-rule="evenodd">\n                <path d="M7.5 2.236L1.618 14h11.764L7.5 2.236zm.894-.447l5.882 11.764A1 1 0 0 1 13.382 15H1.618a1 1 0 0 1-.894-1.447L6.606 1.789a1 1 0 0 1 1.788 0z"\n                />\n                <path d="M7 6h1v5H7zM7 12h1v1H7z" />\n              </g>\n            </svg>\n            <span class="euiCallOutHeader__title">You do not have permission to view the datafeed preview</span>\n          </div>\n          <div class="euiText euiText--small">\n            <p>\n              Please contact your administrator\n          </div>\n        </div>\n      </div>\n    </ml-job-tab-6>\n\n    \x3c!-- tab 7 Forecasts --\x3e\n    <ml-job-tab-6 ng-show="ui.currentTab.index === 7" >\n      <div class="tab_contents">\n        <div>\n          <ml-forecasts-table\n            job="job"\n          />\n        </div>\n      </div>\n    </ml-job-tab-6>\n\n  </div>\n'},3728:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3729);__webpack_require__(3731)},3729:function(module,exports,__webpack_require__){"use strict";__webpack_require__(93);var _modules=__webpack_require__(2);var _forecasts_table=__webpack_require__(3730);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlForecastsTable",function(reactDirective){return reactDirective(_forecasts_table.ForecastsTable,void 0,{restrict:"E"})})},3730:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ForecastsTable=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _risonNode=__webpack_require__(254);var _risonNode2=_interopRequireDefault(_risonNode);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _format=__webpack_require__(286);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _states=__webpack_require__(321);var _recently_accessed=__webpack_require__(500);var _forecast_service=__webpack_require__(627);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var MAX_FORECASTS=500;var TIME_FORMAT="YYYY-MM-DD HH:mm:ss";var ForecastsTable=function(_Component){_inherits(ForecastsTable,_Component);function ForecastsTable(props){_classCallCheck(this,ForecastsTable);var _this=_possibleConstructorReturn(this,(ForecastsTable.__proto__||Object.getPrototypeOf(ForecastsTable)).call(this,props));_this.state={isLoading:0!==props.job.data_counts.processed_record_count,forecasts:[]};return _this}_createClass(ForecastsTable,[{key:"componentDidMount",value:function componentDidMount(){var _this2=this;var dataCounts=this.props.job.data_counts;dataCounts.processed_record_count>0&&_forecast_service.mlForecastService.getForecastsSummary(this.props.job,null,dataCounts.earliest_record_timestamp,MAX_FORECASTS).then(function(resp){_this2.setState({isLoading:false,forecasts:resp.forecasts})}).catch(function(resp){console.log("Error loading list of forecasts for jobs list:",resp);_this2.setState({isLoading:false,errorMessage:"Error loading the list of forecasts run on this job",forecasts:[]})})}},{key:"openSingleMetricView",value:function openSingleMetricView(forecast){var dataCounts=this.props.job.data_counts;var jobEarliest=dataCounts.earliest_record_timestamp;var from=new Date(dataCounts.earliest_record_timestamp).toISOString();var to=void 0!==forecast?new Date(forecast.forecast_end_timestamp).toISOString():new Date(dataCounts.latest_record_timestamp).toISOString();var _g=_risonNode2.default.encode({ml:{jobIds:[this.props.job.job_id]},refreshInterval:{display:"Off",pause:false,value:0},time:{from:from,to:to,mode:"absolute"}});var appState={filters:[],query:{query_string:{analyze_wildcard:true,query:"*"}}};if(void 0!==forecast){var forecastDurationMs=forecast.forecast_end_timestamp-forecast.forecast_start_timestamp;var zoomFrom=Math.max(forecast.forecast_start_timestamp-forecastDurationMs,jobEarliest);appState.mlTimeSeriesExplorer={forecastId:forecast.forecast_id,zoom:{from:new Date(zoomFrom).toISOString(),to:new Date(forecast.forecast_end_timestamp).toISOString()}}}var _a=_risonNode2.default.encode(appState);var url="?_g="+_g+"&_a="+_a;(0,_recently_accessed.addItemToRecentlyAccessed)("timeseriesexplorer",this.props.job.job_id,url);window.open(_chrome2.default.getBasePath()+"/app/ml#/timeseriesexplorer"+url,"_self")}},{key:"render",value:function render(){var _this3=this;if(true===this.state.isLoading)return _react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceAround"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiLoadingSpinner,{size:"l"})));if(void 0!==this.state.errorMessage)return _react2.default.createElement(_eui.EuiCallOut,{title:this.state.errorMessage,color:"danger",iconType:"cross"});var forecasts=this.state.forecasts;if(0===forecasts.length)return _react2.default.createElement(_eui.EuiCallOut,{title:"No forecasts have been run for this job",iconType:"iInCircle"},_react2.default.createElement("p",null,"To run a forecast, open the ",_react2.default.createElement(_eui.EuiLink,{onClick:function onClick(){return _this3.openSingleMetricView()}},"Single Metric Viewer"),"."));var columns=[{field:"forecast_create_timestamp",name:"Created",dataType:"date",render:function render(date){return(0,_format.formatDate)(date,TIME_FORMAT)},sortable:true},{field:"forecast_start_timestamp",name:"From",dataType:"date",render:function render(date){return(0,_format.formatDate)(date,TIME_FORMAT)},sortable:true},{field:"forecast_end_timestamp",name:"To",dataType:"date",render:function render(date){return(0,_format.formatDate)(date,TIME_FORMAT)},sortable:true},{field:"forecast_status",name:"Status",sortable:true},{field:"forecast_memory_bytes",name:"Memory size",render:function render(bytes){return(0,_format.formatNumber)(bytes,"0b")},sortable:true},{field:"processing_time_ms",name:"Processing time",render:function render(ms){return ms+" ms"},sortable:true},{field:"forecast_expiry_timestamp",name:"Expires",render:function render(date){return(0,_format.formatDate)(date,TIME_FORMAT)},sortable:true},{field:"forecast_messages",name:"Messages",sortable:false,render:function render(messages){return _react2.default.createElement("div",null,messages.map(function(message,index){return _react2.default.createElement("p",{key:index},message)}))}},{name:"View",render:function render(forecast){return _react2.default.createElement(_eui.EuiButton,{onClick:function onClick(){return _this3.openSingleMetricView(forecast)},className:"view-forecast-btn",isDisabled:forecast.forecast_status!==_states.FORECAST_REQUEST_STATE.FINISHED},_react2.default.createElement("i",{"aria-hidden":"true",className:"fa fa-line-chart"}))}}];return _react2.default.createElement(_eui.EuiInMemoryTable,{items:forecasts,columns:columns,pagination:{pageSizeOptions:[5,10,25]},sorting:true})}}]);return ForecastsTable}(_react.Component);ForecastsTable.propTypes={job:_propTypes2.default.object.isRequired};exports.ForecastsTable=ForecastsTable},3731:function(module,exports){},3732:function(module,exports,__webpack_require__){"use strict";var _modules=__webpack_require__(2);var _module=_modules.uiModules.get("apps/ml");_module.controller("TabController",function($scope){$scope.formatDelimiter=function(del){var txt=del;switch(del){case" ":txt="space";break;case"\t":txt="tab";break;default:txt=del}return txt}})},3733:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3734)},3734:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3735);__webpack_require__(3736);__webpack_require__(1401);__webpack_require__(1409);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _paginated_table=__webpack_require__(3737);var _paginated_table2=_interopRequireDefault(_paginated_table);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlPaginatedTable",function($filter){var orderBy=$filter("orderBy");return{restrict:"E",template:_paginated_table2.default,transclude:true,scope:{rows:"=",columns:"=",perPage:"=?",sortHandler:"=?",showSelector:"=?"},controllerAs:"mlPaginatedTable",controller:function controller($scope){var self=this;self.sort={columnIndex:null,direction:null};self.sortColumn=function(colIndex){var col=$scope.columns[colIndex];if(!col)return;if(false===col.sortable)return;var sortDirection=void 0;if(self.sort.columnIndex!==colIndex)sortDirection="asc";else{var directions={null:"asc",asc:"desc",desc:null};sortDirection=directions[self.sort.direction]}self.sort.columnIndex=colIndex;self.sort.direction=sortDirection;self._setSortGetter(colIndex)};self._setSortGetter=function(index){_lodash2.default.isFunction($scope.sortHandler)?self.sort.getter=$scope.sortHandler(index):self.sort.getter=function(row){var value=row[index];return value&&void 0!==value.value&&null!==value.value?"function"===typeof value.value?value.value():value.value:value}};$scope.$watchMulti(["rows","columns","[]mlPaginatedTable.sort"],function resortRows(){if(!$scope.rows||!$scope.columns){$scope.sortedRows=false;return}var sort=self.sort;null==sort.direction?$scope.sortedRows=$scope.rows.slice(0):$scope.sortedRows=orderBy($scope.rows,sort.getter,"desc"===sort.direction)})}}})},3735:function(module,exports,__webpack_require__){"use strict";var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _agg_config_result=__webpack_require__(421);var _agg_config_result2=_interopRequireDefault(_agg_config_result);var _filter_bar_click_handler=__webpack_require__(608);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlRows",function($compile,getAppState,Private){var filterBarClickHandler=Private(_filter_bar_click_handler.FilterBarClickHandlerProvider);return{restrict:"A",link:function link($scope,$el,attr){function addCell($tr,contents){var $cell=(0,_jquery2.default)(document.createElement("td"));_lodash2.default.isNumber(contents)&&$cell.addClass("numeric-value");var createAggConfigResultCell=function createAggConfigResultCell(aggConfigResult){var $resultCell=(0,_jquery2.default)(document.createElement("td"));var $state=getAppState();var clickHandler=filterBarClickHandler($state);$resultCell.scope=$scope.$new();$resultCell.addClass("cell-hover");$resultCell.attr("ng-click","clickHandler($event)");$resultCell.scope.clickHandler=function(event){if((0,_jquery2.default)(event.target).is("a"))return;clickHandler({point:{aggConfigResult:aggConfigResult}})};return $compile($resultCell)($cell.scope)};if(contents instanceof _agg_config_result2.default){"bucket"===contents.type&&contents.aggConfig.field()&&contents.aggConfig.field().filterable&&($cell=createAggConfigResultCell(contents));contents=contents.toString("html")}if(_lodash2.default.isObject(contents)){contents.attr&&$cell.attr(contents.attr);contents.class&&$cell.addClass(contents.class);contents.scope?$cell=$compile($cell.html(contents.markup))(contents.scope):$cell.html(contents.markup)}else""===contents?$cell.html("&nbsp;"):$cell.html(contents);$tr.append($cell)}$scope.$watchMulti([attr.mlRows,attr.mlRowsMin],function(vals){var rows=vals[0];var min=vals[1];$el.empty();_lodash2.default.isArray(rows)||(rows=[]);isFinite(min)&&rows.length<min&&(rows=_lodash2.default.clone(rows));rows.forEach(function(row){if(row.length){var rowScope=row[0].scope;var $tr=(0,_jquery2.default)(document.createElement("tr")).appendTo($el);if(rowScope&&void 0!==rowScope.mouseenterRow&&"function"===typeof rowScope.mouseenterRow){$tr.attr({"ng-mouseenter":"mouseenterRow($event)"});$tr.attr({"ng-mouseleave":"mouseleaveRow($event)"});$compile($tr)(rowScope)}row.forEach(function(cell){addCell($tr,cell)});if(rowScope&&rowScope.expandable&&rowScope.expandElement&&""!==row.join("")){void 0===rowScope.open&&(rowScope.open=false);void 0===rowScope.rowInitialised&&(rowScope.rowInitialised=false);rowScope.toggleRow=function(){this.open=!this.open;if(this.initRow&&false===this.rowInitialised){this.rowInitialised=true;this.initRow()}};var $trExpand=(0,_jquery2.default)(document.createElement("tr")).appendTo($el);$trExpand.attr("ng-show","open");$trExpand.addClass("row-expand");var $td=(0,_jquery2.default)(document.createElement("td")).appendTo($trExpand);$td.attr("colspan",row.length);var expEl=rowScope.expandElement;var $exp=(0,_jquery2.default)(document.createElement(expEl)).appendTo($td);rowScope.$expandElement&&rowScope.$expandElement.children().length&&$exp.append(rowScope.$expandElement.children()[0]);$compile($trExpand)(rowScope);rowScope.$expandElement=$exp}}})})}}})},3736:function(module,exports){},3737:function(module,exports){module.exports='<paginate\n  ng-if="sortedRows.length"\n  list="sortedRows"\n  per-page-prop="perPage"\n  class="agg-table">\n  <div class="agg-table-paginated">\n    <table class="table table-condensed">\n      <thead>\n        <tr>\n          <th\n            ng-repeat-start="col in columns"\n            ng-if="col.title"\n            ng-click="mlPaginatedTable.sortColumn($index)"\n            scope="col"\n            class="{{ col.class }}">\n            <span ng-bind="col.title"></span>\n\n            <icon-tip\n              ng-if="col.info"\n              content="\'{{ col.info }}\'"\n            ></icon-tip>\n\n            <button\n              ng-if="col.sortable !== false"\n              id="docTableHeaderFieldSort{{col.title}}"\n              tabindex="0"\n              aria-label="Sort {{col.title}} ascending"\n              class="table-header-button fa fa-sort"\n              ng-class="{\n                \'fa-sort-asc\': mlPaginatedTable.sort.columnIndex === $index && mlPaginatedTable.sort.direction === \'asc\',\n                \'fa-sort-desc\': mlPaginatedTable.sort.columnIndex === $index && mlPaginatedTable.sort.direction === \'desc\',\n                \'fa-sort\': mlPaginatedTable.sort.columnIndex !== $index || mlPaginatedTable.sort.direction === null\n              }"\n              tooltip="Sort by {{col.title}}"\n              tooltip-append-to-body="1">\n            </button>\n\n            <i aria-label="Click on a cell to filter" ng-if="col.filterable" class="fa fa-search" ng-click="$event.stopPropagation()" tooltip="Click on a cell to filter"></i>\n          </th>\n          <td\n            ng-repeat-end\n            ng-if="!col.title"\n            class="{{ col.class }}">\n          </td>\n        </tr>\n      </thead>\n      <tbody ml-rows="page" ml-rows-min="perPage"></tbody>\n    </table>\n  </div>\n\n  \x3c!-- auto-inserted by the paginate directive... --\x3e\n  \x3c!-- <paginate-controls></paginate-controls> --\x3e\n  <div class="pagination-container" ng-transclude></div>\n\n</paginate>\n'},3738:function(module,exports,__webpack_require__){"use strict";__webpack_require__(93);var _modules=__webpack_require__(2);var _validate_job_view=__webpack_require__(3739);var _job_service=__webpack_require__(24);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlValidateJob",function(reactDirective){return reactDirective(_validate_job_view.ValidateJob,void 0,{restrict:"E"},{mlJobService:_job_service.mlJobService})})},3739:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ValidateJob=void 0;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _metadata=__webpack_require__(91);var _validation=__webpack_require__(1420);var _validation_utils=__webpack_require__(631);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var jobTipsUrl="https://www.elastic.co/guide/en/kibana/"+_metadata.metadata.branch+"/job-tips.html";var defaultIconType="questionInCircle";var getDefaultState=function getDefaultState(){return{ui:{iconType:defaultIconType,isLoading:false,isModalVisible:false},data:{messages:[],success:false},title:""}};var statusToEuiColor=function statusToEuiColor(status){switch(status){case _validation.VALIDATION_STATUS.INFO:return"primary";case _validation.VALIDATION_STATUS.ERROR:return"danger";default:return status}};var statusToEuiIconType=function statusToEuiIconType(status){switch(status){case _validation.VALIDATION_STATUS.INFO:return"iInCircle";case _validation.VALIDATION_STATUS.ERROR:return"cross";case _validation.VALIDATION_STATUS.SUCCESS:return"check";case _validation.VALIDATION_STATUS.WARNING:return"alert";default:return status}};var Link=function Link(_ref){var url=_ref.url;return _react2.default.createElement(_eui.EuiLink,{href:url,target:"_BLANK"},"Learn more")};Link.propTypes={url:_propTypes2.default.string.isRequired};var Message=function Message(_ref2){var message=_ref2.message;return _react2.default.createElement(_react2.default.Fragment,null,message.text," ",message.url&&_react2.default.createElement(Link,{url:message.url}))};Message.propTypes={message:_propTypes2.default.shape({text:_propTypes2.default.string,url:_propTypes2.default.string})};var Callout=function Callout(_ref3){var message=_ref3.message;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiCallOut,{color:statusToEuiColor(message.status),size:"s",title:message.heading||_react2.default.createElement(Message,{message:message}),iconType:statusToEuiIconType(message.status)},message.heading&&_react2.default.createElement(Message,{message:message})),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}))};Callout.propTypes={message:_propTypes2.default.shape({status:_propTypes2.default.string,text:_propTypes2.default.string,url:_propTypes2.default.string})};var Modal=function Modal(_ref4){var close=_ref4.close,title=_ref4.title,children=_ref4.children;return _react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_eui.EuiModal,{onClose:close,style:{width:"800px"}},_react2.default.createElement(_eui.EuiModalHeader,null,_react2.default.createElement(_eui.EuiModalHeaderTitle,null,title)),_react2.default.createElement(_eui.EuiModalBody,null,children),_react2.default.createElement(_eui.EuiModalFooter,null,_react2.default.createElement(_eui.EuiButton,{onClick:close,size:"s",fill:true},"Close"))))};Modal.propType={close:_propTypes2.default.func.isRequired,title:_propTypes2.default.string};var ValidateJob=function(_Component){_inherits(ValidateJob,_Component);function ValidateJob(props){_classCallCheck(this,ValidateJob);var _this=_possibleConstructorReturn(this,(ValidateJob.__proto__||Object.getPrototypeOf(ValidateJob)).call(this,props));_this.closeModal=function(){var newState=getDefaultState();newState.ui.iconType=_this.state.ui.iconType;_this.setState(newState)};_this.openModal=function(){var job=_this.props.getJobConfig();var getDuration=_this.props.getDuration;var duration="function"===typeof getDuration?getDuration():void 0;var fields=_this.props.fields;if("object"===("undefined"===typeof job?"undefined":_typeof(job))){var shouldShowLoadingIndicator=true;_this.props.mlJobService.validateJob({duration:duration,fields:fields,job:job}).then(function(data){shouldShowLoadingIndicator=false;_this.setState(_extends({},_this.state,{ui:_extends({},_this.state.ui,{iconType:statusToEuiIconType((0,_validation_utils.getMostSevereMessageStatus)(data.messages)),isLoading:false,isModalVisible:true}),data:data,title:job.job_id}))});var delay=250;setTimeout(function(){shouldShowLoadingIndicator&&_this.setState(_extends({},_this.state,{ui:_extends({},_this.state.ui,{isLoading:true,isModalVisible:false})}))},delay)}};_this.state=getDefaultState();return _this}_createClass(ValidateJob,[{key:"render",value:function render(){var fill=false!==this.props.fill;var isCurrentJobConfig=true===this.props.isCurrentJobConfig;var isDisabled=true===this.props.isDisabled;return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiButton,{onClick:this.openModal,size:"s",fill:fill,iconType:isCurrentJobConfig?this.state.ui.iconType:defaultIconType,iconSide:"right",isDisabled:isDisabled,isLoading:this.state.ui.isLoading},"Validate Job"),!isDisabled&&this.state.ui.isModalVisible&&_react2.default.createElement(Modal,{close:this.closeModal,title:"Validate job "+this.state.title},this.state.data.messages.map(function(m,i){return _react2.default.createElement(Callout,{key:m.id+"_"+i,message:m})}),_react2.default.createElement(_eui.EuiText,null,"Job validation performs certain checks against job configurations and underlying source data and provides specific advice on how to adjust settings that are more likely to produce insightful results."),_react2.default.createElement(_eui.EuiText,null,"For more information, see ",_react2.default.createElement(_eui.EuiLink,{href:jobTipsUrl,target:"_blank"},"Machine Learning Job Tips"),".")))}}]);return ValidateJob}(_react.Component);ValidateJob.propTypes={fields:_propTypes2.default.object,fill:_propTypes2.default.bool,getDuration:_propTypes2.default.func,getJobConfig:_propTypes2.default.func.isRequired,isCurrentJobConfig:_propTypes2.default.bool,isDisabled:_propTypes2.default.bool,mlJobService:_propTypes2.default.object.isRequired};exports.ValidateJob=ValidateJob},3740:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3741);__webpack_require__(3742);__webpack_require__(1417);__webpack_require__(3745);__webpack_require__(3748);__webpack_require__(424)},3741:function(module,exports){},3742:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);__webpack_require__(118);var _parse_interval=__webpack_require__(117);var _timefilter=__webpack_require__(14);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(68);var _check_privilege=__webpack_require__(35);var _new_job=__webpack_require__(3743);var _new_job2=_interopRequireDefault(_new_job);var _save_status_modal=__webpack_require__(3744);var _save_status_modal2=_interopRequireDefault(_save_status_modal);var _new_job_utils=__webpack_require__(144);var _index_utils=__webpack_require__(128);var _field_types=__webpack_require__(322);var _check_ml_nodes=__webpack_require__(69);var _new_job_defaults=__webpack_require__(253);var _job_utils=__webpack_require__(41);var _job_service=__webpack_require__(24);var _messagebar_service=__webpack_require__(79);var _ml_api_service=__webpack_require__(23);var _promise=__webpack_require__(89);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/jobs/new_job/advanced",{template:_new_job2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.loadCurrentIndexPattern,indexPatterns:_index_utils.loadIndexPatterns,savedSearch:_index_utils.loadCurrentSavedSearch,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults,initPromise:(0,_promise.initPromise)(true)}}).when("/jobs/new_job/advanced/:jobId",{template:_new_job2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.loadCurrentIndexPattern,indexPatterns:_index_utils.loadIndexPatterns,savedSearch:_index_utils.loadCurrentSavedSearch,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults,initPromise:(0,_promise.initPromise)(true)}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlNewJob",function($scope,$route,$location,$modal,mlDatafeedService,mlConfirmModalService){_timefilter.timefilter.disableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();var MODE={NEW:0,EDIT:1,CLONE:2};var INDEX_INPUT_TYPE={TEXT:"TEXT",LIST:"LIST"};$scope.INDEX_INPUT_TYPE=INDEX_INPUT_TYPE;var fieldsToIgnore=["_id","_field_names","_index","_parent","_routing","_seq_no","_source","_type","_uid","_version","_feature","_ignored"];var allowedInfluencerTypes=[_field_types.ES_FIELD_TYPES.TEXT,_field_types.ES_FIELD_TYPES.KEYWORD,_field_types.ES_FIELD_TYPES.IP];var msgs=_messagebar_service.mlMessageBarService;var mlConfirm=mlConfirmModalService;msgs.clear();var jobDefaults=(0,_new_job_defaults.newJobDefaults)();$scope.job={};$scope.mode=MODE.NEW;$scope.saveLock=false;$scope.indices={};$scope.types={};$scope.fields={};$scope.dateFields={};$scope.catFields={};$scope.maximumFileSize;$scope.mlElasticDataDescriptionExposedFunctions={};$scope.elasticServerInfo={};$scope.jobGroupsUpdateFunction={};$scope.ui={pageTitle:"Create a new job",dataLocation:"ES",dataPreview:"",currentTab:0,tabs:[{index:0,title:"Job Details"},{index:1,title:"Analysis Configuration"},{index:2,title:"Data Description",hidden:true},{index:3,title:"Datafeed"},{index:4,title:"Edit JSON"},{index:5,title:"Data Preview",hidden:true}],validation:{tabs:[{index:0,valid:true,checks:{jobId:{valid:true},groupIds:{valid:true},modelMemoryLimit:{valid:true}}},{index:1,valid:true,checks:{detectors:{valid:true},influencers:{valid:true},categorizationFilters:{valid:true},bucketSpan:{valid:true}}},{index:2,valid:true,checks:{timeField:{valid:true},timeFormat:{valid:true}}},{index:3,valid:true,checks:{isDatafeed:{valid:true},hasAccessToIndex:{valid:true}}},{index:4,valid:true,checks:{}},{index:5,valid:true,checks:{}}],setTabValid:function setTabValid(tab,valid){$scope.ui.validation.tabs[tab].valid=valid}},jsonText:"",changeTab:changeTab,influencers:[],allInfluencers:allInfluencers,customInfluencers:[],tempCustomInfluencer:"",inputDataFormat:[{value:"delimited",title:"Delimited"},{value:"json",title:"JSON"}],fieldDelimiterOptions:[{value:"\t",title:"tab"},{value:" ",title:"space"},{value:",",title:","},{value:";",title:";"},{value:"custom",title:"custom"}],selectedFieldDelimiter:",",customFieldDelimiter:"",indexTextOk:false,fieldsUpToDate:false,indices:{},types:{},isDatafeed:true,useDedicatedIndex:false,modelMemoryLimit:"",modelMemoryLimitDefault:jobDefaults.anomaly_detectors.model_memory_limit,datafeed:{queryText:'{"match_all":{}}',queryDelayText:"",queryDelayDefault:"60s",frequencyText:"",frequencyDefault:"",scrollSizeText:"",scrollSizeDefault:1e3,indicesText:"",typesText:""},saveStatus:{job:0}};function init(){_job_service.mlJobService.loadJobs();if(_job_service.mlJobService.currentJob){var jobId=$route.current.params.jobId;$scope.job=_job_service.mlJobService.cloneJob(_job_service.mlJobService.currentJob);if(jobId){$scope.mode=MODE.EDIT;console.log("Editing job",_job_service.mlJobService.currentJob);$scope.ui.pageTitle="Editing Job "+$scope.job.job_id}else{if(void 0===_job_service.mlJobService.currentJob.job_version){$scope.mode=MODE.NEW;void 0!==$scope.job.results_index_name&&($scope.ui.useDedicatedIndex=true)}else{$scope.mode=MODE.CLONE;console.log("Cloning job",_job_service.mlJobService.currentJob);$scope.ui.pageTitle="Clone Job from "+$scope.job.job_id;$scope.job.job_id="";if("shared"===$scope.job.results_index_name)delete $scope.job.results_index_name;else{$scope.ui.useDedicatedIndex=true;$scope.job.results_index_name=""}}setDatafeedUIText();setFieldDelimiterControlsFromText();if(!$scope.job.datafeed_config){$scope.ui.dataLocation="NONE";$scope.ui.influencers=_angular2.default.copy($scope.job.analysis_config.influencers)}$scope.job.analysis_limits&&$scope.job.analysis_limits.model_memory_limit&&($scope.ui.modelMemoryLimitText=$scope.job.analysis_limits.model_memory_limit)}_job_service.mlJobService.currentJob=void 0}else{$scope.mode=MODE.NEW;console.log("Creating new job");$scope.job=_job_service.mlJobService.getBlankJob();$scope.job.data_description.format="json";delete $scope.job.data_description.time_format;delete $scope.job.data_description.format;populateFormFromUrl()}loadFields().then(function(){calculateDatafeedFrequencyDefaultSeconds();showDataPreviewTab()}).catch(function(){calculateDatafeedFrequencyDefaultSeconds()})}function changeTab(tab){$scope.ui.currentTab=tab.index;4===tab.index?createJSONText():5===tab.index&&"ES"===$scope.ui.dataLocation&&loadDataPreview()}$scope.indexChanged=function(){$scope.ui.fieldsUpToDate=false};$scope.loadFields=function(){loadFields().catch(function(){})};function loadFields(){return new Promise(function(resolve,reject){clear($scope.fields);clear($scope.dateFields);clear($scope.catFields);clear($scope.ui.influencers);var index=$scope.ui.datafeed.indicesText;""!==index?_ml_api_service.ml.getFieldCaps({index:index}).then(function(resp){$scope.ui.fieldsUpToDate=true;_lodash2.default.each(resp,function(fieldList){_lodash2.default.each(fieldList,function(field,fieldName){_lodash2.default.each(field,function(type){if(-1===fieldsToIgnore.indexOf(fieldName)){var addField=true;if(fieldName.match(/\.keyword$/)){var keywordLess=fieldName.replace(".keyword");void 0!==$scope.fields[keywordLess]&&delete $scope.fields[keywordLess]}else void 0!==$scope.fields[fieldName+".keyword"]&&(addField=false);if(addField){$scope.fields[fieldName]=type;type.type===_field_types.ML_JOB_FIELD_TYPES.DATE&&($scope.dateFields[fieldName]=type);type.type!==_field_types.ML_JOB_FIELD_TYPES.TEXT&&type.type!==_field_types.ML_JOB_FIELD_TYPES.KEYWORD||($scope.catFields[fieldName]=type);-1!==allowedInfluencerTypes.indexOf(type.type)&&$scope.ui.influencers.push(fieldName)}}})})});var scriptFields=Object.keys(_lodash2.default.get($scope.job,"datafeed_config.script_fields",{}));var scriptType={type:"script_fields",searchable:false,aggregatable:true};scriptFields.forEach(function(fieldName){$scope.fields[fieldName]=scriptType});Object.keys($scope.fields).length&&($scope.ui.indexTextOk=true);validateIndex($scope.ui.validation.tabs);guessTimeField();resolve()}).catch(function(error){$scope.ui.indexTextOk=false;validateIndex($scope.ui.validation.tabs);reject(error)}):reject()})}function guessTimeField(){var currentTimeField=$scope.job.data_description.time_field;if(void 0===$scope.dateFields[currentTimeField]){currentTimeField="";$scope.job.data_description.time_field=""}if(""===currentTimeField&&Object.keys($scope.dateFields).length){$scope.job.data_description.time_field=Object.keys($scope.dateFields)[0];console.log("guessTimeField: guessed time fields: ",$scope.job.data_description.time_field)}}$scope.isCurrentJobConfig=false;$scope.$watch("job",function(){$scope.isCurrentJobConfig=false},true);$scope.getJobConfig=function(){getDelimiterSelection();getDatafeedSelection();getAnalysisLimitsSelection();$scope.isCurrentJobConfig=true;return $scope.job};$scope.save=function(){console.log("save() job: ",$scope.job);msgs.clear();getDelimiterSelection();getDatafeedSelection();getAnalysisLimitsSelection();var jobValid=validateJob();if(jobValid.valid)_job_service.mlJobService.loadJobs().then(function(){var tempJob=_job_service.mlJobService.getJob($scope.job.job_id);if(tempJob){var tab=$scope.ui.validation.tabs[0];tab.valid=false;tab.checks.jobId.valid=false;tab.checks.jobId.message="'"+$scope.job.job_id+"' already exists, please choose a different name";changeTab({index:0})}else checkInfluencers();function checkInfluencers(){$scope.job.analysis_config.influencers&&$scope.job.analysis_config.influencers.length?saveFunc():mlConfirm.open({message:"You have not chosen any influencers, do you want to continue?",title:"No Influencers"}).then(saveFunc).catch(function(){changeTab({index:1})})}function saveFunc(){$scope.ui.useDedicatedIndex?""===$scope.job.results_index_name&&($scope.job.results_index_name=$scope.job.job_id):delete $scope.job.results_index_name;$scope.saveLock=true;$scope.ui.saveStatus.job=1;openSaveStatusWindow();var job=(0,_new_job_utils.createJobForSaving)($scope.job);_job_service.mlJobService.saveNewJob(job).then(function(result){if(result.success){var saveNewDatafeed=function saveNewDatafeed(datafeedConfig,jobId){datafeedConfig?_job_service.mlJobService.saveNewDatafeed(datafeedConfig,jobId).then(function(){$scope.saveLock=false}).catch(function(resp){msgs.error("Could not create datafeed: ",resp);$scope.saveLock=false}):$scope.saveLock=false};msgs.info("New Job '"+result.resp.job_id+"' added");$scope.ui.saveStatus.job=2;_job_service.mlJobService.openJob($scope.job.job_id).then(function(){saveNewDatafeed($scope.job.datafeed_config,$scope.job.job_id)}).catch(function(resp){msgs.error("Could not open job: ",resp);msgs.error("Job created, creating datafeed anyway");saveNewDatafeed($scope.job.datafeed_config,$scope.job.job_id)})}else{$scope.ui.saveStatus.job=-1;$scope.saveLock=false;msgs.error("Save failed: "+result.resp.message)}}).catch(function(result){$scope.ui.saveStatus.job=-1;$scope.saveLock=false;msgs.error("Save failed: "+result.resp.message)})}}).catch(function(){msgs.error("Save failed");console.log("save(): job validation failed. Jobs list could not be loaded.")});else{msgs.error(jobValid.message);console.log("save(): job validation failed")}};$scope.cancel=function(){mlConfirm.open({message:"Are you sure you want to cancel job creation?",title:"Are you sure?"}).then(function(){msgs.clear();$location.path("jobs")})};$scope.cloneJobDataDescriptionCallback=function(){extractCustomInfluencers()};function populateFormFromUrl(){var _createSearchItems=(0,_new_job_utils.createSearchItems)($route),indexPattern=_createSearchItems.indexPattern,savedSearch=_createSearchItems.savedSearch,combinedQuery=_createSearchItems.combinedQuery;if(void 0!==indexPattern.id){(0,_index_utils.timeBasedIndexCheck)(indexPattern,true);$scope.ui.datafeed.indicesText=indexPattern.title;$scope.job.data_description.time_field=indexPattern.timeFieldName;void 0!==savedSearch.id&&($scope.ui.datafeed.queryText=JSON.stringify(combinedQuery))}}$scope.timeFieldSelected=function(){return""!==$scope.job.data_description.time_field};$scope.jsonTextChange=function(){try{$scope.job=JSON.parse($scope.ui.jsonText);$scope.changeJobIDCase();void 0!==$scope.jobGroupsUpdateFunction.update&&$scope.jobGroupsUpdateFunction.update($scope.job.groups);extractCustomInfluencers();setFieldDelimiterControlsFromText();setDatafeedUIText();setAnalysisLimitsUIText();void 0!==$scope.job.results_index_name?$scope.ui.useDedicatedIndex=true:$scope.ui.useDedicatedIndex=false}catch(e){console.log("JSON could not be parsed")}};$scope.changeJobIDCase=function(){$scope.job.job_id&&($scope.job.job_id=$scope.job.job_id.toLowerCase())};$scope.datafeedChange=function(){if($scope.ui.isDatafeed){$scope.job.datafeed_config={};$scope.ui.tabs[2].hidden=true;calculateDatafeedFrequencyDefaultSeconds()}else{delete $scope.job.datafeed_config;$scope.ui.tabs[2].hidden=false;$scope.job.data_description.format="json"}showDataPreviewTab()};$scope.setDedicatedIndex=function(){$scope.ui.useDedicatedIndex?$scope.job.results_index_name="":delete $scope.job.results_index_name};$scope.setAnalysisConfigProperty=function(value,field){""===value?delete $scope.job.analysis_config[field]:$scope.job.analysis_config[field]=value};function clear(obj){Object.keys(obj).forEach(function(key){delete obj[key]});Array.isArray(obj)&&(obj.length=0)}function setDatafeedUIText(){if($scope.job.datafeed_config&&Object.keys($scope.job.datafeed_config).length){var datafeedConfig=$scope.job.datafeed_config;$scope.ui.isDatafeed=true;$scope.ui.tabs[2].hidden=true;$scope.ui.dataLocation="ES";showDataPreviewTab();var queryDelayDefault=$scope.ui.datafeed.queryDelayDefault;var queryDelay=datafeedConfig.query_delay;void 0!==datafeedConfig.query_delay&&$scope.ui.datafeed.queryDelayDefault!==datafeedConfig.query_delay||(queryDelay="");var frequencyDefault=$scope.ui.datafeed.frequencyDefault;var freq=datafeedConfig.frequency;void 0!==datafeedConfig.frequency&&$scope.ui.datafeed.frequencyDefault!==datafeedConfig.frequency||(freq="");var scrollSizeDefault=$scope.ui.datafeed.scrollSizeDefault;var scrollSize=datafeedConfig.scroll_size;void 0!==datafeedConfig.scroll_size&&$scope.ui.datafeed.scrollSizeDefault!==datafeedConfig.scroll_size||(scrollSize="");clear($scope.types);_lodash2.default.each(datafeedConfig.types,function(type){$scope.types[type]=$scope.ui.types[type]});clear($scope.indices);_lodash2.default.each(datafeedConfig.indices,function(index){$scope.indices[index]=$scope.ui.indices[index]});var indicesText=datafeedConfig.indices.join(",");$scope.ui.fieldsUpToDate=indicesText===$scope.ui.datafeed.indicesText;var types=Array.isArray(datafeedConfig.types)?datafeedConfig.types:[];$scope.ui.datafeed={queryText:_angular2.default.toJson(datafeedConfig.query,true),queryDelayText:queryDelay,queryDelayDefault:queryDelayDefault,frequencyText:freq,frequencyDefault:frequencyDefault,scrollSizeText:scrollSize,scrollSizeDefault:scrollSizeDefault,indicesText:indicesText,typesText:types.join(",")};false===$scope.ui.fieldsUpToDate&&$scope.loadFields()}else{$scope.ui.isDatafeed=false;$scope.ui.tabs[2].hidden=false}}function setAnalysisLimitsUIText(){void 0!==$scope.job.analysis_limits&&void 0!==$scope.job.analysis_limits.model_memory_limit&&($scope.ui.modelMemoryLimitText=$scope.job.analysis_limits.model_memory_limit)}function calculateDatafeedFrequencyDefaultSeconds(){var bucketSpan=(0,_parse_interval.parseInterval)($scope.job.analysis_config.bucket_span);null!==bucketSpan&&($scope.ui.datafeed.frequencyDefault=(0,_job_utils.calculateDatafeedFrequencyDefaultSeconds)(bucketSpan.asSeconds())+"s")}$scope.calculateDatafeedFrequencyDefaultSeconds=calculateDatafeedFrequencyDefaultSeconds;function setFieldDelimiterControlsFromText(){if($scope.job.data_description&&$scope.job.data_description.field_delimiter){void 0===$scope.job.data_description.format&&($scope.job.data_description.format="delimited");var fieldDelimiter=$scope.job.data_description.field_delimiter;$scope.ui.selectedFieldDelimiter="custom";$scope.ui.customFieldDelimiter="";var isCustom=true;for(var i=0;i<$scope.ui.fieldDelimiterOptions.length-1;i++)if($scope.ui.fieldDelimiterOptions[i].value===fieldDelimiter){isCustom=false;$scope.ui.selectedFieldDelimiter=$scope.ui.fieldDelimiterOptions[i].value}isCustom&&($scope.ui.customFieldDelimiter=fieldDelimiter)}}function getDelimiterSelection(){if("delimited"===$scope.job.data_description.format){var selectedFieldDelimiter=$scope.ui.selectedFieldDelimiter;$scope.job.data_description.field_delimiter="custom"===selectedFieldDelimiter?$scope.ui.customFieldDelimiter:selectedFieldDelimiter}else{delete $scope.job.data_description.field_delimiter;delete $scope.job.data_description.quote_character}}function getAnalysisLimitsSelection(){var ui=$scope.ui;var job=$scope.job;if(""===ui.modelMemoryLimitText||null===ui.modelMemoryLimitText||void 0===ui.modelMemoryLimitText){if(void 0!==job.analysis_limits){delete job.analysis_limits.model_memory_limit;0===Object.keys(job.analysis_limits).length&&delete job.analysis_limits}}else{void 0===job.analysis_limits&&(job.analysis_limits={});job.analysis_limits.model_memory_limit=ui.modelMemoryLimitText}}function getDatafeedSelection(){if($scope.ui.isDatafeed){var df=$scope.ui.datafeed;""===df.queryText&&(df.queryText='{"match_all":{}}');var query=df.queryText;try{query=JSON.parse(query)}catch(e){console.log("getDatafeedSelection(): could not parse query JSON")}var indices=[];df.indicesText&&(indices=df.indicesText.split(",").map(function(i){return i.trim()}));var types=[];if(df.typesText){types=df.typesText.split(",");for(var i=0;i<types.length;i++)types[i]=types[i].trim()}var typeKeys=Object.keys($scope.ui.types);0===_lodash2.default.difference(typeKeys,types).length&&(types=[]);$scope.job.datafeed_config||($scope.job.datafeed_config={});var config=$scope.job.datafeed_config;config.query=query;""===df.queryDelayText||null===df.queryDelayText||void 0===df.queryDelayText?delete config.query_delay:config.query_delay=df.queryDelayText;""===df.frequencyText||null===df.frequencyText||void 0===df.frequencyText?delete config.frequency:config.frequency=df.frequencyText;""===df.scrollSizeText||null===df.scrollSizeText||void 0===df.scrollSizeText?delete config.scroll_size:config.scroll_size=df.scrollSizeText;config.indices=indices;config.types=types}}function getCustomUrlSelection(){$scope.job.custom_settings&&$scope.job.custom_settings.custom_urls&&0===$scope.job.custom_settings.custom_urls.length&&delete $scope.job.custom_settings}function getCategorizationFilterSelection(){$scope.job.analysis_config&&$scope.job.analysis_config.categorization_filters&&0===$scope.job.analysis_config.categorization_filters.length&&delete $scope.job.analysis_config.categorization_filters}function createJSONText(){getDelimiterSelection();getAnalysisLimitsSelection();getDatafeedSelection();getCustomUrlSelection();getCategorizationFilterSelection();$scope.ui.jsonText=_angular2.default.toJson($scope.job,true)}$scope.addCustomUrl=function(){$scope.job.custom_settings||($scope.job.custom_settings={});$scope.job.custom_settings.custom_urls||($scope.job.custom_settings.custom_urls=[]);$scope.job.custom_settings.custom_urls.push({url_name:"",url_value:""})};$scope.removeCustomUrl=function(index){$scope.job.custom_settings.custom_urls.splice(index,1)};$scope.addCategorizationFilter=function(){if($scope.job.analysis_config){$scope.job.analysis_config.categorization_filters||($scope.job.analysis_config.categorization_filters=[]);$scope.job.analysis_config.categorization_filters.push("")}};$scope.removeCategorizationFilter=function(index){$scope.job.analysis_config&&$scope.job.analysis_config.categorization_filters&&$scope.job.analysis_config.categorization_filters.splice(index,1)};$scope.influencerChecked=function(inf){return _lodash2.default.contains($scope.job.analysis_config.influencers,inf)};$scope.toggleInfluencer=function(inf){var influencers=$scope.job.analysis_config.influencers;if($scope.influencerChecked(inf))for(var i=0;i<influencers.length;i++)influencers[i]===inf&&$scope.job.analysis_config.influencers.splice(i,1);else $scope.job.analysis_config.influencers.push(inf)};$scope.addCustomInfluencer=function(){if(""!==$scope.ui.tempCustomInfluencer){$scope.ui.customInfluencers.push($scope.ui.tempCustomInfluencer);$scope.ui.tempCustomInfluencer=""}};function extractCustomInfluencers(){var allInfluencersList=$scope.ui.influencers;$scope.ui.customInfluencers=_lodash2.default.difference($scope.job.analysis_config.influencers,allInfluencersList);console.log("extractCustomInfluencers: ",$scope.ui.customInfluencers)}function validateJob(){var limits=(0,_new_job_defaults.newJobLimits)();var validationResults=(0,_job_utils.basicJobValidation)($scope.job,$scope.fields,limits);var valid=validationResults.valid;var message="Fill in all required fields";var tabs=$scope.ui.validation.tabs;_lodash2.default.each(tabs,function(tab){tab.valid=true;for(var check in tab.checks)if(tab.checks.hasOwnProperty(check)){tab.checks[check].valid=true;tab.checks[check].message=""}});var job=$scope.job;if(job){if(validationResults.contains("job_id_empty"))tabs[0].checks.jobId.valid=false;else if(validationResults.contains("job_id_invalid")){tabs[0].checks.jobId.valid=false;var msg="Job name can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";msg+="must start and end with an alphanumeric character";tabs[0].checks.jobId.message=msg}if(validationResults.contains("job_group_id_invalid")){tabs[0].checks.groupIds.valid=false;var _msg="Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";_msg+="must start and end with an alphanumeric character";tabs[0].checks.groupIds.message=_msg}if(validationResults.contains("model_memory_limit_invalid")){tabs[0].checks.modelMemoryLimit.valid=false;var _msg2="Model memory limit cannot be higher than the maximum value of "+limits.max_model_memory_limit.toUpperCase();tabs[0].checks.modelMemoryLimit.message=_msg2}if(validationResults.contains("categorization_filter_invalid")){tabs[1].checks.categorizationFilters.message="categorizationFieldName must be set to allow filters";tabs[1].checks.categorizationFilters.valid=false}validationResults.contains("detectors_empty")&&(tabs[1].checks.detectors.valid=false);if(validationResults.contains("detectors_duplicates")){var _msg3="Duplicate detectors were found. Detectors having the same combined configuration for";_msg3+=" 'function', 'field_name', 'by_field_name', 'over_field_name' and";_msg3+=" 'partition_field_name' are not allowed within the same job.";tabs[1].checks.detectors.message=_msg3;tabs[1].checks.detectors.valid=false}validationResults.contains("influencers_empty");if(validationResults.contains("bucket_span_empty")){tabs[1].checks.bucketSpan.message="bucket_span must be set";tabs[1].checks.bucketSpan.valid=false}else if(validationResults.contains("bucket_span_invalid")){var _msg4=job.analysis_config.bucket_span+" is not a valid time interval format e.g. 10m, 1h.";_msg4+=" It also needs to be higher than zero.";tabs[1].checks.bucketSpan.message=_msg4;tabs[1].checks.bucketSpan.valid=false}validateIndex(tabs,function(){return validationResults.contains("index_fields_invalid")})}_lodash2.default.each(tabs,function(tab){_lodash2.default.each(tab.checks,function(item){false===item.valid&&(tab.valid=false)})});return{valid:valid,message:message}}function validateIndex(tabs){var dataFeedTest=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return 0===Object.keys($scope.fields).length};if(dataFeedTest()){var msg="Could not load fields from index";tabs[3].checks.hasAccessToIndex.valid=false;tabs[3].checks.hasAccessToIndex.message=msg;tabs[3].valid=false}else{tabs[3].checks.hasAccessToIndex.valid=true;tabs[3].valid=true}}function openSaveStatusWindow(){$modal.open({template:_save_status_modal2.default,controller:"MlSaveStatusModal",backdrop:"static",keyboard:false,size:"sm",resolve:{params:function params(){return{pscope:$scope,openDatafeed:function openDatafeed(){mlDatafeedService.openJobTimepickerWindow($scope.job)}}}}})}function loadDataPreview(){createJSONText();$scope.ui.dataPreview="";var job=$scope.job;job.datafeed_config&&job.datafeed_config.indices.length?_job_service.mlJobService.searchPreview(job).then(function(resp){var data=void 0;data=resp.aggregations?resp.aggregations.buckets.buckets.slice(0,_job_utils.ML_DATA_PREVIEW_COUNT):resp.hits.hits;$scope.ui.dataPreview=_angular2.default.toJson(data,true)}).catch(function(resp){$scope.ui.dataPreview=_angular2.default.toJson(resp,true)}):$scope.ui.dataPreview="Datafeed does not exist"}function showDataPreviewTab(){var hidden=true;$scope.ui.isDatafeed&&(hidden=false);"NONE"===$scope.ui.dataLocation&&$scope.mode===MODE.CLONE&&(hidden=true);$scope.ui.tabs[5].hidden=hidden;$scope.$applyAsync()}function allInfluencers(){var influencers=$scope.ui.influencers.concat($scope.ui.customInfluencers);influencers=_lodash2.default.uniq(influencers);return _lodash2.default.sortBy(influencers,function(inf){return inf})}$scope.aceLoaded=function(editor){$scope.$applyAsync();"datafeed-preview"===editor.container.id&&editor.setReadOnly(true)};init()})},3743:function(module,exports){module.exports='<ml-nav-menu name="new_job_advanced"></ml-nav-menu>\n<ml-new-job class="ml-new-job euiPage euiPage--widthIsNotRestricted">\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlNewJob" class="euiPageBody">\n    <div class="euiPanel euiPanel--paddingLarge euiPageContent">\n      <div class="euiPageContentHeader">\n        <div class="euiPageContentHeaderSection">\n          <h3 class="euiTitle euiTitle--large">{{ui.pageTitle}}</h3>\n        </div>\n      </div>\n      <div class="euiPageContentBody">\n        <ul class="nav nav-tabs">\n          <li\n            class="kbn-settings-tab"\n            ng-class="{ active: ui.currentTab === tab.index }"\n            ng-repeat="tab in ui.tabs"\n            ng-hide="ui.tabs[{{tab.index}}].hidden">\n\n            <a ng-click="ui.changeTab(tab)">\n              {{ tab.title }}\n              <i ng-hide=\'ui.validation.tabs[tab.index].valid\' class=\'validation-error fa fa-exclamation-circle\' />\n            </a>\n          </li>\n        </ul>\n\n        \x3c!-- tab 0 Job Details --\x3e\n        <ml-job-tab-0 class="tab" ng-show="ui.currentTab === 0">\n          <div class="tab_contents">\n            \x3c!-- ID --\x3e\n            <div class="form-group">\n              <ml-form-label label-id="new_job_id" tooltip-append-to-body="true">Name</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_id"\n                aria-describedby="ml_aria_description_new_job_id"\n                ng-model="job.job_id"\n                required\n                placeholder="Job ID"\n                ng-change="changeJobIDCase()"\n                input-focus\n                class="form-control lowercase" />\n              <div ng-hide="ui.validation.tabs[0].checks.jobId.valid" class="validation-error">{{ ( ui.validation.tabs[0].checks.jobId.message || "Enter a name for the job" ) }}</div>\n            </div>\n            \x3c!-- description --\x3e\n            <div class="form-group">\n              <ml-form-label label-id="new_job_description">Description</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_description"\n                aria-describedby="ml_aria_description_new_job_description"\n                ng-model="job.description"\n                placeholder="Job description"\n                class="form-control" />\n            </div>\n\n            <div class="form-group">\n              <ml-form-label label-id="new_job_group">Job Groups</ml-form-label>\n              <ml-job-group-select\n                aria-labelledby="ml_aria_label_new_job_group"\n                aria-describedby="ml_aria_description_new_job_group"\n                job-groups=\'job.groups\'\n                external-update-function=\'jobGroupsUpdateFunction\' />\n              <div ng-hide="ui.validation.checks.groupIds.valid" class="validation-error">{{ ui.validation.tabs[0].checks.groupIds.message }}</div>\n            </div>\n\n            <div class="form-group">\n              <label class="kuiFormLabel">Custom URLs</label><i ml-info-icon="new_job_custom_urls" />\n              <div class="euiSpacer euiSpacer--s"></div>\n              <div ng-if="job.custom_settings && job.custom_settings.custom_urls">\n                <div ng-repeat="item in job.custom_settings.custom_urls track by $index" class="custom-url">\n                  <div class="field-cols">\n\n                    <div class="form-group">\n                      <label class="kuiFormLabel" id="ml_aria_label_custom_url_label_{{$index}}">Label</label>\n                      <input\n                        aria-labelledby="ml_aria_label_custom_url_label_{{$index}}"\n                        ng-model="item.url_name"\n                        type="text"\n                        class="form-control" />\n                    </div>\n                  </div>\n\n                  <div class="field-cols">\n                    <div class="form-group">\n                      <label class="kuiFormLabel" id="ml_aria_label_custom_url_{{$index}}">URL</label>\n                      <textarea\n                        aria-labelledby="ml_aria_label_custom_url_{{$index}}"\n                        ng-model="item.url_value"\n                        type="text"\n                        class="form-control" ></textarea>\n                    </div>\n                  </div>\n\n                  <button\n                    aria-label="Remove Custom URL"\n                    ng-click="removeCustomUrl($index)"\n                    tooltip-append-to-body="true"\n                    type="button"\n                    class="kuiButton kuiButton--danger kuiButton--small remove-button">\n                      <i aria-hidden="true" class="fa fa-times" />\n                  </button>\n                </div>\n              </div>\n              <div>\n                <button\n                  aria-labelledby="ml_aria_label_new_job_custom_urls"\n                  aria-describedby="ml_aria_description_new_job_custom_urls"\n                  ng-click="addCustomUrl()"\n                  type="button"\n                  class="kuiButton kuiButton--primary kuiButton--small">\n                  <i aria-hidden="true" class="fa fa-plus" />\n                  <span id="ml_aria_label_new_job_custom_urls">Add Custom URL</span>\n                </button>\n              </div>\n\n            </div>\n\n            <div class="form-group">\n              <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n                <input type="checkbox"\n                  aria-labelledby="ml_aria_label_new_job_dedicated_index"\n                  aria-describedby="ml_aria_description_new_job_dedicated_index"\n                  class=\'kuiCheckBox\'\n                  ng-change="setDedicatedIndex()"\n                  ng-model  ="ui.useDedicatedIndex" />\n                <span class=\'kuiCheckBoxLabel__text\'>\n                  <span id="ml_aria_label_new_job_dedicated_index">Use dedicated index</span>\n                  <i ml-info-icon="new_job_dedicated_index" />\n                </span>\n              </label>\n            </div>\n\n            <div class="form-group">\n              <ml-form-label label-id="new_job_model_memory_limit">Model memory limit</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_model_memory_limit"\n                aria-describedby="ml_aria_description_new_job_model_memory_limit"\n                ng-model="ui.modelMemoryLimitText"\n                placeholder="{{ui.modelMemoryLimitDefault}}"\n                class="form-control" />\n              <div ng-hide="ui.validation.tabs[0].checks.modelMemoryLimit.valid" class="validation-error">{{ ui.validation.tabs[0].checks.modelMemoryLimit.message }}</div>\n            </div>\n\n          </div>\n        </ml-job-tab-0>\n\n        \x3c!-- tab2 1 Analysis Configuration --\x3e\n        <ml-job-tab-1 ng-show="ui.currentTab === 1">\n          <div class="tab_contents">\n            <div class="form-group">\n              <ml-form-label label-id="new_job_bucketspan">bucket_span</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_bucketspan"\n                aria-describedby="ml_aria_description_new_job_bucketspan"\n                type="text"\n                ng-model="job.analysis_config.bucket_span"\n                placeholder=""\n                ng-change="calculateDatafeedFrequencyDefaultSeconds()"\n                class="form-control" />\n              <div ng-hide="ui.validation.tabs[1].checks.bucketSpan.valid" class="validation-error">\n                {{ ( ui.validation.tabs[1].checks.bucketSpan.message || "bucket_span is not a valid time interval format" ) }}\n              </div>\n            </div>\n            <div class="form-group">\n              <ml-form-label label-id="new_job_summarycountfieldname">summary_count_field_name</ml-form-label>\n              <field-select\n                label-id=\'"new_job_summarycountfieldname"\'\n                on-change=\'setAnalysisConfigProperty\'\n                value=\'job.analysis_config.summary_count_field_name\'\n                field=\'"summary_count_field_name"\'\n                options=\'fields\'>\n              </field-select>\n            </div>\n            <div class="form-group">\n              <ml-form-label label-id="new_job_categorizationfieldname">categorization_field_name</ml-form-label>\n              <field-select\n                label-id=\'"new_job_categorizationfieldname"\'\n                on-change=\'setAnalysisConfigProperty\'\n                value=\'job.analysis_config.categorization_field_name\'\n                field=\'"categorization_field_name"\'\n                options=\'catFields\'>\n              </field-select>\n            </div>\n\n            <div class="form-group"\n              ng-show="(job.analysis_config.categorization_field_name !== undefined && job.analysis_config.categorization_field_name !== \'\') ||\n                       (job.analysis_config.categorization_filters && job.analysis_config.categorization_filters.length)">\n\n              <label class="kuiFormLabel" aria-describedby="ml_aria_description_new_job_categorizationfilters">Categorization Filters</label>\n              <i ml-info-icon="new_job_categorizationfilters" />\n              <div class="euiSpacer euiSpacer--s"></div>\n              <div ng-if="job.analysis_config && job.analysis_config.categorization_filters">\n                <div ng-repeat="item in job.analysis_config.categorization_filters track by $index" class="categorization-filter">\n                  <div class="field-cols">\n\n                    <div class="form-group">\n                      <input\n                        aria-label="Categorization filter regular expression"\n                        ng-model="job.analysis_config.categorization_filters[$index]"\n                        type="text"\n                        class="form-control" />\n                    </div>\n                  </div>\n\n                  <button\n                    aria-label="Remove categorization filter"\n                    ng-click="removeCategorizationFilter($index)"\n                    tooltip-append-to-body="true"\n                    type="button"\n                    class="kuiButton kuiButton--danger kuiButton--small remove-button">\n                      <i aria-hidden="true" class="fa fa-times" />\n                  </button>\n                </div>\n              </div>\n              <div>\n                <button\n                  aria-labelledby="ml_aria_label_add_categorization_filter"\n                  ng-click="addCategorizationFilter()"\n                  type="button"\n                  ng-disabled="job.analysis_config.categorization_field_name === undefined || job.analysis_config.categorization_field_name === \'\'"\n                  class="kuiButton kuiButton--primary kuiButton--small">\n                  <i aria-hidden="true" class="fa fa-plus" />\n                  <span id="ml_aria_label_add_categorization_filter">Add Categorization Filter</span>\n                </button>\n              </div>\n            </div>\n            <div ng-hide="ui.validation.tabs[1].checks.categorizationFilters.valid" class="validation-error">\n              {{ ( ui.validation.tabs[1].checks.categorizationFilters.message || "Categorization filters must all be valid regular expressions" ) }}\n            </div>\n\n            <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n            <label class="kuiFormLabel" aria-describedby="ml_aria_description_new_job_detectors">Detectors</label>\n            <i ml-info-icon="new_job_detectors" />\n\n            <div class="euiSpacer euiSpacer--s"></div>\n\n            <div ml-job-detectors-list\n              ml-detectors="job.analysis_config.detectors"\n              ml-indices="indices"\n              ml-fields="fields"\n              ml-cat-field-name-selected="(job.analysis_config.categorization_field_name?true:false)"\n              ml-edit-mode="\'NEW\'"\n              ></div>\n            <div ng-hide="ui.validation.tabs[1].checks.detectors.valid" class="validation-error">\n              {{ ( ui.validation.tabs[1].checks.detectors.message || "At least one detector should be configured" ) }}\n            </div>\n\n            <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n            <label class="kuiFormLabel" aria-describedby="ml_aria_description_new_job_influencers">Influencers</label>\n            <i ml-info-icon="new_job_influencers" />\n            <div class="influencer-list-container">\n\n              <div ng-repeat="inf in ui.allInfluencers()" >\n                <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n                  <input class=\'kuiCheckBox\' type="checkbox" ng-checked="influencerChecked(inf)" ng-click="toggleInfluencer(inf)" />\n                  <span class=\'kuiCheckBoxLabel__text\'>{{inf}}</span>\n                </label>\n              </div>\n\n              <div class="custom-influencer">\n                <input\n                  type="text"\n                  ng-model="ui.tempCustomInfluencer"\n                  placeholder="Custom influencer"\n                  class="form-control"  />\n                <button\n                  aria-label="Add Custom Influencer"\n                  ng-click="addCustomInfluencer()"\n                  ng-disabled="ui.tempCustomInfluencer===\'\'"\n                  type="button"\n                  class="kuiButton kuiButton--primary kuiButton--small">\n                  <i aria-hidden="true" class="fa fa-plus" /> Add\n                </button>\n              </div>\n            </div>\n            <div ng-hide="ui.validation.tabs[1].checks.influencers.valid" class="validation-error">\n              {{ ( ui.validation.tabs[1].checks.influencers.message || "At least one influencer should be selected" ) }}\n            </div>\n          </div>\n        </ml-job-tab-1>\n\n\n        \x3c!-- tab 2 Data Description --\x3e\n        <ml-job-tab-2 ng-show="ui.currentTab === 2">\n          <div class="tab_contents">\n            <div class="form-group">\n              <ml-form-label label-id="new_job_data_format">Data format</ml-form-label>\n              <select\n                aria-labelledby="ml_aria_label_new_job_data_format"\n                aria-describedby="ml_aria_description_new_job_data_format"\n                ng-model="job.data_description.format"\n                ng-disabled="ui.isDatafeed"\n                ng-options="item.value as item.title for item in ui.inputDataFormat"\n                class="form-control">\n              </select>\n            </div>\n            <ml-job-delimited-options ng-show="job.data_description.format===\'delimited\'">\n              <div class="form-group">\n                <ml-form-label label-id="new_job_delimiter">Delimiter</ml-form-label>\n                <select\n                  aria-labelledby="ml_aria_label_new_job_delimiter"\n                  aria-describedby="ml_aria_description_new_job_delimiter"\n                  ng-model="ui.selectedFieldDelimiter"\n                  ng-options="item.value as item.title for item in ui.fieldDelimiterOptions"\n                  class="form-control" />\n              </div>\n              <div class="form-group">\n                <input\n                  ng-model="ui.customFieldDelimiter"\n                  ng-show="ui.selectedFieldDelimiter===\'custom\'"\n                  ng-required="job.data_description.format===\'delimited\' && ui.selectedFieldDelimiter===\'custom\'"\n                  class="form-control" />\n              </div>\n              <div class="form-group">\n                <ml-form-label label-id="new_job_quote_character">Quote character</ml-form-label>\n                <input\n                  aria-labelledby="ml_aria_label_new_job_quote_character"\n                  aria-describedby="ml_aria_description_new_job_quote_character"\n                  ng-model="job.data_description.quote_character"\n                  ng-required="job.data_description.format===\'delimited\'"\n                  placeholder=""\n                  class="form-control" />\n              </div>\n            </ml-job-delimited-options>\n\n            <div class="form-group">\n              <ml-form-label label-id="new_job_time_field">Time field</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_time_field"\n                aria-describedby="ml_aria_description_new_job_time_field"\n                ng-model="job.data_description.time_field"\n                required\n                placeholder=""\n                class="form-control" />\n              <div ng-hide="ui.validation.tabs[2].checks.timeField.valid" class="validation-error">\n                {{ ( ui.validation.tabs[2].checks.timeField.message || "Time field should be specified" ) }}\n              </div>\n            </div>\n\n            <div class="form-group">\n              <ml-form-label label-id="new_job_time_format">Time format</ml-form-label>\n              <input\n                aria-labelledby="ml_aria_label_new_job_time_format"\n                aria-describedby="ml_aria_description_new_job_time_format"\n                ng-model="job.data_description.time_format"\n                required\n                placeholder=""\n                class="form-control" />\n              <div ng-hide="ui.validation.tabs[2].checks.timeFormat.valid" class="validation-error">\n                {{ ( ui.validation.tabs[2].checks.timeFormat.message || "Time format should be specified" ) }}\n              </div>\n              <div class="time-example">{{ ((exampleTime)?"e.g. "+ exampleTime:"") }}</div>\n            </div>\n          </div>\n        </ml-job-tab-2>\n\n        \x3c!-- tab 3 Datafeed --\x3e\n        <ml-job-tab-3 ng-show="ui.currentTab === 3">\n          <div class="tab_contents">\n            <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n              <input\n                aria-labelledby="ml_aria_label_new_job_enable_datafeed_job"\n                aria-describedby="ml_aria_description_new_job_enable_datafeed_job"\n                class=\'kuiCheckBox\'\n                ng-model="ui.isDatafeed"\n                ng-change="datafeedChange()"\n                ng-disabled="job.data_description.format!==\'json\'"\n                type="checkbox" />\n              <span class=\'kuiCheckBoxLabel__text\'>\n                <span id="ml_aria_label_new_job_enable_datafeed_job">Datafeed job</span>\n                <i ml-info-icon="new_job_enable_datafeed_job" />\n              </span>\n            </label>\n            <div class="euiSpacer euiSpacer--s"></div>\n            <div class="form-group help-pane" ng-show="job.data_description.format!==\'json\' && job.data_description.format!==undefined">\n              <small class="info">Data format must be set to \'JSON\' to enable the datafeed.</small>\n            </div>\n\n            <div ng-if="ui.isDatafeed">\n              <div class="form-group">\n                <ml-form-label label-id="new_job_datafeed_query" tooltip-append-to-body="true">Query</ml-form-label>\n                <input\n                  aria-labelledby="ml_aria_label_new_job_datafeed_query"\n                  aria-describedby="ml_aria_description_new_job_datafeed_query"\n                  ng-model="ui.datafeed.queryText"\n                  placeholder=\'{ "match_all": {}}\'\n                  class="form-control" />\n\n              </div>\n              <div class="form-group" >\n                <ml-form-label label-id="new_job_datafeed_query_delay">Query delay</ml-form-label>\n                <input\n                  aria-labelledby="ml_aria_label_new_job_datafeed_query_delay"\n                  aria-describedby="ml_aria_description_new_job_datafeed_query_delay"\n                  ng-model="ui.datafeed.queryDelayText"\n                  placeholder="{{ui.datafeed.queryDelayDefault}}"\n                  min="0"\n                  class="form-control" />\n\n              </div>\n              <div class="form-group" >\n                <ml-form-label label-id="new_job_datafeed_frequency">Frequency</ml-form-label>\n                <input\n                  aria-labelledby="ml_aria_label_new_job_datafeed_frequency"\n                  aria-describedby="ml_aria_description_new_job_datafeed_frequency"\n                  ng-model="ui.datafeed.frequencyText"\n                  placeholder="{{ui.datafeed.frequencyDefault}}"\n                  min="0"\n                  class="form-control" />\n\n              </div>\n              <div class="form-group" >\n                <ml-form-label label-id="new_job_datafeed_scrollsize" tooltip-append-to-body="true">scroll_size</ml-form-label>\n                <input\n                  aria-labelledby="ml_aria_label_new_job_datafeed_scrollsize"\n                  aria-describedby="ml_aria_description_new_job_datafeed_scrollsize"\n                  ng-model="ui.datafeed.scrollSizeText"\n                  placeholder="{{ui.datafeed.scrollSizeDefault}}"\n                  type="number"\n                  min="0"\n                  class="form-control" />\n\n              </div>\n              <div class="form-group" >\n                <div class="form-group">\n                  <label class="kuiFormLabel">Index</label>\n                  <div class="input-group">\n                  <input\n                    ng-model="ui.datafeed.indicesText"\n                    placeholder=""\n                    class="form-control"\n                    aria-describedby="index-text-status"\n                    ng-change="indexChanged()"\n                    list=\'index_datalist\' />\n                    <span class="input-group-addon" id="index-text-status">\n                      <i ng-show="ui.indexTextOk === true && ui.fieldsUpToDate === true" aria-hidden="true" style=\'color:green;\' class="fa fa-check"></i>\n                      <i ng-show="ui.indexTextOk === false || ui.fieldsUpToDate === false" aria-hidden="true" style=\'color:red;\' class="fa fa-remove"></i>\n                    </span>\n                  </div>\n                  <div ng-hide="ui.validation.tabs[3].checks.hasAccessToIndex.valid"  class="validation-error">{{ ( ui.validation.tabs[3].checks.hasAccessToIndex.message) }}</div>\n                </div>\n                <div class="form-group" ng-show="ui.fieldsUpToData === false || ui.fieldsUpToDate === false">\n                  <button\n                    ng-click="loadFields()"\n                    type="button"\n                    class="kuiButton kuiButton--primary kuiButton--small">\n                    <i aria-hidden="true" class="fa fa-refresh"></i>\n                    <span>Reload index</span>\n                  </button>\n                </div>\n\n                <div ng-show="ui.indexTextOk && ui.fieldsUpToDate === true" class="form-group">\n                  <label class="kuiFormLabel">Time-field name</label>\n                  <select\n                    ng-model="job.data_description.time_field"\n                    class="form-control">\n                    <option ng-repeat="(key, value) in dateFields">{{key}}</option>\n                  </select>\n                </div>\n\n                <div class="clearfix"></div>\n\n              </div>\n            </div>\n          </div>\n        </ml-job-tab-3>\n\n        \x3c!-- tab 4 Edit JSON --\x3e\n        <ml-job-tab-4 ng-show="ui.currentTab === 4" class="ml_json_tab">\n          <div class="tab_contents">\n            <label class="kuiFormLabel" id="ml_aria_label_new_job_json">JSON</label>\n            <div\n              class="form-control json-textarea"\n              ui-ace="{\n                mode: \'json\',\n                onChange: jsonTextChange\n              }"\n              ng-model="ui.jsonText"\n              ></div>\n          </div>\n        </ml-job-tab-4>\n\n        \x3c!-- tab 5 Data preview --\x3e\n        <ml-job-tab-5 ng-show="ui.currentTab === 5" class="ml_data_preview_tab">\n          <div class="tab_contents">\n            <ml-form-label label-id="new_job_data_preview">Data preview</ml-form-label>\n            <ml-loading-indicator\n              label="Loading data preview"\n              is-loading="(ui.dataPreview === \'\')"\n            />\n            <div ng-hide="(ui.dataPreview === \'\')">\n              <div\n                id="datafeed-preview"\n                class="form-control json-textarea"\n                ui-ace="{\n                  mode: \'json\',\n                  onLoad: aceLoaded\n                }"\n                ng-model="ui.dataPreview"\n                ></div>\n                <div class="note">\n                  Preview returns the content of the _source field only.\n                </div>\n            </div>\n          </div>\n        </ml-job-tab-5>\n\n        <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n        <div class="euiFlexGroup euiFlexGroup--gutterSmall euiFlexGroup--alignItemsCenter euiFlexGroup--responsive">\n          <div class="euiFlexItem euiFlexItem--flexGrowZero">\n            <ml-validate-job\n              fields="fields"\n              fill="false"\n              get-job-config="getJobConfig"\n              is-current-job-config="isCurrentJobConfig"\n              is-disabled="(saveLock === true)"\n              ng-show="jobState === JOB_STATE.NOT_STARTED"\n            />\n          </div>\n          <div class="euiFlexItem euiFlexItem--flexGrowZero">\n            <button\n              ng-click="save()"\n              ng-disabled="(saveLock === true)"\n              class="euiButton euiButton--primary euiButton--small euiButton--fill"\n              aria-label="Save">\n              <span class="euiButton__content">\n                <span>Save</span>\n              </span>\n            </button>\n          </div>\n          <div class="euiFlexItem euiFlexItem--flexGrowZero">\n            <button\n              ng-click="cancel()"\n              ng-disabled="(saveLock === true)"\n              class="euiButton euiButton--primary euiButton--small euiButton--fill"\n              aria-label="Cancel">\n              <span class="euiButton__content">\n                <span>Cancel</span>\n              </span>\n            </button>\n          </div>\n        </div>\n\n      </div>\n    </div>\n  </div>\n</ml-new-job>\n'},3744:function(module,exports){module.exports='<div class="save-status-modal">\n  \x3c!-- <ml-message-bar ></ml-message-bar> --\x3e\n  <h3 class="euiTitle euiTitle--small">Saving new job</h3>\n  <div class="status-item">Saving job...\n  \t<i ng-show="pscope.ui.saveStatus.job === -1" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>\n  \t<i ng-show="pscope.ui.saveStatus.job === 1" aria-hidden="true" class="fa fa-spinner fa-spin"></i>\n  \t<i ng-show="pscope.ui.saveStatus.job === 2" aria-hidden="true" style="color:green;" class="fa fa-check"></i>\n  </div>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n\n  <button\n    ng-show="(pscope.ui.saveStatus.job === 2 && pscope.ui.isDatafeed)"\n    ng-disabled="pscope.saveLock"\n    ng-click="openDatafeed();"\n    class="kuiButton kuiButton--primary"\n    aria-label="Back">\n      Start datafeed\n  </button>\n\n  <button\n  \tng-disabled="pscope.saveLock"\n    ng-click="close();"\n    class="kuiButton kuiButton--primary"\n    aria-label="Back">\n    \tClose\n  </button>\n</div>\n'},3745:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3746);__webpack_require__(3747)},3746:function(module,exports){},3747:function(module,exports,__webpack_require__){"use strict";var _modules=__webpack_require__(2);var _module=_modules.uiModules.get("apps/ml");_module.controller("MlSaveStatusModal",function($scope,$location,$modalInstance,params){$scope.pscope=params.pscope;$scope.ui={showTimepicker:false};$scope.openDatafeed=function(){$location.path("jobs");$modalInstance.close();params.openDatafeed()};$scope.close=function(){2===$scope.pscope.ui.saveStatus.job&&$location.path("jobs");$scope.pscope.ui.saveStatus.job=0;$modalInstance.close()}})},3748:function(module,exports,__webpack_require__){"use strict";__webpack_require__(93);var _field_select=__webpack_require__(3749);var _modules=__webpack_require__(2);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("fieldSelect",function(reactDirective){return reactDirective(_field_select.FieldSelect)})},3749:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FieldSelect=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _reactSelect=__webpack_require__(3750);var _reactSelect2=_interopRequireDefault(_reactSelect);__webpack_require__(3756);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var FieldSelect=exports.FieldSelect=function(_Component){_inherits(FieldSelect,_Component);function FieldSelect(){_classCallCheck(this,FieldSelect);return _possibleConstructorReturn(this,(FieldSelect.__proto__||Object.getPrototypeOf(FieldSelect)).apply(this,arguments))}_createClass(FieldSelect,[{key:"render",value:function render(){var _props=this.props,labelId=_props.labelId,onChange=_props.onChange,value=_props.value,options=_props.options,field=_props.field,placeholder=_props.placeholder;function change(selection){var val=selection?selection.value:"";onChange(val,field)}function getOptions(){var ops=[];_lodash2.default.each(options,function(op,key){ops.push({label:key,value:key})});return ops}return _react2.default.createElement(_reactSelect2.default,{"aria-describedby":"ml_aria_description_"+labelId,"aria-labelledby":"ml_aria_label_"+labelId,placeholder:placeholder,options:getOptions(),value:value,onChange:change})}}]);return FieldSelect}(_react.Component);FieldSelect.propTypes={labelId:_propTypes2.default.string,onChange:_propTypes2.default.func,value:_propTypes2.default.string,options:_propTypes2.default.object,field:_propTypes2.default.string,placeholder:_propTypes2.default.string}},3750:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.defaultFilterOptions=exports.defaultClearRenderer=exports.defaultArrowRenderer=exports.defaultMenuRenderer=exports.Option=exports.Value=exports.Creatable=exports.AsyncCreatable=exports.Async=void 0;var _Select=__webpack_require__(632);var _Select2=_interopRequireDefault(_Select);var _Async=__webpack_require__(1426);var _Async2=_interopRequireDefault(_Async);var _AsyncCreatable=__webpack_require__(3755);var _AsyncCreatable2=_interopRequireDefault(_AsyncCreatable);var _Creatable=__webpack_require__(1427);var _Creatable2=_interopRequireDefault(_Creatable);var _Value=__webpack_require__(1425);var _Value2=_interopRequireDefault(_Value);var _Option=__webpack_require__(1424);var _Option2=_interopRequireDefault(_Option);var _defaultMenuRenderer=__webpack_require__(870);var _defaultMenuRenderer2=_interopRequireDefault(_defaultMenuRenderer);var _defaultArrowRenderer=__webpack_require__(1421);var _defaultArrowRenderer2=_interopRequireDefault(_defaultArrowRenderer);var _defaultClearRenderer=__webpack_require__(1422);var _defaultClearRenderer2=_interopRequireDefault(_defaultClearRenderer);var _defaultFilterOptions=__webpack_require__(869);var _defaultFilterOptions2=_interopRequireDefault(_defaultFilterOptions);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_Select2.default.Async=_Async2.default;_Select2.default.AsyncCreatable=_AsyncCreatable2.default;_Select2.default.Creatable=_Creatable2.default;_Select2.default.Value=_Value2.default;_Select2.default.Option=_Option2.default;exports.default=_Select2.default;exports.Async=_Async2.default;exports.AsyncCreatable=_AsyncCreatable2.default;exports.Creatable=_Creatable2.default;exports.Value=_Value2.default;exports.Option=_Option2.default;exports.defaultMenuRenderer=_defaultMenuRenderer2.default;exports.defaultArrowRenderer=_defaultArrowRenderer2.default;exports.defaultClearRenderer=_defaultClearRenderer2.default;exports.defaultFilterOptions=_defaultFilterOptions2.default},3751:function(module,exports,__webpack_require__){"use strict";var emptyFunction=__webpack_require__(43);var invariant=__webpack_require__(55);var ReactPropTypesSecret=__webpack_require__(3752);module.exports=function(){function shim(props,propName,componentName,location,propFullName,secret){if(secret===ReactPropTypesSecret)return;invariant(false,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}shim.isRequired=shim;function getShim(){return shim}var ReactPropTypes={array:shim,bool:shim,func:shim,number:shim,object:shim,string:shim,symbol:shim,any:shim,arrayOf:getShim,element:shim,instanceOf:getShim,node:shim,objectOf:getShim,oneOf:getShim,oneOfType:getShim,shape:getShim,exact:getShim};ReactPropTypes.checkPropTypes=emptyFunction;ReactPropTypes.PropTypes=ReactPropTypes;return ReactPropTypes}},3752:function(module,exports,__webpack_require__){"use strict";var ReactPropTypesSecret="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";module.exports=ReactPropTypesSecret},3753:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var trim=function trim(str){return str.replace(/^\s+|\s+$/g,"")};exports.default=trim},3754:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=function(event){event.preventDefault();event.stopPropagation();if("A"!==event.target.tagName||!("href"in event.target))return;event.target.target?window.open(event.target.href,event.target.target):window.location.href=event.target.href}},3755:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(323);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _Async=__webpack_require__(1426);var _Async2=_interopRequireDefault(_Async);var _Creatable=__webpack_require__(1427);var _Creatable2=_interopRequireDefault(_Creatable);var _Select=__webpack_require__(632);var _Select2=_interopRequireDefault(_Select);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var AsyncCreatableSelect=function(_React$Component){_inherits(AsyncCreatableSelect,_React$Component);function AsyncCreatableSelect(){_classCallCheck(this,AsyncCreatableSelect);return _possibleConstructorReturn(this,(AsyncCreatableSelect.__proto__||Object.getPrototypeOf(AsyncCreatableSelect)).apply(this,arguments))}_createClass(AsyncCreatableSelect,[{key:"focus",value:function focus(){this.select.focus()}},{key:"render",value:function render(){var _this2=this;return _react2.default.createElement(_Async2.default,this.props,function(_ref){var ref=_ref.ref,asyncProps=_objectWithoutProperties(_ref,["ref"]);var asyncRef=ref;return _react2.default.createElement(_Creatable2.default,asyncProps,function(_ref2){var ref=_ref2.ref,creatableProps=_objectWithoutProperties(_ref2,["ref"]);var creatableRef=ref;return _this2.props.children(_extends({},creatableProps,{ref:function ref(select){creatableRef(select);asyncRef(select);_this2.select=select}}))})})}}]);return AsyncCreatableSelect}(_react2.default.Component);var defaultChildren=function defaultChildren(props){return _react2.default.createElement(_Select2.default,props)};AsyncCreatableSelect.propTypes={children:_propTypes2.default.func.isRequired};AsyncCreatableSelect.defaultProps={children:defaultChildren};exports.default=AsyncCreatableSelect},3756:function(module,exports){},3757:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3758)},3758:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3759);__webpack_require__(3760);__webpack_require__(1430);__webpack_require__(3765);__webpack_require__(255);__webpack_require__(427);__webpack_require__(634);__webpack_require__(875);__webpack_require__(3770);__webpack_require__(424);__webpack_require__(635);__webpack_require__(370)},3759:function(module,exports){},3760:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);__webpack_require__(425);var _index=__webpack_require__(364);var _validation_utils=__webpack_require__(631);var _parse_interval=__webpack_require__(127);var _datemath=__webpack_require__(83);var _datemath2=_interopRequireDefault(_datemath);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _job_utils=__webpack_require__(41);var _check_license=__webpack_require__(68);var _check_privilege=__webpack_require__(35);var _ml_time_buckets=__webpack_require__(277);var _filter_agg_types=__webpack_require__(871);var _validate_job=__webpack_require__(629);var _adjust_interval=__webpack_require__(872);var _create_fields=__webpack_require__(873);var _change_job_id_case=__webpack_require__(1429);var _states=__webpack_require__(501);var _index_utils=__webpack_require__(128);var _check_ml_nodes=__webpack_require__(69);var _new_job_defaults=__webpack_require__(253);var _new_job_utils=__webpack_require__(144);var _job_service=__webpack_require__(24);var _prepopulate_job_settings=__webpack_require__(874);var _create_job_service=__webpack_require__(1430);var _full_time_range_selector_service=__webpack_require__(633);var _messagebar_service=__webpack_require__(79);var _promise=__webpack_require__(89);var _create_job=__webpack_require__(3764);var _create_job2=_interopRequireDefault(_create_job);var _timefilter=__webpack_require__(14);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/jobs/new_job/simple/single_metric",{template:_create_job2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.loadCurrentIndexPattern,savedSearch:_index_utils.loadCurrentSavedSearch,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults,initPromise:(0,_promise.initPromise)(true)}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlCreateSingleMetricJob",function($scope,$route,$filter,Private,AppState){_timefilter.timefilter.enableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();var msgs=_messagebar_service.mlMessageBarService;var MlTimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);var moveToAdvancedJobCreation=Private(_new_job_utils.moveToAdvancedJobCreationProvider);var mlSingleMetricJobService=Private(_create_job_service.SingleMetricJobServiceProvider);var mlFullTimeRangeSelectorService=Private(_full_time_range_selector_service.FullTimeRangeSelectorServiceProvider);var stateDefaults={mlJobSettings:{}};var appState=new AppState(stateDefaults);$scope.index=$route.current.params.index;$scope.chartData=mlSingleMetricJobService.chartData;$scope.changeJobIDCase=_change_job_id_case.changeJobIDCase;$scope.addNewJobToRecentlyAccessed=_new_job_utils.addNewJobToRecentlyAccessed;var PAGE_WIDTH=_angular2.default.element(".single-metric-job-container").width();var BAR_TARGET=PAGE_WIDTH>2e3?1e3:PAGE_WIDTH/2;var MAX_BARS=BAR_TARGET+BAR_TARGET/100*100;var REFRESH_INTERVAL_MS=100;var MAX_BUCKET_DIFF=3;var METRIC_AGG_TYPE="metrics";var DEFAULT_MODEL_MEMORY_LIMIT="10MB";var jobProgressChecks={25:false,50:false,75:false};var refreshCounter=0;$scope.JOB_STATE=_states.JOB_STATE;$scope.jobState=$scope.JOB_STATE.NOT_STARTED;$scope.CHART_STATE=_states.CHART_STATE;$scope.chartState=_states.CHART_STATE.NOT_STARTED;var globalForceStop=false;var _createSearchItems=(0,_new_job_utils.createSearchItems)($route),indexPattern=_createSearchItems.indexPattern,savedSearch=_createSearchItems.savedSearch,query=_createSearchItems.query,filters=_createSearchItems.filters,combinedQuery=_createSearchItems.combinedQuery;(0,_index_utils.timeBasedIndexCheck)(indexPattern,true);var pageTitle=void 0!==savedSearch.id?"saved search "+savedSearch.title:"index pattern "+indexPattern.title;$scope.ui={indexPattern:indexPattern,pageTitle:pageTitle,showJobInput:false,showJobFinished:false,dirty:true,formValid:false,bucketSpanValid:true,bucketSpanEstimator:{status:0,message:""},aggTypeOptions:(0,_filter_agg_types.filterAggTypes)(_index.aggTypes.byType[METRIC_AGG_TYPE]),fields:[],timeFields:[],intervals:[{title:"Auto",value:"auto"},{title:"Millisecond",value:"ms"},{title:"Second",value:"s"},{title:"Minute",value:"m"},{title:"Hourly",value:"h"},{title:"Daily",value:"d"},{title:"Weekly",value:"w"},{title:"Monthly",value:"M"},{title:"Yearly",value:"y"},{title:"Custom",value:"custom"}],chartHeight:310,showAdvanced:false,resultsUrl:"",validation:{checks:{jobId:{valid:true},groupIds:{valid:true},modelMemoryLimit:{valid:true}}},isCountOrSum:false};$scope.formConfig={agg:{type:void 0},field:null,bucketSpan:"15m",chartInterval:void 0,resultsIntervalSeconds:void 0,start:0,end:0,timeField:indexPattern.timeFieldName,indexPattern:void 0,query:query,filters:filters,combinedQuery:combinedQuery,jobId:"",description:"",jobGroups:[],useDedicatedIndex:false,isSparseData:false,modelMemoryLimit:DEFAULT_MODEL_MEMORY_LIMIT};$scope.bucketSpanEstimatorExportedFunctions={};$scope.aggChange=function(){loadFields();$scope.ui.isFormValid();$scope.ui.dirty=true;$scope.ui.isCountOrSum="count"===$scope.formConfig.agg.type.dslName||"sum"===$scope.formConfig.agg.type.dslName;"count"===$scope.formConfig.agg.type.dslName&&($scope.formConfig.field=null)};$scope.fieldChange=function(){$scope.ui.isFormValid();$scope.ui.dirty=true};$scope.bucketSpanFieldChange=function(){$scope.ui.isFormValid();$scope.ui.bucketSpanEstimator.status=0;$scope.ui.bucketSpanEstimator.message="";$scope.ui.bucketSpanValid=true;var bucketSpanInterval=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan);null!==bucketSpanInterval&&0!==bucketSpanInterval.asMilliseconds()||($scope.ui.bucketSpanValid=false)};function setTime(){$scope.ui.bucketSpanValid=true;$scope.formConfig.start=_datemath2.default.parse(_timefilter.timefilter.getTime().from).valueOf();$scope.formConfig.end=_datemath2.default.parse(_timefilter.timefilter.getTime().to).valueOf();$scope.formConfig.format="epoch_millis";var bucketSpanInterval=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan);null!==bucketSpanInterval&&0!==bucketSpanInterval.asMilliseconds()||($scope.ui.bucketSpanValid=false);var bounds=_timefilter.timefilter.getActiveBounds();$scope.formConfig.chartInterval=new MlTimeBuckets;$scope.formConfig.chartInterval.setBarTarget(BAR_TARGET);$scope.formConfig.chartInterval.setMaxBars(MAX_BARS);$scope.formConfig.chartInterval.setInterval("auto");$scope.formConfig.chartInterval.setBounds(bounds);(0,_adjust_interval.adjustIntervalDisplayed)($scope.formConfig);$scope.ui.isFormValid();$scope.ui.dirty=true}function loadFields(){var agg=$scope.formConfig.agg;var fields=[];agg.type.params.forEach(function(param){"field"===param.name&&(fields=(0,_create_fields.getIndexedFields)(indexPattern,param.filterFieldTypes.split(",")))});$scope.ui.fields=[];_lodash2.default.each(fields,function(field,i){var id=(0,_job_utils.getSafeAggregationName)(field.displayName,i);var f={id:id,name:field.displayName,tooltip:field.displayName,agg:agg,mlType:field.mlType};$scope.ui.fields.push(f)});(1===$scope.ui.fields.length||null===$scope.formConfig.field&&"cardinality"===agg.type.name)&&($scope.formConfig.field=$scope.ui.fields[0])}$scope.ui.isFormValid=function(){void 0===$scope.formConfig.agg.type||void 0===$scope.formConfig.timeField?$scope.ui.formValid=false:$scope.ui.formValid=true;return $scope.ui.formValid};$scope.loadVis=function(){setTime();$scope.ui.isFormValid();if($scope.ui.formValid){$scope.ui.showJobInput=true;$scope.ui.showJobFinished=false;$scope.formConfig.indexPattern=indexPattern;$scope.ui.dirty=false;$scope.chartState=_states.CHART_STATE.LOADING;mlSingleMetricJobService.getLineChartResults($scope.formConfig).then(function(resp){$scope.chartState=resp.totalResults?_states.CHART_STATE.LOADED:_states.CHART_STATE.NO_RESULTS}).catch(function(resp){msgs.error(resp.message);$scope.chartState=_states.CHART_STATE.NO_RESULTS}).finally(function(){$scope.$broadcast("render")})}};var ignoreModel=false;var refreshInterval=REFRESH_INTERVAL_MS;$scope.createJob=function(){var tempJob=mlSingleMetricJobService.getJobFromConfig($scope.formConfig);if((0,_validate_job.validateJob)(tempJob,$scope.ui.validation.checks)){msgs.clear();mlSingleMetricJobService.createJob($scope.formConfig).then(function(job){_job_service.mlJobService.openJob(job.job_id).then(function(){saveNewDatafeed(job,true)}).catch(function(resp){msgs.error("Could not open job: ",resp);msgs.error("Job created, creating datafeed anyway");saveNewDatafeed(job,false)})}).catch(function(resp){msgs.error("Save failed: ",resp.resp)})}else false===$scope.ui.validation.checks.modelMemoryLimit.valid&&($scope.ui.showAdvanced=true);function saveNewDatafeed(job,startDatafeedAfterSave){_job_service.mlJobService.saveNewDatafeed(job.datafeed_config,job.job_id).then(function(){startDatafeedAfterSave&&mlSingleMetricJobService.startDatafeed($scope.formConfig).then(function(){$scope.jobState=_states.JOB_STATE.RUNNING;refreshCounter=0;ignoreModel=false;refreshInterval=REFRESH_INTERVAL_MS;$scope.formConfig.resultsIntervalSeconds=$scope.formConfig.chartInterval.getInterval().asSeconds();var bucketSpanSeconds=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan).asSeconds();$scope.formConfig.resultsIntervalSeconds<bucketSpanSeconds&&($scope.formConfig.resultsIntervalSeconds=bucketSpanSeconds);$scope.resultsUrl=_job_service.mlJobService.createResultsUrl([$scope.formConfig.jobId],$scope.formConfig.start,$scope.formConfig.end,"timeseriesexplorer");loadCharts()}).catch(function(resp){msgs.error("Could not start datafeed: ",resp)})}).catch(function(resp){msgs.error("Save datafeed failed: ",resp)})}};(0,_validation_utils.addJobValidationMethods)($scope,mlSingleMetricJobService);function loadCharts(){var forceStop=globalForceStop;var counterLimit=20-refreshInterval/REFRESH_INTERVAL_MS;if(refreshCounter>=counterLimit){refreshCounter=0;mlSingleMetricJobService.checkDatafeedState($scope.formConfig).then(function(state){if("stopped"===state){console.log("Stopping poll because datafeed state is: "+state);$scope.$broadcast("render-results");forceStop=true}run()})}else run();function run(){refreshCounter++;reloadSwimlane().then(function(){false===forceStop&&$scope.chartData.percentComplete<100?$scope.jobState===_states.JOB_STATE.STOPPING?$scope.jobState=_states.JOB_STATE.STOPPING:$scope.jobState=_states.JOB_STATE.RUNNING:$scope.jobState=_states.JOB_STATE.FINISHED;if(ignoreModel)jobCheck();else{var fullModelRefresh=false;_lodash2.default.each(jobProgressChecks,function(c,i){if(false===jobProgressChecks[i]&&$scope.chartData.percentComplete>=i){jobProgressChecks[i]=true;fullModelRefresh=true}});fullModelRefresh&&($scope.chartData.model=[]);reloadModelChart().catch(function(){if(refreshCounter%10===0){console.log("Model has failed to load 10 times. Stop trying to load it.");ignoreModel=true}}).finally(function(){jobCheck()})}})}}function jobCheck(){var isLastRun=false;if($scope.jobState===_states.JOB_STATE.RUNNING||$scope.jobState===_states.JOB_STATE.STOPPING){refreshInterval=adjustRefreshInterval($scope.chartData.loadingDifference,refreshInterval);_lodash2.default.delay(loadCharts,refreshInterval)}else{$scope.chartData.percentComplete=100;isLastRun=true}if(isLastRun&&!ignoreModel){$scope.chartData.model=[];reloadModelChart().finally(function(){$scope.chartData.percentComplete=100;$scope.$broadcast("render-results")})}else $scope.$broadcast("render-results")}function reloadModelChart(){return mlSingleMetricJobService.loadModelData($scope.formConfig)}function reloadSwimlane(){return mlSingleMetricJobService.loadSwimlaneData($scope.formConfig)}function adjustRefreshInterval(loadingDifference,currentInterval){var INTERVAL_INCREASE_MS=100;var MAX_INTERVAL=1e4;var interval=currentInterval;interval<MAX_INTERVAL&&(loadingDifference<MAX_BUCKET_DIFF?interval+=INTERVAL_INCREASE_MS:interval-INTERVAL_INCREASE_MS>=REFRESH_INTERVAL_MS&&(interval-=INTERVAL_INCREASE_MS));return interval}$scope.resetJob=function(){$scope.jobState=_states.JOB_STATE.NOT_STARTED;_angular2.default.element(".model-chart, .swimlane").css("opacity",0);_lodash2.default.each(jobProgressChecks,function(c,i){jobProgressChecks[i]=false});window.setTimeout(function(){$scope.ui.showJobInput=true;$scope.loadVis()},500)};$scope.stopJob=function(){$scope.jobState=_states.JOB_STATE.STOPPING;mlSingleMetricJobService.stopDatafeed($scope.formConfig)};$scope.moveToAdvancedJobCreation=function(){var job=mlSingleMetricJobService.getJobFromConfig($scope.formConfig);moveToAdvancedJobCreation(job)};$scope.setFullTimeRange=function(){return mlFullTimeRangeSelectorService.setFullTimeRange($scope.ui.indexPattern,$scope.formConfig.combinedQuery)};$scope.$listenAndDigestAsync(_timefilter.timefilter,"fetch",$scope.loadVis);$scope.$on("$destroy",function(){globalForceStop=true});$scope.$evalAsync(function(){(0,_prepopulate_job_settings.preLoadJob)($scope,appState)})})},3761:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.TimeBucketsCalcAutoIntervalProvider=TimeBucketsCalcAutoIntervalProvider;var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var d=_moment2.default.duration;function TimeBucketsCalcAutoIntervalProvider(){var roundingRules=[[d(500,"ms"),d(100,"ms")],[d(5,"second"),d(1,"second")],[d(10,"second"),d(5,"second")],[d(15,"second"),d(10,"second")],[d(30,"second"),d(15,"second")],[d(1,"minute"),d(30,"second")],[d(5,"minute"),d(1,"minute")],[d(10,"minute"),d(5,"minute")],[d(15,"minute"),d(10,"minute")],[d(30,"minute"),d(10,"minute")],[d(1,"hour"),d(30,"minute")],[d(2,"hour"),d(1,"hour")],[d(4,"hour"),d(2,"hour")],[d(6,"hour"),d(4,"hour")],[d(8,"hour"),d(6,"hour")],[d(12,"hour"),d(8,"hour")],[d(24,"hour"),d(12,"hour")],[d(2,"d"),d(1,"d")],[d(4,"d"),d(2,"d")],[d(1,"week"),d(4,"d")],[d(1,"month"),d(1,"week")],[d(1,"year"),d(1,"month")],[Infinity,d(1,"year")]];var revRoundingRules=roundingRules.slice(0).reverse();function find(rules,check,last){function pick(buckets,duration){var target=duration/buckets;var lastResp=void 0;for(var i=0;i<rules.length;i++){var rule=rules[i];var resp=check(rule[0],rule[1],target);if(null==resp){if(!last)continue;if(lastResp)return lastResp;break}if(!last)return resp;lastResp=resp}var ms=Math.max(Math.floor(target),1);return _moment2.default.duration(ms,"ms")}return function(buckets,duration){var interval=pick(buckets,duration);if(interval)return _moment2.default.duration(interval._data)}}return{near:find(revRoundingRules,function near(upperBound,lowerBound,target){if(upperBound>target){if(Infinity===upperBound)return lowerBound;var boundMs=upperBound.asMilliseconds();var intervalMs=lowerBound.asMilliseconds();var retInterval=Math.abs(boundMs-target)<=Math.abs(intervalMs)?upperBound:lowerBound;return retInterval}},true),lessThan:find(revRoundingRules,function(upperBound,lowerBound,target){if(lowerBound<target)return Infinity!==upperBound?upperBound:lowerBound}),atLeast:find(revRoundingRules,function atLeast(upperBound,lowerBound,target){if(lowerBound<=target)return lowerBound})}}},3762:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.inherits=inherits;function describeConst(val){return{writable:false,enumerable:false,configurable:false,value:val}}function inherits(SubClass,SuperClass){var prototype=Object.create(SuperClass.prototype,{constructor:describeConst(SubClass),superConstructor:describeConst(SuperClass)});Object.defineProperties(SubClass,{prototype:describeConst(prototype),Super:describeConst(SuperClass)});return SubClass}},3763:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};exports.populateAppStateSettings=populateAppStateSettings;var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function populateAppStateSettings(appState,scope){if(void 0!==appState.mlJobSettings&&Object.keys(appState.mlJobSettings).length){var finish=function finish(success){success&&(0,_jquery2.default)("#job-id-input").focus()};var jobSettings=appState.mlJobSettings;(function(){if(scope.formConfig.hasOwnProperty("field"))return populateSingleMetricSettings(jobSettings,scope);if(scope.formConfig.hasOwnProperty("overField"))return populatePopulationSettings(jobSettings,scope);if(scope.formConfig.hasOwnProperty("fields"))return populateMultiMetricSettings(jobSettings,scope)})().then(function(){return finish(true)}).catch(function(){return finish(false)})}}function populateSingleMetricSettings(jobSettings,scope){return new Promise(function(resolve,reject){jobSettings.fields.forEach(function(f){if(void 0!==f.agg){var agg=scope.ui.aggTypeOptions.find(function(o){return o.name===f.agg});if(void 0!==agg){scope.formConfig.agg.type=agg;scope.aggChange()}}if(void 0!==f.fieldName){var field=scope.ui.fields.find(function(o){return o.name===f.fieldName});scope.formConfig.field=field||null}});if(void 0!==scope.formConfig.agg.type&&void 0!==scope.formConfig.field||"count"===scope.formConfig.agg.type.name&&void 0===scope.formConfig.field){populateCommonSettings(jobSettings,scope);resolve()}else reject()})}function populateMultiMetricSettings(jobSettings,scope){return new Promise(function(resolve,reject){jobSettings.fields.forEach(function(f){var fieldName=void 0!==f.fieldName?f.fieldName:"__ml_event_rate_count__";var field=scope.ui.fields.find(function(o){return o.id===fieldName});void 0!==field&&(scope.formConfig.fields[field.id]=field);if(void 0!==f.agg){var agg=scope.ui.aggTypeOptions.find(function(o){return o.name===f.agg});void 0!==agg&&(scope.formConfig.fields[field.id].agg.type=agg)}});if(void 0!==jobSettings.split){var field=scope.ui.splitFields.find(function(o){return o.name===jobSettings.split});if(void 0!==field){scope.formConfig.splitField=field;scope.splitChange()}}if(void 0!==scope.formConfig.fields&&Object.keys(scope.formConfig.fields).length>0){populateCommonSettings(jobSettings,scope);resolve()}else reject()})}function populatePopulationSettings(jobSettings,scope){return new Promise(function(resolve,reject){if(void 0!==jobSettings.population){var loop=function loop(i){var f=jobSettings.fields[i];if(void 0!==f.split){var splitField=scope.ui.splitFields.find(function(o){return o.name===f.split});void 0!==splitField?scope.splitChange(i,splitField).then(function(){check(i)}):check(i)}else check(i)};var check=function check(i){i+1<jobSettings.fields.length&&loop(i+1)};var overField=scope.ui.overFields.find(function(o){return o.name===jobSettings.population});if(void 0!==overField){scope.formConfig.overField=overField;scope.overChange()}jobSettings.fields.forEach(function(f){var fieldName=void 0!==f.fieldName?f.fieldName:"__ml_event_rate_count__";var tempField=scope.ui.fields.find(function(o){return o.id===fieldName});var field=_extends({},tempField);if(void 0!==field){if(void 0!==f.agg){var agg=scope.ui.aggTypeOptions.find(function(o){return o.name===f.agg});void 0!==agg&&(field.agg={type:agg})}scope.formConfig.fields.push(field)}});scope.formChange();loop(0)}if(void 0!==scope.formConfig.fields&&Object.keys(scope.formConfig.fields).length>0){populateCommonSettings(jobSettings,scope);resolve()}else reject()})}function populateCommonSettings(jobSettings,scope){"string"===typeof jobSettings.modelMemoryLimit&&(scope.formConfig.modelMemoryLimit=jobSettings.modelMemoryLimit);"string"===typeof jobSettings.bucketSpan?scope.formConfig.bucketSpan=jobSettings.bucketSpan:runEstimateBucketSpan(scope);"string"===typeof jobSettings.description&&(scope.formConfig.description=jobSettings.description);Array.isArray(jobSettings.groups)&&(scope.formConfig.jobGroups=jobSettings.groups);Array.isArray(jobSettings.influencers)&&(scope.formConfig.influencerFields=jobSettings.influencers.map(function(i){return scope.ui.fields.find(function(f){return f.id===i})}));scope.formConfig.useDedicatedIndex="shared"!==jobSettings.resultsIndexName;scope.ui.showAdvanced=scope.formConfig.useDedicatedIndex}function runEstimateBucketSpan(scope){setTimeout(function(){scope.bucketSpanEstimatorExportedFunctions.guessBucketSpan&&"function"===typeof scope.bucketSpanEstimatorExportedFunctions.guessBucketSpan&&scope.bucketSpanEstimatorExportedFunctions.guessBucketSpan()},0)}},3764:function(module,exports){module.exports='<ml-nav-menu name="new_job_single_metric"></ml-nav-menu>\n<ml-new-job-single-metric>\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlCreateSingleMetricJob" class="single-metric-job-container">\n    <div class="row">\n      <div class="col-md-6">\n        <h1 class="euiTitle euiTitle--large">New job from {{ui.pageTitle}}</h1>\n      </div>\n      <div class="col-md-6">\n        <div class="pull-right">\n          <span style="font-size:10px;" ng-show="formConfig.chartInterval !== undefined">Chart interval: {{formConfig.chartInterval.getInterval().expression}}</span>\n          <ml-full-time-range-selector\n            disabled=\'(jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)\'\n            index-pattern=\'ui.indexPattern\'\n            query=\'formConfig.combinedQuery\'\n          ></ml-full-time-range-selector>\n        </div>\n      </div>\n    </div>\n\n    <div class="euiSpacer euiSpacer--l"></div>\n\n    <div class="row form-controls">\n\n      <div class="form-group col-md-4">\n        <ml-form-label label-id="new_job_detector_function">Aggregation</ml-form-label>\n        <ui-select\n          aria-labelledby="ml_aria_label_new_job_detector_function"\n          aria-describedby="ml_aria_description_new_job_detector_function"\n          ng-model="formConfig.agg.type"\n          name="agg-type"\n          required\n          on-select="aggChange()"\n          ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n          class=""\n        >\n          <ui-select-match placeholder="Select an aggregation">\n            {{$select.selected.title}}\n          </ui-select-match>\n          <ui-select-choices\n            repeat="agg in ui.aggTypeOptions | filter: { title: $select.search }"\n          >\n            <div ng-bind-html="agg.title | highlight: $select.search"></div>\n          </ui-select-choices>\n        </ui-select>\n      </div>\n\n      <div class="form-group col-md-4">\n        <ml-form-label label-id="new_job_detector_fieldname_subset" tooltip-append-to-body="true">Field</ml-form-label>\n        <ui-select\n          aria-labelledby="ml_aria_label_new_job_detector_fieldname_subset"\n          aria-describedby="ml_aria_description_new_job_detector_fieldname_subset"\n          ng-model="formConfig.field"\n          name="field-type"\n          required\n          on-select="fieldChange()"\n          ng-disabled="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n          class=""\n        >\n          <ui-select-match placeholder="Select a field">\n            <ml-field-type-icon type="$select.selected.mlType"></ml-field-type-icon>{{$select.selected.name}}\n          </ui-select-match>\n          <ui-select-choices repeat="field in ui.fields | filter: { name: $select.search }" group-by="\'mlType\'">\n            <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n            <span class="select-item" ng-bind-html="field.name | highlight: $select.search"></span>\n          </ui-select-choices>\n        </ui-select>\n      </div>\n\n      <div class="form-group col-md-4">\n        <ml-form-label label-id="new_job_bucketspan">Bucket span</ml-form-label>\n        <div class=\'bucket-span-container\'>\n          <input\n            aria-labelledby="ml_aria_label_new_job_bucketspan"\n            aria-describedby="ml_aria_description_new_job_bucketspan"\n            ng-model="formConfig.bucketSpan"\n            required\n            placeholder={{formConfig-bucketSpan}}\n            ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED || ui.bucketSpanEstimator.status===1"\n            ng-change="bucketSpanFieldChange()"\n            ng-class=\'{"ng-invalid": (!ui.bucketSpanValid)}\'\n            class="form-control lowercase bucket-span-input" />\n\n          <ml-bucket-span-estimator\n            form-config=\'formConfig\'\n            job-state-wrapper=\'{jobState:jobState}\'\n            job-state=\'JOB_STATE\'\n            ui=\'ui\'\n            bucket-span-field-change="bucketSpanFieldChange"\n            exported-functions=\'bucketSpanEstimatorExportedFunctions\'>\n          </ml-bucket-span-estimator>\n\n          <button class="euiButton euiButton--primary euiButton--small euiButton--fill navbar-btn-link btn-load-vis"\n            aria-label="Run search"\n            ng-click="loadVis()"\n            ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED" >\n            <i class="fa fa-play" ></i>\n          </button>\n        </div>\n        <div ng-hide="ui.bucketSpanValid" class="validation-error">Invalid interval format</div>\n        <div ng-show="ui.bucketSpanEstimator.status===-1" class="validation-error">{{ui.bucketSpanEstimator.message}}</div>\n      </div>\n    </div>\n    <div class="row form-controls" ng-show=\'ui.isCountOrSum\'>\n      <div class="col-md-12">\n        <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n          <input type="checkbox"\n            aria-labelledby="ml_aria_label_new_job_sparsedata"\n            aria-describedby="ml_aria_description_new_job_sparsedata"\n            class=\'kuiCheckBox\'\n            ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n            ng-model="formConfig.isSparseData" />\n          <span id="ml_aria_label_new_job_sparsedata" class=\'kuiCheckBoxLabel__text\'>Sparse data</span>\n          <i ml-info-icon="new_job_sparsedata" />\n        </label>\n      </div>\n    </div>\n\n    <div ng-show="ui.showJobInput">\n      <div class=\'chart-container\'>\n        <ml-single-metric-job-chart\n          chart-data="chartData"\n          chart-height=\'ui.chartHeight\'\n          chart-ticks-margin="chartData.chartTicksMargin">\n        </ml-single-metric-job-chart>\n\n        <div ng-show="chartState === CHART_STATE.NOT_STARTED || chartState === CHART_STATE.LOADING || chartState === CHART_STATE.NO_RESULTS"\n          class=\'chart-loader\'\n          style=\'height: {{ui.chartHeight}}px; margin-top: -{{ui.chartHeight + 32}}px; margin-left: {{chartData.chartTicksMargin.width - 1}}px;\'>\n            <div class=\'status-label\' ng-show="chartState === CHART_STATE.NOT_STARTED"></div>\n            <div class=\'status-label\' ng-show="chartState === CHART_STATE.LOADING">\n              <h2 class="euiTitle euiTitle"><i class=\'fa fa-spinner fa-spin\'></i></h2>\n            </div>\n            <div class=\'status-label\' ng-show="chartState === CHART_STATE.NO_RESULTS">\n              <div class=\'no-results\'>\n                <h4 class="euiTitle euiTitle--small"><i class="fa fa-info-circle"></i> No results found</h4>\n                <span>Consider using the <a ng-click="setFullTimeRange()">full {{ui.indexPattern.title}} data</a></span>\n              </div>\n            </div>\n        </div>\n      </div>\n    </div>\n\n    <div ng-show="ui.showJobInput && (jobState === JOB_STATE.NOT_STARTED || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING)">\n      <div class="form-group">\n        <ml-form-label label-id="new_job_id" tooltip-append-to-body="true">Name</ml-form-label>\n        <input\n          aria-labelledby="ml_aria_label_new_job_id"\n          aria-describedby="ml_aria_description_new_job_id"\n          id="job-id-input"\n          ng-model="formConfig.jobId"\n          required\n          placeholder="Job ID"\n          ng-change="changeJobIDCase(formConfig)"\n          ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n          class="form-control lowercase" />\n          <div ng-hide="ui.validation.checks.jobId.valid" class="validation-error">{{ ( ui.validation.checks.jobId.message || "Enter a name for the job" ) }}</div>\n      </div>\n\n      <div class="form-group">\n        <ml-form-label label-id="new_job_description">Description</ml-form-label>\n        <input\n          aria-labelledby="ml_aria_label_new_job_description"\n          aria-describedby="ml_aria_description_new_job_description"\n          ng-model="formConfig.description"\n          placeholder="Job description"\n          ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n          class="form-control" />\n      </div>\n\n      <div class="form-group">\n        <ml-form-label label-id="new_job_group">Job Groups</ml-form-label>\n        <ml-job-group-select\n          aria-labelledby="ml_aria_label_new_job_group"\n          aria-describedby="ml_aria_description_new_job_group"\n          job-groups=\'formConfig.jobGroups\'\n          disabled=\'(jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)\' />\n        <div ng-hide="ui.validation.checks.groupIds.valid" class="validation-error">{{ ui.validation.checks.groupIds.message }}</div>\n      </div>\n\n      <div class="form-group">\n        <div ng-click="ui.showAdvanced = (!ui.showAdvanced || formConfig.useDedicatedIndex)" class="advanced-button-container">\n          <button\n            aria-label="{{ ui.showAdvanced ? \'Hide Advanced\' : \'Show Advanced\' }}"\n            aria-describedby="ml_aria_description_new_job_advanced_settings"\n            type="button"\n            ng-disabled="formConfig.useDedicatedIndex"\n            class="kuiButton kuiButton--small kuiButton--hollow advanced-button">\n            <i aria-hidden="true" ng-class="{ \'fa-caret-down\': ui.showAdvanced, \'fa-caret-right\': !ui.showAdvanced }" class="fa"></i>\n          </button>\n          <label>Advanced</label><i ml-info-icon="new_job_advanced_settings" />\n        </div>\n        <div class=\'advanced-group\' ng-show="ui.showAdvanced">\n          <div class="form-group">\n            <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n              <input type="checkbox"\n                aria-labelledby="ml_aria_label_new_job_dedicated_index"\n                aria-describedby="ml_aria_description_new_job_dedicated_index"\n                class=\'kuiCheckBox\'\n                ng-model="formConfig.useDedicatedIndex" />\n              <span class=\'kuiCheckBoxLabel__text\'>\n                <span id="ml_aria_label_new_job_dedicated_index">Use dedicated index</span>\n                <i ml-info-icon="new_job_dedicated_index" />\n              </span>\n            </label>\n          </div>\n          <div class="form-group">\n            <label class=\'kuiFormLabel kuiVerticalRhythm\'>\n              <span id="ml_aria_label_new_job_model_memory_limit">\n                Model memory limit\n              </span>\n              <i ml-info-icon="new_job_model_memory_limit" />\n            </label>\n            <div></div>\n            <input\n              aria-labelledby="ml_aria_label_new_job_model_memory_limit"\n              aria-describedby="ml_aria_description_new_job_model_memory_limit"\n              type="text"\n              ng-model=\'formConfig.modelMemoryLimit\'\n              class="kuiTextInput kuiTextInput--large" />\n            <div ng-hide="ui.validation.checks.modelMemoryLimit.valid" class="validation-error">{{ ui.validation.checks.modelMemoryLimit.message }}</div>\n          </div>\n        </div>\n      </div>\n\n      <div class="form-group">\n        <a href="" ng-click="moveToAdvancedJobCreation()">Move to advanced job configuration</a>\n      </div>\n      <div class="euiFlexGroup euiFlexGroup--gutterSmall euiFlexGroup--alignItemsCenter euiFlexGroup--responsive">\n        <div class="euiFlexItem euiFlexItem--flexGrowZero">\n          <ml-validate-job\n            get-duration="getDuration"\n            get-job-config="getJobConfig"\n            fill="false"\n            is-current-job-config="isCurrentJobConfig"\n            is-disabled=\'ui.formValid === false || ui.dirty === true || formConfig.jobId === undefined || ui.bucketSpanValid === false\'\n            ng-show="jobState === JOB_STATE.NOT_STARTED"\n          />\n        </div>\n        <div class="euiFlexItem euiFlexItem--flexGrowZero">\n          <button\n            aria-label="Create Job"\n            ng-click="createJob()"\n            type="button"\n            ng-show="jobState === JOB_STATE.NOT_STARTED"\n            ng-disabled=\'ui.formValid === false || ui.dirty === true || formConfig.jobId === undefined || ui.bucketSpanValid === false\'\n            class="euiButton euiButton--primary euiButton--small euiButton--fill">\n            <span class="euiButton__content">\n              Create Job\n            </span>\n          </button>\n        </div>\n      </div>\n\n      <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.RUNNING">Analysis running <i class=\'fa fa-spinner fa-spin\'></i></div>\n      <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.STOPPING">Analysis stopping <i class=\'fa fa-spinner fa-spin\'></i></div>\n\n      <button\n        aria-label="Stop Job"\n        ng-click="stopJob()"\n        type="button"\n        ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n        ng-disabled="jobState === JOB_STATE.STOPPING"\n        class="euiButton euiButton--danger euiButton--small">\n        <span class="euiButton__content">\n          {{(jobState === JOB_STATE.STOPPING) ? \'Analysis stopping\' : \'Stop analysis\' }}\n        </span>\n      </button>\n\n      <a\n        href=\'{{resultsUrl}}\'\n        ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n        aria-label="View Results"\n        ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n        class="euiButton euiButton--primary euiButton--small euiButton--fill">\n        <span class="euiButton__content">\n          View Results\n        </span>\n      </a>\n\n    </div>\n    <div ng-show="jobState === JOB_STATE.FINISHED">\n      <h3 class="euiTitle euiTitle--large">Job {{formConfig.jobId }} created\n        <i style="color:green;" class="fa fa-check" aria-label="Saved"></i>\n      </h3>\n      <div class="euiSpacer euiSpacer--m"></div>\n\n      <button\n        aria-label="Reset"\n        ng-click="resetJob()"\n        type="button"\n        class="euiButton euiButton--primary euiButton--small euiButton--fill">\n        <span class="euiButton__content">\n          Reset\n        </span>\n      </button>\n      <a\n        href=\'{{resultsUrl}}\'\n        ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n        aria-label="View Results"\n        class="euiButton euiButton--primary euiButton--small euiButton--fill">\n        <span class="euiButton__content">\n          View Results\n        </span>\n      </a>\n\n    </div>\n    <div ng-if=\'jobState === JOB_STATE.FINISHED\'>\n      <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n      <ml-post-save-options\n        job-id=\'formConfig.jobId\'\n        bucket-span=\'formConfig.bucketSpan\'\n        include-influencers=\'false\'\n      ></ml-post-save-options>\n    </div>\n  </div>\n</ml-new-job-single-metric>\n'},3765:function(module,exports,__webpack_require__){"use strict";var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _d=__webpack_require__(19);var _d2=_interopRequireDefault(_d);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _time_buckets=__webpack_require__(273);var _chart_utils=__webpack_require__(256);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlSingleMetricJobChart",function(){function link(scope,element){var svgWidth=_angular2.default.element(".single-metric-job-container").width();var lineChartHeight=scope.chartHeight;var swimlaneHeight=30;var margin={top:0,right:0,bottom:0,left:scope.chartTicksMargin.width};var svgHeight=lineChartHeight+swimlaneHeight+margin.top+margin.bottom;var vizWidth=svgWidth-margin.left-margin.right;var chartLimits={max:0,min:0};var lineChartXScale=null;var lineChartYScale=null;var lineChartValuesLine=null;var lineChartBoundedArea=null;var lineChartGroup=void 0;var modelChartGroup=void 0;var swimlaneGroup=void 0;var $progressBar=void 0;scope.$on("render",function(){init();createSVGGroups();drawLineChart()});scope.$on("render-results",function(){drawResults()});element.on("$destroy",function(){scope.$destroy()});function init(){margin.left=scope.chartTicksMargin.width;vizWidth=svgWidth-margin.left-margin.right;lineChartXScale=_d2.default.time.scale().range([0,vizWidth]);lineChartYScale=_d2.default.scale.linear().range([lineChartHeight,0]);lineChartValuesLine=_d2.default.svg.line().x(function(d){return lineChartXScale(d.date)}).y(function(d){return lineChartYScale(d.value)}).defined(function(d){return null!==d.value});lineChartBoundedArea=_d2.default.svg.area().x(function(d){return lineChartXScale(d.date)||0}).y0(function(d){return lineChartYScale(Math.max(chartLimits.min,Math.min(chartLimits.max,d.upper)))}).y1(function(d){return lineChartYScale(Math.min(chartLimits.max,Math.max(chartLimits.min,d.lower)))})}function createSVGGroups(){if(void 0===scope.chartData.line)return;var chartElement=_d2.default.select(element.get(0));chartElement.select("svg").remove();chartElement.select(".progress").remove();if(null===chartElement.select(".progress-bar")[0][0]){var style="width: "+(+vizWidth+2)+"px;\n          margin-bottom: -"+(+lineChartHeight+5)+"px;\n          margin-left: "+(+margin.left-1)+"px;'";chartElement.append("div").attr("class","progress").attr("style",style).append("div").attr("class","progress-bar")}$progressBar=(0,_jquery2.default)(".progress-bar");var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);swimlaneGroup=svg.append("g").attr("class","swimlane").attr("transform","translate("+margin.left+","+margin.top+")");modelChartGroup=svg.append("g").attr("class","model-chart").attr("transform","translate("+margin.left+","+margin.top+")");lineChartGroup=svg.append("g").attr("class","line-chart").attr("transform","translate("+margin.left+","+margin.top+")")}function drawLineChart(){var data=scope.chartData.line;lineChartXScale=lineChartXScale.domain(_d2.default.extent(data,function(d){return d.date}));var timeBuckets=new _time_buckets.TimeBuckets;timeBuckets.setInterval("auto");if(data.length>0){var xDomain=lineChartXScale.domain();var bounds={min:(0,_moment2.default)(xDomain[0]),max:(0,_moment2.default)(xDomain[1])};timeBuckets.setBounds(bounds)}var xAxisTickFormat=timeBuckets.getScaledDateFormat();chartLimits.max=_d2.default.max(data,function(d){return d.value});chartLimits.min=_d2.default.min(data,function(d){return d.value});var padding=.1*(chartLimits.max-chartLimits.min);chartLimits.max+=padding;chartLimits.min-=padding;lineChartYScale=lineChartYScale.domain([chartLimits.min,chartLimits.max]);var xAxis=_d2.default.svg.axis().scale(lineChartXScale).orient("bottom").innerTickSize(-lineChartHeight).outerTickSize(0).tickPadding(10).ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)});var yAxis=_d2.default.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(-vizWidth).outerTickSize(0).tickPadding(10);void 0!==scope.chartData.fieldFormat&&yAxis.tickFormat(function(d){return scope.chartData.fieldFormat.convert(d,"text")});lineChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",lineChartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1);drawLineChartAxes(xAxis,yAxis);drawLineChartPaths(data);(0,_chart_utils.drawLineChartDots)(data,lineChartGroup,lineChartValuesLine)}function drawLineChartAxes(xAxis,yAxis){var axes=lineChartGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0,"+lineChartHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis)}function drawLineChartPaths(data){lineChartGroup.append("path").attr("class","values-line").attr("d",lineChartValuesLine(data))}function drawResults(){var model=scope.chartData.model;drawModelPaths(model);drawSwimlane(vizWidth,lineChartHeight);updateProgressBar()}function drawModelPaths(model){modelChartGroup.selectAll("*").remove();modelChartGroup.append("path").attr("class","area bounds").attr("d",lineChartBoundedArea(model))}function drawSwimlane(swlWidth,swlHeight){var data=scope.chartData.swimlane;var cellWidth=0;data.length>0&&(cellWidth=lineChartXScale(data[0].time+scope.chartData.swimlaneInterval)-lineChartXScale(data[0].time));_d2.default.time.scale().range([0,swlWidth]).domain(_d2.default.extent(data,function(d){return d.date}));_d2.default.scale.linear().range([swlHeight,0]).domain([0,swlHeight]);var color=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#d2e9f7","#8bc8fb","#ffdd00","#ff7e00","#fe5050"]);swimlaneGroup.select(".swimlane-cells").remove();var cells=swimlaneGroup.append("g").attr("class","swimlane-cells").selectAll("cells").data(data);cells.enter().append("rect").attr("x",function(d){return lineChartXScale(d.date)}).attr("y",0).attr("rx",0).attr("ry",0).attr("class",function(d){return d.value>0?"swimlane-cell":"swimlane-cell-hidden"}).attr("width",cellWidth).attr("height",swlHeight).style("fill",function(d){return color(d.value)})}function updateProgressBar(){var pcnt=scope.chartData.percentComplete<100?scope.chartData.percentComplete:0;$progressBar.css("width",pcnt+"%")}}return{scope:{chartData:"=",chartHeight:"=",chartTicksMargin:"="},link:link}})},3766:function(module,exports){},3767:function(module,exports,__webpack_require__){"use strict";var _post_save_service=__webpack_require__(3768);var _create_watch_service=__webpack_require__(369);var _check_license=__webpack_require__(68);var _post_save_options=__webpack_require__(3769);var _post_save_options2=_interopRequireDefault(_post_save_options);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlPostSaveOptions",function(Private){return{restrict:"AE",replace:false,scope:{jobId:"=",bucketSpan:"=",includeInfluencers:"="},template:_post_save_options2.default,link:function link($scope){var xpackFeature=Private(_check_license.xpackFeatureProvider);$scope.watcherEnabled=xpackFeature.isAvailable("watcher");$scope.status=_post_save_service.postSaveService.status;$scope.STATUS=_post_save_service.postSaveService.STATUS;_create_watch_service.mlCreateWatchService.reset();_create_watch_service.mlCreateWatchService.config.includeInfluencers=$scope.includeInfluencers;$scope.runInRealtime=false;$scope.createWatch=false;$scope.embedded=true;$scope.clickRunInRealtime=function(){$scope.createWatch=!!$scope.runInRealtime&&$scope.createWatch};$scope.apply=function(){_post_save_service.postSaveService.apply($scope.jobId,$scope.runInRealtime,$scope.createWatch)}}}})},3768:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.postSaveService=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _job_service=__webpack_require__(24);var _create_watch_service=__webpack_require__(369);var _messagebar_service=__webpack_require__(79);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var msgs=_messagebar_service.mlMessageBarService;var PostSaveService=function(){function PostSaveService(){_classCallCheck(this,PostSaveService);this.STATUS={SAVE_FAILED:-1,SAVING:0,SAVED:1};this.status={realtimeJob:null,watch:null};_create_watch_service.mlCreateWatchService.status=this.status;this.externalCreateWatch}_createClass(PostSaveService,[{key:"startRealtimeJob",value:function startRealtimeJob(jobId){var _this=this;return new Promise(function(resolve,reject){_this.status.realtimeJob=_this.STATUS.SAVING;var datafeedId=_job_service.mlJobService.getDatafeedId(jobId);_job_service.mlJobService.openJob(jobId).finally(function(){_job_service.mlJobService.startDatafeed(datafeedId,jobId,0,void 0).then(function(){_this.status.realtimeJob=_this.STATUS.SAVED;resolve()}).catch(function(resp){msgs.error("Could not start datafeed: ",resp);_this.status.realtimeJob=_this.STATUS.SAVE_FAILED;reject()})})})}},{key:"apply",value:function apply(jobId,runInRealtime,createWatch){runInRealtime&&this.startRealtimeJob(jobId).then(function(){createWatch&&_create_watch_service.mlCreateWatchService.createNewWatch(jobId)})}}]);return PostSaveService}();exports.postSaveService=new PostSaveService},3769:function(module,exports){module.exports='<div class=\'post-save-options\'>\n\n  <div class=\'form-group\'>\n    <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n      <input ng-model=\'runInRealtime\' ng-disabled="status.realtimeJob!==null" type="checkbox" class=\'kuiCheckBox\' ng-click="clickRunInRealtime()"/>\n      <span class="kuiCheckBoxLabel__text">\n        Continue job in real-time\n        <span ng-hide="status.realtimeJob===null">\n          <i ng-show="status.realtimeJob === STATUS.SAVE_FAILED" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>\n          <i ng-show="status.realtimeJob === STATUS.SAVING" aria-hidden="true" class="fa fa-spinner fa-spin"></i>\n          <i ng-show="status.realtimeJob === STATUS.SAVED" aria-hidden="true" style="color:green;" class="fa fa-check"></i>\n         </span>\n      </span>\n    </label>\n  </div>\n  <div ng-show=\'watcherEnabled\' class=\'form-group\'>\n    <label\n      class=\'kuiCheckBoxLabel kuiVerticalRhythm\'\n      ng-class="{\'disabled\': !runInRealtime}">\n      <input ng-model=\'createWatch\' ng-disabled="!runInRealtime || status.realtimeJob!==null" type="checkbox" class=\'kuiCheckBox\' />\n      <span class="kuiCheckBoxLabel__text">\n        Create watch for real-time job\n        <span ng-hide="status.watch===null">\n          <i ng-show="status.watch === STATUS.SAVE_FAILED" aria-hidden="true" style="color:red;" class="fa fa-remove"></i>\n          <i ng-show="status.watch === STATUS.SAVING" aria-hidden="true" class="fa fa-spinner fa-spin"></i>\n          <i ng-show="status.watch === STATUS.SAVED" aria-hidden="true" style="color:green;" class="fa fa-check"></i>\n        </span>\n      </span>\n    </label>\n\n    <div ng-if=\'runInRealtime && createWatch\'>\n      <ml-create-watch\n        job-id=\'jobId\'\n        bucket-span=\'bucketSpan\'\n        include-influencers=\'includeInfluencers\'\n        embedded=\'embedded\'\n      ></ml-create-watch>\n    </div>\n  </div>\n\n  <button\n    aria-label="Create watch"\n    ng-click="apply()"\n    ng-hide=\'(status.realtimeJob===STATUS.SAVED && createWatch===false) || (status.realtimeJob===STATUS.SAVED && status.watch===STATUS.SAVED && createWatch===true)\'\n    ng-disabled=\'runInRealtime===false\'\n    type="button"\n    class="kuiButton kuiButton--primary">\n      Apply\n  </button>\n\n</div>\n'},3770:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3771);__webpack_require__(3772)},3771:function(module,exports){},3772:function(module,exports,__webpack_require__){"use strict";var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _bucket_span_estimator_view=__webpack_require__(3773);var _new_job_utils=__webpack_require__(144);var _general=__webpack_require__(300);var _ml_api_service=__webpack_require__(23);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlBucketSpanEstimator",function(){return{restrict:"AE",replace:false,scope:{bucketSpanFieldChange:"=",formConfig:"=",jobStateWrapper:"=",JOB_STATE:"=jobState",ui:"=ui",exportedFunctions:"="},link:function link($scope,$element){var STATUS={FAILED:-1,NOT_RUNNING:0,RUNNING:1,FINISHED:2};var errorHandler=function errorHandler(error){console.log("Bucket span could not be estimated",error);$scope.ui.bucketSpanEstimator.status=STATUS.FAILED;$scope.ui.bucketSpanEstimator.message="Bucket span could not be estimated"};$scope.guessBucketSpan=function(){$scope.ui.bucketSpanEstimator.status=STATUS.RUNNING;$scope.ui.bucketSpanEstimator.message="";var data={aggTypes:[],duration:{start:$scope.formConfig.start,end:$scope.formConfig.end},fields:[],filters:$scope.formConfig.filters,index:$scope.formConfig.indexPattern.title,query:(0,_new_job_utils.getQueryFromSavedSearch)($scope.formConfig),splitField:$scope.formConfig.splitField&&$scope.formConfig.splitField.name,timeField:$scope.formConfig.timeField};if(void 0===$scope.formConfig.fields){var fieldName=null===$scope.formConfig.field?null:$scope.formConfig.field.name;data.fields.push(fieldName);data.aggTypes.push($scope.formConfig.agg.type.dslName)}else Object.keys($scope.formConfig.fields).map(function(id){var field=$scope.formConfig.fields[id];var fieldName=field.id===_general.EVENT_RATE_COUNT_FIELD?null:field.name;data.fields.push(fieldName);data.aggTypes.push(field.agg.type.dslName)});_ml_api_service.ml.estimateBucketSpan(data).then(function(interval){if(interval.error){errorHandler(interval.message);return}var notify=$scope.formConfig.bucketSpan!==interval.name;$scope.formConfig.bucketSpan=interval.name;$scope.ui.bucketSpanEstimator.status=STATUS.FINISHED;notify&&"function"===typeof $scope.bucketSpanFieldChange&&$scope.bucketSpanFieldChange()}).catch(errorHandler)};void 0!==$scope.exportedFunctions&&"object"===_typeof($scope.exportedFunctions)&&($scope.exportedFunctions.guessBucketSpan=$scope.guessBucketSpan);$scope.$watch("formConfig.agg.type",updateButton,true);$scope.$watch("jobStateWrapper.jobState",updateButton,true);$scope.$watch("[ui.showJobInput,ui.formValid,ui.bucketSpanEstimator.status]",updateButton,true);function updateButton(){var buttonDisabled=false===$scope.ui.showJobInput||false===$scope.ui.formValid||void 0===$scope.formConfig.agg.type||$scope.jobStateWrapper.jobState===$scope.JOB_STATE.RUNNING||$scope.jobStateWrapper.jobState===$scope.JOB_STATE.STOPPING||$scope.jobStateWrapper.jobState===$scope.JOB_STATE.FINISHED||$scope.ui.bucketSpanEstimator.status===STATUS.RUNNING;var estimatorRunning=$scope.ui.bucketSpanEstimator.status===STATUS.RUNNING;var buttonText=estimatorRunning?"Estimating bucket span":"Estimate bucket span";var props={buttonDisabled:buttonDisabled,estimatorRunning:estimatorRunning,guessBucketSpan:$scope.guessBucketSpan,buttonText:buttonText};_reactDom2.default.render(_react2.default.createElement(_bucket_span_estimator_view.BucketSpanEstimator,props),$element[0])}updateButton()}}})},3773:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.BucketSpanEstimator=BucketSpanEstimator;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function BucketSpanEstimator(_ref){var buttonDisabled=_ref.buttonDisabled,buttonText=_ref.buttonText,estimatorRunning=_ref.estimatorRunning,guessBucketSpan=_ref.guessBucketSpan;return _react2.default.createElement("div",{className:"bucket-span-estimator"},_react2.default.createElement(_eui.EuiToolTip,{content:"Experimental feature for estimating bucket span.",position:"bottom"},_react2.default.createElement(_eui.EuiButton,{disabled:buttonDisabled,fill:true,iconSide:"right",isLoading:estimatorRunning,onClick:guessBucketSpan,size:"s"},buttonText)))}BucketSpanEstimator.propTypes={buttonDisabled:_propTypes2.default.bool.isRequired,buttonText:_propTypes2.default.string.isRequired,estimatorRunning:_propTypes2.default.bool.isRequired,guessBucketSpan:_propTypes2.default.func.isRequired}},3774:function(module,exports,__webpack_require__){"use strict";var _full_time_range_selector=__webpack_require__(3775);var _full_time_range_selector2=_interopRequireDefault(_full_time_range_selector);var _full_time_range_selector_service=__webpack_require__(633);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlFullTimeRangeSelector",function(Private){return{restrict:"E",replace:true,template:_full_time_range_selector2.default,scope:{indexPattern:"=",disabled:"=",query:"="},controller:function controller($scope){var mlFullTimeRangeSelectorService=Private(_full_time_range_selector_service.FullTimeRangeSelectorServiceProvider);$scope.setFullTimeRange=function(){mlFullTimeRangeSelectorService.setFullTimeRange($scope.indexPattern,$scope.query)}}}})},3775:function(module,exports){module.exports='<button\n  ng-click="setFullTimeRange()"\n  type="button"\n  ng-disabled="disabled"\n  class="euiButton euiButton--primary euiButton--small euiButton--fill">\n  <span class="euiButton__content">\n    Use full {{indexPattern.title}} data\n  </span>\n</button>\n'},3776:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _field_type_icon=__webpack_require__(1431);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlFieldTypeIcon",function(){return{restrict:"E",replace:false,scope:{tooltipEnabled:"=",type:"="},link:function link(scope,element){scope.$watch("type",updateComponent);updateComponent();function updateComponent(){var props={tooltipEnabled:scope.tooltipEnabled,type:scope.type};_reactDom2.default.render(_react2.default.createElement(_field_type_icon.FieldTypeIcon,props),element[0])}}}})},3777:function(module,exports){},3778:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3779)},3779:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3780);__webpack_require__(3781);__webpack_require__(1433);__webpack_require__(3783);__webpack_require__(255);__webpack_require__(427);__webpack_require__(634);__webpack_require__(875);__webpack_require__(1434);__webpack_require__(3786);__webpack_require__(1435);__webpack_require__(1436);__webpack_require__(1437);__webpack_require__(1438);__webpack_require__(424);__webpack_require__(635);__webpack_require__(370)},3780:function(module,exports){},3781:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);__webpack_require__(425);var _index=__webpack_require__(364);var _validation_utils=__webpack_require__(631);var _parse_interval=__webpack_require__(127);var _datemath=__webpack_require__(83);var _datemath2=_interopRequireDefault(_datemath);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(68);var _check_privilege=__webpack_require__(35);var _ml_time_buckets=__webpack_require__(277);var _filter_agg_types=__webpack_require__(871);var _validate_job=__webpack_require__(629);var _adjust_interval=__webpack_require__(872);var _states=__webpack_require__(501);var _create_fields=__webpack_require__(873);var _index_utils=__webpack_require__(128);var _chart_data_utils=__webpack_require__(1432);var _check_ml_nodes=__webpack_require__(69);var _new_job_defaults=__webpack_require__(253);var _string_utils=__webpack_require__(40);var _new_job_utils=__webpack_require__(144);var _job_service=__webpack_require__(24);var _prepopulate_job_settings=__webpack_require__(874);var _create_job_service=__webpack_require__(1433);var _full_time_range_selector_service=__webpack_require__(633);var _messagebar_service=__webpack_require__(79);var _promise=__webpack_require__(89);var _ml_api_service=__webpack_require__(23);var _create_job=__webpack_require__(3782);var _create_job2=_interopRequireDefault(_create_job);var _timefilter=__webpack_require__(14);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/jobs/new_job/simple/multi_metric",{template:_create_job2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.loadCurrentIndexPattern,savedSearch:_index_utils.loadCurrentSavedSearch,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults,initPromise:(0,_promise.initPromise)(true)}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlCreateMultiMetricJob",function($scope,$route,Private,AppState){_timefilter.timefilter.enableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();var msgs=_messagebar_service.mlMessageBarService;var MlTimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);var moveToAdvancedJobCreation=Private(_new_job_utils.moveToAdvancedJobCreationProvider);var chartDataUtils=Private(_chart_data_utils.ChartDataUtilsProvider);var mlMultiMetricJobService=Private(_create_job_service.MultiMetricJobServiceProvider);var mlFullTimeRangeSelectorService=Private(_full_time_range_selector_service.FullTimeRangeSelectorServiceProvider);$scope.addNewJobToRecentlyAccessed=_new_job_utils.addNewJobToRecentlyAccessed;var stateDefaults={mlJobSettings:{}};var appState=new AppState(stateDefaults);mlMultiMetricJobService.clearChartData();$scope.chartData=mlMultiMetricJobService.chartData;var PAGE_WIDTH=_angular2.default.element(".multi-metric-job-container").width();var BAR_TARGET=PAGE_WIDTH>1600?800:PAGE_WIDTH/2;var MAX_BARS=BAR_TARGET+BAR_TARGET/100*100;var REFRESH_INTERVAL_MS=100;var MAX_BUCKET_DIFF=3;var METRIC_AGG_TYPE="metrics";var DEFAULT_MODEL_MEMORY_LIMIT="10MB";var refreshCounter=0;$scope.JOB_STATE=_states.JOB_STATE;$scope.jobState=$scope.JOB_STATE.NOT_STARTED;$scope.CHART_STATE=_states.CHART_STATE;$scope.chartStates={eventRate:_states.CHART_STATE.LOADING,fields:{}};var globalForceStop=false;var _createSearchItems=(0,_new_job_utils.createSearchItems)($route),indexPattern=_createSearchItems.indexPattern,savedSearch=_createSearchItems.savedSearch,query=_createSearchItems.query,filters=_createSearchItems.filters,combinedQuery=_createSearchItems.combinedQuery;(0,_index_utils.timeBasedIndexCheck)(indexPattern,true);var pageTitle=void 0!==savedSearch.id?"saved search "+savedSearch.title:"index pattern "+indexPattern.title;$scope.ui={indexPattern:indexPattern,pageTitle:pageTitle,showJobInput:true,showJobFinished:false,dirty:false,formValid:false,bucketSpanValid:true,bucketSpanEstimator:{status:0,message:""},aggTypeOptions:(0,_filter_agg_types.filterAggTypes)(_index.aggTypes.byType[METRIC_AGG_TYPE]),fields:[],splitFields:[],timeFields:[],splitText:"",intervals:[{title:"Auto",value:"auto"},{title:"Millisecond",value:"ms"},{title:"Second",value:"s"},{title:"Minute",value:"m"},{title:"Hourly",value:"h"},{title:"Daily",value:"d"},{title:"Weekly",value:"w"},{title:"Monthly",value:"M"},{title:"Yearly",value:"y"},{title:"Custom",value:"custom"}],eventRateChartHeight:100,chartHeight:150,showFieldCharts:false,showAdvanced:false,validation:{checks:{jobId:{valid:true},groupIds:{valid:true},modelMemoryLimit:{valid:true}}},isCountOrSum:false};$scope.formConfig={agg:{type:void 0},fields:{},bucketSpan:"15m",chartInterval:void 0,resultsIntervalSeconds:void 0,start:0,end:0,timeField:indexPattern.timeFieldName,splitField:void 0,influencerFields:[],firstSplitFieldName:void 0,indexPattern:indexPattern,query:query,filters:filters,combinedQuery:combinedQuery,jobId:"",description:"",jobGroups:[],useDedicatedIndex:false,isSparseData:false,modelMemoryLimit:DEFAULT_MODEL_MEMORY_LIMIT};$scope.formChange=function(){$scope.ui.isFormValid();$scope.ui.dirty=true;$scope.loadVis()};$scope.splitChange=function(){var splitField=$scope.formConfig.splitField;$scope.formConfig.firstSplitFieldName=void 0;if(void 0!==splitField){$scope.addDefaultFieldsToInfluencerList();$scope.ui.splitText="Data split by "+splitField.name;chartDataUtils.getSplitFields($scope.formConfig,$scope.formConfig.splitField.name,10).then(function(resp){resp.results.values&&resp.results.values.length&&($scope.formConfig.firstSplitFieldName=resp.results.values[0]);setFieldsChartStates(_states.CHART_STATE.LOADING);drawCards(resp.results.values);$scope.formChange()});$scope.setModelMemoryLimit()}else{setFieldsChartStates(_states.CHART_STATE.LOADING);$scope.ui.splitText="";$scope.formConfig.modelMemoryLimit=DEFAULT_MODEL_MEMORY_LIMIT;destroyCards();$scope.formChange()}};$scope.splitReset=function(){$scope.formConfig.splitField=void 0;$scope.splitChange()};function setTime(){$scope.ui.bucketSpanValid=true;$scope.formConfig.start=_datemath2.default.parse(_timefilter.timefilter.getTime().from).valueOf();$scope.formConfig.end=_datemath2.default.parse(_timefilter.timefilter.getTime().to).valueOf();$scope.formConfig.format="epoch_millis";var bucketSpanInterval=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan);null!==bucketSpanInterval&&0!==bucketSpanInterval.asMilliseconds()||($scope.ui.bucketSpanValid=false);var bounds=_timefilter.timefilter.getActiveBounds();$scope.formConfig.chartInterval=new MlTimeBuckets;$scope.formConfig.chartInterval.setBarTarget(BAR_TARGET);$scope.formConfig.chartInterval.setMaxBars(MAX_BARS);$scope.formConfig.chartInterval.setInterval("auto");$scope.formConfig.chartInterval.setBounds(bounds);(0,_adjust_interval.adjustIntervalDisplayed)($scope.formConfig);$scope.ui.isFormValid();$scope.ui.dirty=true}function initAgg(){_lodash2.default.each($scope.ui.aggTypeOptions,function(agg){"Mean"===agg.title&&($scope.formConfig.agg.type=agg)})}$scope.ui.isFormValid=function(){void 0===$scope.formConfig.agg.type||void 0===$scope.formConfig.timeField||0===Object.keys($scope.formConfig.fields).length?$scope.ui.formValid=false:$scope.ui.formValid=true;return $scope.ui.formValid};$scope.loadVis=function(){var thisLoadTimestamp=Date.now();$scope.chartData.lastLoadTimestamp=thisLoadTimestamp;setTime();$scope.ui.isFormValid();$scope.ui.showJobInput=true;$scope.ui.showJobFinished=false;$scope.ui.dirty=false;showSparseDataCheckbox();mlMultiMetricJobService.clearChartData();setFieldsChartStates(_states.CHART_STATE.LOADING);if(Object.keys($scope.formConfig.fields).length){$scope.ui.showFieldCharts=true;mlMultiMetricJobService.getLineChartResults($scope.formConfig,thisLoadTimestamp).then(function(resp){loadDocCountData(resp.detectors)}).catch(function(resp){msgs.error(resp.message);_lodash2.default.each($scope.formConfig.fields,function(field,id){$scope.chartStates.fields[id]=_states.CHART_STATE.NO_RESULTS})})}else{$scope.ui.showFieldCharts=false;loadDocCountData([])}function loadDocCountData(dtrs){chartDataUtils.loadDocCountData($scope.formConfig,$scope.chartData).then(function(resp){if(thisLoadTimestamp===$scope.chartData.lastLoadTimestamp){_lodash2.default.each(dtrs,function(dtr,id){var state=resp.totalResults?_states.CHART_STATE.LOADED:_states.CHART_STATE.NO_RESULTS;$scope.chartStates.fields[id]=state});$scope.chartData.lastLoadTimestamp=null;chartDataUtils.updateChartMargin($scope.chartData);$scope.$broadcast("render");$scope.chartStates.eventRate=resp.totalResults?_states.CHART_STATE.LOADED:_states.CHART_STATE.NO_RESULTS}}).catch(function(resp){$scope.chartStates.eventRate=_states.CHART_STATE.NO_RESULTS;msgs.error(resp.message)})}};function setFieldsChartStates(state){_lodash2.default.each($scope.chartStates.fields,function(chart,key){$scope.chartStates.fields[key]=state})}function showSparseDataCheckbox(){$scope.ui.isCountOrSum=false;_lodash2.default.each($scope.formConfig.fields,function(fd){"count"!==fd.agg.type.dslName&&"sum"!==fd.agg.type.dslName||($scope.ui.isCountOrSum=true)})}function drawCards(labels){var $frontCard=_angular2.default.element(".multi-metric-job-container .detector-container .card-front");$frontCard.addClass("card");$frontCard.find(".card-title").text(labels[0]);var marginTop=labels.length>1?54:0;$frontCard.css("margin-top",marginTop);var backCardTitle="";if(2===labels.length){backCardTitle=$scope.formConfig.fields[Object.keys($scope.formConfig.fields)[0]].agg.type.title;backCardTitle+=" ";backCardTitle+=Object.keys($scope.formConfig.fields)[0]}_angular2.default.element(".card-behind").remove();for(var _i=0;_i<labels.length;_i++){var el='<div class="card card-behind card-behind-'+_i+'"><div class="card-title">';el+=(0,_string_utils.mlEscape)(labels[_i]);el+='</div><label class="kuiFormLabel">';el+=(0,_string_utils.mlEscape)(backCardTitle);el+="</label></div>";var $backCard=_angular2.default.element(el);$backCard.css("z-index",9-_i);$backCard.insertBefore($frontCard)}var cardsBehind=_angular2.default.element(".card-behind");for(var _i2=0;_i2<cardsBehind.length;_i2++){cardsBehind[_i2].style.marginTop=marginTop+"px";marginTop-=(10-_i2*(10/labels.length))*(10/labels.length)}var i=0;var then=window.performance.now();var fps=20;var fpsInterval=1e3/fps;function fadeCard(callTime){if(i<cardsBehind.length){var now=callTime;var elapsed=now-then;if(elapsed>fpsInterval){cardsBehind[i].style.opacity=1;i++;then=now-elapsed%fpsInterval}window.requestAnimationFrame(fadeCard)}}fadeCard()}function destroyCards(){_angular2.default.element(".card-behind").remove();var $frontCard=_angular2.default.element(".multi-metric-job-container .detector-container .card-front");$frontCard.removeClass("card");$frontCard.find(".card-title").text("");$frontCard.css("margin-top",0)}var refreshInterval=REFRESH_INTERVAL_MS;$scope.createJob=function(){var tempJob=mlMultiMetricJobService.getJobFromConfig($scope.formConfig);if((0,_validate_job.validateJob)(tempJob,$scope.ui.validation.checks)){msgs.clear();mlMultiMetricJobService.createJob($scope.formConfig).then(function(job){_job_service.mlJobService.openJob(job.job_id).then(function(){saveNewDatafeed(job,true)}).catch(function(resp){msgs.error("Could not open job: ",resp);msgs.error("Job created, creating datafeed anyway");saveNewDatafeed(job,false)})}).catch(function(resp){msgs.error("Save failed: ",resp.resp)})}else false===$scope.ui.validation.checks.modelMemoryLimit.valid&&($scope.ui.showAdvanced=true);function saveNewDatafeed(job,startDatafeedAfterSave){_job_service.mlJobService.saveNewDatafeed(job.datafeed_config,job.job_id).then(function(){startDatafeedAfterSave&&mlMultiMetricJobService.startDatafeed($scope.formConfig).then(function(){$scope.jobState=_states.JOB_STATE.RUNNING;refreshCounter=0;refreshInterval=REFRESH_INTERVAL_MS;$scope.formConfig.resultsIntervalSeconds=$scope.formConfig.chartInterval.getInterval().asSeconds();var bucketSpanSeconds=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan).asSeconds();$scope.formConfig.resultsIntervalSeconds<bucketSpanSeconds&&($scope.formConfig.resultsIntervalSeconds=bucketSpanSeconds);$scope.resultsUrl=_job_service.mlJobService.createResultsUrl([$scope.formConfig.jobId],$scope.formConfig.start,$scope.formConfig.end,"explorer");loadCharts()}).catch(function(resp){msgs.error("Could not start datafeed: ",resp)})}).catch(function(resp){msgs.error("Save datafeed failed: ",resp)})}};(0,_validation_utils.addJobValidationMethods)($scope,mlMultiMetricJobService);function loadCharts(){var forceStop=globalForceStop;var counterLimit=20-refreshInterval/REFRESH_INTERVAL_MS;if(refreshCounter>=counterLimit){refreshCounter=0;_job_service.mlJobService.updateSingleJobDatafeedState($scope.formConfig.jobId).then(function(state){if("stopped"===state){console.log("Stopping poll because datafeed state is: "+state);$scope.$broadcast("render-results");forceStop=true}run()})}else run();function run(){refreshCounter++;reloadJobSwimlaneData().then(function(){reloadDetectorSwimlane().then(function(){false===forceStop&&$scope.chartData.percentComplete<100?$scope.jobState===_states.JOB_STATE.STOPPING?$scope.jobState=_states.JOB_STATE.STOPPING:$scope.jobState=_states.JOB_STATE.RUNNING:$scope.jobState=_states.JOB_STATE.FINISHED;jobCheck()})})}}function jobCheck(){if($scope.jobState===_states.JOB_STATE.RUNNING||$scope.jobState===_states.JOB_STATE.STOPPING){refreshInterval=adjustRefreshInterval($scope.chartData.loadingDifference,refreshInterval);_lodash2.default.delay(loadCharts,refreshInterval)}else _lodash2.default.each($scope.chartData.detectors,function(chart){chart.percentComplete=100});$scope.chartData.percentComplete>0&&toggleSwimlaneVisibility();$scope.$broadcast("render-results")}function reloadJobSwimlaneData(){return chartDataUtils.loadJobSwimlaneData($scope.formConfig,$scope.chartData)}function reloadDetectorSwimlane(){return chartDataUtils.loadDetectorSwimlaneData($scope.formConfig,$scope.chartData)}function adjustRefreshInterval(loadingDifference,currentInterval){var INTERVAL_INCREASE_MS=100;var MAX_INTERVAL=1e4;var interval=currentInterval;interval<MAX_INTERVAL&&(loadingDifference<MAX_BUCKET_DIFF?interval+=INTERVAL_INCREASE_MS:interval-INTERVAL_INCREASE_MS>=REFRESH_INTERVAL_MS&&(interval-=INTERVAL_INCREASE_MS));return interval}$scope.resetJob=function(){$scope.jobState=_states.JOB_STATE.NOT_STARTED;toggleSwimlaneVisibility();window.setTimeout(function(){$scope.ui.showJobInput=true;$scope.loadVis()},500)};function toggleSwimlaneVisibility(){if($scope.jobState===_states.JOB_STATE.NOT_STARTED){_angular2.default.element(".swimlane-cells").css("opacity",0);_angular2.default.element(".bar").css("opacity",1)}else _angular2.default.element(".bar").css("opacity",.1)}$scope.stopJob=function(){$scope.jobState=_states.JOB_STATE.STOPPING;mlMultiMetricJobService.stopDatafeed($scope.formConfig)};$scope.moveToAdvancedJobCreation=function(){var job=mlMultiMetricJobService.getJobFromConfig($scope.formConfig);moveToAdvancedJobCreation(job)};$scope.setModelMemoryLimit=function(){var formConfig=$scope.formConfig;_ml_api_service.ml.calculateModelMemoryLimit({indexPattern:formConfig.indexPattern.title,splitFieldName:formConfig.splitField.name,query:formConfig.query,fieldNames:Object.keys(formConfig.fields),influencerNames:formConfig.influencerFields.map(function(f){return f.name}),timeFieldName:formConfig.timeField,earliestMs:formConfig.start,latestMs:formConfig.end}).then(function(resp){formConfig.modelMemoryLimit=resp.modelMemoryLimit}).catch(function(){formConfig.modelMemoryLimit=DEFAULT_MODEL_MEMORY_LIMIT})};$scope.setFullTimeRange=function(){return mlFullTimeRangeSelectorService.setFullTimeRange($scope.ui.indexPattern,$scope.formConfig.combinedQuery)};initAgg();(0,_create_fields.createFields)($scope,indexPattern);$scope.loadVis();$scope.$evalAsync(function(){(0,_prepopulate_job_settings.preLoadJob)($scope,appState)});$scope.$listenAndDigestAsync(_timefilter.timefilter,"fetch",function(){$scope.loadVis();void 0!==$scope.formConfig.splitField&&$scope.setModelMemoryLimit()});$scope.$on("$destroy",function(){globalForceStop=true;_angular2.default.element(window).off("resize")})})},3782:function(module,exports){module.exports='<ml-nav-menu name="new_job_multi_metric"></ml-nav-menu>\n<ml-new-job-multi-metric>\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlCreateMultiMetricJob" class="multi-metric-job-container">\n    <div class="row">\n      <div class="col-md-6">\n        <h1 class="euiTitle euiTitle--large">New job from {{ui.pageTitle}}</h1>\n      </div>\n      <div class="col-md-6">\n        <div class="pull-right">\n          <span style="font-size:10px;" ng-show="formConfig.chartInterval !== undefined">Chart interval: {{formConfig.chartInterval.getInterval().expression}}</span>\n          <ml-full-time-range-selector\n            disabled=\'(jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)\'\n            index-pattern=\'ui.indexPattern\'\n            query=\'formConfig.combinedQuery\'\n          ></ml-full-time-range-selector>\n        </div>\n      </div>\n    </div>\n\n    <div class="euiSpacer euiSpacer--s"></div>\n\n    <div class="row">\n      <div class="col-md-4">\n        <div class="row form-controls">\n          <h4 class="euiTitle euiTitle--small">Job settings</h4>\n          <div>\n            <div class=\'form-section\'>\n              <ml-fields-selection></ml-fields-selection>\n            </div>\n\n            <div class=\'form-section form-section-overflow\' >\n              <h4 class="euiTitle euiTitle--small">\n                Split Data\n                <button\n                  ng-if="formConfig.splitField !== undefined && (!ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)"\n                  ng-click="splitReset()"\n                  aria-label="Reset Split Data to none."\n                  ng-disabled="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                  class="euiButton euiButton--primary euiButton--small remove-split"\n                >\n                  Remove split\n                </button>\n              </h4>\n              <div class="euiSpacer euiSpacer--s"></div>\n              <div class="row">\n                <div class="col-md-12">\n                  <div class="form-group">\n                    <ui-select\n                      ng-model="formConfig.splitField"\n                      ng-change="splitChange()"\n                      ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                    >\n                        <ui-select-match placeholder="Select a field">\n                          <ml-field-type-icon type="$select.selected.mlType"></ml-field-type-icon>{{$select.selected.name}}\n                        </ui-select-match>\n                        <ui-select-choices repeat="field in ui.splitFields | filter: { name: $select.search }" group-by="\'mlType\'">\n                          <div>\n                            <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n                            <span\n                              class="select-item"\n                              ng-bind-html="field.name | highlight: $select.search">\n                            </span>\n                          </div>\n                        </ui-select-choices>\n                    </ui-select>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div class=\'form-section\' >\n              <ml-influencers-selection></ml-influencers-selection>\n            </div>\n\n            <div class=\'form-section\' >\n              <ml-bucket-span-selection></ml-bucket-span-selection>\n            </div>\n\n            <div class=\'form-section\' >\n              <div ng-show="jobState !== JOB_STATE.FINISHED">\n                <h4 class="euiTitle euiTitle--small">Job Details</h4>\n                <div class="euiSpacer euiSpacer--s"></div>\n              </div>\n\n              <div class="form-group">\n                <div ng-show="ui.showJobInput && (jobState === JOB_STATE.NOT_STARTED || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING)">\n                  <ml-general-job-details></ml-general-job-details>\n\n                  <div class="form-group">\n                    <a href="" ng-click="moveToAdvancedJobCreation()">Move to advanced job configuration</a>\n                  </div>\n\n                  <div class="euiFlexGroup euiFlexGroup--gutterSmall euiFlexGroup--alignItemsCenter euiFlexGroup--responsive">\n                    <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                      <ml-validate-job\n                        get-duration="getDuration"\n                        get-job-config="getJobConfig"\n                        fill="false"\n                        is-current-job-config="isCurrentJobConfig"\n                        is-disabled="!ui.formValid"\n                        ng-show="jobState === JOB_STATE.NOT_STARTED"\n                      />\n                    </div>\n                    <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                      <button\n                        aria-label="Create Job"\n                        ng-click="createJob()"\n                        type="button"\n                        ng-show="jobState === JOB_STATE.NOT_STARTED"\n                        ng-disabled="!ui.formValid"\n                        class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                        <span class="euiButton__content">\n                          Create Job\n                        </span>\n                      </button>\n                    </div>\n                  </div>\n\n                  <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.RUNNING">Analysis running <i class=\'fa fa-spinner fa-spin\'></i></div>\n                  <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.STOPPING">Analysis stopping <i class=\'fa fa-spinner fa-spin\'></i></div>\n\n                  <div class="euiSpacer euiSpacer--s"></div>\n\n                  <button\n                    aria-label="Stop Job"\n                    ng-click="stopJob()"\n                    type="button"\n                    ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n                    ng-disabled="jobState === JOB_STATE.STOPPING"\n                    class="euiButton euiButton--danger euiButton--small">\n                    <span class="euiButton__content">\n                      {{(jobState === JOB_STATE.STOPPING) ? \'Analysis stopping\' : \'Stop analysis\' }}\n                    </span>\n                  </button>\n\n                  <a\n                    href=\'{{resultsUrl}}\'\n                    ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n                    aria-label="View Results"\n                    ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      View Results\n                    </span>\n                  </a>\n                </div>\n                <div ng-show="jobState === JOB_STATE.FINISHED">\n                  <h3 class="euiTitle euiTitle--large">Job {{formConfig.jobId }} created\n                    <i style="color:green;" class="fa fa-check" aria-label="Saved"></i>\n                  </h3>\n                  <div class="euiSpacer euiSpacer--m"></div>\n\n                  <button\n                    aria-label="Reset"\n                    ng-click="resetJob()"\n                    type="button"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      Reset\n                    </span>\n                  </button>\n                  <a\n                    href=\'{{resultsUrl}}\'\n                    ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n                    aria-label="View Results"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      View Results\n                    </span>\n                  </a>\n                </div>\n\n                <div ng-if=\'jobState === JOB_STATE.FINISHED\'>\n                  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n                  <ml-post-save-options\n                    job-id=\'formConfig.jobId\'\n                    bucket-span=\'formConfig.bucketSpan\'\n                    include-influencers=\'true\'\n                    ></ml-post-save-options>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="col-md-8">\n        <div class="row charts-container">\n          <h4 class="euiTitle euiTitle--small">Results</h4>\n          <div>\n            <div class=\'chart-list-panel event-rate-container\' style=\'height: {{ui.eventRateChartHeight + 70}}px;\'>\n              <label class="kuiFormLabel">Document count</label>\n\n              <div class=\'chart-container\'>\n                <div style=\'height: {{ui.eventRateChartHeight + 25}}px;\'>\n                  <ml-event-rate-chart\n                    chart-data="chartData.job"\n                    event-rate-chart-height=\'ui.eventRateChartHeight\'\n                    chart-ticks-margin="chartData.chartTicksMargin">\n                  </ml-event-rate-chart>\n                </div>\n\n                <div ng-show="chartStates.eventRate === CHART_STATE.NOT_STARTED || chartStates.eventRate === CHART_STATE.LOADING || chartStates.eventRate === CHART_STATE.NO_RESULTS"\n                  class=\'chart-loader event-rate-chart-loader\'\n                  style=\'height: {{ui.eventRateChartHeight}}px; margin-top: -{{ui.eventRateChartHeight + 30}}px;\'>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.NOT_STARTED"></div>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.LOADING">\n                      <h2 class="euiTitle euiTitle"><i class=\'fa fa-spinner fa-spin\'></i></h2>\n                    </div>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.NO_RESULTS">\n                      <div class=\'no-results\'>\n                        <h4 class="euiTitle euiTitle--small"><i class="fa fa-info-circle"></i> No results found</h4>\n                        <span>Consider using the <a ng-click="setFullTimeRange()">full {{ui.indexPattern.title}} data</a></span>\n                      </div>\n                    </div>\n                </div>\n\n              </div>\n\n            </div>\n            <div class=\'chart-list-panel detector-container\' ng-show=\'ui.showFieldCharts\'>\n              <label  class="kuiFormLabel" ng-hide="ui.splitText === \'\'">{{ui.splitText}}</label>\n              <div class=\'card-front\'>\n                <div class="card-title"></div>\n                <div ng-repeat=\'(id, chart) in chartData.detectors\' class=\'chart\' style=\'height: {{ui.chartHeight + 50}}px;\'>\n                  <label class="kuiFormLabel">{{formConfig.fields[id].agg.type.title}} {{formConfig.fields[id].name}}</label>\n                  <div class=\'chart-container\'>\n                    <div style=\'height: {{ui.chartHeight + 25}}px;\'>\n                      <ml-multi-metric-job-chart\n                        chart-data="chart"\n                        chart-height=\'ui.chartHeight\'\n                        chart-ticks-margin="chartData.chartTicksMargin">\n                      </ml-multi-metric-job-chart>\n                    </div>\n\n                    <div ng-show="chartStates.fields[id] === CHART_STATE.NOT_STARTED || chartStates.fields[id] === CHART_STATE.LOADING || chartStates.fields[id] === CHART_STATE.NO_RESULTS"\n                      class=\'chart-loader fields-chart-loader\'\n                      style=\'height: {{ui.chartHeight}}px; margin-top: -{{ui.chartHeight + 30}}px; margin-left: {{chartData.chartTicksMargin.width - 1}}px;\'>\n                        <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.NOT_STARTED"></div>\n                        <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.LOADING">\n                          <h2 class="euiTitle euiTitle"><i class=\'fa fa-spinner fa-spin\'></i></h2>\n                        </div>\n                        <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.NO_RESULTS">\n                          <div class=\'no-results\'>\n                            <h4 class="euiTitle euiTitle--small"><i class="fa fa-info-circle"></i> No results found</h4>\n                          </div>\n                        </div>\n                    </div>\n\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</ml-new-job-multi-metric>\n'},3783:function(module,exports,__webpack_require__){"use strict";var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _d=__webpack_require__(19);var _d2=_interopRequireDefault(_d);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _time_buckets=__webpack_require__(273);var _chart_utils=__webpack_require__(256);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlMultiMetricJobChart",function(){function link(scope,element){var svgWidth=0;var lineChartHeight=scope.chartHeight;var marginTop=5;var progressBarMarginBottom=lineChartHeight+marginTop-15;var margin={top:marginTop,right:1,bottom:20,left:scope.chartTicksMargin.width};var svgHeight=lineChartHeight+margin.top+margin.bottom;var vizWidth=svgWidth-margin.left-margin.right;var chartLimits={max:0,min:0};var lineChartXScale=null;var lineChartYScale=null;var lineChartGroup=void 0;var swimlaneGroup=void 0;var lineChartValuesLine=null;var $progressBar=void 0;scope.$on("render",function(){init();createSVGGroups();drawLineChart()});scope.$on("render-results",function(){drawResults()});element.on("$destroy",function(){scope.$destroy()});function init(){var $el=_angular2.default.element(".multi-metric-job-container .card-front");var offset=$el.hasClass("card")?30:0;margin.left=scope.chartTicksMargin.width;svgWidth=$el.width()-offset;vizWidth=svgWidth-margin.left-margin.right;lineChartXScale=_d2.default.time.scale().range([0,vizWidth]);lineChartYScale=_d2.default.scale.linear().range([lineChartHeight,0]);lineChartValuesLine=_d2.default.svg.line().x(function(d){return lineChartXScale(d.date)}).y(function(d){return lineChartYScale(d.value)}).defined(function(d){return null!==d.value})}function createSVGGroups(){if(void 0===scope.chartData.line)return;var chartElement=_d2.default.select(element.get(0));chartElement.select("svg").remove();chartElement.select(".progress").remove();if(null===chartElement.select(".progress-bar")[0][0]){var style="width: "+(+vizWidth+2)+"px;\n          margin-bottom: -"+ +progressBarMarginBottom+"px;\n          margin-left: "+(+margin.left-1)+"px;'";chartElement.append("div").attr("class","progress").attr("style",style).append("div").attr("class","progress-bar")}$progressBar=(0,_jquery2.default)(".progress-bar");var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);swimlaneGroup=svg.append("g").attr("class","swimlane").attr("transform","translate("+margin.left+", "+margin.top+")");lineChartGroup=svg.append("g").attr("class","line-chart").attr("transform","translate("+margin.left+", "+margin.top+")")}function drawLineChart(){var data=scope.chartData.line;lineChartXScale=lineChartXScale.domain(_d2.default.extent(data,function(d){return d.date}));chartLimits.max=_d2.default.max(data,function(d){return d.value});chartLimits.min=_d2.default.min(data,function(d){return d.value});var padding=.05*(chartLimits.max-chartLimits.min);chartLimits.max+=padding;chartLimits.min-=padding;lineChartYScale=lineChartYScale.domain([chartLimits.min,chartLimits.max]);var timeBuckets=new _time_buckets.TimeBuckets;timeBuckets.setInterval("auto");if(data.length>0){var xDomain=lineChartXScale.domain();var bounds={min:(0,_moment2.default)(xDomain[0]),max:(0,_moment2.default)(xDomain[1])};timeBuckets.setBounds(bounds)}var xAxisTickFormat=timeBuckets.getScaledDateFormat();var xAxis=_d2.default.svg.axis().scale(lineChartXScale).orient("bottom").innerTickSize(-lineChartHeight).outerTickSize(0).tickPadding(10).ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)});var yAxis=_d2.default.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(-vizWidth).outerTickSize(0).tickPadding(10);void 0!==scope.chartData.fieldFormat&&yAxis.tickFormat(function(d){return scope.chartData.fieldFormat.convert(d,"text")});swimlaneGroup.append("rect").attr("x",0).attr("y",0).attr("height",lineChartHeight).attr("width",vizWidth).style("fill","#FFFFFF");lineChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",lineChartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1);drawLineChartAxes(xAxis,yAxis);drawLineChartPaths(data);(0,_chart_utils.drawLineChartDots)(data,lineChartGroup,lineChartValuesLine)}function drawLineChartAxes(xAxis,yAxis){var axes=lineChartGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0, "+lineChartHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis)}function drawLineChartPaths(data){lineChartGroup.append("path").attr("class","values-line").attr("d",lineChartValuesLine(data))}function drawResults(){drawSwimlane(vizWidth,lineChartHeight);updateProgressBar()}function drawSwimlane(swlWidth,swlHeight){var data=scope.chartData.swimlane;var cellWidth=0;data.length>0&&(cellWidth=lineChartXScale(data[0].time+scope.chartData.swimlaneInterval)-lineChartXScale(data[0].time));_d2.default.time.scale().range([0,swlWidth]).domain(_d2.default.extent(data,function(d){return d.date}));_d2.default.scale.linear().range([swlHeight,0]).domain([0,swlHeight]);var color=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#d2e9f7","#8bc8fb","#ffdd00","#ff7e00","#fe5050"]);swimlaneGroup.select(".swimlane-cells").remove();var cells=swimlaneGroup.append("g").attr("class","swimlane-cells").selectAll("cells").data(data);cells.enter().append("rect").attr("x",function(d){return lineChartXScale(d.date)}).attr("y",0).attr("rx",0).attr("ry",0).attr("class",function(d){return d.value>0?"swimlane-cell":"swimlane-cell-hidden"}).attr("width",cellWidth-0).attr("height",swlHeight-0).style("fill",function(d){return color(d.value)})}function updateProgressBar(){var pcnt=scope.chartData.percentComplete<100?scope.chartData.percentComplete:0;$progressBar.css("width",pcnt+"%")}}return{scope:{chartData:"=",chartHeight:"=",chartTicksMargin:"="},link:link}})},3784:function(module,exports,__webpack_require__){"use strict";var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _d=__webpack_require__(19);var _d2=_interopRequireDefault(_d);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _time_buckets=__webpack_require__(273);var _chart_utils=__webpack_require__(256);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlEventRateChart",function(){function link(scope,element){var svgWidth=0;var barChartHeight=scope.eventRateChartHeight;var marginTop=5;var progressBarMarginBottom=barChartHeight+marginTop-15;var margin={top:marginTop,right:1,bottom:20,left:scope.chartTicksMargin.width};var svgHeight=barChartHeight+margin.top+margin.bottom;var vizWidth=svgWidth-margin.left-margin.right;var chartLimits={max:0,min:0};var barChartXScale=null;var swimlaneXScale=null;var barChartYScale=null;var barChartGroup=void 0;var swimlaneGroup=void 0;var $progressBar=void 0;scope.$on("render",function(){init();createSVGGroups();drawBarChart()});scope.$on("render-results",function(){drawResults()});element.on("$destroy",function(){scope.$destroy()});function init(){var $el=_angular2.default.element(".event-rate-container");margin.left=scope.chartTicksMargin.width;svgWidth=$el.width();vizWidth=svgWidth-margin.left-margin.right;barChartXScale=_d2.default.scale.linear().rangeRound([0,vizWidth],.05);swimlaneXScale=_d2.default.time.scale().range([0,vizWidth]);barChartYScale=_d2.default.scale.linear().range([barChartHeight,0])}function createSVGGroups(){if(void 0===scope.chartData.bars)return;var chartElement=_d2.default.select(element.get(0));chartElement.select("svg").remove();chartElement.select(".progress").remove();if(null===chartElement.select(".progress-bar")[0][0]){var style="width: "+(+vizWidth+2)+"px;\n          margin-bottom: -"+ +progressBarMarginBottom+"px;\n          margin-left: "+(+margin.left-1)+"px;'";chartElement.append("div").attr("class","progress").attr("style",style).append("div").attr("class","progress-bar")}$progressBar=(0,_jquery2.default)(".progress-bar");var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);barChartGroup=svg.append("g").attr("class","bar-chart").attr("transform","translate("+margin.left+","+margin.top+")");swimlaneGroup=svg.append("g").attr("class","swimlane").attr("transform","translate("+margin.left+","+margin.top+")")}function drawBarChart(){var data=scope.chartData.bars;var finerData=scope.chartData.bars;scope.chartData.line.length>0&&(finerData=scope.chartData.line);swimlaneXScale.domain(_d2.default.extent(finerData,function(d){return d.date}));var timeExtent=_d2.default.extent(data,function(d){return d.date});timeExtent[1]=new Date(timeExtent[1].getTime()+scope.chartData.barsInterval);barChartXScale=_d2.default.time.scale().range([0,vizWidth]).domain(timeExtent);chartLimits.max=_d2.default.max(data,function(d){return d.value});chartLimits.min=0;var padding=.05*(chartLimits.max-chartLimits.min);chartLimits.max+=padding;barChartYScale=barChartYScale.domain([chartLimits.min,chartLimits.max]);var timeBuckets=new _time_buckets.TimeBuckets;timeBuckets.setInterval("auto");if(data.length>0){var xDomain=barChartXScale.domain();var bounds={min:(0,_moment2.default)(xDomain[0]),max:(0,_moment2.default)(xDomain[1])};timeBuckets.setBounds(bounds)}var xAxisTickFormat=timeBuckets.getScaledDateFormat();var xAxis=_d2.default.svg.axis().scale(swimlaneXScale).orient("bottom").innerTickSize(-barChartHeight).outerTickSize(0).tickPadding(10).ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)});var yAxis=_d2.default.svg.axis().scale(barChartYScale).orient("left").innerTickSize(-vizWidth).outerTickSize(0).tickPadding(10);barChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",barChartHeight).attr("width",vizWidth).style("fill","#FFFFFF");barChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",barChartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1);drawBarChartAxes(xAxis,yAxis);drawBarChartPaths(data)}function drawBarChartAxes(xAxis,yAxis){var axes=barChartGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0,"+barChartHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis)}function drawBarChartPaths(data){var earliestTime=scope.chartData.earliestTime;var cellWidth=0;data.length>0&&(cellWidth=barChartXScale(earliestTime+scope.chartData.barsInterval)-barChartXScale(earliestTime));barChartGroup.selectAll("bar").data(data).enter().append("rect").style("fill","#32a7c2").attr("class","bar").attr("x",function(d){return barChartXScale(d.time)}).attr("width",cellWidth).attr("y",function(d){return barChartYScale(d.value)}).attr("height",function(d){return barChartHeight-barChartYScale(d.value)})}function drawResults(){updateProgressBar();drawSwimlane(vizWidth,barChartHeight)}function drawSwimlane(swlWidth,swlHeight){var lineData=scope.chartData.line;var data=scope.chartData.swimlane;var earliestTime=scope.chartData.earliestTime;var cellWidth=0;data.length>0&&(cellWidth=barChartXScale(earliestTime+scope.chartData.swimlaneInterval)-barChartXScale(earliestTime));_d2.default.time.scale().range([0,swlWidth]).domain(_d2.default.extent(lineData,function(d){return d.date}));_d2.default.scale.linear().range([swlHeight,0]).domain([0,swlHeight]);var color=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#d2e9f7","#8bc8fb","#ffdd00","#ff7e00","#fe5050"]);swimlaneGroup.select(".swimlane-cells").remove();var cells=swimlaneGroup.append("g").attr("class","swimlane-cells").selectAll("cells").data(data);cells.enter().append("rect").attr("x",function(d){return swimlaneXScale(d.date)}).attr("y",0).attr("rx",0).attr("ry",0).attr("class",function(d){return d.value>0?"swimlane-cell":"swimlane-cell-hidden"}).attr("width",cellWidth-0).attr("height",swlHeight-0).style("fill",function(d){return color(d.value)})}function updateProgressBar(){var pcnt=scope.chartData.percentComplete;$progressBar.css("width",pcnt+"%")}}return{scope:{chartData:"=",eventRateChartHeight:"=",chartTicksMargin:"="},link:link}})},3785:function(module,exports){},3786:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3787);__webpack_require__(3789)},3787:function(module,exports,__webpack_require__){"use strict";var _states=__webpack_require__(501);var _fields_selection=__webpack_require__(3788);var _fields_selection2=_interopRequireDefault(_fields_selection);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlFieldsSelection",function(){return{restrict:"E",replace:true,template:_fields_selection2.default,controller:function controller($scope){$scope.toggleFields=function(field){var key=field.id;var f=$scope.formConfig.fields[key];if(void 0===f){$scope.formConfig.fields[key]=field;$scope.chartStates.fields[key]=_states.CHART_STATE.LOADING}else{delete $scope.formConfig.fields[key];delete $scope.chartStates.fields[key]}void 0!==$scope.formConfig.splitField&&$scope.setModelMemoryLimit()}}}})},3788:function(module,exports){module.exports='<div class=\'fields-selection\'>\n  <h4 class="euiTitle euiTitle--small">Fields</h4>\n  <div class="euiSpacer euiSpacer--s"></div>\n  <div class="row">\n    <div class="col-md-12">\n      <div class="form-group">\n\n        <div class=\'selection-list-container fields-list\'>\n          <div class="checkbox field-row" ng-repeat="field in ui.fields" >\n            <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n              <input type="checkbox"\n                class=\'kuiCheckBox\'\n                ng-checked="formConfig.fields[field.id] !== undefined"\n                ng-click="toggleFields(field); formChange()"\n                ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                />\n              <span\n                class=\'kuiCheckBoxLabel__text\'\n                tooltip=\'{{field.tooltip}}\'\n                tooltip-append-to-body="true">\n                {{field.name}}\n              </span>\n            </label>\n            <div class="agg-type-select-wrapper">\n              <select\n                ng-model="field.agg.type"\n                ng-options="agg as agg.title for agg in ui.aggTypeOptions | filterAggTypes:field"\n                ng-change="formChange()"\n                ng-disabled="formConfig.fields[field.id] === undefined || jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                class="form-control agg-type-select">\n              </select>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="row form-controls" ng-show=\'ui.isCountOrSum\'>\n    <span class="col-md-12">\n      <label class=\'kuiCheckBoxLabel kuiVerticalRhythm sparse-data\'>\n        <input type="checkbox"\n          class=\'kuiCheckBox\'\n          ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n          ng-model  ="formConfig.isSparseData" />\n          <span class=\'kuiCheckBoxLabel__text\'>\n            Sparse data <i ml-info-icon="new_job_sparsedata" tooltip-append-to-body="true"></i>\n          </span>\n      </label>\n    </span>\n  </div>\n</div>\n'},3789:function(module,exports){},3790:function(module,exports,__webpack_require__){"use strict";var _influencers_selection=__webpack_require__(3791);var _influencers_selection2=_interopRequireDefault(_influencers_selection);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlInfluencersSelection",function(){return{restrict:"E",replace:true,template:_influencers_selection2.default,controller:function controller($scope){$scope.isDefaultInfluencer=function(field){var defaultFields=getDefaultFields();return void 0!==defaultFields.find(function(f){return f.name===field.name})};$scope.toggleInfluencerChange=function(){$scope.addDefaultFieldsToInfluencerList()};$scope.addDefaultFieldsToInfluencerList=function(){var defaultFields=getDefaultFields();var nonDefaultFields=getNonDefaultFields(defaultFields);$scope.formConfig.influencerFields=defaultFields.concat(nonDefaultFields)};function getDefaultFields(){var defaultFields=getSplitFields();true===$scope.formConfig.hasOwnProperty("overField")&&void 0===defaultFields.find(function(f){return f.name===$scope.formConfig.overField.name})&&defaultFields.push($scope.formConfig.overField);return defaultFields}function getNonDefaultFields(defaultFields){return $scope.formConfig.influencerFields.filter(function(f){return void 0===defaultFields.find(function(sp){return sp===f})})}function getSplitFields(){if(false===$scope.formConfig.hasOwnProperty("splitField")){var splitFields=$scope.formConfig.fields.map(function(f){return f.splitField}).filter(function(f){return void 0!==f&&""!==f});splitFields=_lodash2.default.uniq(splitFields,"name");return splitFields}return void 0===$scope.formConfig.splitField?[]:[$scope.formConfig.splitField]}}}})},3791:function(module,exports){module.exports='<div class="influencers-selection">\n  <div>\n    <h4 class="euiTitle euiTitle--small">Key Fields (Influencers)</h4>\n    <div class="euiSpacer euiSpacer--s"></div>\n  </div>\n  <div class="row">\n    <div class="col-md-12">\n      <div class="form-group">\n        <div class=\'selection-list-container\'>\n          <ui-select\n            ng-model="formConfig.influencerFields"\n            ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n            on-select="toggleInfluencerChange()"\n            on-remove="toggleInfluencerChange()"\n            multiple\n            append-to-body=true\n          >\n            <ui-select-match placeholder="Key fields">\n              <span ng-class="{\'default-influencer\': isDefaultInfluencer($item)}">\n                <ml-field-type-icon type="$item.mlType"></ml-field-type-icon>{{$item.name}}\n              </span>\n            </ui-select-match>\n            <ui-select-choices repeat="field in ui.splitFields | filter: { name: $select.search }" group-by="\'mlType\'">\n              <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n              <span class="select-item" ng-bind-html="(field.name | highlight: $select.search)"></span>\n            </ui-select-choices>\n          </ui-select>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'},3792:function(module,exports){},3793:function(module,exports,__webpack_require__){"use strict";var _bucket_span_selection=__webpack_require__(3794);var _bucket_span_selection2=_interopRequireDefault(_bucket_span_selection);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlBucketSpanSelection",function(){return{restrict:"E",replace:true,template:_bucket_span_selection2.default,controller:function controller($scope){$scope.bucketSpanFieldChange=function(){$scope.ui.bucketSpanEstimator.status=0;$scope.ui.bucketSpanEstimator.message="";$scope.formChange()};$scope.bucketSpanEstimatorExportedFunctions={}}}})},3794:function(module,exports){module.exports='<div class=\'bucket-span-selection\'>\n  <h4 class="euiTitle euiTitle--small" id="ml_aria_label_new_job_bucketspan">Bucket span</h4><i ml-info-icon="new_job_bucketspan" />\n  <div class="euiSpacer euiSpacer--s"></div>\n  <div class="row">\n    <div class="col-md-12">\n      <div class="form-group">\n        <div>\n          <input\n            aria-labelledby="ml_aria_label_new_job_bucketspan"\n            aria-describedby="ml_aria_description_new_job_bucketspan"\n            ng-model="formConfig.bucketSpan"\n            required\n            placeholder={{formConfig-bucketSpan}}\n            ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED || ui.bucketSpanEstimator.status===1"\n            ng-change="bucketSpanFieldChange()"\n            ng-class=\'{"ng-invalid": (!ui.bucketSpanValid)}\'\n            class="form-control lowercase bucket-span-input" />\n\n          <ml-bucket-span-estimator\n            bucket-span-field-change="bucketSpanFieldChange"\n            form-config=\'formConfig\'\n            job-state-wrapper=\'{jobState:jobState}\'\n            job-state=\'JOB_STATE\'\n            ui=\'ui\'\n            exported-functions=\'bucketSpanEstimatorExportedFunctions\'>\n          </ml-bucket-span-estimator>\n\n        </div>\n        <div ng-hide="ui.bucketSpanValid" class="validation-error">Invalid interval format</div>\n        <div ng-show="ui.bucketSpanEstimator.status===-1" class="validation-error">{{ui.bucketSpanEstimator.message}}</div>\n      </div>\n    </div>\n\n    <div class="col-md-0">\n    </div>\n  </div>\n</div>\n'},3795:function(module,exports){},3796:function(module,exports,__webpack_require__){"use strict";var _general_job_details=__webpack_require__(3797);var _general_job_details2=_interopRequireDefault(_general_job_details);var _change_job_id_case=__webpack_require__(1429);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlGeneralJobDetails",function(){return{restrict:"E",replace:true,template:_general_job_details2.default,controller:function controller($scope){$scope.changeJobIDCase=_change_job_id_case.changeJobIDCase}}})},3797:function(module,exports){module.exports='<div class="general-job-details">\n  <div class="form-group">\n    <ml-form-label label-id="new_job_id" tooltip-append-to-body="true">Name</ml-form-label>\n    <input\n      aria-labelledby="ml_aria_label_new_job_id"\n      aria-describedby="ml_aria_description_new_job_id"\n      id="job-id-input"\n      ng-model="formConfig.jobId"\n      required\n      placeholder="Job ID"\n      ng-change="changeJobIDCase(formConfig)"\n      ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n      class="form-control lowercase" />\n    <div ng-hide="ui.validation.checks.jobId.valid" class="validation-error">{{ ( ui.validation.checks.jobId.message || "Enter a name for the job" ) }}</div>\n  </div>\n\n  <div class="form-group">\n    <ml-form-label label-id="new_job_description">Description</ml-form-label>\n    <input\n      aria-labelledby="ml_aria_label_new_job_description"\n      aria-describedby="ml_aria_description_new_job_description"\n      ng-model="formConfig.description"\n      placeholder="Job description"\n      ng-disabled="jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n      class="form-control" />\n  </div>\n  <div class="form-group">\n    <ml-form-label label-id="new_job_group">Job Groups</ml-form-label>\n    <ml-job-group-select\n      aria-labelledby="ml_aria_label_new_job_group"\n      aria-describedby="ml_aria_description_new_job_group"\n      job-groups=\'formConfig.jobGroups\'\n      disabled=\'(jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)\' />\n    <div ng-hide="ui.validation.checks.groupIds.valid" class="validation-error">{{ ui.validation.checks.groupIds.message }}</div>\n  </div>\n\n  <div class="form-group">\n    <div ng-click="ui.showAdvanced = (!ui.showAdvanced || formConfig.useDedicatedIndex)" class="advanced-button-container">\n      <button\n        aria-label="{{ ui.showAdvanced ? \'Hide Advanced\' : \'Show Advanced\' }}"\n        ng-disabled="formConfig.useDedicatedIndex"\n        type="button"\n        class="kuiButton kuiButton--small kuiButton--hollow advanced-button">\n        <i aria-hidden="true" ng-class="{ \'fa-caret-down\': ui.showAdvanced, \'fa-caret-right\': !ui.showAdvanced }" class="fa"></i>\n      </button>\n      <label class="kuiFormLabel" aria-describedby="ml_aria_description_new_job_advanced_settings">Advanced</label>\n      <i ml-info-icon="new_job_advanced_settings" ></i>\n    </div>\n    <div class=\'advanced-group\' ng-show="ui.showAdvanced">\n      <div class="form-group">\n      <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n        <input type="checkbox"\n          aria-labelledby="ml_aria_label_new_job_dedicated_index"\n          aria-describedby="ml_aria_description_new_job_dedicated_index"\n          class=\'kuiCheckBox\'\n          ng-model  ="formConfig.useDedicatedIndex" />\n        <span class=\'kuiCheckBoxLabel__text\'>\n          <span id="ml_aria_label_new_job_dedicated_index">Use dedicated index</span>\n          <i ml-info-icon="new_job_dedicated_index" ></i>\n        </span>\n      </label>\n      </div>\n      <div class="form-group">\n        <label class=\'kuiFormLabel kuiVerticalRhythm\'>\n          <span id="ml_aria_label_new_job_model_memory_limit">\n            Model memory limit\n          </span>\n          <i ml-info-icon="new_job_model_memory_limit"></i>\n        </label>\n        <div></div>\n        <input\n          aria-labelledby="ml_aria_label_new_job_model_memory_limit"\n          aria-describedby="ml_aria_description_new_job_model_memory_limit"\n          type="text"\n          ng-model=\'formConfig.modelMemoryLimit\'\n          class="kuiTextInput kuiTextInput--large" />\n        <div ng-hide="ui.validation.checks.modelMemoryLimit.valid" class="validation-error">{{ ui.validation.checks.modelMemoryLimit.message }}</div>\n      </div>\n    </div>\n  </div>\n  <div class="form-group"></div>\n</div>\n'},3798:function(module,exports){},3799:function(module,exports,__webpack_require__){"use strict";var _field_types=__webpack_require__(322);var _general=__webpack_require__(300);var _modules=__webpack_require__(2);var _module=_modules.uiModules.get("apps/ml");_module.filter("filterAggTypes",function(){return function(aggTypes,field){return aggTypes.filter(function(type){if(field.id===_general.EVENT_RATE_COUNT_FIELD){if(type.isCountType)return true}else if(!type.isCountType){if(field.mlType!==_field_types.ML_JOB_FIELD_TYPES.KEYWORD&&field.mlType!==_field_types.ML_JOB_FIELD_TYPES.IP)return true;if(type.isAggregatableStringType)return true}return false})}})},3800:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3801)},3801:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3802);__webpack_require__(3803);__webpack_require__(1439);__webpack_require__(3805);__webpack_require__(255);__webpack_require__(427);__webpack_require__(634);__webpack_require__(875);__webpack_require__(1434);__webpack_require__(3806);__webpack_require__(1435);__webpack_require__(1436);__webpack_require__(1437);__webpack_require__(1438);__webpack_require__(424);__webpack_require__(635);__webpack_require__(370);__webpack_require__(636)},3802:function(module,exports){},3803:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);__webpack_require__(425);var _index=__webpack_require__(364);var _validation_utils=__webpack_require__(631);var _parse_interval=__webpack_require__(127);var _datemath=__webpack_require__(83);var _datemath2=_interopRequireDefault(_datemath);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(68);var _check_privilege=__webpack_require__(35);var _ml_time_buckets=__webpack_require__(277);var _filter_agg_types=__webpack_require__(871);var _validate_job=__webpack_require__(629);var _adjust_interval=__webpack_require__(872);var _states=__webpack_require__(501);var _create_fields=__webpack_require__(873);var _index_utils=__webpack_require__(128);var _chart_data_utils=__webpack_require__(1432);var _check_ml_nodes=__webpack_require__(69);var _new_job_defaults=__webpack_require__(253);var _string_utils=__webpack_require__(40);var _new_job_utils=__webpack_require__(144);var _job_service=__webpack_require__(24);var _prepopulate_job_settings=__webpack_require__(874);var _create_job_service=__webpack_require__(1439);var _full_time_range_selector_service=__webpack_require__(633);var _messagebar_service=__webpack_require__(79);var _promise=__webpack_require__(89);var _create_job=__webpack_require__(3804);var _create_job2=_interopRequireDefault(_create_job);var _timefilter=__webpack_require__(14);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/jobs/new_job/simple/population",{template:_create_job2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.loadCurrentIndexPattern,savedSearch:_index_utils.loadCurrentSavedSearch,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,loadNewJobDefaults:_new_job_defaults.loadNewJobDefaults,initPromise:(0,_promise.initPromise)(true)}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlCreatePopulationJob",function($scope,$route,$timeout,Private,AppState){_timefilter.timefilter.enableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();var msgs=_messagebar_service.mlMessageBarService;var MlTimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);var moveToAdvancedJobCreation=Private(_new_job_utils.moveToAdvancedJobCreationProvider);var chartDataUtils=Private(_chart_data_utils.ChartDataUtilsProvider);var mlPopulationJobService=Private(_create_job_service.PopulationJobServiceProvider);var mlFullTimeRangeSelectorService=Private(_full_time_range_selector_service.FullTimeRangeSelectorServiceProvider);$scope.addNewJobToRecentlyAccessed=_new_job_utils.addNewJobToRecentlyAccessed;var stateDefaults={mlJobSettings:{}};var appState=new AppState(stateDefaults);mlPopulationJobService.clearChartData();$scope.chartData=mlPopulationJobService.chartData;var jobDefaults=(0,_new_job_defaults.newJobDefaults)();var PAGE_WIDTH=_angular2.default.element(".population-job-container").width();var BAR_TARGET=PAGE_WIDTH>1600?800:PAGE_WIDTH/2;var MAX_BARS=BAR_TARGET+BAR_TARGET/100*100;var REFRESH_INTERVAL_MS=100;var MAX_BUCKET_DIFF=3;var METRIC_AGG_TYPE="metrics";var DEFAULT_MODEL_MEMORY_LIMIT=jobDefaults.anomaly_detectors.model_memory_limit;var refreshCounter=0;$scope.JOB_STATE=_states.JOB_STATE;$scope.jobState=$scope.JOB_STATE.NOT_STARTED;$scope.CHART_STATE=_states.CHART_STATE;$scope.chartStates={eventRate:_states.CHART_STATE.LOADING,fields:{}};var globalForceStop=false;var _createSearchItems=(0,_new_job_utils.createSearchItems)($route),indexPattern=_createSearchItems.indexPattern,savedSearch=_createSearchItems.savedSearch,query=_createSearchItems.query,filters=_createSearchItems.filters,combinedQuery=_createSearchItems.combinedQuery;(0,_index_utils.timeBasedIndexCheck)(indexPattern,true);var pageTitle=void 0!==savedSearch.id?"saved search "+savedSearch.title:"index pattern "+indexPattern.title;$scope.ui={indexPattern:indexPattern,pageTitle:pageTitle,showJobInput:true,showJobFinished:false,dirty:false,formValid:false,bucketSpanValid:true,bucketSpanEstimator:{status:0,message:""},aggTypeOptions:(0,_filter_agg_types.filterAggTypes)(_index.aggTypes.byType[METRIC_AGG_TYPE]),fields:[],overFields:[],splitFields:[],timeFields:[],splitText:"",intervals:[{title:"Auto",value:"auto"},{title:"Millisecond",value:"ms"},{title:"Second",value:"s"},{title:"Minute",value:"m"},{title:"Hourly",value:"h"},{title:"Daily",value:"d"},{title:"Weekly",value:"w"},{title:"Monthly",value:"M"},{title:"Yearly",value:"y"},{title:"Custom",value:"custom"}],eventRateChartHeight:100,chartHeight:150,showFieldCharts:false,showAdvanced:false,validation:{checks:{jobId:{valid:true},groupIds:{valid:true},modelMemoryLimit:{valid:true},duplicateDetectors:{valid:true}}},isOverField:function isOverField(field){return field.name===$scope.formConfig.overField.name?null:field}};$scope.formConfig={agg:{type:void 0},fields:[],bucketSpan:"15m",chartInterval:void 0,resultsIntervalSeconds:void 0,start:0,end:0,overField:void 0,timeField:indexPattern.timeFieldName,influencerFields:[],firstSplitFieldName:void 0,indexPattern:indexPattern,query:query,filters:filters,combinedQuery:combinedQuery,jobId:"",description:"",jobGroups:[],useDedicatedIndex:false,modelMemoryLimit:DEFAULT_MODEL_MEMORY_LIMIT};$scope.formChange=function(refreshCardLayout){$scope.ui.isFormValid();$scope.ui.dirty=true;$scope.loadVis();refreshCardLayout&&sortSplitCards()};$scope.overChange=function(){$scope.addDefaultFieldsToInfluencerList();$scope.formChange()};$scope.splitChange=function(fieldIndex,splitField){return new Promise(function(resolve){$scope.formConfig.fields[fieldIndex].firstSplitFieldName=void 0;if(void 0!==splitField){$scope.formConfig.fields[fieldIndex].splitField=splitField;$scope.addDefaultFieldsToInfluencerList();chartDataUtils.getSplitFields($scope.formConfig,splitField.name,10).then(function(resp){if(resp.results.values&&resp.results.values.length){$scope.formConfig.fields[fieldIndex].firstSplitFieldName=resp.results.values[0];$scope.formConfig.fields[fieldIndex].cardLabels=resp.results.values}drawCards(fieldIndex,true);$scope.formChange();resolve()})}else{$scope.formConfig.fields[fieldIndex].splitField=void 0;$scope.formConfig.fields[fieldIndex].cardLabels=void 0;setFieldsChartStates(_states.CHART_STATE.LOADING);$scope.toggleInfluencerChange();$scope.ui.splitText="";destroyCards(fieldIndex);$scope.formChange();resolve()}})};$scope.splitReset=function(fieldIndex){$scope.splitChange(fieldIndex,void 0)};function setTime(){$scope.ui.bucketSpanValid=true;$scope.formConfig.start=_datemath2.default.parse(_timefilter.timefilter.getTime().from).valueOf();$scope.formConfig.end=_datemath2.default.parse(_timefilter.timefilter.getTime().to).valueOf();$scope.formConfig.format="epoch_millis";var bucketSpanInterval=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan);null!==bucketSpanInterval&&0!==bucketSpanInterval.asMilliseconds()||($scope.ui.bucketSpanValid=false);var bounds=_timefilter.timefilter.getActiveBounds();$scope.formConfig.chartInterval=new MlTimeBuckets;$scope.formConfig.chartInterval.setBarTarget(BAR_TARGET);$scope.formConfig.chartInterval.setMaxBars(MAX_BARS);$scope.formConfig.chartInterval.setInterval("auto");$scope.formConfig.chartInterval.setBounds(bounds);(0,_adjust_interval.adjustIntervalDisplayed)($scope.formConfig);$scope.ui.isFormValid();$scope.ui.dirty=true}function initAgg(){_lodash2.default.each($scope.ui.aggTypeOptions,function(agg){"Mean"===agg.title&&($scope.formConfig.agg.type=agg)})}$scope.ui.isFormValid=function(){void 0===$scope.formConfig.agg.type||void 0===$scope.formConfig.timeField||0===$scope.formConfig.fields.length?$scope.ui.formValid=false:$scope.ui.formValid=true;return $scope.ui.formValid};$scope.loadVis=function(){var thisLoadTimestamp=Date.now();$scope.chartData.lastLoadTimestamp=thisLoadTimestamp;setTime();$scope.ui.isFormValid();$scope.ui.showJobInput=true;$scope.ui.showJobFinished=false;$scope.ui.dirty=false;mlPopulationJobService.clearChartData();setFieldsChartStates(_states.CHART_STATE.LOADING);if($scope.formConfig.fields.length){$scope.ui.showFieldCharts=true;mlPopulationJobService.getLineChartResults($scope.formConfig,thisLoadTimestamp).then(function(resp){loadDocCountData(resp.detectors)}).catch(function(resp){msgs.error(resp.message);$scope.formConfig.fields.forEach(function(field){var id=field.id;$scope.chartStates.fields[id]=_states.CHART_STATE.NO_RESULTS})})}else{$scope.ui.showFieldCharts=false;loadDocCountData([])}function loadDocCountData(dtrs){chartDataUtils.loadDocCountData($scope.formConfig,$scope.chartData).then(function(resp){if(thisLoadTimestamp===$scope.chartData.lastLoadTimestamp){_lodash2.default.each(dtrs,function(dtr,id){var state=resp.totalResults?_states.CHART_STATE.LOADED:_states.CHART_STATE.NO_RESULTS;$scope.chartStates.fields[id]=state});$scope.chartData.lastLoadTimestamp=null;chartDataUtils.updateChartMargin($scope.chartData);$scope.$broadcast("render");$scope.chartStates.eventRate=resp.totalResults?_states.CHART_STATE.LOADED:_states.CHART_STATE.NO_RESULTS}}).catch(function(resp){$scope.chartStates.eventRate=_states.CHART_STATE.NO_RESULTS;msgs.error(resp.message)})}};function setFieldsChartStates(state){_lodash2.default.each($scope.chartStates.fields,function(chart,key){$scope.chartStates.fields[key]=state})}function drawCards(fieldIndex){var animate=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];var labels=$scope.formConfig.fields[fieldIndex].cardLabels;var $frontCard=_angular2.default.element(".population-job-container .detector-container.card-"+fieldIndex+" .card-front");$frontCard.addClass("card");$frontCard.find(".card-title").text(labels[0]);var marginTop=labels.length>1?54:0;$frontCard.css("margin-top",marginTop);var backCardTitle="";if(2===labels.length){backCardTitle=$scope.formConfig.fields[Object.keys($scope.formConfig.fields)[0]].agg.type.title;backCardTitle+=" ";backCardTitle+=Object.keys($scope.formConfig.fields)[0]}_angular2.default.element(".detector-container.card-"+fieldIndex+" .card-behind").remove();for(var _i=0;_i<labels.length;_i++){var el='<div class="card card-behind card-behind-'+_i+'"><div class="card-title">';el+=(0,_string_utils.mlEscape)(labels[_i]);el+='</div><label class="kuiFormLabel">';el+=(0,_string_utils.mlEscape)(backCardTitle);el+="</label></div>";var $backCard=_angular2.default.element(el);$backCard.css("z-index",9-_i);$backCard.insertBefore($frontCard)}var cardsBehind=_angular2.default.element(".detector-container.card-"+fieldIndex+" .card-behind");for(var _i2=0;_i2<cardsBehind.length;_i2++){cardsBehind[_i2].style.marginTop=marginTop+"px";marginTop-=(10-_i2*(10/labels.length))*(10/labels.length)}var i=0;var then=window.performance.now();var fps=20;var fpsInterval=1e3/fps;function fadeCard(callTime){if(i<cardsBehind.length){var now=callTime;var elapsed=now-then;if(elapsed>fpsInterval){cardsBehind[i].style.opacity=1;i++;then=now-elapsed%fpsInterval}window.requestAnimationFrame(fadeCard)}}if(animate)fadeCard();else for(var j=0;j<cardsBehind.length;j++)cardsBehind[j].style.opacity=1}function destroyCards(fieldIndex){_angular2.default.element(".detector-container.card-"+fieldIndex+" .card-behind").remove();var $frontCard=_angular2.default.element(".population-job-container .detector-container.card-"+fieldIndex+" .card-front");$frontCard.removeClass("card");$frontCard.find(".card-title").text("");$frontCard.css("margin-top",0)}function sortSplitCards(){$timeout(function(){$scope.formConfig.fields.forEach(function(f,i){void 0===f.splitField?destroyCards(i):drawCards(i,false)})},0)}var refreshInterval=REFRESH_INTERVAL_MS;$scope.createJob=function(){var tempJob=mlPopulationJobService.getJobFromConfig($scope.formConfig);if((0,_validate_job.validateJob)(tempJob,$scope.ui.validation.checks)){msgs.clear();mlPopulationJobService.createJob($scope.formConfig).then(function(job){_job_service.mlJobService.openJob(job.job_id).then(function(){saveNewDatafeed(job,true)}).catch(function(resp){msgs.error("Could not open job: ",resp);msgs.error("Job created, creating datafeed anyway");saveNewDatafeed(job,false)})}).catch(function(resp){msgs.error("Save failed: ",resp.resp)})}else false===$scope.ui.validation.checks.modelMemoryLimit.valid&&($scope.ui.showAdvanced=true);function saveNewDatafeed(job,startDatafeedAfterSave){_job_service.mlJobService.saveNewDatafeed(job.datafeed_config,job.job_id).then(function(){startDatafeedAfterSave&&mlPopulationJobService.startDatafeed($scope.formConfig).then(function(){$scope.jobState=_states.JOB_STATE.RUNNING;refreshCounter=0;refreshInterval=REFRESH_INTERVAL_MS;$scope.formConfig.resultsIntervalSeconds=$scope.formConfig.chartInterval.getInterval().asSeconds();var bucketSpanSeconds=(0,_parse_interval.parseInterval)($scope.formConfig.bucketSpan).asSeconds();$scope.formConfig.resultsIntervalSeconds<bucketSpanSeconds&&($scope.formConfig.resultsIntervalSeconds=bucketSpanSeconds);$scope.resultsUrl=_job_service.mlJobService.createResultsUrl([$scope.formConfig.jobId],$scope.formConfig.start,$scope.formConfig.end,"explorer");loadCharts()}).catch(function(resp){msgs.error("Could not start datafeed: ",resp)})}).catch(function(resp){msgs.error("Save datafeed failed: ",resp)})}};(0,_validation_utils.addJobValidationMethods)($scope,mlPopulationJobService);function loadCharts(){var forceStop=globalForceStop;var counterLimit=20-refreshInterval/REFRESH_INTERVAL_MS;if(refreshCounter>=counterLimit){refreshCounter=0;_job_service.mlJobService.updateSingleJobDatafeedState($scope.formConfig.jobId).then(function(state){if("stopped"===state){console.log("Stopping poll because datafeed state is: "+state);$scope.$broadcast("render-results");forceStop=true}run()})}else run();function run(){refreshCounter++;reloadJobSwimlaneData().then(function(){reloadDetectorSwimlane().then(function(){false===forceStop&&$scope.chartData.percentComplete<100?$scope.jobState===_states.JOB_STATE.STOPPING?$scope.jobState=_states.JOB_STATE.STOPPING:$scope.jobState=_states.JOB_STATE.RUNNING:$scope.jobState=_states.JOB_STATE.FINISHED;jobCheck()})})}}function jobCheck(){if($scope.jobState===_states.JOB_STATE.RUNNING||$scope.jobState===_states.JOB_STATE.STOPPING){refreshInterval=adjustRefreshInterval($scope.chartData.loadingDifference,refreshInterval);_lodash2.default.delay(loadCharts,refreshInterval)}else _lodash2.default.each($scope.chartData.detectors,function(chart){chart.percentComplete=100});$scope.chartData.percentComplete>0&&toggleSwimlaneVisibility();$scope.$broadcast("render-results")}function reloadJobSwimlaneData(){return chartDataUtils.loadJobSwimlaneData($scope.formConfig,$scope.chartData)}function reloadDetectorSwimlane(){return chartDataUtils.loadDetectorSwimlaneData($scope.formConfig,$scope.chartData)}function adjustRefreshInterval(loadingDifference,currentInterval){var INTERVAL_INCREASE_MS=100;var MAX_INTERVAL=1e4;var interval=currentInterval;interval<MAX_INTERVAL&&(loadingDifference<MAX_BUCKET_DIFF?interval+=INTERVAL_INCREASE_MS:interval-INTERVAL_INCREASE_MS>=REFRESH_INTERVAL_MS&&(interval-=INTERVAL_INCREASE_MS));return interval}$scope.resetJob=function(){$scope.jobState=_states.JOB_STATE.NOT_STARTED;toggleSwimlaneVisibility();window.setTimeout(function(){$scope.ui.showJobInput=true;$scope.loadVis()},500)};function toggleSwimlaneVisibility(){if($scope.jobState===_states.JOB_STATE.NOT_STARTED){_angular2.default.element(".swimlane-cells").css("opacity",0);_angular2.default.element(".bar").css("opacity",1)}else _angular2.default.element(".bar").css("opacity",.1)}$scope.stopJob=function(){$scope.jobState=_states.JOB_STATE.STOPPING;mlPopulationJobService.stopDatafeed($scope.formConfig)};$scope.moveToAdvancedJobCreation=function(){var job=mlPopulationJobService.getJobFromConfig($scope.formConfig);moveToAdvancedJobCreation(job)};$scope.setFullTimeRange=function(){return mlFullTimeRangeSelectorService.setFullTimeRange($scope.ui.indexPattern,$scope.formConfig.combinedQuery)};initAgg();(0,_create_fields.createFields)($scope,indexPattern);$scope.loadVis();$scope.$evalAsync(function(){(0,_prepopulate_job_settings.preLoadJob)($scope,appState)});$scope.$listenAndDigestAsync(_timefilter.timefilter,"fetch",$scope.loadVis);$scope.$on("$destroy",function(){globalForceStop=true;_angular2.default.element(window).off("resize")})})},3804:function(module,exports){module.exports='<ml-nav-menu name="new_job_population"></ml-nav-menu>\n<ml-chart-tooltip></ml-chart-tooltip>\n<ml-new-job-population>\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlCreatePopulationJob" class="population-job-container">\n    <div class="row">\n      <div class="col-md-6">\n        <h3 class="euiTitle euiTitle--large">New job from {{ui.pageTitle}}</h3>\n      </div>\n      <div class="col-md-6">\n        <div class="pull-right">\n          <span style="font-size:10px;" ng-show="formConfig.chartInterval !== undefined">Chart interval: {{formConfig.chartInterval.getInterval().expression}}</span>\n          <ml-full-time-range-selector\n            disabled=\'(jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)\'\n            index-pattern=\'ui.indexPattern\'\n            query=\'formConfig.combinedQuery\'\n          ></ml-full-time-range-selector>\n        </div>\n      </div>\n    </div>\n\n    <div class="euiSpacer euiSpacer--s"></div>\n\n    <div class="row">\n      <div class="col-md-4">\n        <div class="row form-controls">\n          <h4 class="euiTitle euiTitle--small">Job settings</h4>\n          <div>\n            <div class=\'form-section form-section-overflow\' >\n              <h4 class="euiTitle euiTitle--small">Population</h4>\n              <div class="euiSpacer euiSpacer--s"></div>\n              <div class="row">\n                <div class="col-md-12">\n                  <div class="form-group">\n                    <ui-select\n                      ng-model="formConfig.overField"\n                      on-select="overChange()"\n                      ng-disabled="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                      append-to-body=true>\n                      <ui-select-match placeholder="Select population field">\n                        <ml-field-type-icon type="$select.selected.mlType"></ml-field-type-icon>{{$select.selected.name}}\n                      </ui-select-match>\n                      <ui-select-choices repeat="field in ui.overFields | filter: { name: $select.search }" group-by="\'mlType\'">\n                        <div>\n                          <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n                          <span\n                            class="select-item"\n                            ng-bind-html="field.name | highlight: $select.search">\n                          </span>\n                        </div>\n                      </ui-select-choices>\n                    </ui-select>\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div class=\'form-section form-section-overflow\'>\n              <ml-fields-selection-population></ml-fields-selection-population>\n              <div ng-hide="ui.validation.checks.duplicateDetectors.valid" class="validation-error">{{ ui.validation.checks.duplicateDetectors.message }}</div>\n            </div>\n\n            \x3c!-- <div class=\'form-section\' >\n              <h4 class="euiTitle euiTitle--small">Split Data</h4>\n              <div class="row">\n                <div class="col-md-12">\n                  <div class="form-group">\n                    <select\n                      ng-model="formConfig.splitField"\n                      ng-change="splitChange()"\n                      ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                      class="form-control">\n                        <option value=\'{{undefined}}\'>--No split--</option>\n                        <option ng-repeat="field in ui.splitFields" value=\'{{field}}\'>{{field}}</option>\n                    </select>\n                  </div>\n                </div>\n              </div>\n            </div> --\x3e\n\n            <div class=\'form-section\' >\n              <ml-influencers-selection></ml-influencers-selection>\n            </div>\n\n            <div class=\'form-section\' >\n              <ml-bucket-span-selection></ml-bucket-span-selection>\n            </div>\n\n            <div class=\'form-section\' >\n              <div ng-show="jobState !== JOB_STATE.FINISHED">\n                <h4 class="euiTitle euiTitle--small">Job Details</h4>\n                <div class="euiSpacer euiSpacer--s"></div>\n              </div>\n\n              <div class="form-group">\n                <div ng-show="ui.showJobInput && (jobState === JOB_STATE.NOT_STARTED || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING)">\n                  <ml-general-job-details></ml-general-job-details>\n\n                  <div class="form-group">\n                    <a href="" ng-click="moveToAdvancedJobCreation()">Move to advanced job configuration</a>\n                  </div>\n\n                  <div class="euiFlexGroup euiFlexGroup--gutterSmall euiFlexGroup--alignItemsCenter euiFlexGroup--responsive">\n                    <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                      <ml-validate-job\n                        get-duration="getDuration"\n                        get-job-config="getJobConfig"\n                        fill="false"\n                        is-current-job-config="isCurrentJobConfig"\n                        is-disabled="!ui.formValid"\n                        ng-show="jobState === JOB_STATE.NOT_STARTED"\n                      />\n                    </div>\n                    <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                      <button\n                        aria-label="Create Job"\n                        ng-click="createJob()"\n                        type="button"\n                        ng-show="jobState === JOB_STATE.NOT_STARTED"\n                        ng-disabled="!ui.formValid"\n                        class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                        <span class="euiButton__content">\n                          Create Job\n                        </span>\n                      </button>\n                    </div>\n                  </div>\n\n                  <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.RUNNING">Analysis running <i class=\'fa fa-spinner fa-spin\'></i></div>\n                  <div class=\'job-state-info\' ng-show="jobState === JOB_STATE.STOPPING">Analysis stopping <i class=\'fa fa-spinner fa-spin\'></i></div>\n\n                  <div class="euiSpacer euiSpacer--s"></div>\n\n                  <button\n                    aria-label="Stop Job"\n                    ng-click="stopJob()"\n                    type="button"\n                    ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n                    ng-disabled="jobState === JOB_STATE.STOPPING"\n                    class="euiButton euiButton--danger euiButton--small">\n                    <span class="euiButton__content">\n                      {{(jobState === JOB_STATE.STOPPING) ? \'Analysis stopping\' : \'Stop analysis\' }}\n                    </span>\n                  </button>\n\n                  <a\n                    href=\'{{resultsUrl}}\'\n                    ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n                    aria-label="View Results"\n                    ng-show="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      View Results\n                    </span>\n                  </a>\n                </div>\n                <div ng-show="jobState === JOB_STATE.FINISHED">\n                  <h3 class="euiTitle euiTitle--large">Job {{formConfig.jobId }} created\n                    <i style="color:green;" class="fa fa-check" aria-label="Saved"></i>\n                  </h3>\n                  <div class="euiSpacer euiSpacer--m"></div>\n\n                  <button\n                    aria-label="Reset"\n                    ng-click="resetJob()"\n                    type="button"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      Reset\n                    </span>\n                  </button>\n                  <a\n                    href=\'{{resultsUrl}}\'\n                    ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n                    aria-label="View Results"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      View Results\n                    </span>\n                  </a>\n                </div>\n\n                <div ng-if=\'jobState === JOB_STATE.FINISHED\'>\n                  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium">\n                  <ml-post-save-options\n                    job-id=\'formConfig.jobId\'\n                    bucket-span=\'formConfig.bucketSpan\'\n                    include-influencers=\'true\'\n                    ></ml-post-save-options>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="col-md-8">\n        <div class="row charts-container">\n          <h4 class="euiTitle euiTitle--small">Results</h4>\n          <div>\n            <div class=\'chart-list-panel event-rate-container\' style=\'height: {{ui.eventRateChartHeight + 70}}px;\'>\n              <label class="kuiFormLabel">Document count</label>\n\n              <div class=\'chart-container\'>\n                <div style=\'height: {{ui.eventRateChartHeight + 25}}px;\'>\n                  <ml-event-rate-chart\n                    chart-data="chartData.job"\n                    event-rate-chart-height=\'ui.eventRateChartHeight\'\n                    chart-ticks-margin="chartData.chartTicksMargin">\n                  </ml-event-rate-chart>\n                </div>\n\n                <div ng-show="chartStates.eventRate === CHART_STATE.NOT_STARTED || chartStates.eventRate === CHART_STATE.LOADING || chartStates.eventRate === CHART_STATE.NO_RESULTS"\n                  class=\'chart-loader event-rate-chart-loader\'\n                  style=\'height: {{ui.eventRateChartHeight}}px; margin-top: -{{ui.eventRateChartHeight + 30}}px;\'>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.NOT_STARTED"></div>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.LOADING">\n                      <h2 class="euiTitle euiTitle"><i class=\'fa fa-spinner fa-spin\'></i></h2>\n                    </div>\n                    <div class=\'status-label\' ng-if="chartStates.eventRate === CHART_STATE.NO_RESULTS">\n                      <div class=\'no-results\'>\n                        <h4 class="euiTitle euiTitle--small"><i class="fa fa-info-circle"></i> No results found</h4>\n                        <span>Consider using the <a ng-click="setFullTimeRange()">full {{ui.indexPattern.title}} data</a></span>\n                      </div>\n                    </div>\n                </div>\n\n              </div>\n\n            </div>\n            <div ng-repeat=\'(id, chart) in chartData.detectors track by id\'>\n              <div class=\'chart-list-panel detector-container card-{{id}}\' ng-show=\'ui.showFieldCharts\'>\n                <div class=\'card-front\'>\n                  <div class="card-title"></div>\n                  <div class=\'chart\' style=\'height: {{ui.chartHeight + 90}}px;\'>\n                    <label class="kuiFormLabel">{{formConfig.fields[id].agg.type.title}} {{formConfig.fields[id].name}} over {{formConfig.overField.name}} <span ng-if="formConfig.fields[id].splitField!==undefined"> split by {{formConfig.fields[id].splitField.name}}</span></label>\n                    <div class="split-controls">\n                      <div class="split-align">Split data: </div>\n                      <div class="split-field-container">\n                        <ui-select\n                          class="split-field-select"\n                          ng-model="formConfig.fields[id].splitField"\n                          ng-change="splitChange(id, $select.selected)"\n                          append-to-body="true"\n                          ng-disabled="ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                        >\n                            <ui-select-match placeholder="Select a field">\n                              <ml-field-type-icon type="$select.selected.mlType"></ml-field-type-icon>{{$select.selected.name}}\n                            </ui-select-match>\n                            <ui-select-choices repeat="field in ui.splitFields | filter: { name: $select.search } | filter: ui.isOverField" group-by="\'mlType\'">\n                              <div>\n                                <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n                                <span\n                                  class="select-item"\n                                  ng-bind-html="field.name | highlight: $select.search">\n                                </span>\n                              </div>\n                            </ui-select-choices>\n                        </ui-select>\n                      </div>\n                      <button\n                        ng-if="formConfig.fields[id].splitField !== undefined && (!ui.formValid === false || jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED)"\n                        ng-click="splitReset(id)"\n                        aria-label="Remove split"\n                        ng-disabled="jobState === JOB_STATE.RUNNING || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                        class="euiButton euiButton--primary euiButton--small split-align remove-split"\n                      >\n                        Remove split\n                      </button>\n                    </div>\n\n                    <div class=\'chart-container\'>\n                      <div style=\'height: {{ui.chartHeight + 25}}px;\'>\n                        <ml-population-job-chart\n                          chart-data="chart"\n                          chart-height=\'ui.chartHeight\'\n                          chart-ticks-margin="chartData.chartTicksMargin"\n                          over-field-name="formConfig.overField.name">\n                        </ml-population-job-chart>\n                      </div>\n\n                      <div ng-show="chartStates.fields[id] === CHART_STATE.NOT_STARTED || chartStates.fields[id] === CHART_STATE.LOADING || chartStates.fields[id] === CHART_STATE.NO_RESULTS"\n                        class=\'chart-loader fields-chart-loader\'\n                        style=\'height: {{ui.chartHeight}}px; margin-top: -{{ui.chartHeight + 30}}px; margin-left: {{chartData.chartTicksMargin.width - 1}}px;\'>\n                          <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.NOT_STARTED"></div>\n                          <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.LOADING">\n                            <h2 class="euiTitle euiTitle"><i class=\'fa fa-spinner fa-spin\'></i></h2>\n                          </div>\n                          <div class=\'status-label\' ng-show="chartStates.fields[id] === CHART_STATE.NO_RESULTS">\n                            <div class=\'no-results\'>\n                              <h4 class="euiTitle euiTitle--small"><i class="fa fa-info-circle"></i> No results found</h4>\n                            </div>\n                          </div>\n                      </div>\n\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</ml-new-job-population>\n'},3805:function(module,exports,__webpack_require__){"use strict";var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _d=__webpack_require__(19);var _d2=_interopRequireDefault(_d);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _time_buckets=__webpack_require__(273);var _chart_utils=__webpack_require__(256);var _string_utils=__webpack_require__(40);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlPopulationJobChart",function(mlChartTooltipService){function link(scope,element){var svgWidth=0;var chartHeight=scope.chartHeight;var margin={top:0,right:0,bottom:20,left:scope.chartTicksMargin.width};var svgHeight=chartHeight+margin.top+margin.bottom;var vizWidth=svgWidth-margin.left-margin.right;var chartLimits={max:0,min:0};var chartXScale=null;var chartYScale=null;var chartGroup=void 0;var swimlaneGroup=void 0;var $progressBar=void 0;scope.$on("render",function(){init();createSVGGroups();drawChart()});scope.$on("render-results",function(){drawResults()});element.on("$destroy",function(){scope.$destroy()});function init(){var $el=_angular2.default.element(".population-job-container .card-front");var offset=$el.hasClass("card")?30:0;margin.left=scope.chartTicksMargin.width;svgWidth=$el.width()-offset;vizWidth=svgWidth-margin.left-margin.right;chartXScale=_d2.default.time.scale().range([0,vizWidth]);chartYScale=_d2.default.scale.linear().range([chartHeight,0])}function createSVGGroups(){if(void 0===scope.chartData.line)return;var chartElement=_d2.default.select(element.get(0));chartElement.select("svg").remove();chartElement.select(".progress").remove();if(null===chartElement.select(".progress-bar")[0][0]){var style="width: "+(+vizWidth+2)+"px;\n          margin-bottom: -"+(+chartHeight-15)+"px;\n          margin-left: "+(+margin.left-1)+"px;'";chartElement.append("div").attr("class","progress").attr("style",style).append("div").attr("class","progress-bar")}$progressBar=(0,_jquery2.default)(".progress-bar");var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);swimlaneGroup=svg.append("g").attr("class","swimlane").attr("transform","translate("+margin.left+", "+margin.top+")");chartGroup=svg.append("g").attr("class","line-chart").attr("transform","translate("+margin.left+", "+margin.top+")")}function drawChart(){if(0===scope.chartData.line.length)return;var data=scope.chartData.line.reduce(function(p,c){c.values.length?c.values.forEach(function(v){p.push({date:c.date,value:v.value,label:v.label})}):p.push({date:c.date,value:null,label:null});return p},[]);chartXScale=chartXScale.domain(_d2.default.extent(data,function(d){return d.date}));chartLimits.max=_d2.default.max(data,function(d){return d.value});chartLimits.min=_d2.default.min(data,function(d){return d.value});var padding=.05*(chartLimits.max-chartLimits.min);chartLimits.max+=padding;chartLimits.min-=padding;chartYScale=chartYScale.domain([chartLimits.min,chartLimits.max]);var timeBuckets=new _time_buckets.TimeBuckets;timeBuckets.setInterval("auto");if(data.length>0){var xDomain=chartXScale.domain();var bounds={min:(0,_moment2.default)(xDomain[0]),max:(0,_moment2.default)(xDomain[1])};timeBuckets.setBounds(bounds)}var xAxisTickFormat=timeBuckets.getScaledDateFormat();var xAxis=_d2.default.svg.axis().scale(chartXScale).orient("bottom").innerTickSize(-chartHeight).outerTickSize(0).tickPadding(10).ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)});var yAxis=_d2.default.svg.axis().scale(chartYScale).orient("left").innerTickSize(-vizWidth).outerTickSize(0).tickPadding(10);void 0!==scope.chartData.fieldFormat&&yAxis.tickFormat(function(d){return scope.chartData.fieldFormat.convert(d,"text")});swimlaneGroup.append("rect").attr("x",0).attr("y",0).attr("height",chartHeight).attr("width",vizWidth).style("fill","#FFFFFF");chartGroup.append("rect").attr("x",0).attr("y",0).attr("height",chartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1);drawChartAxes(xAxis,yAxis);drawChartDots(data)}function drawChartAxes(xAxis,yAxis){var axes=chartGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0, "+chartHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis)}function drawChartDots(data){var dotGroup=chartGroup.append("g").classed("values-dots",true);dotGroup.selectAll("circle").data(data).enter().append("circle").attr("cx",function(d){return chartXScale(d.date)}).attr("cy",function(d){return chartYScale(d.value)}).attr("r",3).style("display",function(d){return null===d.value?"none":"auto"}).on("mouseover",function(d){showTooltip(d,this)}).on("mouseout",function(){return mlChartTooltipService.hide()})}function showTooltip(data,el){scope;var contents="";var formattedDate=(0,_moment2.default)(data.date).format("MMMM Do YYYY, HH:mm");contents+=formattedDate+"<br/><hr/>";contents+=(0,_string_utils.mlEscape)(scope.overFieldName)+": "+(0,_string_utils.mlEscape)(data.label)+"<br/>";void 0!==scope.chartData.fieldFormat?contents+="Value: "+scope.chartData.fieldFormat.convert(data.value,"text"):contents+="Value: "+parseInt(data.value);mlChartTooltipService.show(contents,el,{x:5,y:10})}function drawResults(){drawSwimlane(vizWidth,chartHeight);updateProgressBar()}function drawSwimlane(swlWidth,swlHeight){var data=scope.chartData.swimlane;var cellWidth=0;data.length>0&&(cellWidth=chartXScale(data[0].time+scope.chartData.swimlaneInterval)-chartXScale(data[0].time));_d2.default.time.scale().range([0,swlWidth]).domain(_d2.default.extent(data,function(d){return d.date}));_d2.default.scale.linear().range([swlHeight,0]).domain([0,swlHeight]);var color=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#d2e9f7","#8bc8fb","#ffdd00","#ff7e00","#fe5050"]);swimlaneGroup.select(".swimlane-cells").remove();var cells=swimlaneGroup.append("g").attr("class","swimlane-cells").selectAll("cells").data(data);cells.enter().append("rect").attr("x",function(d){return chartXScale(d.date)}).attr("y",0).attr("rx",0).attr("ry",0).attr("class",function(d){return d.value>0?"swimlane-cell":"swimlane-cell-hidden"}).attr("width",cellWidth-0).attr("height",swlHeight-0).style("fill",function(d){return color(d.value)})}function updateProgressBar(){var pcnt=scope.chartData.percentComplete<100?scope.chartData.percentComplete:0;$progressBar.css("width",pcnt+"%")}}return{scope:{chartData:"=",chartHeight:"=",chartTicksMargin:"=",overFieldName:"="},link:link}})},3806:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3807);__webpack_require__(3809);__webpack_require__(370)},3807:function(module,exports,__webpack_require__){"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var _states=__webpack_require__(501);var _general=__webpack_require__(300);var _fields_selection=__webpack_require__(3808);var _fields_selection2=_interopRequireDefault(_fields_selection);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlFieldsSelectionPopulation",function(){return{restrict:"E",replace:true,template:_fields_selection2.default,controller:function controller($scope){$scope.eventRateSelected=false;$scope.tempSelectedField={field:void 0};$scope.selectField=function(){$scope.addField()};$scope.addField=function(){if(false===$scope.eventRateSelected||true===$scope.eventRateSelected&&$scope.tempSelectedField.field.id!==_general.EVENT_RATE_COUNT_FIELD){var field=_extends({},$scope.tempSelectedField.field,{agg:{type:$scope.tempSelectedField.field.agg.type}});$scope.formConfig.fields.push(field);$scope.chartStates.fields[field.id]=_states.CHART_STATE.LOADING;$scope.sortFields();$scope.formChange(true)}$scope.tempSelectedField.field=void 0};$scope.removeField=function(index,field){$scope.formConfig.fields.splice(index,1);delete $scope.chartStates.fields[field.id];$scope.sortFields();$scope.formChange(true)};$scope.sortFields=function(){$scope.eventRateSelected=false;var eventRateIndex=-1;$scope.formConfig.fields.forEach(function(f,i){if(f.id===_general.EVENT_RATE_COUNT_FIELD){eventRateIndex=i;$scope.eventRateSelected=true}});eventRateIndex>=0&&$scope.formConfig.fields.splice(0,0,$scope.formConfig.fields.splice(eventRateIndex,1)[0])}}}})},3808:function(module,exports){module.exports='<div class=\'fields-selection-population\'>\n  <h4 class="euiTitle euiTitle--small">Fields</h4>\n  <div class="euiSpacer euiSpacer--s"></div>\n  <div class="row">\n    <div class="col-md-12">\n      <div class="form-group">\n        <div class="field-select-container">\n          <ui-select\n            ng-model="tempSelectedField.field"\n            on-select="selectField()"\n            ng-disabled="formConfig.overField === undefined || jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n            append-to-body=true>\n            <ui-select-match placeholder="Add field">\n                <ml-field-type-icon type="$select.selected.mlType"></ml-field-type-icon>{{$select.selected.name}}\n            </ui-select-match>\n            <ui-select-choices repeat="field in ui.fields | filter: { name: $select.search }" group-by="\'mlType\'">\n              <ml-field-type-icon type="field.mlType"></ml-field-type-icon>\n              <span class="select-item" ng-bind-html="field.name | highlight: $select.search"></span>\n            </ui-select-choices>\n          </ui-select>\n\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div class="row" ng-show="formConfig.fields.length > 0">\n    <div class="col-md-12">\n      <div class="form-group">\n\n        <div class=\'selection-list-container fields-list\'>\n          <div class="checkbox field-row" ng-repeat="field in formConfig.fields track by $index">\n            <div class=\'field kuiCheckBoxLabel kuiVerticalRhythm\'>\n              <span\n                class=\'kuiCheckBoxLabel__text\'\n                tooltip=\'{{field.tooltip}}\'\n                tooltip-append-to-body="true">\n                {{field.name}}\n              </span>\n            </div>\n            <div>\n              <div class="agg-type">\n                <div class="agg-type-select-wrapper">\n                  <select\n                    class="form-control agg-type-select"\n                    ng-model="field.agg.type"\n                    ng-options="agg as agg.title for agg in ui.aggTypeOptions | filterAggTypes:field"\n                    ng-change="formChange()"\n                    ng-disabled="formConfig.fields[$index] === undefined || jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED">\n                  </select>\n                </div>\n                <button\n                  aria-label="Remove Detector"\n                  ng-click="removeField($index, field)"\n                  tooltip-append-to-body="true"\n                  ng-disabled="formConfig.fields[$index] === undefined || jobState === JOB_STATE.RUNNING  || jobState === JOB_STATE.STOPPING || jobState === JOB_STATE.FINISHED"\n                  type="button"\n                  class="euiButton euiButton--danger euiButton--small remove-button">\n                    <i aria-hidden="true" class="fa fa-trash"></i>\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'},3809:function(module,exports){},3810:function(module,exports,__webpack_require__){"use strict";var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _chart_tooltip=__webpack_require__(3811);var _chart_tooltip2=_interopRequireDefault(_chart_tooltip);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlChartTooltip",function(mlChartTooltipService){return{restrict:"E",replace:true,template:_chart_tooltip2.default,link:function link(scope,element){mlChartTooltipService.element=element}}}).service("mlChartTooltipService",function($timeout){this.element=null;this.fadeTimeout=null;var doc=document.documentElement;var FADE_TIMEOUT_MS=200;this.show=function(contents,target){var offset=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{x:0,y:0};if(null!==this.element){null!==this.fadeTimeout&&$timeout.cancel(this.fadeTimeout);this.element.html(contents);var navOffset=(0,_jquery2.default)(".global-nav").width();var contentWidth=(0,_jquery2.default)("body").width()-navOffset-10;var tooltipWidth=this.element.width();var scrollTop=(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0);var pos=target.getBoundingClientRect();var x=pos.left+offset.x+4-navOffset;var y=pos.top+offset.y+scrollTop;x+tooltipWidth>contentWidth?this.element.css({left:x-(tooltipWidth+offset.x+22),top:y-28}):this.element.css({left:x,top:y-28});this.element.css({opacity:"0.9",display:"block"})}};this.hide=function(){var _this=this;if(null!==this.element){this.element.css({opacity:"0"});this.fadeTimeout=$timeout(function(){_this.element.css("display","none");_this.fadeTimeout=null},FADE_TIMEOUT_MS)}}})},3811:function(module,exports){module.exports='<div class="ml-chart-tooltip euiText"></div>\n'},3812:function(module,exports){},3813:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3814)},3814:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3815);__webpack_require__(3816);__webpack_require__(1440);__webpack_require__(427);__webpack_require__(424)},3815:function(module,exports){},3816:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _datemath=__webpack_require__(83);var _datemath2=_interopRequireDefault(_datemath);var _job_utils=__webpack_require__(41);var _new_job_utils=__webpack_require__(144);__webpack_require__(425);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(68);var _check_privilege=__webpack_require__(35);var _index_utils=__webpack_require__(128);var _check_ml_nodes=__webpack_require__(69);var _job_service=__webpack_require__(24);var _create_job_service=__webpack_require__(1440);var _messagebar_service=__webpack_require__(79);var _ml_api_service=__webpack_require__(23);var _promise=__webpack_require__(89);var _create_job=__webpack_require__(3817);var _create_job2=_interopRequireDefault(_create_job);var _timefilter=__webpack_require__(14);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/jobs/new_job/simple/recognize",{template:_create_job2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.loadCurrentIndexPattern,savedSearch:_index_utils.loadCurrentSavedSearch,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,initPromise:(0,_promise.initPromise)(true)}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlCreateRecognizerJobs",function($scope,$window,$route,Private){var mlCreateRecognizerJobsService=Private(_create_job_service.CreateRecognizerJobsServiceProvider);_timefilter.timefilter.disableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();var msgs=_messagebar_service.mlMessageBarService;var SAVE_STATE={NOT_SAVED:0,SAVING:1,SAVED:2,FAILED:3,PARTIAL_FAILURE:4};var DATAFEED_STATE={NOT_STARTED:0,STARTING:1,STARTED:2,FINISHED:3,STOPPING:4,FAILED:5};$scope.addNewJobToRecentlyAccessed=_new_job_utils.addNewJobToRecentlyAccessed;$scope.SAVE_STATE=SAVE_STATE;$scope.DATAFEED_STATE=DATAFEED_STATE;$scope.overallState=SAVE_STATE.NOT_SAVED;var moduleId=$route.current.params.id;$scope.moduleId=moduleId;var _createSearchItems=(0,_new_job_utils.createSearchItems)($route),indexPattern=_createSearchItems.indexPattern,savedSearch=_createSearchItems.savedSearch,query=_createSearchItems.query,combinedQuery=_createSearchItems.combinedQuery;var pageTitle=void 0!==savedSearch.id?"saved search "+savedSearch.title:"index pattern "+indexPattern.title;$scope.displayQueryWarning=void 0!==savedSearch.id;$scope.ui={formValid:true,indexPattern:indexPattern,pageTitle:pageTitle,showJobInput:true,numberOfJobs:0,kibanaLabels:{dashboard:"Dashboards",search:"Searches",visualization:"Visualizations"},validation:{checks:{jobLabel:{valid:true},groupIds:{valid:true}}}};$scope.formConfig={indexPattern:indexPattern,jobLabel:"",jobGroups:[],jobs:[],kibanaObjects:{},start:0,end:0,query:query,filters:[],useFullIndexData:true,startDatafeedAfterSave:true};$scope.resultsUrl="";$scope.resetJob=function(){$scope.overallState=SAVE_STATE.NOT_SAVED;$scope.formConfig.jobs=[];$scope.formConfig.filters=[];$scope.formConfig.kibanaObjects={};loadJobConfigs()};function loadJobConfigs(){_ml_api_service.ml.getDataRecognizerModule({moduleId:moduleId}).then(function(resp){if(resp.jobs&&resp.jobs.length){var tempGroups={};resp.jobs.forEach(function(job){$scope.formConfig.jobs.push({id:job.id,jobConfig:job.config,jobState:SAVE_STATE.NOT_SAVED,datafeedId:null,datafeedConfig:{},datafeedState:SAVE_STATE.NOT_SAVED,runningState:DATAFEED_STATE.NOT_STARTED,errors:[]});$scope.ui.numberOfJobs++;job.config.groups&&job.config.groups.length&&job.config.groups.forEach(function(group){tempGroups[group]=null})});$scope.formConfig.jobGroups=Object.keys(tempGroups);resp.datafeeds.forEach(function(datafeed){var job=_lodash2.default.find($scope.formConfig.jobs,{id:datafeed.config.job_id});if(void 0!==job){var datafeedId=_job_service.mlJobService.getDatafeedId(job.id);job.datafeedId=datafeedId;job.datafeedConfig=datafeed.config}})}if(resp.kibana){_lodash2.default.each(resp.kibana,function(obj,key){$scope.formConfig.kibanaObjects[key]=obj.map(function(o){return{id:o.id,title:o.title,saveState:SAVE_STATE.NOT_SAVED,config:o.config,exists:false}})});checkIfKibanaObjectsExist($scope.formConfig.kibanaObjects)}})}$scope.changeUseFullIndexData=function(){var shouldEnableTimeFilter=!$scope.formConfig.useFullIndexData;shouldEnableTimeFilter?_timefilter.timefilter.enableTimeRangeSelector():_timefilter.timefilter.disableTimeRangeSelector();$scope.$applyAsync()};$scope.changeJobLabelCase=function(){$scope.formConfig.jobLabel=$scope.formConfig.jobLabel.toLowerCase()};$scope.save=function(){if(validateJobs()){msgs.clear();$scope.overallState=SAVE_STATE.SAVING;_angular2.default.element(".results").css("opacity",1);window.setTimeout(function(){saveDataRecognizerItems().then(function(){$scope.formConfig.startDatafeedAfterSave?startDatafeeds().then(function(){$scope.setOverallState()}).catch(function(){$scope.setOverallState()}):$scope.setOverallState()})},500)}};function saveDataRecognizerItems(){return new Promise(function(resolve){setAllToSaving();var prefix=$scope.formConfig.jobLabel;var indexPatternName=$scope.formConfig.indexPattern.title;var groups=$scope.formConfig.jobGroups;var tempQuery=void 0===savedSearch.id?void 0:combinedQuery;_ml_api_service.ml.setupDataRecognizerConfig({moduleId:moduleId,prefix:prefix,groups:groups,query:tempQuery,indexPatternName:indexPatternName}).then(function(resp){resp.jobs&&$scope.formConfig.jobs.forEach(function(job){var jobId=""+prefix+job.id;var jobResult=resp.jobs.find(function(j){return j.id===jobId});if(void 0!==jobResult)if(jobResult.success)job.jobState=SAVE_STATE.SAVED;else{job.jobState=SAVE_STATE.FAILED;jobResult.error&&jobResult.error.msg&&job.errors.push(jobResult.error.msg)}else{job.jobState=SAVE_STATE.FAILED;job.errors.push("Could not save job "+jobId)}var datafeedId=(0,_job_utils.prefixDatafeedId)(job.datafeedId,prefix);var datafeedResult=resp.datafeeds.find(function(d){return d.id===datafeedId});if(void 0!==datafeedResult)if(datafeedResult.success)job.datafeedState=SAVE_STATE.SAVED;else{job.datafeedState=SAVE_STATE.FAILED;datafeedResult.error&&datafeedResult.error.msg&&job.errors.push(datafeedResult.error.msg)}else{job.datafeedState=SAVE_STATE.FAILED;job.errors.push("Could not save datafeed "+datafeedId)}});resp.kibana&&_lodash2.default.each($scope.formConfig.kibanaObjects,function(kibanaObject,objName){kibanaObject.forEach(function(obj){var kibanaObjectResult=resp.kibana[objName].find(function(o){return o.id===obj.id});if(void 0!==kibanaObjectResult)kibanaObjectResult.success||false===kibanaObjectResult.success&&true===kibanaObjectResult.exists?obj.saveState=SAVE_STATE.SAVED:obj.saveState=SAVE_STATE.FAILED;else{obj.saveState=SAVE_STATE.FAILED;obj.errors.push("Could not save "+objName+" "+obj.id)}})});resolve()})})}function setAllToSaving(){$scope.formConfig.jobs.forEach(function(j){j.jobState=SAVE_STATE.SAVING;j.datafeedState=SAVE_STATE.SAVING});_lodash2.default.each($scope.formConfig.kibanaObjects,function(kibanaObject){kibanaObject.forEach(function(obj){obj.saveState=SAVE_STATE.SAVING})})}function startDatafeeds(){return new Promise(function(resolve,reject){var jobs=$scope.formConfig.jobs;var numberOfJobs=jobs.length;mlCreateRecognizerJobsService.indexTimeRange($scope.formConfig.indexPattern,$scope.formConfig).then(function(resp){if($scope.formConfig.useFullIndexData){$scope.formConfig.start=resp.start.epoch;$scope.formConfig.end=resp.end.epoch}else{$scope.formConfig.start=_datemath2.default.parse(_timefilter.timefilter.getTime().from).valueOf();$scope.formConfig.end=_datemath2.default.parse(_timefilter.timefilter.getTime().to).valueOf()}var jobsCounter=0;var datafeedCounter=0;open(jobs[jobsCounter]);function incrementAndOpen(job){jobsCounter++;jobsCounter<numberOfJobs?open(jobs[jobsCounter]):job.runningState===DATAFEED_STATE.FAILED&&reject()}function open(job){if(job.jobState===SAVE_STATE.FAILED){datafeedCounter++;job.runningState=DATAFEED_STATE.FAILED;incrementAndOpen(job);return}job.runningState=DATAFEED_STATE.STARTING;var jobId=$scope.formConfig.jobLabel+job.id;_job_service.mlJobService.openJob(jobId).then(function(){incrementAndOpen(job);start(job)}).catch(function(err){console.log("Opening job failed",err);start(job);job.errors.push(err.message);incrementAndOpen(job)})}function start(job){var jobId=$scope.formConfig.jobLabel+job.id;var datafeedId=(0,_job_utils.prefixDatafeedId)(job.datafeedId,$scope.formConfig.jobLabel);mlCreateRecognizerJobsService.startDatafeed(datafeedId,jobId,$scope.formConfig.start,$scope.formConfig.end).then(function(){job.runningState=DATAFEED_STATE.STARTED;datafeedCounter++;datafeedCounter===numberOfJobs&&resolve()}).catch(function(err){console.log("Starting datafeed failed",err);job.errors.push(err.message);job.runningState=DATAFEED_STATE.FAILED;reject(err)})}})})}function checkIfKibanaObjectsExist(kibanaObjects){_lodash2.default.each(kibanaObjects,function(objects,type){objects.forEach(function(obj){checkForSavedObject(type,obj).then(function(result){if(result){obj.saveState=SAVE_STATE.SAVED;obj.exists=true}})})})}function checkForSavedObject(type,savedObject){return new Promise(function(resolve,reject){var exists=false;mlCreateRecognizerJobsService.loadExistingSavedObjects(type).then(function(resp){var savedObjects=resp.savedObjects;savedObjects.forEach(function(obj){if(savedObject.title===obj.attributes.title){exists=true;savedObject.id=obj.id}});resolve(exists)}).catch(function(resp){console.log("Could not load saved objects",resp);reject(resp)})})}$scope.setOverallState=function(){var jobIds=[];var failedJobsCount=$scope.formConfig.jobs.reduce(function(count,job){if(job.jobState===SAVE_STATE.FAILED||job.datafeedState===SAVE_STATE.FAILED)return count+1;jobIds.push(""+$scope.formConfig.jobLabel+job.id);return count},0);failedJobsCount?failedJobsCount===$scope.formConfig.jobs.length?$scope.overallState=SAVE_STATE.FAILED:$scope.overallState=SAVE_STATE.PARTIAL_FAILURE:$scope.overallState=SAVE_STATE.SAVED;$scope.resultsUrl=_job_service.mlJobService.createResultsUrl(jobIds,$scope.formConfig.start,$scope.formConfig.end,"explorer")};function validateJobs(){var valid=true;var checks=$scope.ui.validation.checks;_lodash2.default.each(checks,function(item){item.valid=true});var label=$scope.formConfig.jobLabel+"extra";if(false===(0,_job_utils.isJobIdValid)(label)){valid=false;checks.jobLabel.valid=false;var msg="Job label can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";msg+="must start and end with an alphanumeric character";checks.jobLabel.message=msg}$scope.formConfig.jobGroups.forEach(function(group){if(false===(0,_job_utils.isJobIdValid)(group)){valid=false;checks.groupIds.valid=false;var _msg="Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";_msg+="must start and end with an alphanumeric character";checks.groupIds.message=_msg}});return valid}loadJobConfigs()})},3817:function(module,exports){module.exports='<ml-nav-menu name="new_job_multi_metric"></ml-nav-menu>\n<ml-new-job-recognizer>\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlCreateRecognizerJobs" class="recognizer-job-container">\n    <div class="row">\n      <div class="col-md-12">\n        <h3 class="euiTitle euiTitle--large">New job from {{ui.pageTitle}}</h3>\n\n        <div ng-if="displayQueryWarning === true" class="euiCallOut euiCallOut--warning">\n            <div class="euiCallOutHeader">\n              <svg class="euiIcon euiCallOutHeader__icon euiIcon--medium" xmlns="http://www.w3.org/2000/svg"\n                  width="16" height="16" viewBox="0 0 16 16">\n                <g fill-rule="evenodd">\n                  <path d="M7.5 2.236L1.618 14h11.764L7.5 2.236zm.894-.447l5.882 11.764A1 1 0 0 1 13.382 15H1.618a1 1 0 0 1-.894-1.447L6.606 1.789a1 1 0 0 1 1.788 0z"\n                  />\n                  <path d="M7 6h1v5H7zM7 12h1v1H7z" />\n                </g>\n              </svg>\n              <span class="euiCallOutHeader__title">Search will be overwritten</span>\n            </div>\n            <div class="euiText euiText--small">\n              <p>\n                Using a saved search will mean the query used in the datafeeds will be different from the default ones we supply in the {{moduleId}} module.\n              </p>\n            </div>\n          </div>\n      </div>\n    </div>\n\n    <div class="euiSpacer euiSpacer--s"></div>\n\n    <div class="row">\n      <div class="col-md-4">\n        <div class="row form-controls">\n          <h4 class="euiTitle euiTitle--small">Job settings</h4>\n          <div>\n\n            <div class=\'form-section\' >\n              <div ng-show="jobState !== SAVE_STATE.FINISHED">\n                <h4 class="euiTitle euiTitle--small">Job Details</h4>\n                <div class="euiSpacer euiSpacer--s"></div>\n              </div>\n\n              <div class="form-group">\n                <div ng-show="ui.showJobInput && (overallState === SAVE_STATE.NOT_SAVED || overallState === SAVE_STATE.SAVING)">\n                  <div class="form-group">\n                    <ml-form-label label-id="new_job_recognizer_job_prefix">Job ID prefix</ml-form-label>\n                    <input\n                      aria-labelledby="ml_aria_label_new_job_recognizer_job_prefix"\n                      aria-describedby="ml_aria_description_new_job_recognizer_job_prefix"\n                      ng-model="formConfig.jobLabel"\n                      placeholder="Job ID prefix"\n                      ng-change="changeJobLabelCase()"\n                      ng-disabled="overallState === SAVE_STATE.SAVING"\n                      class="form-control lowercase" />\n                      <div ng-hide="ui.validation.checks.jobLabel.valid" class="validation-error">{{ ui.validation.checks.jobLabel.message }}</div>\n                  </div>\n                  <div class="form-group">\n                    <ml-form-label label-id="new_job_group">Job groups</ml-form-label>\n                    <ml-job-group-select\n                      aria-labelledby="ml_aria_label_new_job_group"\n                      aria-describedby="ml_aria_description_new_job_group"\n                      job-groups=\'formConfig.jobGroups\'\n                      disabled=\'(overallState === SAVE_STATE.SAVING)\' />\n                    <div ng-hide="ui.validation.checks.groupIds.valid" class="validation-error">{{ ui.validation.checks.groupIds.message }}</div>\n                  </div>\n                  <div class="form-group">\n                    <div ng-click="ui.showAdvanced = (!ui.showAdvanced || formConfig.useDedicatedIndex)" class="advanced-button-container">\n                      <button\n                        aria-label="{{ ui.showAdvanced ? \'Hide Advanced\' : \'Show Advanced\' }}"\n                        ng-disabled="formConfig.useDedicatedIndex"\n                        type="button"\n                        class="kuiButton kuiButton--small kuiButton--hollow advanced-button">\n                        <i ng-class="{ \'fa-caret-down\': ui.showAdvanced, \'fa-caret-right\': !ui.showAdvanced }" class="fa" aria-label="Show advanced" ></i>\n                      </button>\n                      <label class="kuiFormLabel" aria-describedby="ml_aria_description_new_job_advanced_settings">Advanced</label>\n                      <i ml-info-icon="new_job_advanced_settings" aria-label="Advanced settings" />\n                    </div>\n                    <div class=\'advanced-group\' ng-show="ui.showAdvanced">\n                      <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n                        <input type="checkbox"\n                          aria-labelledby="ml_aria_label_new_job_dedicated_index"\n                          aria-describedby="ml_aria_description_new_job_dedicated_index"\n                          class=\'kuiCheckBox\'\n                          ng-model="formConfig.useDedicatedIndex" />\n                        <span class=\'kuiCheckBoxLabel__text\'>\n                          <span id="ml_aria_label_new_job_dedicated_index">Use dedicated index</span>\n                          <i ml-info-icon="new_job_dedicated_index" aria-label="Use dedicated index" />\n                        </span>\n                      </label>\n                    </div>\n                  </div>\n\n                  <div class="form-group">\n                    <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n                      <input type="checkbox"\n                        class=\'kuiCheckBox\'\n                        ng-model="formConfig.startDatafeedAfterSave" />\n                        <span class=\'kuiCheckBoxLabel__text\'>\n                          Start datafeed after save\n                        </span>\n                    </label>\n                  </div>\n                  <div class="form-group">\n                    <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n                      <input type="checkbox"\n                        class=\'kuiCheckBox\'\n                        ng-change="changeUseFullIndexData()"\n                        ng-model="formConfig.useFullIndexData" />\n                        <span class=\'kuiCheckBoxLabel__text\'>\n                          Use full {{formConfig.indexPattern.title}} data\n                        </span>\n                    </label>\n                  </div>\n\n                  <button\n                    aria-label="Create Job"\n                    ng-click="save()"\n                    type="button"\n                    ng-show="overallState === SAVE_STATE.NOT_SAVED"\n                    ng-disabled="!ui.formValid"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      Create Job{{((ui.numberOfJobs > 1)?\'s\':\'\')}}\n                    </span>\n                  </button>\n\n                  <div class=\'job-state-info\' ng-show="overallState === SAVE_STATE.SAVING">Analysis running <i class=\'fa fa-spinner fa-spin\' aria-label="Analysis running" ></i></div>\n                </div>\n                <div ng-show="overallState === SAVE_STATE.SAVED || overallState === SAVE_STATE.PARTIAL_FAILURE">\n                  <h3 ng-if="overallState === SAVE_STATE.SAVED" class="euiTitle euiTitle--large">Jobs created\n                    <i style="color:green;" class="fa fa-check" aria-label="Saved"></i>\n                  </h3>\n\n                  <h3 ng-if="overallState === SAVE_STATE.PARTIAL_FAILURE" class="euiTitle euiTitle--large">Some jobs failed to be created\n                    <i style="color:red;" class="fa fa-remove" aria-label="Save failed"></i>\n                  </h3>\n\n                  <div class="euiSpacer euiSpacer--m"></div>\n\n                  <button\n                    aria-label="Reset"\n                    ng-click="resetJob()"\n                    type="button"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      Reset\n                    </span>\n                  </button>\n                  <a\n                    href=\'{{resultsUrl}}\'\n                    ng-click="addNewJobToRecentlyAccessed(formConfig.jobId, resultsUrl)"\n                    aria-label="View Results"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      View Results\n                    </span>\n                  </a>\n                </div>\n\n                <div ng-show="overallState === SAVE_STATE.FAILED">\n                  <h3 class="euiTitle euiTitle--large">Jobs creation failed\n                    <i style="color:red;" class="fa fa-remove" aria-label="Save failed"></i>\n                  </h3>\n                  <div class="euiSpacer euiSpacer--m"></div>\n\n                  <button\n                    aria-label="Reset"\n                    ng-click="resetJob()"\n                    type="button"\n                    class="euiButton euiButton--primary euiButton--small euiButton--fill">\n                    <span class="euiButton__content">\n                      Reset\n                    </span>\n                  </button>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <div class="col-md-8">\n        <div class="row charts-container">\n          <h4 class="euiTitle euiTitle--small">Jobs</h4>\n          <div class=\'jobs-list\'>\n            <div ng-repeat=\'job in formConfig.jobs\' class=\'job-container\'>\n              <div class=\'labels\'>\n                <div class=\'title\'>{{formConfig.jobLabel}}{{job.id}}</div>\n                <div class=\'sub-title\'>{{job.jobConfig.description}}</div>\n                <div class=\'validation-error\' ng-repeat="error in job.errors">{{error}}</div>\n              </div>\n              <div class=\'results\'>\n                <div class=\'result-box\'>\n                  <div class=\'result-box-title\'>Job</div>\n                  <div class=\'result-box-inner\'>\n                    <i ng-show="job.jobState === SAVE_STATE.NOT_SAVED" aria-label="Not saved" ></i>\n                    <i ng-show="job.jobState === SAVE_STATE.FAILED" style="color:red;" class="fa fa-remove"aria-label="Save failed" ></i>\n                    <i ng-show="job.jobState === SAVE_STATE.SAVING" class="fa fa-spinner fa-spin"aria-label="Saving" ></i>\n                    <i ng-show="job.jobState === SAVE_STATE.SAVED" style="color:green;" class="fa fa-check"aria-label="Saved" ></i>\n                  </div>\n                </div>\n                <div class=\'result-box\'>\n                  <div class=\'result-box-title\'>Datafeed</div>\n                  <div class=\'result-box-inner\'>\n                    <i ng-show="job.datafeedState === SAVE_STATE.NOT_SAVED" aria-label="Not saved" ></i>\n                    <i ng-show="job.datafeedState === SAVE_STATE.FAILED" style="color:red;" class="fa fa-remove"aria-label="Save failed" ></i>\n                    <i ng-show="job.datafeedState === SAVE_STATE.SAVING" class="fa fa-spinner fa-spin"aria-label="Saving" ></i>\n                    <i ng-show="job.datafeedState === SAVE_STATE.SAVED" style="color:green;" class="fa fa-check"aria-label="Saved" ></i>\n                  </div>\n                </div>\n                <div class=\'result-box\' ng-if="formConfig.startDatafeedAfterSave">\n                  <div class=\'result-box-title\'>Running</div>\n                  <div class=\'result-box-inner\'>\n                    <i ng-show="job.runningState === DATAFEED_STATE.NOT_STARTED" aria-label="Not started" ></i>\n                    <i ng-show="job.runningState === DATAFEED_STATE.FAILED" style="color:red;" class="fa fa-remove"aria-label="Start failed" ></i>\n                    <i ng-show="job.runningState === DATAFEED_STATE.STARTING" class="fa fa-spinner fa-spin"aria-label="Starting" ></i>\n                    <i ng-show="job.runningState === DATAFEED_STATE.STARTED" style="color:green;" class="fa fa-check"aria-label="Started" ></i>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="row charts-container" ng-repeat=\'(key, value) in formConfig.kibanaObjects\'>\n          <h4 class="euiTitle euiTitle--small">{{ui.kibanaLabels[key]}}</h4>\n          <div class=\'save-objects-list\'>\n            <div ng-repeat=\'obj in value\' class=\'job-container\'>\n              <div class=\'labels\'>\n                <div class=\'title\' ng-class="{exists: obj.exists}">\n                  {{obj.title}}\n                  <span ng-if="obj.exists">(already exists)</span>\n                </div>\n              </div>\n              <div class=\'results\'>\n                <div class=\'result-box\'>\n                  <div class=\'result-box-inner\'>\n                    <i ng-show="obj.saveState === SAVE_STATE.NOT_SAVED" aria-label="Not saved" ></i>\n                    <i ng-show="obj.saveState === SAVE_STATE.FAILED" style="color:red;" class="fa fa-remove"aria-label="Save failed" ></i>\n                    <i ng-show="obj.saveState === SAVE_STATE.SAVING" class="fa fa-spinner fa-spin"aria-label="Saving" ></i>\n                    <i ng-show="obj.saveState === SAVE_STATE.SAVED  && !obj.exists" style="color:green;" class="fa fa-check"aria-label="Saved" ></i>\n                    <i ng-show="obj.saveState === SAVE_STATE.SAVED && obj.exists" style="color:#BBBBBB;" class="fa fa-check"aria-label="Already saved" ></i>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</ml-new-job-recognizer>\n'},3818:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3819);__webpack_require__(1441);__webpack_require__(3820);__webpack_require__(3824);__webpack_require__(1442)},3819:function(module,exports){},3820:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3821)},3821:function(module,exports,__webpack_require__){"use strict";var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(68);var _preconfigured_job_redirect=__webpack_require__(3822);var _check_privilege=__webpack_require__(35);var _index_utils=__webpack_require__(128);var _check_ml_nodes=__webpack_require__(69);var _promise=__webpack_require__(89);var _index_or_search=__webpack_require__(3823);var _index_or_search2=_interopRequireDefault(_index_or_search);var _timefilter=__webpack_require__(14);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/jobs/new_job",{redirectTo:"/jobs/new_job/step/index_or_search"});_routes2.default.when("/jobs/new_job/step/index_or_search",{template:_index_or_search2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPatterns:_index_utils.loadIndexPatterns,preConfiguredJobRedirect:_preconfigured_job_redirect.preConfiguredJobRedirect,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,initPromise:(0,_promise.initPromise)(true)}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlNewJobStepIndexOrSearch",function($scope){_timefilter.timefilter.disableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();$scope.indexPatterns=(0,_index_utils.getIndexPatterns)();$scope.withIndexPatternUrl=function(pattern){if(!pattern)return;return"#/jobs/new_job/step/job_type?index="+encodeURIComponent(pattern.id)};$scope.withSavedSearchUrl=function(savedSearch){if(!savedSearch)return;return"#/jobs/new_job/step/job_type?savedSearchId="+encodeURIComponent(savedSearch.id)}})},3822:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.preConfiguredJobRedirect=preConfiguredJobRedirect;var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _lodash=__webpack_require__(1);var _general=__webpack_require__(300);var _job_service=__webpack_require__(24);var _index_utils=__webpack_require__(128);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function preConfiguredJobRedirect(AppState,Private,courier){return new Promise(function(resolve,reject){var basePath=_chrome2.default.getBasePath()+"/app/ml#";var stateDefaults={mlJobSettings:{}};var appState=new AppState(stateDefaults);var redirectUrl=getWizardUrlFromAppState(appState);if(null===redirectUrl){var job=_job_service.mlJobService.currentJob;job?(0,_index_utils.loadIndexPatterns)(Private,courier).then(function(){redirectUrl=getWizardUrlFromCloningJob(job);if(null===redirectUrl){window.location.href=basePath+"/jobs/new_job/advanced";reject()}else{window.location.href=basePath+"/"+redirectUrl;reject()}}).catch(function(error){console.log(error);resolve()}):resolve()}else{window.location.href=basePath+"/"+redirectUrl;reject()}})}function getWizardUrlFromAppState(appState){if(void 0!==appState.mlJobSettings&&Object.keys(appState.mlJobSettings).length){var page="";var jobSettings=appState.mlJobSettings;jobSettings.fields&&jobSettings.fields.length&&(page=jobSettings.fields.length>1||void 0!==jobSettings.split?void 0!==jobSettings.population?"population":"multi_metric":"single_metric");return"jobs/new_job/simple/"+page}return null}function getWizardUrlFromCloningJob(job){var created=(0,_lodash.get)(job,"custom_settings.created_by");var page="";if(void 0!==created){created===_general.WIZARD_TYPE.SINGLE_METRIC?page="single_metric":created===_general.WIZARD_TYPE.MULTI_METRIC?page="multi_metric":created===_general.WIZARD_TYPE.POPULATION&&(page="population");var indexPatternId=(0,_index_utils.getIndexPatternIdFromName)(job.datafeed_config.indices[0]);return"jobs/new_job/simple/"+page+"?index="+indexPatternId+"&_g=()"}return null}},3823:function(module,exports){module.exports='<ml-nav-menu name="new_job"></ml-nav-menu>\n<ml-new-job class="index-or-saved-search-selection">\n  <ml-message-bar></ml-message-bar>\n  <div class=\'kuiViewContent kuiViewContent--constrainedWidth kuiViewContentItem\' >\n    <div ng-controller="MlNewJobStepIndexOrSearch" class="wizard">\n      <div class="wizard-column wizard-column--small">\n        <h3 class="kuiTitle kuiVerticalRhythm">From a New Search, Select Index</h3>\n        <paginated-selectable-list\n          per-page="20"\n          list="indexPatterns"\n          list-property="attributes.title"\n          user-make-url="withIndexPatternUrl"\n          class="wizard-row visualizeWizardPaginatedSelectableList kuiVerticalRhythm"\n        ></paginated-selectable-list>\n      </div>\n      <div class="wizard-column wizard-column--large">\n\n        <h3 class="kuiTitle kuiVerticalRhythm">Or, From a Saved Search</h3>\n        <saved-object-finder\n          title="Saved Searches"\n          type="searches"\n          class="wizard-row visualizeWizardSavedObjectFinder kuiVerticalRhythm"\n          make-url="withSavedSearchUrl"\n        ></saved-object-finder>\n       </div>\n    </div>\n    </div>\n</ml-new-job>\n'},3824:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3825)},3825:function(module,exports,__webpack_require__){"use strict";var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(68);var _check_privilege=__webpack_require__(35);var _new_job_utils=__webpack_require__(144);var _index_utils=__webpack_require__(128);var _recently_accessed=__webpack_require__(500);var _check_ml_nodes=__webpack_require__(69);var _promise=__webpack_require__(89);var _job_type=__webpack_require__(3826);var _job_type2=_interopRequireDefault(_job_type);var _timefilter=__webpack_require__(14);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/jobs/new_job/step/job_type",{template:_job_type2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkCreateJobsPrivilege,indexPattern:_index_utils.loadCurrentIndexPattern,savedSearch:_index_utils.loadCurrentSavedSearch,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,initPromise:(0,_promise.initPromise)(true)}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlNewJobStepJobType",function($scope,$route){_timefilter.timefilter.disableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();var _createSearchItems=(0,_new_job_utils.createSearchItems)($route),indexPattern=_createSearchItems.indexPattern,savedSearch=_createSearchItems.savedSearch;$scope.indexWarningTitle="";$scope.isTimeBasedIndex=(0,_index_utils.timeBasedIndexCheck)(indexPattern);false===$scope.isTimeBasedIndex&&($scope.indexWarningTitle=void 0===savedSearch.id?"Index pattern "+indexPattern.title+" is not time based":savedSearch.title+" uses index pattern "+indexPattern.title+" which is not time based");$scope.indexPattern=indexPattern;$scope.savedSearch=savedSearch;$scope.recognizerResults={count:0};$scope.pageTitleLabel=void 0!==savedSearch.id?"saved search "+savedSearch.title:"index pattern "+indexPattern.title;$scope.getUrl=function(basePath){return void 0===savedSearch.id?basePath+"?index="+indexPattern.id:basePath+"?savedSearchId="+savedSearch.id};$scope.addSelectionToRecentlyAccessed=function(){var title=void 0===savedSearch.id?indexPattern.title:savedSearch.title;var url=$scope.getUrl("");(0,_recently_accessed.addItemToRecentlyAccessed)("jobs/new_job/datavisualizer",title,url)};$scope.assetsPath=_chrome2.default.getBasePath()+"/plugins/ml/assets"})},3826:function(module,exports){module.exports='<ml-nav-menu name="new_job"></ml-nav-menu>\n<ml-new-job class="job-type-gallery">\n  <ml-message-bar></ml-message-bar>\n  <div ng-controller="MlNewJobStepJobType">\n    \x3c!-- Presents the various options for creating a job --\x3e\n    <div class="job-types-content">\n      <h1 class="euiTitle euiTitle--large">Create a job from the {{pageTitleLabel}}</h1>\n      <div class="euiSpacer euiSpacer--l"></div>\n\n      <div ng-if="isTimeBasedIndex===false">\n        <div class="index-warning">\n          <div class="euiCallOut euiCallOut--warning">\n            <div class="euiCallOutHeader">\n              <svg class="euiIcon euiCallOutHeader__icon euiIcon--medium" xmlns="http://www.w3.org/2000/svg"\n              width="16" height="16" viewBox="0 0 16 16">\n                <g fill-rule="evenodd">\n                  <path d="M7.5 2.236L1.618 14h11.764L7.5 2.236zm.894-.447l5.882 11.764A1 1 0 0 1 13.382 15H1.618a1 1 0 0 1-.894-1.447L6.606 1.789a1 1 0 0 1 1.788 0z"\n                  />\n                  <path d="M7 6h1v5H7zM7 12h1v1H7z" />\n                </g>\n              </svg>\n              <span class="euiCallOutHeader__title">{{indexWarningTitle}}</span>\n            </div>\n            <div class="euiText euiText--small">\n              <p>Anomaly detection can only be run over indices which are time based.<br/>\n                <a class="euiLink euiLink--primary" href="#jobs/new_job">Select a different index</a>\n              </p>\n            </div>\n          </div>\n        </div>\n        <div class="euiSpacer euiSpacer--xxl"></div>\n      </div>\n\n      <div ng-show="recognizerResults.count!==0" class="recognizer-section">\n        <div class="euiText">\n          <h3 class="euiTitle euiTitle--small">Use a supplied configuration</h3>\n          <p>\n            The fields in your data have been recognized as matching known configurations.\n            Select to create a set of machine learning jobs and associated dashboards.\n          </p>\n        </div>\n        <div class="euiSpacer euiSpacer--m"></div>\n        <ml-data-recognizer\n          class-name=\'"euiFlexGrid euiFlexGrid--gutterLarge euiFlexGrid--fourths"\'\n          item-class-name=\'""\'\n          index-pattern=\'indexPattern\'\n          saved-search=\'savedSearch\'\n          results=recognizerResults/>\n        <div class="euiSpacer euiSpacer--xxl"></div>\n      </div>\n\n      <div class="euiText">\n        <h3 class="euiTitle euiTitle--small">Use a wizard</h3>\n        <p>\n          Use one of the wizards to create a machine learning job to find anomalies in your data.\n        </p>\n      </div>\n\n      <div class="euiSpacer euiSpacer--m"></div>\n\n      <div class="euiFlexGrid euiFlexGrid--gutterLarge euiFlexGrid--fourths">\n        <div class="euiFlexItem" ng-class=\'{disabled: isTimeBasedIndex===false}\'>\n          <a ng-href="{{getUrl(\'#jobs/new_job/simple/single_metric\')}}" ng-class=\'{disabled: isTimeBasedIndex===false}\' class="euiLink synopsis">\n            <div class="euiPanel euiPanel--paddingMedium synopsisPanel">\n              <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n                <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                  <img class="synopsisIcon" ng-src="{{assetsPath}}/ml_create_single_metric_job.svg" alt="Single metric job">\n                </div>\n                <div class="euiFlexItem synopsisContent">\n                  <h4 class="euiTitle euiTitle--small synopsisTitle">Single metric</h4>\n                  <div class="euiText synopsisBody">\n                    <p>\n                      <span class="euiTextColor euiTextColor--subdued">\n                      Detect anomalies in a single time series.\n                      </span>\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </a>\n        </div>\n        <div class="euiFlexItem" ng-class=\'{disabled: isTimeBasedIndex===false}\'>\n          <a ng-href="{{getUrl(\'#jobs/new_job/simple/multi_metric\')}}" ng-class=\'{disabled: isTimeBasedIndex===false}\' class="euiLink synopsis">\n            <div class="euiPanel euiPanel--paddingMedium synopsisPanel">\n              <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n                <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                  <img class="synopsisIcon" ng-src="{{assetsPath}}/ml_create_multi_metric_job.svg" alt="Multi metric job">\n                </div>\n                <div class="euiFlexItem synopsisContent">\n                  <h4 class="euiTitle euiTitle--small synopsisTitle">Multi metric</h4>\n                  <div class="euiText synopsisBody">\n                    <p>\n                      <span class="euiTextColor euiTextColor--subdued">\n                      Detect anomalies in multiple metrics by splitting a time series by a categorical field.\n                      </span>\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </a>\n        </div>\n        <div class="euiFlexItem" ng-class=\'{disabled: isTimeBasedIndex===false}\'>\n          <a ng-href="{{getUrl(\'#jobs/new_job/simple/population\')}}" ng-class=\'{disabled: isTimeBasedIndex===false}\' class="euiLink synopsis">\n            <div class="euiPanel euiPanel--paddingMedium synopsisPanel">\n              <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n                <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                  <img class="synopsisIcon" ng-src="{{assetsPath}}/ml_create_population_job.svg" alt="Population job">\n                </div>\n                <div class="euiFlexItem synopsisContent">\n                  <h4 class="euiTitle euiTitle--small synopsisTitle">Population</h4>\n                  <div class="euiText synopsisBody">\n                    <p>\n                      <span class="euiTextColor euiTextColor--subdued">\n                      Detect activity that is unusual compared to the behavior of the population.\n                      </span>\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </a>\n        </div>\n        <div class="euiFlexItem" ng-class=\'{disabled: isTimeBasedIndex===false}\'>\n          <a ng-href="{{getUrl(\'#jobs/new_job/advanced\')}}" ng-class=\'{disabled: isTimeBasedIndex===false}\' class="euiLink synopsis">\n            <div class="euiPanel euiPanel--paddingMedium synopsisPanel">\n              <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n                <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                  <img class="synopsisIcon" ng-src="{{assetsPath}}/ml_create_advanced_job.svg" alt="Advanced job">\n                </div>\n                <div class="euiFlexItem synopsisContent">\n                  <h4 class="euiTitle euiTitle--small synopsisTitle">Advanced</h4>\n                  <div class="euiText synopsisBody">\n                    <p>\n                      <span class="euiTextColor euiTextColor--subdued">\n                      Use the full range of options to create a job for more advanced use cases.\n                      </span>\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </a>\n        </div>\n      </div>\n\n      <div class="euiSpacer euiSpacer--xxl"></div>\n\n      <div class="euiText">\n        <h3 class="euiTitle euiTitle--small">Learn more about your data</h3>\n        <p>\n          If you\'re not sure what type of job to create, first explore the fields and metrics in your data.\n        </p>\n      </div>\n      <div class="euiSpacer euiSpacer--m"></div>\n\n      <div class="euiFlexGrid euiFlexGrid--gutterLarge euiFlexGrid--fourths">\n        <div class="euiFlexItem" ng-class=\'{disabled: isTimeBasedIndex===false}\'>\n          <a\n            ng-href="{{getUrl(\'#jobs/new_job/datavisualizer\')}}"\n            ng-click="addSelectionToRecentlyAccessed()"\n            ng-class=\'{disabled: isTimeBasedIndex===false}\'\n            class="euiLink synopsis">\n            <div class="euiPanel euiPanel--paddingMedium synopsisPanel">\n              <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n                <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                  <img class="synopsisIcon" ng-src="{{assetsPath}}/ml_data_visualizer.svg" alt="Single metric job">\n                </div>\n                <div class="euiFlexItem synopsisContent">\n                  <h4 class="euiTitle euiTitle--small synopsisTitle">Data Visualizer</h4>\n                  <div class="euiText synopsisBody">\n                    <p>\n                      <span class="euiTextColor euiTextColor--subdued">\n                      Learn more about the characteristics of your data and identify the fields for analysis with machine learning.\n                      </span>\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </a>\n        </div>\n      </div>\n\n    </div>\n\n  </div>\n</ml-new-job>\n'},3827:function(module,exports,__webpack_require__){"use strict";__webpack_require__(93);var _data_recognizer=__webpack_require__(1443);var _modules=__webpack_require__(2);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlDataRecognizer",function(reactDirective){return reactDirective(_data_recognizer.DataRecognizer,void 0,{restrict:"AE"})})},3828:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.RecognizedResult=void 0;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var RecognizedResult=exports.RecognizedResult=function RecognizedResult(_ref){var config=_ref.config,indexPattern=_ref.indexPattern,savedSearch=_ref.savedSearch;var id=void 0===savedSearch||void 0===savedSearch.id?"index="+indexPattern.id:"savedSearchId="+savedSearch.id;var href="#/jobs/new_job/simple/recognize?id="+config.id+"&"+id;var logo=null;logo=config.logo&&config.logo.src?_react2.default.createElement("div",null,_react2.default.createElement("img",{className:"synopsisIcon",src:config.logo.src})):_react2.default.createElement("h3",{className:"euiTitle euiTitle--small"},config.id);return _react2.default.createElement("div",{className:"euiFlexItem"},_react2.default.createElement("a",{href:href,className:"euiLink synopsis"},_react2.default.createElement("div",{className:"euiPanel euiPanel--paddingMedium synopsisPanel"},_react2.default.createElement("div",{className:"euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive"},_react2.default.createElement("div",{className:"euiFlexItem euiFlexItem--flexGrowZero ml-data-recognizer-logo"},logo),_react2.default.createElement("div",{className:"euiFlexItem synopsisContent"},_react2.default.createElement("h4",{className:"euiTitle euiTitle--small synopsisTitle"},config.title),_react2.default.createElement("div",{className:"euiText synopsisBody"},_react2.default.createElement("p",null,_react2.default.createElement("span",{className:"euiTextColor euiTextColor--subdued"},config.description))))))))};RecognizedResult.propTypes={config:_propTypes2.default.object,indexPattern:_propTypes2.default.object,savedSearch:_propTypes2.default.object}},3829:function(module,exports){},3830:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3831)},3831:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3832);var _messagebar=__webpack_require__(3833);var _messagebar2=_interopRequireDefault(_messagebar);var _messagebar_service=__webpack_require__(79);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.controller("MlMessageBarController",function($scope){$scope.messages=_messagebar_service.mlMessageBarService.getMessages();$scope.removeMessage=_messagebar_service.mlMessageBarService.removeMessage}).directive("mlMessageBar",function(){return{restrict:"AE",template:_messagebar2.default}})},3832:function(module,exports){},3833:function(module,exports){module.exports='<div ng-controller="MlMessageBarController">\n  <div\n    ng-repeat="msg in messages"\n    class=\'ml-message {{msg.style}}\'>\n      {{msg.text}} <a ng-click="removeMessage($index)">x</a>\n  </div>\n</div>'},3834:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3835);__webpack_require__(3836);__webpack_require__(1442);__webpack_require__(3838);__webpack_require__(427);__webpack_require__(635)},3835:function(module,exports){},3836:function(module,exports,__webpack_require__){"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _risonNode=__webpack_require__(254);var _risonNode2=_interopRequireDefault(_risonNode);__webpack_require__(425);__webpack_require__(1415);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _notify=__webpack_require__(9);var _courier=__webpack_require__(94);var _field_types=__webpack_require__(322);var _field_types_utils=__webpack_require__(1428);var _ml_time_buckets=__webpack_require__(277);var _check_license=__webpack_require__(68);var _check_privilege=__webpack_require__(35);var _new_job_utils=__webpack_require__(144);var _index_utils=__webpack_require__(128);var _check_ml_nodes=__webpack_require__(69);var _ml_api_service=__webpack_require__(23);var _promise=__webpack_require__(89);var _datavisualizer=__webpack_require__(3837);var _datavisualizer2=_interopRequireDefault(_datavisualizer);var _timefilter=__webpack_require__(14);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/jobs/new_job/datavisualizer",{template:_datavisualizer2.default,resolve:{CheckLicense:_check_license.checkLicenseExpired,privileges:_check_privilege.checkGetJobsPrivilege,indexPattern:_index_utils.loadCurrentIndexPattern,savedSearch:_index_utils.loadCurrentSavedSearch,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,initPromise:(0,_promise.initPromise)(true)}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlDataVisualizerViewFields",function($scope,$route,$timeout,$window,Private,AppState){_timefilter.timefilter.enableTimeRangeSelector();_timefilter.timefilter.enableAutoRefreshSelector();var _createSearchItems=(0,_new_job_utils.createSearchItems)($route),indexPattern=_createSearchItems.indexPattern,query=_createSearchItems.query;(0,_index_utils.timeBasedIndexCheck)(indexPattern,true);var OMIT_FIELDS=["_source","_type","_index","_id","_version","_score"];$scope.metricCards=[];$scope.totalMetricFieldCount=0;$scope.populatedMetricFieldCount=0;$scope.showAllMetrics=false;$scope.fieldCards=[];$scope.totalNonMetricFieldCount=0;$scope.populatedNonMetricFieldCount=0;$scope.ML_JOB_FIELD_TYPES=_field_types.ML_JOB_FIELD_TYPES;$scope.showAllFields=false;$scope.filterFieldType="*";$scope.urlBasePath=_chrome2.default.getBasePath();$scope.appState=new AppState;$scope.indexPattern=indexPattern;$scope.earliest=_timefilter.timefilter.getActiveBounds().min.valueOf();$scope.latest=_timefilter.timefilter.getActiveBounds().max.valueOf();$scope.metricFilterIcon=0;$scope.metricFieldFilter="";$scope.fieldFilterIcon=0;$scope.fieldFilter="";$scope.recognizerResults={count:0};$scope.searchQueryText="";if(_lodash2.default.has($scope.appState,"query"))"lucene"===_lodash2.default.get($scope.appState,"query.language")&&($scope.searchQueryText=_lodash2.default.get($scope.appState,"query.query",""));else{var queryString=_lodash2.default.get(query,"query_string.query","");"*"!==queryString&&($scope.searchQueryText=queryString)}$scope.searchQuery=buildSearchQuery();$scope.samplerShardSize=$scope.appState.samplerShardSize?$scope.appState.samplerShardSize:5e3;var MlTimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);var metricFieldRegexp=void 0;var metricFieldFilterTimeout=void 0;var fieldRegexp=void 0;var fieldFilterTimeout=void 0;var indexedFieldTypes=[];_lodash2.default.each(indexPattern.fields,function(field){if(!field.scripted){var dataVisualizerType=(0,_field_types_utils.kbnTypeToMLJobType)(field);void 0!==dataVisualizerType&&indexedFieldTypes.push(dataVisualizerType)}});indexedFieldTypes=_lodash2.default.chain(indexedFieldTypes).unique().without(_field_types.ML_JOB_FIELD_TYPES.NUMBER).value();$scope.indexedFieldTypes=indexedFieldTypes.sort();$scope.$listenAndDigestAsync(_timefilter.timefilter,"fetch",function(){$scope.earliest=_timefilter.timefilter.getActiveBounds().min.valueOf();$scope.latest=_timefilter.timefilter.getActiveBounds().max.valueOf();loadOverallStats()});$scope.submitSearchQuery=function(){$scope.searchQuery=buildSearchQuery();saveAppState();loadOverallStats()};$scope.samplerShardSizeChanged=function(){saveAppState();loadOverallStats()};$scope.toggleAllMetrics=function(){$scope.showAllMetrics=!$scope.showAllMetrics;createMetricCards()};$scope.toggleAllFields=function(){$scope.showAllFields=!$scope.showAllFields;createNonMetricCards()};$scope.filterFieldTypeChanged=function(fieldType){$scope.filterFieldType=fieldType;createNonMetricCards()};$scope.metricFieldFilterChanged=function(){void 0!==metricFieldFilterTimeout&&$timeout.cancel(metricFieldFilterTimeout);metricFieldFilterTimeout=$timeout(function(){metricFieldRegexp=$scope.metricFieldFilter&&""!==$scope.metricFieldFilter?new RegExp("("+$scope.metricFieldFilter+")","gi"):void 0;createMetricCards();metricFieldFilterTimeout=void 0},1500);$timeout(function(){$scope.metricFilterIcon=1},250)};$scope.clearMetricFilter=function(){$scope.metricFieldFilter="";metricFieldRegexp=void 0;createMetricCards()};$scope.fieldFilterChanged=function(){void 0!==fieldFilterTimeout&&$timeout.cancel(fieldFilterTimeout);fieldFilterTimeout=$timeout(function(){fieldRegexp=$scope.fieldFilter&&""!==$scope.fieldFilter?new RegExp("("+$scope.fieldFilter+")","gi"):void 0;createNonMetricCards();fieldFilterTimeout=void 0},1500);$timeout(function(){$scope.fieldFilterIcon=1},250)};$scope.clearFieldFilter=function(){$scope.fieldFilter="";fieldRegexp=void 0;createNonMetricCards()};$scope.createJob=function(){var _a=_risonNode2.default.encode({query:{language:"lucene",query:$scope.searchQueryText}});var path=$scope.urlBasePath+"/app/ml#/jobs/new_job/advanced?index="+$scope.indexPattern+"&_a="+_a;$window.open(path,"_self")};function buildSearchQuery(){var searchQuery=(0,_courier.luceneStringToDsl)($scope.searchQueryText);(0,_courier.decorateQuery)(searchQuery);return searchQuery}function saveAppState(){$scope.appState.query={language:"lucene",query:$scope.searchQueryText};$scope.appState.samplerShardSize=$scope.samplerShardSize;$scope.appState.save()}function createMetricCards(){$scope.metricCards.length=0;var aggregatableExistsFields=$scope.overallStats.aggregatableExistsFields||[];var allMetricFields=[];allMetricFields=void 0===metricFieldRegexp?_lodash2.default.filter(indexPattern.fields,function(f){return f.type===_field_types.KBN_FIELD_TYPES.NUMBER&&!_lodash2.default.contains(OMIT_FIELDS,f.displayName)}):_lodash2.default.filter(indexPattern.fields,function(f){return f.type===_field_types.KBN_FIELD_TYPES.NUMBER&&!_lodash2.default.contains(OMIT_FIELDS,f.displayName)&&f.displayName.match(metricFieldRegexp)});var metricExistsFields=_lodash2.default.filter(allMetricFields,function(f){return _lodash2.default.find(aggregatableExistsFields,{fieldName:f.displayName})});var metricCards=[];metricCards.push({type:_field_types.ML_JOB_FIELD_TYPES.NUMBER,existsInDocs:true,loading:true});$scope.totalMetricFieldCount=allMetricFields.length+1;$scope.populatedMetricFieldCount=metricExistsFields.length+1;$scope.totalMetricFieldCount===$scope.populatedMetricFieldCount&&($scope.showAllMetrics=true);var aggregatableFields=$scope.overallStats.aggregatableExistsFields;true===$scope.showAllMetrics&&(aggregatableFields=aggregatableFields.concat($scope.overallStats.aggregatableNotExistsFields));var metricFields=$scope.showAllMetrics?allMetricFields:metricExistsFields;_lodash2.default.each(metricFields,function(field){var fieldData=_lodash2.default.find(aggregatableFields,{fieldName:field.displayName});var card=_extends({},fieldData,{fieldFormat:field.format,type:_field_types.ML_JOB_FIELD_TYPES.NUMBER,loading:true});metricCards.push(card)});$scope.metricCards=metricCards;loadMetricFieldStats()}function createNonMetricCards(){$scope.fieldCards.length=0;var allNonMetricFields=[];if("*"===$scope.filterFieldType)allNonMetricFields=_lodash2.default.filter(indexPattern.fields,function(f){return f.type!==_field_types.KBN_FIELD_TYPES.NUMBER&&!_lodash2.default.contains(OMIT_FIELDS,f.displayName)});else if($scope.filterFieldType===_field_types.ML_JOB_FIELD_TYPES.TEXT||$scope.filterFieldType===_field_types.ML_JOB_FIELD_TYPES.KEYWORD){var aggregatableCheck=$scope.filterFieldType===_field_types.ML_JOB_FIELD_TYPES.KEYWORD;allNonMetricFields=_lodash2.default.filter(indexPattern.fields,function(f){return!_lodash2.default.contains(OMIT_FIELDS,f.displayName)&&f.type===_field_types.KBN_FIELD_TYPES.STRING&&f.aggregatable===aggregatableCheck})}else allNonMetricFields=_lodash2.default.filter(indexPattern.fields,function(f){return!_lodash2.default.contains(OMIT_FIELDS,f.displayName)&&f.type===$scope.filterFieldType});void 0!==fieldRegexp&&(allNonMetricFields=_lodash2.default.filter(allNonMetricFields,function(f){return f.displayName.match(fieldRegexp)}));$scope.totalNonMetricFieldCount=allNonMetricFields.length;var populatedNonMetricFields=[];var nonMetricFieldData=[];var populatedNonMetricFieldCount=0;_lodash2.default.each(allNonMetricFields,function(f){var checkAggregatableField=_lodash2.default.find($scope.overallStats.aggregatableExistsFields,{fieldName:f.displayName});if(void 0!==checkAggregatableField){populatedNonMetricFields.push(f);nonMetricFieldData.push(checkAggregatableField);populatedNonMetricFieldCount++}else{var checkNonAggregatableField=_lodash2.default.find($scope.overallStats.nonAggregatableExistsFields,{fieldName:f.displayName});if(void 0!==checkNonAggregatableField){populatedNonMetricFields.push(f);nonMetricFieldData.push(checkNonAggregatableField);populatedNonMetricFieldCount++}}});$scope.populatedNonMetricFieldCount=populatedNonMetricFieldCount;$scope.totalNonMetricFieldCount===$scope.populatedNonMetricFieldCount&&($scope.showAllFields=true);var nonMetricFieldsToShow=true===$scope.showAllFields?allNonMetricFields:populatedNonMetricFields;true===$scope.showAllFields&&(nonMetricFieldData=nonMetricFieldData.concat($scope.overallStats.aggregatableNotExistsFields,$scope.overallStats.nonAggregatableNotExistsFields));var fieldCards=[];_lodash2.default.each(nonMetricFieldsToShow,function(field){var fieldData=_lodash2.default.find(nonMetricFieldData,{fieldName:field.displayName});var card=_extends({},fieldData,{fieldFormat:field.format,aggregatable:field.aggregatable,scripted:field.scripted,loading:fieldData.existsInDocs});var dataVisualizerType=(0,_field_types_utils.kbnTypeToMLJobType)(field);if(void 0!==dataVisualizerType)card.type=dataVisualizerType;else{card.type=field.type;card.isUnsupportedType=true}fieldCards.push(card)});$scope.fieldCards=_lodash2.default.sortBy(fieldCards,"fieldName");loadNonMetricFieldStats()}function loadMetricFieldStats(){var numberFields=_lodash2.default.filter($scope.metricCards,{existsInDocs:true});numberFields=_lodash2.default.map(numberFields,function(card){var props={fieldName:card.fieldName,type:card.type};_lodash2.default.has(card,["stats","cardinality"])&&(props.cardinality=card.stats.cardinality);return props});var buckets=new MlTimeBuckets;var bounds=_timefilter.timefilter.getActiveBounds();var BAR_TARGET=75;buckets.setInterval("auto");buckets.setBounds(bounds);buckets.setBarTarget(BAR_TARGET);var aggInterval=buckets.getInterval();_ml_api_service.ml.getVisualizerFieldStats({indexPatternTitle:indexPattern.title,query:$scope.searchQuery,timeFieldName:indexPattern.timeFieldName,earliest:$scope.earliest,latest:$scope.latest,samplerShardSize:$scope.samplerShardSize,interval:aggInterval.expression,fields:numberFields}).then(function(resp){_lodash2.default.each($scope.metricCards,function(card){void 0!==card.fieldName?card.stats=_extends({},card.stats,_lodash2.default.find(resp,{fieldName:card.fieldName})):card.stats=_lodash2.default.find(resp,function(stats){return void 0===stats.fieldName});card.loading=false});$scope.metricFilterIcon=0}).catch(function(err){console.log("DataVisualizer - error getting stats for metric cards from elasticsearch:",err);500===err.statusCode?_notify.notify.error("Error loading data for metrics in index "+indexPattern.title+". "+err.message+". The request may have timed out. Try using a smaller sample size or narrowing the time range.",{lifetime:3e4}):_notify.notify.error("Error loading data for metrics in index "+indexPattern.title+". "+err.message,{lifetime:3e4})})}function loadNonMetricFieldStats(){var fields=_lodash2.default.filter($scope.fieldCards,{existsInDocs:true});fields=_lodash2.default.map(fields,function(card){var props={fieldName:card.fieldName,type:card.type};_lodash2.default.has(card,["stats","cardinality"])&&(props.cardinality=card.stats.cardinality);return props});fields.length>0?_ml_api_service.ml.getVisualizerFieldStats({indexPatternTitle:indexPattern.title,query:$scope.searchQuery,fields:fields,timeFieldName:indexPattern.timeFieldName,earliest:$scope.earliest,latest:$scope.latest,samplerShardSize:$scope.samplerShardSize,maxExamples:10}).then(function(resp){_lodash2.default.each($scope.fieldCards,function(card){card.stats=_extends({},card.stats,_lodash2.default.find(resp,{fieldName:card.fieldName}));card.loading=false});$scope.fieldFilterIcon=0}).catch(function(err){console.log("DataVisualizer - error getting non metric field stats from elasticsearch:",err);500===err.statusCode?_notify.notify.error("Error loading data for fields in index "+indexPattern.title+". "+err.message+". The request may have timed out. Try using a smaller sample size or narrowing the time range.",{lifetime:3e4}):_notify.notify.error("Error loading data for fields in index "+indexPattern.title+". "+err.message,{lifetime:3e4})}):$scope.fieldFilterIcon=0}function loadOverallStats(){var aggregatableFields=[];var nonAggregatableFields=[];_lodash2.default.each(indexPattern.fields,function(field){-1===OMIT_FIELDS.indexOf(field.displayName)&&(true===field.aggregatable?aggregatableFields.push(field.displayName):nonAggregatableFields.push(field.displayName))});_ml_api_service.ml.getVisualizerOverallStats({indexPatternTitle:indexPattern.title,query:$scope.searchQuery,timeFieldName:indexPattern.timeFieldName,samplerShardSize:$scope.samplerShardSize,earliest:$scope.earliest,latest:$scope.latest,aggregatableFields:aggregatableFields,nonAggregatableFields:nonAggregatableFields}).then(function(resp){$scope.overallStats=resp;createMetricCards();createNonMetricCards()}).catch(function(err){console.log("DataVisualizer - error getting overall stats from elasticsearch:",err);500===err.statusCode?_notify.notify.error("Error loading data for fields in index "+indexPattern.title+". "+err.message+". The request may have timed out. Try using a smaller sample size or narrowing the time range.",{lifetime:3e4}):_notify.notify.error("Error loading data for fields in index "+indexPattern.title+". "+err.message,{lifetime:3e4})})}loadOverallStats()})},3837:function(module,exports){module.exports='<ml-nav-menu name="datavisualizer"></ml-nav-menu>\n<ml-chart-tooltip></ml-chart-tooltip>\n<ml-datavisualizer class="data-visualizer-container">\n  <div ng-controller="MlDataVisualizerViewFields" >\n    <div class="title-container euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--justifyContentSpaceBetween euiFlexGroup--alignItemsCenter euiFlexGroup--responsive">\n      <div class="euiFlexItem euiFlexItem--flexGrowZero euiText">\n        <h1>{{indexPattern.title}}</h1>\n      </div>\n      <div class="euiFlexItem euiFlexItem--flexGrowZero">\n          <ml-full-time-range-selector index-pattern=\'indexPattern\' query=\'searchQuery\' />\n      </div>\n    </div>\n\n    <div class="main-container">\n\n      <div class="kuiPanel kuiVerticalRhythm datavisualizer-panel">\n\n        <form\n          ng-submit="submitSearchQuery()"\n          name="querybarform"\n          class="flexGroup__filler query-bar-form"\n          style="width: 100%"\n        >\n          <div class="kuiLocalSearch">\n            <input\n              type="text"\n              class="kuiLocalSearchInput"\n              ng-model="searchQueryText"\n              placeholder="Search... (e.g. status:200 AND extension:PHP)"\n              aria-label="Search input"\n              autocomplete="off"\n            >\n            <button\n              class="kuiLocalSearchButton"\n              type="submit"\n              aria-label="Search"\n            >\n              <span aria-hidden="true" class="kuiIcon fa-search"></span>\n            </button>\n          </div>\n        </form>\n\n        <div class="document-count-container">\n          <label for="sampleShardSize">Sample</label>\n          <select id="sampleShardSize" class="kuiSelect type-input" ng-model="samplerShardSize" ng-change="samplerShardSizeChanged(samplerShardSize)">\n            <option ng-value="1000">1000</option>\n            <option ng-value="5000">5000</option>\n            <option ng-value="10000">10000</option>\n            <option ng-value="100000">100000</option>\n            <option ng-value="-1">all</option>\n          </select>\n          <span>documents per shard from a total of</span>\n          <span class="field-emphasis">{{ overallStats.totalCount }}</span>\n          <ng-pluralize count="overallStats.totalCount" when="{\'1\':\'document\', \'other\':\'documents\'}">documents</ng-pluralize>\n          <i aria-hidden="true" class="fa fa-info-circle" tooltip-placement="right"\n            tooltip="Selecting a smaller sample size will reduce query run times and the load on the cluster."></i>\n        </div>\n\n      </div>\n\n      <div class="kuiPanel kuiVerticalRhythm datavisualizer-panel card-panel">\n      \t<div class="euiText">\n          <h2 class="kuiSubTitle kuiVerticalRhythm">Metrics</h2>\n        </div>\n\n        <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--justifyContentSpaceBetween euiFlexGroup--responsive euiFlexGroup--wrap">\n          <div class="field-sort-controls euiFlexItem euiFlexItem--flexGrowZero">\n            <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n              <div ng-if="showAllMetrics === false" class="field-count-label euiFlexItem euiFlexItem--flexGrowZero">\n                <span class="field-emphasis">{{ metricCards.length }}</span>\n                <ng-pluralize count="metricCards.length" when="{\'1\':\'field exists\', \'other\':\'fields exist\'}">fields exist</ng-pluralize> in documents (\n                <span class="field-emphasis">{{ totalMetricFieldCount }}</span> in total)\n              </div>\n\n              <div ng-if="showAllMetrics === true" class="field-count-label euiFlexItem euiFlexItem--flexGrowZero">\n                <span class="field-emphasis">{{ metricCards.length }}</span>\n                <ng-pluralize count="metricCards.length" when="{\'1\':\'field\', \'other\':\'fields\'}">fields</ng-pluralize>\n                (\n                <span class="field-emphasis">{{ populatedMetricFieldCount }}</span>\n                <ng-pluralize count="populatedMetricFieldCount" when="{\'1\':\'exists\', \'other\':\'exist\'}">exist</ng-pluralize> in documents)\n              </div>\n\n              <div ng-hide="populatedMetricFieldCount === totalMetricFieldCount" class="field-group-input euiFlexItem euiFlexItem--flexGrowZero">\n                <input id="toggleAllMetricsCheckbox" type="checkbox" class="kuiCheckBox" ng-click="toggleAllMetrics()" ng-checked="showAllMetrics === true">\n                <label for="toggleAllMetricsCheckbox">show empty fields</label>\n              </div>\n            </div>\n          </div>\n          <div class="field-filter-controls euiFlexItem euiFlexItem--flexGrowZero">\n            <ml-form-filter-input\n              filter="metricFieldFilter"\n              filter-icon="metricFilterIcon"\n              filter-changed="metricFieldFilterChanged"\n              clear-filter="clearMetricFilter" />\n          </div>\n        </div>\n\n        <div class="card-container" ng-repeat="card in metricCards">\n          <ml-field-data-card\n            index-pattern="indexPattern"\n            query="searchQuery"\n            earliest="earliest"\n            latest="latest"\n            card="card">\n          </ml-field-data-card>\n        </div>\n\n      </div>\n\n      <div class="kuiPanel kuiVerticalRhythm datavisualizer-panel card-panel">\n        <div class="euiText">\n          <h2 class="kuiSubTitle kuiVerticalRhythm">Fields</h2>\n        </div>\n\n        <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--justifyContentSpaceBetween euiFlexGroup--responsive euiFlexGroup--wrap">\n          <div class="field-sort-controls euiFlexItem euiFlexItem--flexGrowZero">\n            <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--responsive">\n              <div ng-if="showAllFields === false" class="field-count-label euiFlexItem euiFlexItem--flexGrowZero">\n                <span class="field-emphasis">{{ fieldCards.length }}</span>\n                <ng-pluralize count="fieldCards.length" when="{\'1\':\'field exists\', \'other\':\'fields exist\'}">fields exist</ng-pluralize> in documents\n                (<span class="field-emphasis">{{ totalNonMetricFieldCount }}</span> in total)\n              </div>\n\n              <div ng-if="showAllFields === true" class="field-count-label euiFlexItem euiFlexItem--flexGrowZero">\n                <span class="field-emphasis">{{ fieldCards.length }}</span>\n                <ng-pluralize count="fieldCards.length" when="{\'1\':\'field\', \'other\':\'fields\'}">fields</ng-pluralize>\n                (<span class="field-emphasis">{{ populatedNonMetricFieldCount }}</span>\n                <ng-pluralize count="populatedNonMetricFieldCount" when="{\'1\':\'exists\', \'other\':\'exist\'}">exist</ng-pluralize> in documents)\n              </div>\n\n              <div ng-hide="populatedNonMetricFieldCount === totalNonMetricFieldCount" class="field-group-input euiFlexItem euiFlexItem--flexGrowZero">\n                <input id="toggleAllFieldsCheckbox" type="checkbox" class="kuiCheckBox" ng-click="toggleAllFields()" ng-checked="showAllFields === true">\n                <label for="toggleAllFieldsCheckbox">show empty fields</label>\n              </div>\n            </div>\n          </div>\n          <div class="field-filter-controls euiFlexItem euiFlexItem--flexGrowZero">\n            <div class="euiFlexGroup euiFlexGroup--gutterSmall euiFlexGroup--responsive">\n              <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                <select class="kuiSelect type-input"\n                  ng-model="filterFieldType"\n                  ng-change="filterFieldTypeChanged(filterFieldType)"\n                  aria-label="Select field types">\n                  <option value="*">All field types</option>\n                  <option ng-repeat="type in indexedFieldTypes" value="{{type}}">{{type}} types</option>\n                </select>\n              </div>\n              <div class="euiFlexItem euiFlexItem--flexGrowZero">\n                <ml-form-filter-input\n                  filter="fieldFilter"\n                  filter-icon="fieldFilterIcon"\n                  filter-changed="fieldFilterChanged"\n                  clear-filter="clearFieldFilter" />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="card-container" ng-repeat="card in fieldCards">\n          <ml-field-data-card\n            index-pattern="indexPattern"\n            query="searchQuery"\n            earliest="earliest"\n            latest="latest"\n            card="card">\n          </ml-field-data-card>\n        </div>\n\n      </div>\n\n    </div>\n\n    <div class="datavisualizer-sidebar">\n      <ng-include src="urlBasePath+\'/plugins/ml/datavisualizer/datavisualizer_sidebar.html\'"></ng-include>\n    </div>\n\n  </div>\n</ml-datavisualizer>\n'},3838:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3839);__webpack_require__(3840);__webpack_require__(3842);__webpack_require__(3843);__webpack_require__(3845);__webpack_require__(3846);__webpack_require__(370);__webpack_require__(636)},3839:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _d=__webpack_require__(19);var _d2=_interopRequireDefault(_d);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _parse_interval=__webpack_require__(117);var _chart_utils=__webpack_require__(256);var _string_utils=__webpack_require__(40);var _ml_time_buckets=__webpack_require__(277);var _modules=__webpack_require__(2);var _timefilter=__webpack_require__(14);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlDocumentCountChart",function(Private,mlChartTooltipService){function link(scope,element,attrs){var svgWidth=attrs.width?+attrs.width:400;var svgHeight=scope.height=attrs.height?+attrs.height:400;var margin={top:0,right:5,bottom:20,left:15};var chartWidth=svgWidth-(margin.left+margin.right);var chartHeight=svgHeight-(margin.top+margin.bottom);var xScale=null;var yScale=_d2.default.scale.linear().range([chartHeight,0]);var xAxisTickFormat="YYYY-MM-DD HH:mm";var barChartGroup=void 0;var barWidth=5;var MlTimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);scope.chartData=[];element.on("$destroy",function(){scope.$destroy()});function processChartData(){var bucketsData=_lodash2.default.get(scope,["card","stats","documentCounts","buckets"],{});var chartData=[];_lodash2.default.each(bucketsData,function(value,time){chartData.push({date:new Date(+time),time:+time,value:value})});scope.chartData=chartData}function render(){var chartElement=_d2.default.select(element.get(0)).select(".content-wrapper");chartElement.selectAll("*").remove();if(void 0===scope.chartData)return;var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);var maxYVal=_d2.default.max(scope.chartData,function(d){return d.value});yScale=yScale.domain([0,maxYVal]);var yAxis=_d2.default.svg.axis().scale(yScale).orient("left").outerTickSize(0);var maxYAxisLabelWidth=(0,_string_utils.calculateTextWidth)(maxYVal,true,svg);margin.left=Math.max(maxYAxisLabelWidth+yAxis.tickPadding()+5,25);chartWidth=Math.max(svgWidth-margin.left-margin.right,0);var bounds=_timefilter.timefilter.getActiveBounds();xScale=_d2.default.time.scale().domain([new Date(bounds.min.valueOf()),new Date(bounds.max.valueOf())]).range([0,chartWidth]);if(scope.chartData.length>0){var buckets=new MlTimeBuckets;var aggInterval=_lodash2.default.get(scope,["card","stats","documentCounts","interval"]);buckets.setInterval(aggInterval);buckets.setBounds(bounds);xAxisTickFormat=buckets.getScaledDateFormat();var intervalMs=(0,_parse_interval.parseInterval)(aggInterval).asMilliseconds();barWidth=xScale(scope.chartData[0].time+intervalMs)-xScale(scope.chartData[0].time)}var xAxis=_d2.default.svg.axis().scale(xScale).orient("bottom").outerTickSize(0).ticks((0,_chart_utils.numTicksForDateFormat)(chartWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)});barChartGroup=svg.append("g").attr("class","bar-chart").attr("transform","translate("+margin.left+", "+margin.top+")");drawBarChartAxes(xAxis,yAxis);drawBarChartPaths()}function drawBarChartAxes(xAxis,yAxis){var axes=barChartGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0, "+chartHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis)}function drawBarChartPaths(){barChartGroup.selectAll("bar").data(scope.chartData).enter().append("rect").attr("class","bar").attr("x",function(d){return xScale(d.time)}).attr("width",barWidth).attr("y",function(d){return yScale(d.value)}).attr("height",function(d){return chartHeight-yScale(d.value)}).on("mouseover",function(d){showChartTooltip(d,this)}).on("mousemove",function(d){showChartTooltip(d,this)}).on("mouseout",function(){return mlChartTooltipService.hide()});function showChartTooltip(data,rect){var formattedDate=(0,_moment2.default)(data.time).format("MMMM Do YYYY, HH:mm");var contents=formattedDate+"<br/><hr/>count: "+data.value;var rectY=_d2.default.select(rect).attr("y");var mouseY=+_d2.default.mouse(rect)[1];mlChartTooltipService.show(contents,rect,{x:5,y:mouseY-rectY})}}processChartData();render()}return{scope:false,link:link}})},3840:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);__webpack_require__(366);var _field_data_card=__webpack_require__(3841);var _field_data_card2=_interopRequireDefault(_field_data_card);var _field_types=__webpack_require__(322);var _string_utils=__webpack_require__(40);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlFieldDataCard",function(){function link(scope,element){scope.ML_JOB_FIELD_TYPES=_field_types.ML_JOB_FIELD_TYPES;scope.mlEscape=_string_utils.mlEscape;if(scope.card.type===_field_types.ML_JOB_FIELD_TYPES.NUMBER){if(scope.card.fieldName){scope.$watch("card.stats",function(){var cardinality=_lodash2.default.get(scope,["card","stats","cardinality"],0);scope.detailsMode=cardinality>100?"distribution":"top"});var cardinality=_lodash2.default.get(scope,["card","stats","cardinality"],0);scope.detailsMode=cardinality>100?"distribution":"top"}(0,_jquery2.default)(".ml-field-data-card-tooltip").remove();(0,_jquery2.default)("body").append('<div class="ml-field-data-card-tooltip" style="opacity:0; display: none;">')}scope.card.type===_field_types.ML_JOB_FIELD_TYPES.DATE&&scope.$watch("card.stats",function(){_lodash2.default.has(scope,"card.stats.earliest")&&(scope.card.stats.earliest=new Date(scope.card.stats.earliest));_lodash2.default.has(scope,"card.stats.latest")&&(scope.card.stats.latest=new Date(scope.card.stats.latest))},true);scope.getCardUrl=function(){var urlBasePath=_chrome2.default.getBasePath();var baseCardPath=urlBasePath+"/plugins/ml/components/field_data_card/content_types";var cardType=scope.card.type;switch(cardType){case _field_types.ML_JOB_FIELD_TYPES.BOOLEAN:return baseCardPath+"/card_boolean.html";case _field_types.ML_JOB_FIELD_TYPES.DATE:return baseCardPath+"/card_date.html";case _field_types.ML_JOB_FIELD_TYPES.GEO_POINT:return baseCardPath+"/card_geo_point.html";case _field_types.ML_JOB_FIELD_TYPES.IP:return baseCardPath+"/card_ip.html";case _field_types.ML_JOB_FIELD_TYPES.KEYWORD:return baseCardPath+"/card_keyword.html";case _field_types.ML_JOB_FIELD_TYPES.NUMBER:return scope.card.fieldName?baseCardPath+"/card_number.html":baseCardPath+"/card_document_count.html";case _field_types.ML_JOB_FIELD_TYPES.TEXT:return baseCardPath+"/card_text.html";default:return baseCardPath+"/card_other.html"}};element.on("$destroy",function(){scope.$destroy()})}return{scope:{card:"=",indexPattern:"=",query:"=",earliest:"=",latest:"="},template:_field_data_card2.default,link:link}}).filter("formatField",function(){return function(value,fieldFormat){return fieldFormat.convert(value,"text")}})},3841:function(module,exports){module.exports='<div class="ml-field-data-card">\n  <ml-field-title-bar card="card" />\n\n  <div ng-if="card.loading === true" class="card-contents">\n    <ml-loading-indicator\n      label="Loading"\n      is-loading="card.loading"\n      height="200"\n    />\n  </div>\n\n  <div ng-if="card.existsInDocs === false" class="card-contents">\n    <div class="not-exist-message">\n      <i class="fa fa-exclamation-triangle" aria-hidden="true"></i>\n      This field does not appear in any documents for the selected time range\n    </div>\n  </div>\n\n  <ng-include ng-if="card.loading === false" src="getCardUrl()"></ng-include>\n</div>\n'},3842:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _d=__webpack_require__(19);var _d2=_interopRequireDefault(_d);var _chart_utils=__webpack_require__(256);var _ordinal_suffix=__webpack_require__(1311);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlMetricDistributionChart",function(mlChartTooltipService){function link(scope,element,attrs){var svgWidth=attrs.width?+attrs.width:400;var svgHeight=scope.height=attrs.height?+attrs.height:400;var margin={top:0,right:15,bottom:20,left:15};var infoLabelHeight=15;var chartWidth=svgWidth-(margin.left+margin.right);var chartHeight=svgHeight-(margin.top+margin.bottom+infoLabelHeight);var xScale=_d2.default.scale.linear().range([0,chartWidth]);var yScale=_d2.default.scale.linear().range([chartHeight,0]);var xAxisMin=0;var xAxisMax=1;var chartGroup=void 0;var distributionArea=_d2.default.svg.area().x(function(d){return xScale(d.x)}).y0(function(){return yScale(0)}).y1(function(d){return yScale(d.y)});var MIN_BAR_WIDTH=3;element.on("$destroy",function(){scope.$destroy()});function processDistributionData(){var distributionData=_lodash2.default.get(scope,["card","stats","distribution","percentiles"],[]);var chartData=[];if(0===distributionData.length)return chartData;var minX=distributionData[0].minValue;var maxX=distributionData[distributionData.length-1].maxValue;xAxisMin=minX;xAxisMax=maxX;if(maxX===minX)if(0!==minX){xAxisMin=0;xAxisMax=2*minX}else xAxisMax=1;var minBarWidth=MIN_BAR_WIDTH/chartWidth*(xAxisMax-xAxisMin);var processedData=[];var lastBar=void 0;_lodash2.default.each(distributionData,function(data,index){if(0===index){var bar={x0:data.minValue,x1:Math.max(data.minValue+minBarWidth,data.maxValue),dataMin:data.minValue,dataMax:data.maxValue,percent:data.percent};bar.y=data.percent/(bar.x1-bar.x0)*Math.max(1,minBarWidth/Math.max(data.maxValue-data.minValue,.5*minBarWidth));bar.isMinWidth=data.maxValue<=data.minValue+minBarWidth;processedData.push(bar);lastBar=bar}else if(false===lastBar.isMinWidth||data.maxValue>lastBar.x1){var _bar={x0:lastBar.x1,x1:Math.max(lastBar.x1+minBarWidth,data.maxValue),dataMin:data.minValue,dataMax:data.maxValue,percent:data.percent};_bar.y=data.percent/(_bar.x1-_bar.x0)*Math.max(1,minBarWidth/Math.max(data.maxValue-data.minValue,.5*minBarWidth));_bar.isMinWidth=data.maxValue<=lastBar.x1+minBarWidth;processedData.push(_bar);lastBar=_bar}else{lastBar.percent=lastBar.percent+data.percent;lastBar.y=lastBar.percent/(lastBar.x1-lastBar.x0);lastBar.dataMax=data.maxValue}});maxX!==minX&&(xAxisMax=_lodash2.default.last(processedData).x1);var barHeights=_lodash2.default.pluck(processedData,"y");barHeights=barHeights.sort(function(a,b){return a-b});var maxBarHeight=0;var processedDataLength=processedData.length;maxBarHeight=1===Math.abs(processedDataLength%2)?20*barHeights[Math.floor(processedDataLength/2)]:20*(barHeights[Math.floor(processedDataLength/2)-1]+barHeights[Math.floor(processedDataLength/2)])/2;_lodash2.default.each(processedData,function(data){data.y=Math.min(data.y,maxBarHeight)});scope.processedData=processedData;chartData.push({x:minX,y:0});_lodash2.default.each(processedData,function(data){chartData.push({x:data.x0,y:data.y});chartData.push({x:data.x1,y:data.y})});chartData.push({x:processedData[processedData.length-1].x1,y:0});return chartData}function init(){scope.chartData=processDistributionData();var chartElement=_d2.default.select(element.get(0)).select(".content-wrapper");chartElement.select("svg").remove();var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);var minPercentile=_lodash2.default.get(scope,["card","stats","distribution","minPercentile"]);var maxPercentile=_lodash2.default.get(scope,["card","stats","distribution","maxPercentile"]);var minPercent=(0,_ordinal_suffix.ordinalSuffix)(minPercentile);var maxPercent=(0,_ordinal_suffix.ordinalSuffix)(maxPercentile);svg.append("text").attr("x",chartWidth/2).attr("y",10).attr("class","info-text").attr("transform","translate("+margin.left+", "+margin.top+")").text("Displaying "+minPercent+" - "+maxPercent+" percentiles");var translateTop=margin.top+infoLabelHeight;chartGroup=svg.append("g").attr("class","distribution-chart").attr("transform","translate("+margin.left+", "+translateTop+")");var dataLength=scope.chartData.length;if(dataLength>0){xScale=xScale.domain([xAxisMin,xAxisMax]);var yMax=_d2.default.max(scope.chartData,function(d){return d.y});yScale=yScale.domain([0,yMax])}}function drawAxes(){var axes=chartGroup.append("g").attr("class","axes");var xAxis=_d2.default.svg.axis().scale(xScale).orient("bottom").outerTickSize(0).ticks((0,_chart_utils.numTicks)(chartWidth)).tickFormat(function(d){return scope.card.fieldFormat.convert(d,"text")});var yAxis=_d2.default.svg.axis().scale(yScale).orient("left").outerTickSize(0).ticks(0);axes.append("g").attr("class","x axis").attr("transform","translate(0, "+chartHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis)}function drawDistributionArea(){var path=chartGroup.append("path");path.datum(scope.chartData).attr("class","area").attr("d",distributionArea).on("mouseover",showChartTooltip).on("mouseout",function(){return mlChartTooltipService.hide()}).on("mousemove",showChartTooltip);function showChartTooltip(){var xPos=_d2.default.mouse(this)[0];var yPos=_d2.default.mouse(this)[1];var xVal=xScale.invert(xPos);var processedDataIdx=0;for(var i=0;i<scope.processedData.length;i++)if(xVal<scope.processedData[i].x1){processedDataIdx=i;break}var contents="value:"+xVal;var bar=scope.processedData[processedDataIdx];var minValFormatted=scope.card.fieldFormat.convert(bar.dataMin,"text");if(bar.dataMax>bar.dataMin){var maxValFormatted=scope.card.fieldFormat.convert(bar.dataMax,"text");contents=bar.percent+"% of documents have<br>values between "+minValFormatted+" and "+maxValFormatted}else contents=bar.percent+"% of documents have<br>a value of "+minValFormatted;contents="<div class='centered-text'>"+contents+"</div>";path.length&&path[0].length&&mlChartTooltipService.show(contents,path[0][0],{x:xPos+5,y:yPos+10})}}init();drawAxes();drawDistributionArea()}return{scope:false,link:link}})},3843:function(module,exports,__webpack_require__){"use strict";var _top_values=__webpack_require__(3844);var _top_values2=_interopRequireDefault(_top_values);var _string_utils=__webpack_require__(40);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlTopValues",function(){return{restrict:"E",template:_top_values2.default,link:function link(scope){scope.mlEscape=_string_utils.mlEscape}}})},3844:function(module,exports){module.exports='<div ng-repeat="value in card.stats.topValues" class="top-value">\n  <div class="field-label"\n    tooltip-html-unsafe="{{mlEscape(value.key) | formatField:card.fieldFormat}}"\n    tooltip-append-to-body="true"\n    tooltip-placement="right">\n    {{value.key | formatField:card.fieldFormat}}\n  </div>\n  <div class="top-value-bar-holder">\n    <div ng-if="card.stats.isTopValuesSampled === false"\n      class="top-value-bar {{card.type}}"\n      ng-attr-style="width: {{ 100 * value.doc_count/card.stats.count }}%;"\n      tooltip-html-unsafe="{{ 100 * value.doc_count/card.stats.count >= 0.1 ? (100 * value.doc_count/card.stats.count | number:1): \'< 0.1\' }}%"\n      tooltip-append-to-body="true"\n      tooltip-placement="right">\n    </div>\n    <div ng-if="card.stats.isTopValuesSampled === true"\n      class="top-value-bar {{card.type}}"\n      ng-attr-style="width: {{ 100 * value.doc_count/card.stats.topValuesSampleSize }}%;"\n      tooltip-html-unsafe="{{ 100 * value.doc_count/card.stats.topValuesSampleSize >= 0.1 ? (100 * value.doc_count/card.stats.topValuesSampleSize | number:1): \'< 0.1\' }}%"\n      tooltip-append-to-body="true"\n      tooltip-placement="right">\n    </div>\n  </div>\n  <div ng-if="card.stats.isTopValuesSampled === false" class="count-label">{{value.doc_count}}</div>\n  <div ng-if="card.stats.isTopValuesSampled === true" class="count-label">\n    {{ 100 * value.doc_count/card.stats.topValuesSampleSize >= 0.1 ? (100 * value.doc_count/card.stats.topValuesSampleSize | number:1): \'< 0.1\' }}%\n  </div>\n</div>\n<div ng-if="card.stats.isTopValuesSampled === true" class="sampled-message euiText">\n  Calculated from sample of {{ card.stats.topValuesSamplerShardSize }} documents per shard\n</div>\n'},3845:function(module,exports){},3846:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3847);__webpack_require__(3849)},3847:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _field_title_bar=__webpack_require__(3848);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlFieldTitleBar",function(){return{restrict:"E",replace:false,scope:{card:"="},link:function link(scope,element){scope.$watch("card",updateComponent);updateComponent();function updateComponent(){var props={card:scope.card};_reactDom2.default.render(_react2.default.createElement(_field_title_bar.FieldTitleBar,props),element[0])}}}})},3848:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.FieldTitleBar=FieldTitleBar;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _field_type_icon=__webpack_require__(370);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function FieldTitleBar(_ref){var card=_ref.card;if("object"!==("undefined"===typeof card?"undefined":_typeof(card))||null===card)return null;var classNames=["ml-field-title-bar"];void 0===card.fieldName?classNames.push("document_count"):true===card.isUnsupportedType?classNames.push("type-other"):classNames.push(card.type);var fieldName=card.fieldName||"document count";return _react2.default.createElement(_eui.EuiText,{className:classNames.join(" ")},_react2.default.createElement(_field_type_icon.FieldTypeIcon,{type:card.type,tooltipEnabled:true}),_react2.default.createElement(_eui.EuiToolTip,{position:"left",content:fieldName},_react2.default.createElement("div",{className:"field-name"},fieldName)))}FieldTitleBar.propTypes={card:_propTypes2.default.object.isRequired}},3849:function(module,exports){},3850:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3851);__webpack_require__(3899);__webpack_require__(3900);__webpack_require__(3901);__webpack_require__(3902);__webpack_require__(3911);__webpack_require__(877)},3851:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _dragselect=__webpack_require__(3852);var _dragselect2=_interopRequireDefault(_dragselect);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);__webpack_require__(1444);__webpack_require__(1447);__webpack_require__(3888);__webpack_require__(877);var _query_filter=__webpack_require__(274);var _parse_interval=__webpack_require__(117);var _promise=__webpack_require__(89);var _explorer=__webpack_require__(3898);var _explorer2=_interopRequireDefault(_explorer);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(68);var _check_privilege=__webpack_require__(35);var _index_utils=__webpack_require__(128);var _refresh_interval_watcher=__webpack_require__(1449);var _ml_time_buckets=__webpack_require__(277);var _ml_api_service=__webpack_require__(23);var _results_service=__webpack_require__(426);var _job_service=__webpack_require__(24);var _field_format_service=__webpack_require__(255);var _job_select_service=__webpack_require__(503);var _job_utils=__webpack_require__(41);var _timefilter=__webpack_require__(14);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}_routes2.default.when("/explorer/?",{template:_explorer2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,indexPatterns:_index_utils.loadIndexPatterns,initPromise:(0,_promise.initPromise)(true)}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlExplorerController",function($scope,$timeout,AppState,Private,mlCheckboxShowChartsService,mlExplorerDashboardService,mlSelectLimitService,mlSelectIntervalService,mlSelectSeverityService){$scope.timeFieldName="timestamp";$scope.loading=true;_timefilter.timefilter.enableTimeRangeSelector();_timefilter.timefilter.enableAutoRefreshSelector();var TimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);var queryFilter=Private(_query_filter.FilterBarQueryFilterProvider);var mlJobSelectService=Private(_job_select_service.JobSelectServiceProvider);var resizeTimeout=null;var $mlExplorer=(0,_jquery2.default)(".ml-explorer");var MAX_INFLUENCER_FIELD_VALUES=10;var MAX_CATEGORY_EXAMPLES=10;var VIEW_BY_JOB_LABEL="job ID";var ALLOW_CELL_RANGE_SELECTION=mlExplorerDashboardService.allowCellRangeSelection;var disableDragSelectOnMouseLeave=true;$scope.queryFilters=[];var dragSelect=new _dragselect2.default({selectables:document.querySelectorAll(".sl-cell"),callback:function callback(elements){elements.length>1&&!ALLOW_CELL_RANGE_SELECTION&&(elements=[elements[0]]);elements.length>0&&mlExplorerDashboardService.dragSelect.changed({action:"newSelection",elements:elements});disableDragSelectOnMouseLeave=true},onDragStart:function onDragStart(){if(ALLOW_CELL_RANGE_SELECTION){mlExplorerDashboardService.dragSelect.changed({action:"dragStart"});disableDragSelectOnMouseLeave=false}},onElementSelect:function onElementSelect(){ALLOW_CELL_RANGE_SELECTION&&mlExplorerDashboardService.dragSelect.changed({action:"elementSelect"})}});$scope.selectedJobs=null;$scope.getSelectedJobIds=function(){var selectedJobs=_lodash2.default.filter($scope.jobs,function(job){return job.selected});return _lodash2.default.map(selectedJobs,function(job){return job.id})};$scope.viewBySwimlaneOptions=[];$scope.viewBySwimlaneData={fieldName:"",laneLabels:[],points:[],interval:3600};$scope.initializeVis=function(){var stateDefaults={filters:[],mlExplorerSwimlane:{}};$scope.appState=new AppState(stateDefaults);$scope.jobs=[];_job_service.mlJobService.loadJobs().then(function(resp){if(resp.jobs.length>0){$scope.jobs=createJobs(resp.jobs);var selectedJobIds=mlJobSelectService.getSelectedJobIds(true);$scope.setSelectedJobs(selectedJobIds)}else $scope.loading=false}).catch(function(resp){console.log("Explorer - error getting job info from elasticsearch:",resp)});mlExplorerDashboardService.init()};function createJobs(jobs){return jobs.map(function(job){var bucketSpan=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span);return{id:job.job_id,selected:false,bucketSpanSeconds:bucketSpan.asSeconds()}})}$scope.setSelectedJobs=function(selectedIds){var previousSelected=0;null!==$scope.selectedJobs&&(previousSelected=$scope.selectedJobs.length);var recreateJobs=false;var hasInfluencers=false;selectedIds.forEach(function(id){false===recreateJobs&&void 0===_lodash2.default.find($scope.jobs,{id:id})&&(recreateJobs=true);var job=_job_service.mlJobService.getJob(id);var influencers=[];void 0!==job&&(influencers=job.analysis_config.influencers||[]);hasInfluencers=hasInfluencers||influencers.length>0});true===recreateJobs&&($scope.jobs=createJobs(_job_service.mlJobService.jobs));$scope.noInfluencersConfigured=!hasInfluencers;$scope.selectedJobs=[];_lodash2.default.each($scope.jobs,function(job){job.selected=-1!==_lodash2.default.indexOf(selectedIds,job.id);job.selected&&$scope.selectedJobs.push(job)});(previousSelected<=1&&$scope.selectedJobs.length>1||1===$scope.selectedJobs.length&&previousSelected>1)&&delete $scope.appState.mlExplorerSwimlane.viewBy;$scope.appState.save();_field_format_service.mlFieldFormatService.populateFormats(selectedIds,(0,_index_utils.getIndexPatterns)()).finally(function(){clearSelectedAnomalies();loadOverallData()})};$scope.setSwimlaneSelectActive=function(active){if(!active&&disableDragSelectOnMouseLeave){dragSelect.clearSelection();dragSelect.stop();return}dragSelect.start()};$scope.setSwimlaneViewBy=function(viewByFieldName){$scope.swimlaneViewByFieldName=viewByFieldName;$scope.appState.mlExplorerSwimlane.viewBy=viewByFieldName;$scope.appState.save();loadViewBySwimlane([]);clearSelectedAnomalies()};$scope.$listenAndDigestAsync(_timefilter.timefilter,"fetch",function(){loadOverallData();clearSelectedAnomalies()});var refreshWatcher=Private(_refresh_interval_watcher.refreshIntervalWatcher);refreshWatcher.init(function(){loadOverallData();clearSelectedAnomalies()});mlJobSelectService.listenJobSelectionChange($scope,function(event,selections){delete $scope.appState.mlExplorerSwimlane.selectedType;delete $scope.appState.mlExplorerSwimlane.selectedLane;delete $scope.appState.mlExplorerSwimlane.selectedTime;delete $scope.appState.mlExplorerSwimlane.selectedInterval;$scope.setSelectedJobs(selections)});(0,_jquery2.default)(window).resize(function(){null!==resizeTimeout&&$timeout.cancel(resizeTimeout);resizeTimeout=$timeout(redrawOnResize,500)});var navListener=$scope.$on("globalNav:update",function(){$timeout(function(){redrawOnResize()},300)});function redrawOnResize(){$scope.swimlaneWidth=getSwimlaneContainerWidth();$scope.$apply();mlExplorerDashboardService.swimlaneDataChange.changed("overall");mlExplorerDashboardService.swimlaneDataChange.changed("viewBy")}$scope.$listen(queryFilter,"update",function(){$scope.queryFilters=queryFilter.getFilters();console.log("explorer_controller queryFilter update, filters:",$scope.queryFilters)});$scope.initializeVis();$scope.showViewBySwimlane=function(){return null!==$scope.viewBySwimlaneData&&$scope.viewBySwimlaneData.laneLabels&&$scope.viewBySwimlaneData.laneLabels.length>0};function getSelectionTimeRange(cellData){var bounds=_timefilter.timefilter.getActiveBounds();var earliestMs=bounds.min.valueOf();var latestMs=bounds.max.valueOf();if(void 0!==cellData&&void 0!==cellData.time){earliestMs=void 0!==cellData.time[0]?1e3*cellData.time[0]:bounds.min.valueOf();latestMs=bounds.max.valueOf();void 0!==cellData.time[1]&&(latestMs=1e3*(cellData.time[1]+cellData.interval)-1)}return{earliestMs:earliestMs,latestMs:latestMs}}function getSelectionInfluencers(cellData){var influencers=[];void 0!==cellData&&void 0!==cellData.fieldName&&cellData.fieldName!==VIEW_BY_JOB_LABEL&&cellData.laneLabels.forEach(function(laneLabel){influencers.push({fieldName:$scope.swimlaneViewByFieldName,fieldValue:laneLabel})});return influencers}var swimlaneCellClickListener=function swimlaneCellClickListener(cellData){if(0===_lodash2.default.keys(cellData).length){$scope.viewByLoadedForTimeFormatted&&loadViewBySwimlane([]);clearSelectedAnomalies()}else{var timerange=getSelectionTimeRange(cellData);$scope.cellData=cellData;if(cellData.score>0){if(void 0===cellData.fieldName){loadViewBySwimlaneForSelectedTime(timerange.earliestMs,timerange.latestMs);$scope.viewByLoadedForTimeFormatted=(0,_moment2.default)(timerange.earliestMs).format("MMMM Do YYYY, HH:mm")}var jobIds=cellData.fieldName===VIEW_BY_JOB_LABEL?cellData.laneLabels:$scope.getSelectedJobIds();var influencers=getSelectionInfluencers(cellData);loadAnomaliesTableData();loadDataForCharts(jobIds,influencers,timerange.earliestMs,timerange.latestMs)}else{$scope.$evalAsync(function(){$scope.influencers={};$scope.anomalyChartRecords=[];$scope.tableData={anomalies:[],interval:mlSelectIntervalService.state.get("interval").val,examplesByJobId:{},showViewSeriesLink:true}});mlExplorerDashboardService.anomalyDataChange.changed([],timerange.earliestMs,timerange.latestMs)}}};mlExplorerDashboardService.swimlaneCellClick.watch(swimlaneCellClickListener);var checkboxShowChartsListener=function checkboxShowChartsListener(){var showCharts=mlCheckboxShowChartsService.state.get("showCharts");if(showCharts&&void 0!==$scope.cellData)swimlaneCellClickListener($scope.cellData);else{var timerange=getSelectionTimeRange($scope.cellData);mlExplorerDashboardService.anomalyDataChange.changed([],timerange.earliestMs,timerange.latestMs)}};mlCheckboxShowChartsService.state.watch(checkboxShowChartsListener);var anomalyChartsSeverityListener=function anomalyChartsSeverityListener(){var showCharts=mlCheckboxShowChartsService.state.get("showCharts");if(showCharts&&void 0!==$scope.cellData){var timerange=getSelectionTimeRange($scope.cellData);mlExplorerDashboardService.anomalyDataChange.changed($scope.anomalyChartRecords,timerange.earliestMs,timerange.latestMs)}};mlSelectSeverityService.state.watch(anomalyChartsSeverityListener);var tableControlsListener=function tableControlsListener(){loadAnomaliesTableData()};mlSelectIntervalService.state.watch(tableControlsListener);mlSelectSeverityService.state.watch(tableControlsListener);var swimlaneLimitListener=function swimlaneLimitListener(){loadViewBySwimlane([]);clearSelectedAnomalies()};mlSelectLimitService.state.watch(swimlaneLimitListener);var swimlaneRenderDoneListener=function swimlaneRenderDoneListener(){dragSelect.addSelectables(document.querySelectorAll(".sl-cell"))};mlExplorerDashboardService.swimlaneRenderDone.watch(swimlaneRenderDoneListener);$scope.$on("$destroy",function(){dragSelect.stop();mlCheckboxShowChartsService.state.unwatch(checkboxShowChartsListener);mlExplorerDashboardService.swimlaneCellClick.unwatch(swimlaneCellClickListener);mlExplorerDashboardService.swimlaneRenderDone.unwatch(swimlaneRenderDoneListener);mlSelectSeverityService.state.unwatch(anomalyChartsSeverityListener);mlSelectIntervalService.state.unwatch(tableControlsListener);mlSelectSeverityService.state.unwatch(tableControlsListener);mlSelectLimitService.state.unwatch(swimlaneLimitListener);delete $scope.cellData;refreshWatcher.cancel();navListener()});function loadDataForCharts(jobIds,influencers,earliestMs,latestMs){0===influencers.length&&getTopInfluencers(jobIds,earliestMs,latestMs);_results_service.mlResultsService.getRecordsForInfluencer(jobIds,influencers,0,earliestMs,latestMs,500).then(function(resp){if(void 0!==$scope.cellData&&_lodash2.default.keys($scope.cellData).length>0){$scope.anomalyChartRecords=resp.records;console.log("Explorer anomaly charts data set:",$scope.anomalyChartRecords);mlCheckboxShowChartsService.state.get("showCharts")&&mlExplorerDashboardService.anomalyDataChange.changed($scope.anomalyChartRecords,earliestMs,latestMs)}if(influencers.length>0){var recordInfluencersByName={};influencers.forEach(function(influencer){var fieldName=influencer.fieldName;void 0===recordInfluencersByName[influencer.fieldName]&&(recordInfluencersByName[influencer.fieldName]=[]);recordInfluencersByName[fieldName].push(influencer.fieldValue)});resp.records.forEach(function(record){var influencersByName=record.influencers||[];influencersByName.forEach(function(influencer){var _recordInfluencersByN;var fieldName=influencer.influencer_field_name;var fieldValues=influencer.influencer_field_values;void 0===recordInfluencersByName[fieldName]&&(recordInfluencersByName[fieldName]=[]);(_recordInfluencersByN=recordInfluencersByName[fieldName]).push.apply(_recordInfluencersByN,_toConsumableArray(fieldValues))})});var uniqValuesByName={};Object.keys(recordInfluencersByName).forEach(function(fieldName){var fieldValues=recordInfluencersByName[fieldName];uniqValuesByName[fieldName]=_lodash2.default.uniq(fieldValues)});var filterInfluencers=[];Object.keys(uniqValuesByName).forEach(function(fieldName){var matchingFieldName=influencers.find(function(influencer){return influencer.fieldName===fieldName});void 0!==matchingFieldName?filterInfluencers.push.apply(filterInfluencers,_toConsumableArray(influencers)):uniqValuesByName[fieldName].forEach(function(fieldValue){filterInfluencers.push({fieldName:fieldName,fieldValue:fieldValue})})});getTopInfluencers(jobIds,earliestMs,latestMs,filterInfluencers)}})}function loadViewBySwimlaneOptions(){$scope.swimlaneViewByFieldName=null;var viewByOptions=[];var selectedJobIds=$scope.getSelectedJobIds();var fieldsByJob={"*":[]};_lodash2.default.each(_job_service.mlJobService.jobs,function(job){var fieldsForJob=[];var analysisConfig=job.analysis_config;var detectors=analysisConfig.detectors||[];_lodash2.default.each(detectors,function(detector){_lodash2.default.has(detector,"partition_field_name")&&fieldsForJob.push(detector.partition_field_name);_lodash2.default.has(detector,"over_field_name")&&fieldsForJob.push(detector.over_field_name);_lodash2.default.has(detector,"by_field_name")&&!_lodash2.default.has(detector,"over_field_name")&&fieldsForJob.push(detector.by_field_name)});var influencers=analysisConfig.influencers||[];fieldsForJob=fieldsForJob.concat(influencers);-1!==selectedJobIds.indexOf(job.job_id)&&(viewByOptions=viewByOptions.concat(influencers));fieldsByJob[job.job_id]=_lodash2.default.uniq(fieldsForJob);fieldsByJob["*"]=_lodash2.default.union(fieldsByJob["*"],fieldsByJob[job.job_id])});$scope.fieldsByJob=fieldsByJob;viewByOptions=_lodash2.default.chain(viewByOptions).uniq().sortBy(function(fieldName){return fieldName.toLowerCase()}).value();viewByOptions.push(VIEW_BY_JOB_LABEL);$scope.viewBySwimlaneOptions=viewByOptions;if(void 0!==$scope.appState.mlExplorerSwimlane.viewBy&&-1!==$scope.viewBySwimlaneOptions.indexOf($scope.appState.mlExplorerSwimlane.viewBy))$scope.swimlaneViewByFieldName=$scope.appState.mlExplorerSwimlane.viewBy;else{if(selectedJobIds.length>1)$scope.swimlaneViewByFieldName=VIEW_BY_JOB_LABEL;else{var firstSelectedJob=_lodash2.default.find(_job_service.mlJobService.jobs,function(job){return job.job_id===selectedJobIds[0]});var firstJobInfluencers=firstSelectedJob.analysis_config.influencers||[];_lodash2.default.each(firstSelectedJob.analysis_config.detectors,function(detector){if(_lodash2.default.has(detector,"partition_field_name")&&-1!==firstJobInfluencers.indexOf(detector.partition_field_name)){$scope.swimlaneViewByFieldName=detector.partition_field_name;return false}if(_lodash2.default.has(detector,"over_field_name")&&-1!==firstJobInfluencers.indexOf(detector.over_field_name)){$scope.swimlaneViewByFieldName=detector.over_field_name;return false}if(_lodash2.default.has(detector,"by_field_name")&&!_lodash2.default.has(detector,"over_field_name")&&-1!==firstJobInfluencers.indexOf(detector.by_field_name)){$scope.swimlaneViewByFieldName=detector.by_field_name;return false}});null===$scope.swimlaneViewByFieldName&&(firstJobInfluencers.length>0?$scope.swimlaneViewByFieldName=firstJobInfluencers[0]:$scope.swimlaneViewByFieldName=$scope.viewBySwimlaneOptions.length>0?$scope.viewBySwimlaneOptions[0]:null)}$scope.appState.mlExplorerSwimlane.viewBy=$scope.swimlaneViewByFieldName;$scope.appState.save()}loadViewBySwimlane([])}function loadOverallData(){if(null===$scope.selectedJobs)return;$scope.loading=true;$scope.hasResults=false;$scope.swimlaneBucketInterval=calculateSwimlaneBucketInterval();console.log("Explorer swimlane bucketInterval:",$scope.swimlaneBucketInterval);var bounds=_timefilter.timefilter.getActiveBounds();var searchBounds=(0,_ml_time_buckets.getBoundsRoundedToInterval)(bounds,$scope.swimlaneBucketInterval,false);var selectedJobIds=$scope.getSelectedJobIds();var overallBucketsBounds=(0,_ml_time_buckets.getBoundsRoundedToInterval)(bounds,$scope.swimlaneBucketInterval,true);_results_service.mlResultsService.getOverallBucketScores(selectedJobIds,1,overallBucketsBounds.min.valueOf(),overallBucketsBounds.max.valueOf(),$scope.swimlaneBucketInterval.asSeconds()+"s").then(function(resp){processOverallResults(resp.results,searchBounds);console.log("Explorer overall swimlane data set:",$scope.overallSwimlaneData);if($scope.overallSwimlaneData.points&&$scope.overallSwimlaneData.points.length>0){$scope.hasResults=true;loadViewBySwimlaneOptions()}else $scope.hasResults=false;$scope.loading=false;$timeout(function(){$scope.$broadcast("render");mlExplorerDashboardService.swimlaneDataChange.changed("overall")},0)})}function getTopInfluencers(selectedJobIds,earliestMs,latestMs){var influencers=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];true!==$scope.noInfluencersConfigured?_results_service.mlResultsService.getTopInfluencers(selectedJobIds,earliestMs,latestMs,MAX_INFLUENCER_FIELD_VALUES,influencers).then(function(resp){$scope.influencers=resp.influencers;console.log("Explorer top influencers data set:",$scope.influencers)}):$scope.influencers={}}function loadViewBySwimlane(fieldValues){function finish(){console.log("Explorer view by swimlane data set:",$scope.viewBySwimlaneData);$timeout(function(){mlExplorerDashboardService.swimlaneDataChange.changed("viewBy")},0)}if(void 0===$scope.selectedJobs||void 0===$scope.swimlaneViewByFieldName||null===$scope.swimlaneViewByFieldName){$scope.viewBySwimlaneData={fieldName:"",laneLabels:[],points:[],interval:3600};finish()}else{var bounds=_timefilter.timefilter.getActiveBounds();var searchBounds=(0,_ml_time_buckets.getBoundsRoundedToInterval)(bounds,$scope.swimlaneBucketInterval,false);var selectedJobIds=$scope.getSelectedJobIds();var limit=mlSelectLimitService.state.get("limit");var swimlaneLimit=void 0===limit?10:limit.val;var interval=$scope.swimlaneBucketInterval.asSeconds()+"s";if($scope.swimlaneViewByFieldName!==VIEW_BY_JOB_LABEL)_results_service.mlResultsService.getInfluencerValueMaxScoreByTime(selectedJobIds,$scope.swimlaneViewByFieldName,fieldValues,searchBounds.min.valueOf(),searchBounds.max.valueOf(),interval,swimlaneLimit).then(function(resp){processViewByResults(resp.results,fieldValues);finish()});else{var jobIds=void 0!==fieldValues&&fieldValues.length>0?fieldValues:selectedJobIds;_results_service.mlResultsService.getScoresByBucket(jobIds,searchBounds.min.valueOf(),searchBounds.max.valueOf(),interval,swimlaneLimit).then(function(resp){processViewByResults(resp.results,fieldValues);finish()})}}}function loadViewBySwimlaneForSelectedTime(earliestMs,latestMs){var selectedJobIds=$scope.getSelectedJobIds();var limit=mlSelectLimitService.state.get("limit");var swimlaneLimit=void 0===limit?10:limit.val;$scope.swimlaneViewByFieldName!==VIEW_BY_JOB_LABEL?_results_service.mlResultsService.getTopInfluencers(selectedJobIds,earliestMs,latestMs,swimlaneLimit).then(function(resp){var topFieldValues=[];var topInfluencers=resp.influencers[$scope.swimlaneViewByFieldName];_lodash2.default.each(topInfluencers,function(influencerData){influencerData.maxAnomalyScore>0&&topFieldValues.push(influencerData.influencerFieldValue)});loadViewBySwimlane(topFieldValues)}):_results_service.mlResultsService.getScoresByBucket(selectedJobIds,earliestMs,latestMs,$scope.swimlaneBucketInterval.asSeconds()+"s",swimlaneLimit).then(function(resp){loadViewBySwimlane(_lodash2.default.keys(resp.results))})}function loadAnomaliesTableData(){var cellData=$scope.cellData;var jobIds=void 0!==$scope.cellData&&cellData.fieldName===VIEW_BY_JOB_LABEL?cellData.laneLabels:$scope.getSelectedJobIds();var influencers=getSelectionInfluencers(cellData);var timeRange=getSelectionTimeRange(cellData);_ml_api_service.ml.results.getAnomaliesTableData(jobIds,[],influencers,mlSelectIntervalService.state.get("interval").val,mlSelectSeverityService.state.get("threshold").val,timeRange.earliestMs,timeRange.latestMs,500,MAX_CATEGORY_EXAMPLES).then(function(resp){var anomalies=resp.anomalies;var detectorsByJob=_job_service.mlJobService.detectorsByJob;anomalies.forEach(function(anomaly){var jobId=anomaly.jobId;var detector=_lodash2.default.get(detectorsByJob,[jobId,anomaly.detectorIndex]);anomaly.detector=_lodash2.default.get(detector,["detector_description"],anomaly.source.function_description);var customRules=detector.custom_rules;void 0!==customRules&&(anomaly.rulesLength=customRules.length);anomaly.isTimeSeriesViewDetector=(0,_job_utils.isTimeSeriesViewDetector)(_job_service.mlJobService.getJob(jobId),anomaly.detectorIndex);_lodash2.default.has(_job_service.mlJobService.customUrlsByJob,jobId)&&(anomaly.customUrls=_job_service.mlJobService.customUrlsByJob[jobId])});$scope.$evalAsync(function(){$scope.tableData={anomalies:anomalies,interval:resp.interval,examplesByJobId:resp.examplesByJobId,showViewSeriesLink:true}})}).catch(function(resp){console.log("Explorer - error loading data for anomalies table:",resp)})}function clearSelectedAnomalies(){$scope.anomalyChartRecords=[];$scope.viewByLoadedForTimeFormatted=null;delete $scope.cellData;var jobIds=$scope.getSelectedJobIds();var bounds=_timefilter.timefilter.getActiveBounds();var earliestMs=bounds.min.valueOf();var latestMs=bounds.max.valueOf();mlExplorerDashboardService.anomalyDataChange.changed($scope.anomalyChartRecords,earliestMs,latestMs);loadDataForCharts(jobIds,[],earliestMs,latestMs);loadAnomaliesTableData()}function calculateSwimlaneBucketInterval(){var bounds=_timefilter.timefilter.getActiveBounds();var buckets=new TimeBuckets;buckets.setInterval("auto");buckets.setBounds(bounds);var intervalSeconds=buckets.getInterval().asSeconds();var numBuckets=parseInt((bounds.max.valueOf()-bounds.min.valueOf())/1e3/intervalSeconds);var swimlaneWidth=getSwimlaneContainerWidth();var cellWidth=Math.floor(swimlaneWidth/numBuckets);$scope.swimlaneWidth=swimlaneWidth;cellWidth<8&&buckets.setInterval(2*intervalSeconds+"s");var selectedJobs=_lodash2.default.filter($scope.jobs,function(job){return job.selected});var maxBucketSpanSeconds=_lodash2.default.reduce(selectedJobs,function(memo,job){return Math.max(memo,job.bucketSpanSeconds)},0);if(maxBucketSpanSeconds>intervalSeconds){buckets.setInterval(maxBucketSpanSeconds+"s");buckets.setBounds(bounds)}return buckets.getInterval()}function getSwimlaneContainerWidth(){return true===$scope.noInfluencersConfigured?$mlExplorer.width()-250:$mlExplorer.width()/6*5-220}function processOverallResults(scoresByTime,searchBounds){var dataset={laneLabels:["Overall"],points:[],interval:$scope.swimlaneBucketInterval.asSeconds(),earliest:searchBounds.min.valueOf()/1e3,latest:searchBounds.max.valueOf()/1e3};_lodash2.default.keys(scoresByTime).length>0&&_lodash2.default.each(scoresByTime,function(score,timeMs){var time=timeMs/1e3;dataset.points.push({laneLabel:"Overall",time:time,value:score});dataset.earliest=Math.min(time,dataset.earliest);dataset.latest=Math.max(time+dataset.interval,dataset.latest)});$scope.overallSwimlaneData=dataset}function processViewByResults(scoresByInfluencerAndTime,sortedLaneValues){var dataset={fieldName:$scope.swimlaneViewByFieldName,points:[],interval:$scope.swimlaneBucketInterval.asSeconds()};dataset.earliest=$scope.overallSwimlaneData.earliest;dataset.latest=$scope.overallSwimlaneData.latest;var laneLabels=[];var maxScoreByLaneLabel={};_lodash2.default.each(scoresByInfluencerAndTime,function(influencerData,influencerFieldValue){laneLabels.push(influencerFieldValue);maxScoreByLaneLabel[influencerFieldValue]=0;_lodash2.default.each(influencerData,function(anomalyScore,timeMs){var time=timeMs/1e3;dataset.points.push({laneLabel:influencerFieldValue,time:time,value:anomalyScore});maxScoreByLaneLabel[influencerFieldValue]=Math.max(maxScoreByLaneLabel[influencerFieldValue],anomalyScore)})});var sortValuesLength=sortedLaneValues.length;dataset.laneLabels=0===sortValuesLength?laneLabels.sort(function(a,b){return maxScoreByLaneLabel[b]-maxScoreByLaneLabel[a]}):laneLabels.sort(function(a,b){var aIndex=sortedLaneValues.indexOf(a);var bIndex=sortedLaneValues.indexOf(b);aIndex=aIndex>-1?aIndex:sortValuesLength;bIndex=bIndex>-1?bIndex:sortValuesLength;return aIndex-bIndex});$scope.viewBySwimlaneData=dataset}})},3852:function(module,exports,__webpack_require__){(function(module){var __WEBPACK_AMD_DEFINE_RESULT__;function DragSelect(e){this.multiSelectKeyPressed,this.initialCursorPos,this.initialScroll,this.selected=[],this._prevSelected=[],this._createBindings(),this._setupOptions(e),this.start()}DragSelect.prototype._createBindings=function(){this._startUp=this._startUp.bind(this),this._handleMove=this._handleMove.bind(this),this.reset=this.reset.bind(this),this._onClick=this._onClick.bind(this)},DragSelect.prototype._setupOptions=function(e){if(this.selectables=[],this._handleSelectables(this.toArray(e.selectables)),this.multiSelectKeys=e.multiSelectKeys||["ctrlKey","shiftKey","metaKey"],this.autoScrollSpeed=e.autoScrollSpeed||1,this.selectCallback=e.onElementSelect||function(){},this.unselectCallback=e.onElementUnselect||function(){},this.moveStartCallback=e.onDragStart||function(){},this.moveCallback=e.onDragMove||function(){},this.callback=e.callback||function(){},this.area=e.area||document,this.customStyles=e.customStyles,this.area!==document){var t=getComputedStyle(this.area);"absolute"===t.position||"relative"===t.position||"fixed"===t.position||(this.area.style.position="relative")}this.selector=e.selector||this._createSelector(),this.addClass(this.selector,"ds-selector")},DragSelect.prototype._handleSelectables=function(e,t,s){for(var i=0;i<e.length;i++){var o=e[i],r=this.selectables.indexOf(o);r<0&&!t?(this.addClass(o,"ds-selectable"),o.addEventListener("click",this._onClick),this.selectables.push(o),s&&this.selected.indexOf(o)<0&&(this.addClass(o,"ds-selected"),this.selected.push(o))):r>-1&&t&&(this.removeClass(o,"ds-hover"),this.removeClass(o,"ds-selectable"),o.removeEventListener("click",this._onClick),this.selectables.splice(r,1),s&&this.selected.indexOf(o)>-1&&(this.removeClass(o,"ds-selected"),this.selected.splice(this.selected.indexOf(o),1)))}},DragSelect.prototype._onClick=function(e){if(!this.mouseInteraction){var t=e.target;this.isMultiSelectKeyPressed(e)?this._prevSelected=this.selected.slice():this._prevSelected=[],this.checkIfInsideSelection(!0),this.selectables.indexOf(t)>-1&&(this.toggle(t),this.reset())}},DragSelect.prototype._createSelector=function(){var e=document.createElement("div");return e.style.position="absolute",this.customStyles||(e.style.background="rgba(0, 0, 255, 0.1)",e.style.border="1px solid rgba(0, 0, 255, 0.45)",e.style.display="none",e.style.pointerEvents="none"),(this.area===document?document.body:this.area).appendChild(e),e},DragSelect.prototype.start=function(){this.area.addEventListener("mousedown",this._startUp)},DragSelect.prototype._startUp=function(e){if(this.mouseInteraction=!0,this.selector.style.display="block",this.isMultiSelectKeyPressed(e)?this._prevSelected=this.selected.slice():this._prevSelected=[],this._getStartingPositions(e),this.checkIfInsideSelection(!0),this.selector.style.display="none",this.moveStartCallback(e),this._breaked)return!1;this.area.removeEventListener("mousedown",this._startUp),this.area.addEventListener("mousemove",this._handleMove),this.area.addEventListener("mouseup",this.reset)},DragSelect.prototype.isMultiSelectKeyPressed=function(e){this.multiSelectKeyPressed=!1;for(var t=0;t<this.multiSelectKeys.length;t++)e[this.multiSelectKeys[t]]&&(this.multiSelectKeyPressed=!0);return this.multiSelectKeyPressed},DragSelect.prototype._getStartingPositions=function(e){this.initialCursorPos=this.getCursorPos(e,this.area),this.initialScroll=this.getScroll(this.area);var t={};t.x=this.initialCursorPos.x+this.initialScroll.x,t.y=this.initialCursorPos.y+this.initialScroll.y,t.w=0,t.h=0,this.updatePos(this.selector,t)},DragSelect.prototype._handleMove=function(e){var t=this.getPosition(e);if(this.moveCallback(e),this._breaked)return!1;this.selector.style.display="block",this.updatePos(this.selector,t),this.checkIfInsideSelection(),this._autoScroll(e)},DragSelect.prototype.getPosition=function(e){var t=this.getCursorPos(e,this.area),s=this.getScroll(this.area);this.newCursorPos=t;var i={x:s.x-this.initialScroll.x,y:s.y-this.initialScroll.y},o={};return t.x>this.initialCursorPos.x-i.x?(o.x=this.initialCursorPos.x+this.initialScroll.x,o.w=t.x-this.initialCursorPos.x+i.x):(o.x=t.x+s.x,o.w=this.initialCursorPos.x-t.x-i.x),t.y>this.initialCursorPos.y-i.y?(o.y=this.initialCursorPos.y+this.initialScroll.y,o.h=t.y-this.initialCursorPos.y+i.y):(o.y=t.y+s.y,o.h=this.initialCursorPos.y-t.y-i.y),o},DragSelect.prototype.checkIfInsideSelection=function(e){for(var t=!1,s=0,i=this.selectables.length;s<i;s++){var o=this.selectables[s];this.isElementTouching(o,this.selector,this.area)?(this._handleSelection(o,e),t=!0):this._handleUnselection(o,e)}return t},DragSelect.prototype._handleSelection=function(e,t){if(this.hasClass(e,"ds-hover")&&!t)return!1;var s=this.selected.indexOf(e);s<0?this.select(e):s>-1&&this.multiSelectKeyPressed&&this.unselect(e),this.addClass(e,"ds-hover")},DragSelect.prototype._handleUnselection=function(e,t){if(!this.hasClass(e,"ds-hover")&&!t)return!1;var s=this.selected.indexOf(e),i=this._prevSelected.indexOf(e);s>-1&&i<0?this.unselect(e):s<0&&i>-1&&this.select(e),this.removeClass(e,"ds-hover")},DragSelect.prototype.select=function(e){return!(this.selected.indexOf(e)>-1)&&(this.selected.push(e),this.addClass(e,"ds-selected"),this.selectCallback(e),!this._breaked&&e)},DragSelect.prototype.unselect=function(e){return!(this.selected.indexOf(e)<0)&&(this.selected.splice(this.selected.indexOf(e),1),this.removeClass(e,"ds-selected"),this.unselectCallback(e),!this._breaked&&e)},DragSelect.prototype.toggle=function(e){return this.selected.indexOf(e)>-1?this.unselect(e):this.select(e),e},DragSelect.prototype.isElementTouching=function(e,t,s){var i=this.getScroll(s),o={y:t.getBoundingClientRect().top+i.y,x:t.getBoundingClientRect().left+i.x,h:t.offsetHeight||e.getBoundingClientRect().height,w:t.offsetWidth||e.getBoundingClientRect().width},r={y:e.getBoundingClientRect().top+i.y,x:e.getBoundingClientRect().left+i.x,h:e.offsetHeight||e.getBoundingClientRect().height,w:e.offsetWidth||e.getBoundingClientRect().width};return o.x<r.x+r.w&&o.x+o.w>r.x&&o.y<r.y+r.h&&o.h+o.y>r.y},DragSelect.prototype._autoScroll=function(e){var t=this.isCursorNearEdge(e,this.area),s=this.area===document?this.area.body:this.area;"top"===t&&s.scrollTop>0?s.scrollTop-=1*this.autoScrollSpeed:"bottom"===t?s.scrollTop+=1*this.autoScrollSpeed:"left"===t&&s.scrollLeft>0?s.scrollLeft-=1*this.autoScrollSpeed:"right"===t&&(s.scrollLeft+=1*this.autoScrollSpeed)},DragSelect.prototype.isCursorNearEdge=function(e,t){var s=this.getCursorPos(e,t),i=this.getAreaRect(t),o={x:Math.max(i.width/10,30),y:Math.max(i.height/10,30)};return s.y<o.y?"top":i.height-s.y<o.y?"bottom":i.width-s.x<o.x?"right":s.x<o.x&&"left"},DragSelect.prototype.reset=function(e){if(this.area.removeEventListener("mousemove",this._handleMove),this.area.addEventListener("mousedown",this._startUp),this.callback(this.selected,e),this._breaked)return!1;this.selector.style.width="0",this.selector.style.height="0",this.selector.style.display="none",setTimeout(function(){this.mouseInteraction=!1}.bind(this),100)},DragSelect.prototype.break=function(){this._breaked=!0,setTimeout(function(){this._breaked=!1}.bind(this),100)},DragSelect.prototype.stop=function(){this.reset(),this.area.removeEventListener("mousedown",this._startUp),this.area.removeEventListener("mouseup",this.reset)},DragSelect.prototype.getSelection=function(){return this.selected},DragSelect.prototype.addSelection=function(e,t,s){for(var i=this.toArray(e),o=0,r=i.length;o<r;o++){var l=i[o];this.select(l)}return s||this.addSelectables(i),t&&this.callback(this.selected,!1),this.selected},DragSelect.prototype.removeSelection=function(e,t,s){for(var i=this.toArray(e),o=0,r=i.length;o<r;o++){var l=i[o];this.unselect(l)}return s&&this.removeSelectables(i),t&&this.callback(this.selected,!1),this.selected},DragSelect.prototype.setSelection=function(e,t,s){return this.clearSelection(),this.addSelection(e,t,s),this.selected},DragSelect.prototype.clearSelection=function(e){for(var t=this.selected.slice(),s=0,i=t.length;s<i;s++){var o=t[s];this.unselect(o)}return e&&this.callback(this.selected,!1),this.selected},DragSelect.prototype.addSelectables=function(e,t){var s=this.toArray(e);return this._handleSelectables(s,!1,t),e},DragSelect.prototype.getSelectables=function(){return this.selectables},DragSelect.prototype.removeSelectables=function(e,t){var s=this.toArray(e);return this._handleSelectables(s,!0,t),e},DragSelect.prototype.addClass=function(e,t){if(e.classList)return e.classList.add(t);var s=e.getAttribute("class")||"";return-1!==s.indexOf(t)?e:(""!==s&&(t=" "+t),e.setAttribute("class",s+t),e)},DragSelect.prototype.removeClass=function(e,t){if(e.classList)return e.classList.remove(t);var s=e.getAttribute("class")||"",i=new RegExp(t+"\\b","g");return s=s.replace(i,""),e.setAttribute("class",s),e},DragSelect.prototype.hasClass=function(e,t){return e.classList?e.classList.contains(t):(e.getAttribute("class")||"").indexOf(t)>-1},DragSelect.prototype.toArray=function(e){if(!e)return!1;if(!e.length&&this.isElement(e))return[e];for(var t=[],s=e.length-1;s>=0;s--)t[s]=e[s];return t},DragSelect.prototype.isElement=function(e){try{return e instanceof HTMLElement||e instanceof SVGElement}catch(t){return"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument}},DragSelect.prototype.getCursorPos=function(e,t){var s={x:e.pageX||e.clientX,y:e.pageY||e.clientY},i=this.getAreaRect(t||document),o=this.getScroll();return{x:s.x-i.left-o.x,y:s.y-i.top-o.y}},DragSelect.prototype.getInitialCursorPosition=function(){return this.initialCursorPos},DragSelect.prototype.getCurrentCursorPosition=function(){return this.newCursorPos},DragSelect.prototype.getCursorPositionDifference=function(){var e=this.getInitialCursorPosition(),t=this.getCurrentCursorPosition();return{x:e.x-t.x,y:e.y-t.y}},DragSelect.prototype.getScroll=function(e){var t={top:document.body.scrollTop>0?document.body.scrollTop:document.documentElement.scrollTop,left:document.body.scrollLeft>0?document.body.scrollLeft:document.documentElement.scrollLeft};return{y:e&&e.scrollTop>=0?e.scrollTop:t.top,x:e&&e.scrollLeft>=0?e.scrollLeft:t.left}},DragSelect.prototype.getAreaRect=function(e){if(e===document){var t={y:e.documentElement.clientHeight>0?e.documentElement.clientHeight:window.innerHeight,x:e.documentElement.clientWidth>0?e.documentElement.clientWidth:window.innerWidth};return{top:0,left:0,bottom:0,right:0,width:t.x,height:t.y}}return{top:e.getBoundingClientRect().top,left:e.getBoundingClientRect().left,bottom:e.getBoundingClientRect().bottom,right:e.getBoundingClientRect().right,width:e.offsetWidth,height:e.offsetHeight}},DragSelect.prototype.updatePos=function(e,t){return e.style.left=t.x+"px",e.style.top=t.y+"px",e.style.width=t.w+"px",e.style.height=t.h+"px",e},"undefined"!=typeof module&&null!==module?module.exports=DragSelect:(true,true)&&__webpack_require__(558)?!(__WEBPACK_AMD_DEFINE_RESULT__=function(){return DragSelect}.call(exports,__webpack_require__,exports,module),void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)):window.DragSelect=DragSelect}).call(exports,__webpack_require__(103)(module))},3853:function(module,exports,__webpack_require__){"use strict";__webpack_require__(93);var _modules=__webpack_require__(2);var _timefilter=__webpack_require__(14);var _anomalies_table=__webpack_require__(3854);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlAnomaliesTable",function($injector){var reactDirective=$injector.get("reactDirective");return reactDirective(_anomalies_table.AnomaliesTable,[["filter",{watchDepth:"reference"}],["tableData",{watchDepth:"reference"}]],{restrict:"E"},{timefilter:_timefilter.timefilter})})},3854:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AnomaliesTable=void 0;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _format=__webpack_require__(286);var _description_cell=__webpack_require__(3855);var _detector_cell=__webpack_require__(3857);var _entity_cell=__webpack_require__(1445);var _influencers_cell=__webpack_require__(3858);var _anomaly_details=__webpack_require__(3859);var _links_menu=__webpack_require__(3860);var _check_privilege=__webpack_require__(35);var _anomalies_table_service=__webpack_require__(876);var _field_format_service=__webpack_require__(255);var _anomaly_utils=__webpack_require__(299);var _format_value=__webpack_require__(637);var _rule_editor=__webpack_require__(3861);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var INFLUENCERS_LIMIT=5;function renderTime(date,aggregationInterval){return"hour"===aggregationInterval?(0,_format.formatDate)(date,"MMMM Do YYYY, HH:mm"):"second"===aggregationInterval?(0,_format.formatDate)(date,"MMMM Do YYYY, HH:mm:ss"):(0,_format.formatDate)(date,"MMMM Do YYYY")}function showLinksMenuForItem(item){var canConfigureRules=(0,_anomaly_utils.isRuleSupported)(item)&&(0,_check_privilege.checkPermission)("canUpdateJob");return canConfigureRules||item.isTimeSeriesViewDetector||"mlcategory"===item.entityName||void 0!==item.customUrls}function getColumns(items,examplesByJobId,isAggregatedData,interval,timefilter,showViewSeriesLink,showRuleEditorFlyout,itemIdToExpandedRowMap,toggleRow,filter){var columns=[{name:"",render:function render(item){return _react2.default.createElement(_eui.EuiButtonIcon,{onClick:function onClick(){return toggleRow(item)},iconType:itemIdToExpandedRowMap[item.rowId]?"arrowDown":"arrowRight","aria-label":itemIdToExpandedRowMap[item.rowId]?"Hide details":"Show details","data-row-id":item.rowId})}},{field:"time",name:"time",dataType:"date",render:function render(date){return renderTime(date,interval)},sortable:true},{field:"severity",name:(true===isAggregatedData?"max ":"")+"severity",render:function render(score){return _react2.default.createElement(_eui.EuiHealth,{color:(0,_anomaly_utils.getSeverityColor)(score),compressed:"true"},score>=1?Math.floor(score):"< 1")},sortable:true},{field:"detector",name:"detector",render:function render(detectorDescription,item){return _react2.default.createElement(_detector_cell.DetectorCell,{detectorDescription:detectorDescription,numberOfRules:item.rulesLength})},sortable:true}];items.some(function(item){return void 0!==item.entityValue})&&columns.push({field:"entityValue",name:"found for",render:function render(entityValue,item){return _react2.default.createElement(_entity_cell.EntityCell,{entityName:item.entityName,entityValue:entityValue,filter:filter})},sortable:true});items.some(function(item){return void 0!==item.influencers})&&columns.push({field:"influencers",name:"influenced by",render:function render(influencers){return _react2.default.createElement(_influencers_cell.InfluencersCell,{limit:INFLUENCERS_LIMIT,influencers:influencers})},sortable:true});items.some(function(item){return void 0!==item.actual})&&columns.push({field:"actualSort",name:"actual",render:function render(actual,item){var fieldFormat=_field_format_service.mlFieldFormatService.getFieldFormat(item.jobId,item.source.detector_index);return(0,_format_value.formatValue)(item.actual,item.source.function,fieldFormat)},sortable:true});if(items.some(function(item){return void 0!==item.typical})){columns.push({field:"typicalSort",name:"typical",render:function render(typical,item){var fieldFormat=_field_format_service.mlFieldFormatService.getFieldFormat(item.jobId,item.source.detector_index);return(0,_format_value.formatValue)(item.typical,item.source.function,fieldFormat)},sortable:true});var nonTimeOfDayOrWeek=items.some(function(item){var summaryRecFunc=item.source.function;return"time_of_day"!==summaryRecFunc&&"time_of_week"!==summaryRecFunc});true===nonTimeOfDayOrWeek&&columns.push({field:"metricDescriptionSort",name:"description",render:function render(metricDescriptionSort,item){return _react2.default.createElement(_description_cell.DescriptionCell,{actual:item.actual,typical:item.typical})},sortable:true})}columns.push({field:"jobId",name:"job ID",sortable:true});var showLinks=true===showViewSeriesLink||items.some(function(item){return showLinksMenuForItem(item)});true===showLinks&&columns.push({name:"actions",render:function render(item){return true===showLinksMenuForItem(item)?_react2.default.createElement(_links_menu.LinksMenu,{anomaly:item,showViewSeriesLink:showViewSeriesLink,isAggregatedData:isAggregatedData,interval:interval,timefilter:timefilter,showRuleEditorFlyout:showRuleEditorFlyout}):null},sortable:false});var showExamples=items.some(function(item){return"mlcategory"===item.entityName});true===showExamples&&columns.push({name:"category examples",sortable:false,truncateText:true,render:function render(item){var examples=_lodash2.default.get(examplesByJobId,[item.jobId,item.entityValue],[]);return _react2.default.createElement(_eui.EuiText,{size:"xs"},examples.map(function(example,i){return _react2.default.createElement("span",{key:"example"+i,className:"category-example"},example)}))}});return columns}var AnomaliesTable=function(_Component){_inherits(AnomaliesTable,_Component);function AnomaliesTable(props){_classCallCheck(this,AnomaliesTable);var _this=_possibleConstructorReturn(this,(AnomaliesTable.__proto__||Object.getPrototypeOf(AnomaliesTable)).call(this,props));_this.isShowingAggregatedData=function(){return"second"!==_this.props.tableData.interval};_this.toggleRow=function(item){var itemIdToExpandedRowMap=_extends({},_this.state.itemIdToExpandedRowMap);if(itemIdToExpandedRowMap[item.rowId])delete itemIdToExpandedRowMap[item.rowId];else{var examples="mlcategory"===item.entityName?_lodash2.default.get(_this.props.tableData,["examplesByJobId",item.jobId,item.entityValue]):void 0;itemIdToExpandedRowMap[item.rowId]=_react2.default.createElement(_anomaly_details.AnomalyDetails,{anomaly:item,examples:examples,isAggregatedData:_this.isShowingAggregatedData(),filter:_this.props.filter,influencersLimit:INFLUENCERS_LIMIT})}_this.setState({itemIdToExpandedRowMap:itemIdToExpandedRowMap})};_this.onMouseOverRow=function(record){if(void 0!==_this.mouseOverRecord){if(_this.mouseOverRecord.rowId!==record.rowId){_anomalies_table_service.mlAnomaliesTableService.anomalyRecordMouseleave.changed(_this.mouseOverRecord);_anomalies_table_service.mlAnomaliesTableService.anomalyRecordMouseenter.changed(record)}}else _anomalies_table_service.mlAnomaliesTableService.anomalyRecordMouseenter.changed(record);_this.mouseOverRecord=record};_this.onMouseLeaveRow=function(){if(void 0!==_this.mouseOverRecord){_anomalies_table_service.mlAnomaliesTableService.anomalyRecordMouseleave.changed(_this.mouseOverRecord);_this.mouseOverRecord=void 0}};_this.setShowRuleEditorFlyoutFunction=function(func){_this.setState({showRuleEditorFlyout:func})};_this.unsetShowRuleEditorFlyoutFunction=function(){var showRuleEditorFlyout=function showRuleEditorFlyout(){};_this.setState({showRuleEditorFlyout:showRuleEditorFlyout})};_this.state={itemIdToExpandedRowMap:{},showRuleEditorFlyout:function showRuleEditorFlyout(){}};return _this}_createClass(AnomaliesTable,[{key:"render",value:function render(){var _this2=this;var _props=this.props,timefilter=_props.timefilter,tableData=_props.tableData,filter=_props.filter;if(void 0===tableData||void 0===tableData.anomalies||0===tableData.anomalies.length)return _react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceAround"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("h4",null,"No matching anomalies found"))));var columns=getColumns(tableData.anomalies,tableData.examplesByJobId,this.isShowingAggregatedData(),tableData.interval,timefilter,tableData.showViewSeriesLink,this.state.showRuleEditorFlyout,this.state.itemIdToExpandedRowMap,this.toggleRow,filter);var sorting={sort:{field:"severity",direction:"desc"}};var getRowProps=function getRowProps(item){return{onMouseOver:function onMouseOver(){return _this2.onMouseOverRow(item)},onMouseLeave:function onMouseLeave(){return _this2.onMouseLeaveRow()}}};return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_rule_editor.RuleEditorFlyout,{setShowFunction:this.setShowRuleEditorFlyoutFunction,unsetShowFunction:this.unsetShowRuleEditorFlyoutFunction}),_react2.default.createElement(_eui.EuiInMemoryTable,{className:"ml-anomalies-table eui-textBreakWord",items:tableData.anomalies,columns:columns,pagination:{pageSizeOptions:[10,25,100],initialPageSize:25},sorting:sorting,itemId:"rowId",itemIdToExpandedRowMap:this.state.itemIdToExpandedRowMap,compressed:true,rowProps:getRowProps}))}}],[{key:"getDerivedStateFromProps",value:function getDerivedStateFromProps(nextProps,prevState){var itemIdToExpandedRowMap=prevState.itemIdToExpandedRowMap;var prevExpandedNotInData=Object.keys(itemIdToExpandedRowMap).find(function(rowId){var matching=nextProps.tableData.anomalies.find(function(anomaly){return anomaly.rowId===rowId});return void 0===matching});if(void 0!==prevExpandedNotInData)return{itemIdToExpandedRowMap:{}};return null}}]);return AnomaliesTable}(_react.Component);AnomaliesTable.propTypes={timefilter:_propTypes2.default.object.isRequired,tableData:_propTypes2.default.object,filter:_propTypes2.default.func};exports.AnomaliesTable=AnomaliesTable},3855:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DescriptionCell=DescriptionCell;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _metric_change_description=__webpack_require__(3856);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DescriptionCell(_ref){var actual=_ref.actual,typical=_ref.typical;var _getMetricChangeDescr=(0,_metric_change_description.getMetricChangeDescription)(actual,typical),iconType=_getMetricChangeDescr.iconType,message=_getMetricChangeDescr.message;return _react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"s"},void 0!==iconType&&_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiIcon,{type:iconType,size:"s"})),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiText,{size:"xs"},_react2.default.createElement("p",null,message))))}DescriptionCell.propTypes={actual:_propTypes2.default.oneOfType([_propTypes2.default.array,_propTypes2.default.number]),typical:_propTypes2.default.oneOfType([_propTypes2.default.array,_propTypes2.default.number])}},3856:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getMetricChangeDescription=getMetricChangeDescription;var _modules=__webpack_require__(2);var _module=_modules.uiModules.get("apps/ml");function getMetricChangeDescription(actualProp,typicalProp){if(void 0===actualProp||void 0===typicalProp)return{iconType:"empty",message:""};var iconType=void 0;var message=void 0;var actual=actualProp;var typical=typicalProp;if(Array.isArray(actualProp)){if(1!==actualProp.length)return{iconType:"alert",message:"Unusual values"};actual=actualProp[0]}Array.isArray(typicalProp)&&1===typicalProp.length&&(typical=typicalProp[0]);if(actual===typical)message="actual same as typical";else{var isHigher=actual>typical;iconType=isHigher?"sortUp":"sortDown";if(0!==typical&&0!==actual){var factor=isHigher?actual/typical:typical/actual;var direction=isHigher?"higher":"lower";message=factor>1.5?factor<=100?Math.round(factor)+"x "+direction:"More than 100x "+direction:factor>=1.05?factor.toPrecision(2)+"x "+direction:"Unusually "+(isHigher?"high":"low")}else message=0===actual?"Unexpected zero value":"Unexpected non-zero value"}return{iconType:iconType,message:message}}_module.filter("metricChangeDescription",function(){return function(actual,typical){var _getMetricChangeDescr=getMetricChangeDescription(actual,typical),iconType=_getMetricChangeDescr.iconType,message=_getMetricChangeDescr.message;switch(iconType){case"sortUp":return'<i class="fa fa-arrow-up"></i> '+message;case"sortDown":return'<i class="fa fa-arrow-down"></i> '+message;case"alert":return'<i class="fa fa-exclamation-triangle"></i> '+message}return message}})},3857:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DetectorCell=DetectorCell;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DetectorCell(_ref){var detectorDescription=_ref.detectorDescription,numberOfRules=_ref.numberOfRules;var rulesIcon=void 0;void 0!==numberOfRules&&numberOfRules>0&&(rulesIcon=_react2.default.createElement(_eui.EuiToolTip,{content:"rules have been configured for this detector"},_react2.default.createElement(_eui.EuiIcon,{type:"controlsHorizontal",className:"detector-rules-icon"})));return _react2.default.createElement(_react2.default.Fragment,null,detectorDescription,rulesIcon)}DetectorCell.propTypes={detectorDescription:_propTypes2.default.string.isRequired,numberOfRules:_propTypes2.default.number}},3858:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.InfluencersCell=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var InfluencersCell=exports.InfluencersCell=function(_Component){_inherits(InfluencersCell,_Component);function InfluencersCell(props){_classCallCheck(this,InfluencersCell);var _this=_possibleConstructorReturn(this,(InfluencersCell.__proto__||Object.getPrototypeOf(InfluencersCell)).call(this,props));_this.state={showAll:false};return _this}_createClass(InfluencersCell,[{key:"toggleAllInfluencers",value:function toggleAllInfluencers(){this.setState({showAll:!this.state.showAll})}},{key:"renderInfluencers",value:function renderInfluencers(influencers){var numberToDisplay=false===this.state.showAll?this.props.limit:influencers.length;var displayInfluencers=influencers.slice(0,numberToDisplay);var othersCount=Math.max(influencers.length-numberToDisplay,0);if(1===othersCount){displayInfluencers.push(influencers[this.props.limit]);othersCount=0}var displayRows=displayInfluencers.map(function(influencer,index){return _react2.default.createElement("div",{key:index},influencer.influencerFieldName,": ",influencer.influencerFieldValue)});return _react2.default.createElement(_react2.default.Fragment,null,displayRows,this.renderOthers(influencers.length,othersCount))}},{key:"renderOthers",value:function renderOthers(totalCount,othersCount){var _this2=this;if(othersCount>0)return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiLink,{onClick:function onClick(){return _this2.toggleAllInfluencers()}},"and ",othersCount," more"));if(totalCount>this.props.limit+1)return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiLink,{onClick:function onClick(){return _this2.toggleAllInfluencers()}},"show less"))}},{key:"render",value:function render(){var recordInfluencers=this.props.influencers||[];var influencers=[];recordInfluencers.forEach(function(influencer){_lodash2.default.each(influencer,function(influencerFieldValue,influencerFieldName){influencers.push({influencerFieldName:influencerFieldName,influencerFieldValue:influencerFieldValue})})});return _react2.default.createElement("div",null,this.renderInfluencers(influencers),this.renderOthers(influencers))}}]);return InfluencersCell}(_react.Component);InfluencersCell.propTypes={influencers:_propTypes2.default.array,limit:_propTypes2.default.number}},3859:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AnomalyDetails=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _eui=__webpack_require__(3);var _format=__webpack_require__(286);var _entity_cell=__webpack_require__(1445);var _anomaly_utils=__webpack_require__(299);var _format_value=__webpack_require__(637);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var TIME_FIELD_NAME="timestamp";function getFilterEntity(entityName,entityValue,filter){return _react2.default.createElement(_entity_cell.EntityCell,{entityName:entityName,entityValue:entityValue,filter:filter})}function getDetailsItems(anomaly,examples,filter){var source=anomaly.source;var causes=[];var sourceCauses=source.causes||[];var singleCauseByFieldName=void 0;var singleCauseByFieldValue=void 0;if(1===sourceCauses.length){if(void 0!==sourceCauses[0].by_field_name){singleCauseByFieldName=sourceCauses[0].by_field_name;singleCauseByFieldValue=sourceCauses[0].by_field_value}}else causes=sourceCauses.map(function(cause){var simplified=_lodash2.default.pick(cause,"typical","actual","probability");simplified.entityName=_lodash2.default.has(cause,"by_field_name")?cause.by_field_name:cause.over_field_name;simplified.entityValue=_lodash2.default.has(cause,"by_field_value")?cause.by_field_value:cause.over_field_value;return simplified});var items=[];void 0!==source.partition_field_value&&items.push({title:source.partition_field_name,description:getFilterEntity(source.partition_field_name,source.partition_field_value,filter)});void 0!==source.by_field_value&&items.push({title:source.by_field_name,description:getFilterEntity(source.by_field_name,source.by_field_value,filter)});void 0!==singleCauseByFieldName&&items.push({title:singleCauseByFieldName,description:getFilterEntity(singleCauseByFieldName,singleCauseByFieldValue,filter)});void 0!==source.over_field_value&&items.push({title:source.over_field_name,description:getFilterEntity(source.over_field_name,source.over_field_value,filter)});var anomalyTime=source[TIME_FIELD_NAME];var timeDesc=""+(0,_format.formatDate)(anomalyTime,"MMMM Do YYYY, HH:mm:ss");if(void 0!==source.bucket_span){var anomalyEndTime=anomalyTime+1e3*source.bucket_span;timeDesc+=" to "+(0,_format.formatDate)(anomalyEndTime,"MMMM Do YYYY, HH:mm:ss")}items.push({title:"time",description:timeDesc});void 0!==examples&&examples.length>0&&examples.forEach(function(example,index){var title=0===index?"category examples":"";items.push({title:title,description:example})});items.push({title:"function",description:"metric"!==source.function?source.function:source.function_description});void 0!==source.field_name&&items.push({title:"fieldName",description:source.field_name});var functionDescription=source.function_description||"";void 0!==anomaly.actual&&true===(0,_anomaly_utils.showActualForFunction)(functionDescription)&&items.push({title:"actual",description:(0,_format_value.formatValue)(anomaly.actual,source.function)});void 0!==anomaly.typical&&true===(0,_anomaly_utils.showTypicalForFunction)(functionDescription)&&items.push({title:"typical",description:(0,_format_value.formatValue)(anomaly.typical,source.function)});items.push({title:"job ID",description:anomaly.jobId});items.push({title:"probability",description:source.probability});causes.length>1&&causes.forEach(function(cause,index){var title=0===index?cause.entityName+" values":"";var description=cause.entityValue+" (actual "+(0,_format_value.formatValue)(cause.actual,source.function)+", ";description+="typical "+(0,_format_value.formatValue)(cause.typical,source.function)+", probability "+cause.probability+")";items.push({title:title,description:description})});return items}var AnomalyDetails=exports.AnomalyDetails=function(_Component){_inherits(AnomalyDetails,_Component);function AnomalyDetails(props){_classCallCheck(this,AnomalyDetails);var _this=_possibleConstructorReturn(this,(AnomalyDetails.__proto__||Object.getPrototypeOf(AnomalyDetails)).call(this,props));_this.state={showAllInfluencers:false};return _this}_createClass(AnomalyDetails,[{key:"toggleAllInfluencers",value:function toggleAllInfluencers(){this.setState({showAllInfluencers:!this.state.showAllInfluencers})}},{key:"renderDescription",value:function renderDescription(){var anomaly=this.props.anomaly;var source=anomaly.source;var anomalyDescription=(0,_anomaly_utils.getSeverity)(anomaly.severity)+" anomaly in "+anomaly.detector;void 0!==anomaly.entityName&&(anomalyDescription+=" found for "+anomaly.entityName+" "+anomaly.entityValue);if(void 0!==source.partition_field_name&&source.partition_field_name!==anomaly.entityName){anomalyDescription+=" detected in "+source.partition_field_name;anomalyDescription+=" "+source.partition_field_value}var mvDescription=void 0;if(void 0!==source.correlated_by_field_value){mvDescription="multivariate correlations found in "+source.by_field_name+"; ";mvDescription+=source.by_field_value+" is considered anomalous given "+source.correlated_by_field_value}return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiText,{size:"xs"},_react2.default.createElement("h5",null,"Description"),anomalyDescription),void 0!==mvDescription&&_react2.default.createElement(_eui.EuiText,{size:"xs"},mvDescription))}},{key:"renderDetails",value:function renderDetails(){var detailItems=getDetailsItems(this.props.anomaly,this.props.examples,this.props.filter);var isInterimResult=_lodash2.default.get(this.props.anomaly,"source.is_interim",false);return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiText,null,true===this.props.isAggregatedData?_react2.default.createElement("h5",null,"Details on highest severity anomaly"):_react2.default.createElement("h5",null,"Anomaly details"),true===isInterimResult&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiIcon,{type:"alert"}),_react2.default.createElement("span",{className:"interim-result"},"Interim result"))),_react2.default.createElement(_eui.EuiDescriptionList,{type:"column",listItems:detailItems,className:"anomaly-description-list"}))}},{key:"renderInfluencers",value:function renderInfluencers(){var _this2=this;var anomalyInfluencers=this.props.anomaly.influencers;var listItems=[];var othersCount=0;var numToDisplay=0;if(void 0!==anomalyInfluencers){numToDisplay=true===this.state.showAllInfluencers?anomalyInfluencers.length:Math.min(this.props.influencersLimit,anomalyInfluencers.length);othersCount=Math.max(anomalyInfluencers.length-numToDisplay,0);if(1===othersCount){numToDisplay++;othersCount=0}var _loop=function _loop(i){Object.keys(anomalyInfluencers[i]).forEach(function(influencerFieldName){listItems.push({title:influencerFieldName,description:anomalyInfluencers[i][influencerFieldName]})})};for(var i=0;i<numToDisplay;i++)_loop(i)}if(listItems.length>0)return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("h5",null,"Influencers")),_react2.default.createElement(_eui.EuiDescriptionList,{type:"column",listItems:listItems,className:"anomaly-description-list"}),othersCount>0&&_react2.default.createElement(_eui.EuiLink,{onClick:function onClick(){return _this2.toggleAllInfluencers()}},"and ",othersCount," more"),numToDisplay>this.props.influencersLimit+1&&_react2.default.createElement(_eui.EuiLink,{onClick:function onClick(){return _this2.toggleAllInfluencers()}},"show less"))}},{key:"render",value:function render(){return _react2.default.createElement("div",{className:"ml-anomalies-table-details"},this.renderDescription(),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),this.renderDetails(),this.renderInfluencers())}}]);return AnomalyDetails}(_react.Component);AnomalyDetails.propTypes={anomaly:_propTypes2.default.object.isRequired,examples:_propTypes2.default.array,isAggregatedData:_propTypes2.default.bool,filter:_propTypes2.default.func,influencersLimit:_propTypes2.default.number}},3860:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.LinksMenu=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _risonNode=__webpack_require__(254);var _risonNode2=_interopRequireDefault(_risonNode);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _notify=__webpack_require__(9);var _field_types=__webpack_require__(322);var _check_privilege=__webpack_require__(35);var _anomaly_utils=__webpack_require__(299);var _parse_interval=__webpack_require__(127);var _mapping_service=__webpack_require__(427);var _ml_api_service=__webpack_require__(23);var _job_service=__webpack_require__(24);var _custom_url_utils=__webpack_require__(867);var _index_utils=__webpack_require__(128);var _string_utils=__webpack_require__(40);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var LinksMenu=exports.LinksMenu=function(_Component){_inherits(LinksMenu,_Component);function LinksMenu(props){_classCallCheck(this,LinksMenu);var _this=_possibleConstructorReturn(this,(LinksMenu.__proto__||Object.getPrototypeOf(LinksMenu)).call(this,props));_this.openCustomUrl=function(customUrl){var _this$props=_this.props,anomaly=_this$props.anomaly,interval=_this$props.interval,isAggregatedData=_this$props.isAggregatedData;console.log("Anomalies Table - open customUrl for record:",anomaly);var record=_lodash2.default.cloneDeep(anomaly.source);var timestamp=record.timestamp;var configuredUrlValue=customUrl.url_value;var timeRangeInterval=(0,_parse_interval.parseInterval)(customUrl.time_range);if(configuredUrlValue.includes("$earliest$")){var earliestMoment=(0,_moment2.default)(timestamp);if(null!==timeRangeInterval)earliestMoment.subtract(timeRangeInterval);else{earliestMoment=(0,_moment2.default)(timestamp).startOf(interval);"hour"===interval&&earliestMoment.subtract(1,"h")}record.earliest=earliestMoment.toISOString()}if(configuredUrlValue.includes("$latest$")){var latestMoment=(0,_moment2.default)(timestamp).add(record.bucket_span,"s");if(null!==timeRangeInterval)latestMoment.add(timeRangeInterval);else if(true===isAggregatedData){latestMoment=(0,_moment2.default)(timestamp).endOf(interval);"hour"===interval&&latestMoment.add(1,"h")}record.latest=latestMoment.toISOString()}if((configuredUrlValue.includes("$mlcategoryterms$")||configuredUrlValue.includes("$mlcategoryregex$"))&&_lodash2.default.has(record,"mlcategory")){var jobId=record.job_id;var categoryId=record.mlcategory[0];_ml_api_service.ml.results.getCategoryDefinition(jobId,categoryId).then(function(resp){var termsArray=resp.terms.split(" ").map(function(term){return"+"+term});record.mlcategoryterms=termsArray.join(" ");record.mlcategoryregex=resp.regex;var urlPath=(0,_string_utils.replaceStringTokens)(customUrl.url_value,record,true);window.open(urlPath,"_blank")}).catch(function(resp){console.log("openCustomUrl(): error loading categoryDefinition:",resp);_notify.toastNotifications.addDanger("Unable to open link as an error occurred loading details on category ID "+categoryId)})}else{var urlPath=(0,_custom_url_utils.getUrlForRecord)(customUrl,record);window.open(urlPath,"_blank")}};_this.viewSeries=function(){var record=_this.props.anomaly.source;var bounds=_this.props.timefilter.getActiveBounds();var from=bounds.min.toISOString();var to=bounds.max.toISOString();var recordTime=(0,_moment2.default)(record.timestamp);var zoomFrom=recordTime.subtract(50*record.bucket_span,"s").toISOString();var zoomTo=recordTime.add(100*record.bucket_span,"s").toISOString();var entityCondition={};_lodash2.default.has(record,"partition_field_value")&&(entityCondition[record.partition_field_name]=record.partition_field_value);_lodash2.default.has(record,"over_field_value")&&(entityCondition[record.over_field_name]=record.over_field_value);_lodash2.default.has(record,"by_field_value")&&(entityCondition[record.by_field_name]=record.by_field_value);var _g=_risonNode2.default.encode({ml:{jobIds:[record.job_id]},refreshInterval:{display:"Off",pause:false,value:0},time:{from:from,to:to,mode:"absolute"}});var _a=_risonNode2.default.encode({mlTimeSeriesExplorer:{zoom:{from:zoomFrom,to:zoomTo},detectorIndex:record.detector_index,entities:entityCondition},filters:[],query:{query_string:{analyze_wildcard:true,query:"*"}}});var path=_chrome2.default.getBasePath()+"/app/ml#/timeseriesexplorer";path+="?_g="+_g+"&_a="+encodeURIComponent(_a);window.open(path,"_blank")};_this.viewExamples=function(){var categoryId=_this.props.anomaly.entityValue;var record=_this.props.anomaly.source;var indexPatterns=(0,_index_utils.getIndexPatterns)();var job=_job_service.mlJobService.getJob(_this.props.anomaly.jobId);if(void 0===job){console.log("viewExamples(): no job found with ID: "+_this.props.anomaly.jobId);_notify.toastNotifications.addDanger("Unable to view examples as no details could be found for job ID "+_this.props.anomaly.jobId);return}var categorizationFieldName=job.analysis_config.categorization_field_name;var datafeedIndices=job.datafeed_config.indices;var i=0;findFieldType(datafeedIndices[i]);function findFieldType(index){(0,_mapping_service.getFieldTypeFromMapping)(index,categorizationFieldName).then(function(resp){if(""!==resp)createAndOpenUrl(index,resp);else{i++;i<datafeedIndices.length?findFieldType(datafeedIndices[i]):error()}}).catch(function(){error()})}function createAndOpenUrl(index,categorizationFieldType){var indexPatternId=index;for(var j=0;j<indexPatterns.length;j++)if(indexPatterns[j].get("title")===index){indexPatternId=indexPatterns[j].id;break}_ml_api_service.ml.results.getCategoryDefinition(record.job_id,categoryId).then(function(resp){var query=null;categorizationFieldType===_field_types.ES_FIELD_TYPES.KEYWORD?resp.regex&&(query=categorizationFieldName+":/"+resp.regex+"/"):resp.terms&&(query=categorizationFieldName+":"+resp.terms.split(" ").join(" AND "+categorizationFieldName+":"));var recordTime=(0,_moment2.default)(record.timestamp);var from=recordTime.toISOString();var to=recordTime.add(record.bucket_span,"s").toISOString();var _g=_risonNode2.default.encode({refreshInterval:{display:"Off",pause:false,value:0},time:{from:from,to:to,mode:"absolute"}});var appStateProps={index:indexPatternId,filters:[]};null!==query&&(appStateProps.query={query_string:{analyze_wildcard:true,query:query}});var _a=_risonNode2.default.encode(appStateProps);var path=_chrome2.default.getBasePath();path+="/app/kibana#/discover";path+="?_g="+_g;path+="&_a="+encodeURIComponent(_a);window.open(path,"_blank")}).catch(function(resp){console.log("viewExamples(): error loading categoryDefinition:",resp);_notify.toastNotifications.addDanger("Unable to view examples as an error occurred loading details on category ID "+categoryId)})}function error(){console.log("viewExamples(): error finding type of field "+categorizationFieldName+" in indices:",datafeedIndices);_notify.toastNotifications.addDanger("Unable to view examples of documents with mlcategory "+categoryId+" as no mapping could be found for the categorization field "+categorizationFieldName)}};_this.onButtonClick=function(){_this.setState(function(prevState){return{isPopoverOpen:!prevState.isPopoverOpen}})};_this.closePopover=function(){_this.setState({isPopoverOpen:false})};_this.state={isPopoverOpen:false,toasts:[]};return _this}_createClass(LinksMenu,[{key:"render",value:function render(){var _this2=this;var _props=this.props,anomaly=_props.anomaly,showViewSeriesLink=_props.showViewSeriesLink;var canConfigureRules=(0,_anomaly_utils.isRuleSupported)(anomaly.source)&&(0,_check_privilege.checkPermission)("canUpdateJob");var button=_react2.default.createElement(_eui.EuiButtonIcon,{size:"s",color:"text",onClick:this.onButtonClick,iconType:"gear","aria-label":"Select action"});var items=[];void 0!==anomaly.customUrls&&anomaly.customUrls.forEach(function(customUrl,index){items.push(_react2.default.createElement(_eui.EuiContextMenuItem,{key:"custom_url_"+index,icon:"popout",onClick:function onClick(){_this2.closePopover();_this2.openCustomUrl(customUrl)}},customUrl.url_name))});true===showViewSeriesLink&&true===anomaly.isTimeSeriesViewDetector&&items.push(_react2.default.createElement(_eui.EuiContextMenuItem,{key:"view_series",icon:"popout",onClick:function onClick(){_this2.closePopover();_this2.viewSeries()}},"View series"));"mlcategory"===anomaly.entityName&&items.push(_react2.default.createElement(_eui.EuiContextMenuItem,{key:"view_examples",icon:"popout",onClick:function onClick(){_this2.closePopover();_this2.viewExamples()}},"View examples"));canConfigureRules&&items.push(_react2.default.createElement(_eui.EuiContextMenuItem,{key:"create_rule",icon:"controlsHorizontal",onClick:function onClick(){_this2.closePopover();_this2.props.showRuleEditorFlyout(anomaly)}},"Configure rules"));return _react2.default.createElement(_eui.EuiPopover,{id:"singlePanel",button:button,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none",anchorPosition:"downLeft"},_react2.default.createElement(_eui.EuiContextMenuPanel,{items:items}))}}]);return LinksMenu}(_react.Component);LinksMenu.propTypes={anomaly:_propTypes2.default.object.isRequired,showViewSeriesLink:_propTypes2.default.bool,isAggregatedData:_propTypes2.default.bool,interval:_propTypes2.default.string,timefilter:_propTypes2.default.object.isRequired,showRuleEditorFlyout:_propTypes2.default.func}},3861:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _rule_editor_flyout=__webpack_require__(3862);Object.defineProperty(exports,"RuleEditorFlyout",{enumerable:true,get:function get(){return _rule_editor_flyout.RuleEditorFlyout}})},3862:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.RuleEditorFlyout=void 0;var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _notify=__webpack_require__(9);var _detector_description_list=__webpack_require__(1446);var _actions_section=__webpack_require__(3865);var _check_privilege=__webpack_require__(35);var _conditions_section=__webpack_require__(3866);var _scope_section=__webpack_require__(3868);var _select_rule_action=__webpack_require__(3870);var _utils=__webpack_require__(502);var _detector_rule=__webpack_require__(423);var _job_utils=__webpack_require__(41);var _job_service=__webpack_require__(24);var _ml_api_service=__webpack_require__(23);var _metadata=__webpack_require__(91);__webpack_require__(3874);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var docsUrl="https://www.elastic.co/guide/en/elastic-stack-overview/"+_metadata.metadata.branch+"/ml-rules.html";var RuleEditorFlyout=exports.RuleEditorFlyout=function(_Component){_inherits(RuleEditorFlyout,_Component);function RuleEditorFlyout(props){_classCallCheck(this,RuleEditorFlyout);var _this=_possibleConstructorReturn(this,(RuleEditorFlyout.__proto__||Object.getPrototypeOf(RuleEditorFlyout)).call(this,props));_this.showFlyout=function(anomaly){var ruleIndex=-1;var job=_job_service.mlJobService.getJob(anomaly.jobId);if(void 0===job){_notify.toastNotifications.addDanger("Unable to configure rules as an error occurred obtaining details for job ID "+anomaly.jobId);_this.setState({job:job,isFlyoutVisible:false});return}_this.partitioningFieldNames=(0,_job_utils.getPartitioningFieldNames)(job,anomaly.detectorIndex);var detectorIndex=anomaly.detectorIndex;var detector=job.analysis_config.detectors[detectorIndex];void 0===detector.custom_rules&&(ruleIndex=0);var isConditionsEnabled=false;0===ruleIndex&&(isConditionsEnabled=0===_this.partitioningFieldNames.length);_this.setState({anomaly:anomaly,job:job,ruleIndex:ruleIndex,isConditionsEnabled:isConditionsEnabled,isScopeEnabled:false,isFlyoutVisible:true});_this.partitioningFieldNames.length>0&&_this.canGetFilters&&_ml_api_service.ml.filters.filters().then(function(filters){var filterListIds=filters.map(function(filter){return filter.filter_id});_this.setState({filterListIds:filterListIds})}).catch(function(resp){console.log("Error loading list of filters:",resp);_notify.toastNotifications.addDanger("Error loading the filter lists used in the rule scope")})};_this.closeFlyout=function(){_this.setState({isFlyoutVisible:false})};_this.setEditRuleIndex=function(ruleIndex){var detectorIndex=_this.state.anomaly.detectorIndex;var detector=_this.state.job.analysis_config.detectors[detectorIndex];var rules=detector.custom_rules;var rule=void 0===rules||ruleIndex>=rules.length?(0,_utils.getNewRuleDefaults)():rules[ruleIndex];var isConditionsEnabled=0===_this.partitioningFieldNames.length||void 0!==rule.conditions&&rule.conditions.length>0;var isScopeEnabled=void 0!==rule.scope&&Object.keys(rule.scope).length>0;true===isScopeEnabled&&Object.keys(rule.scope).forEach(function(field){rule.scope[field].enabled=true});_this.setState({ruleIndex:ruleIndex,rule:rule,isConditionsEnabled:isConditionsEnabled,isScopeEnabled:isScopeEnabled})};_this.onSkipResultChange=function(e){var checked=e.target.checked;_this.setState(function(prevState){var actions=[].concat(_toConsumableArray(prevState.rule.actions));var idx=actions.indexOf(_detector_rule.ACTION.SKIP_RESULT);-1===idx&&checked?actions.push(_detector_rule.ACTION.SKIP_RESULT):idx>-1&&!checked&&actions.splice(idx,1);return{rule:_extends({},prevState.rule,{actions:actions})}})};_this.onSkipModelUpdateChange=function(e){var checked=e.target.checked;_this.setState(function(prevState){var actions=[].concat(_toConsumableArray(prevState.rule.actions));var idx=actions.indexOf(_detector_rule.ACTION.SKIP_MODEL_UPDATE);-1===idx&&checked?actions.push(_detector_rule.ACTION.SKIP_MODEL_UPDATE):idx>-1&&!checked&&actions.splice(idx,1);return{rule:_extends({},prevState.rule,{actions:actions})}})};_this.onConditionsEnabledChange=function(e){var isConditionsEnabled=e.target.checked;_this.setState(function(prevState){var conditions=void 0;conditions=false===isConditionsEnabled?[]:[(0,_utils.getNewConditionDefaults)()];return{rule:_extends({},prevState.rule,{conditions:conditions}),isConditionsEnabled:isConditionsEnabled}})};_this.addCondition=function(){_this.setState(function(prevState){var conditions=[].concat(_toConsumableArray(prevState.rule.conditions));conditions.push((0,_utils.getNewConditionDefaults)());return{rule:_extends({},prevState.rule,{conditions:conditions})}})};_this.updateCondition=function(index,appliesTo,operator,value){_this.setState(function(prevState){var conditions=[].concat(_toConsumableArray(prevState.rule.conditions));index<conditions.length&&(conditions[index]={applies_to:appliesTo,operator:operator,value:value});return{rule:_extends({},prevState.rule,{conditions:conditions})}})};_this.deleteCondition=function(index){_this.setState(function(prevState){var conditions=[].concat(_toConsumableArray(prevState.rule.conditions));index<conditions.length&&conditions.splice(index,1);return{rule:_extends({},prevState.rule,{conditions:conditions})}})};_this.onScopeEnabledChange=function(e){var isScopeEnabled=e.target.checked;_this.setState(function(prevState){var rule=_extends({},prevState.rule);false===isScopeEnabled&&delete rule.scope;return{rule:rule,isScopeEnabled:isScopeEnabled}})};_this.updateScope=function(fieldName,filterId,filterType,enabled){_this.setState(function(prevState){var scope=_extends({},prevState.rule.scope);void 0===scope&&(scope={});scope[fieldName]={filter_id:filterId,filter_type:filterType,enabled:enabled};return{rule:_extends({},prevState.rule,{scope:scope})}})};_this.saveEdit=function(){var _this$state=_this.state,job=_this$state.job,anomaly=_this$state.anomaly,rule=_this$state.rule,ruleIndex=_this$state.ruleIndex;var jobId=job.job_id;var detectorIndex=anomaly.detectorIndex;(0,_utils.saveJobRule)(job,detectorIndex,ruleIndex,rule).then(function(resp){if(resp.success){_notify.toastNotifications.addSuccess("Changes to "+jobId+" detector rules saved");_this.closeFlyout()}else _notify.toastNotifications.addDanger("Error saving changes to "+jobId+" detector rules")}).catch(function(error){console.error(error);_notify.toastNotifications.addDanger("Error saving changes to "+jobId+" detector rules")})};_this.deleteRuleAtIndex=function(index){var _this$state2=_this.state,job=_this$state2.job,anomaly=_this$state2.anomaly;var jobId=job.job_id;var detectorIndex=anomaly.detectorIndex;(0,_utils.deleteJobRule)(job,detectorIndex,index).then(function(resp){if(resp.success){_notify.toastNotifications.addSuccess("Rule deleted from "+jobId+" detector");_this.closeFlyout()}else _notify.toastNotifications.addDanger("Error deleting rule from "+jobId+" detector")}).catch(function(error){console.error(error);var errorMessage="Error deleting rule from "+jobId+" detector";error.message&&(errorMessage+=" : "+error.message);_notify.toastNotifications.addDanger(errorMessage)})};_this.state={anomaly:{},job:{},ruleIndex:-1,rule:(0,_utils.getNewRuleDefaults)(),skipModelUpdate:false,isConditionsEnabled:false,isScopeEnabled:false,filterListIds:[],isFlyoutVisible:false};_this.partitioningFieldNames=[];_this.canGetFilters=(0,_check_privilege.checkPermission)("canGetFilters");return _this}_createClass(RuleEditorFlyout,[{key:"componentDidMount",value:function componentDidMount(){"function"===typeof this.props.setShowFunction&&this.props.setShowFunction(this.showFlyout)}},{key:"componentWillUnmount",value:function componentWillUnmount(){"function"===typeof this.props.unsetShowFunction&&this.props.unsetShowFunction()}},{key:"render",value:function render(){var _state=this.state,isFlyoutVisible=_state.isFlyoutVisible,job=_state.job,anomaly=_state.anomaly,ruleIndex=_state.ruleIndex,rule=_state.rule,filterListIds=_state.filterListIds,isConditionsEnabled=_state.isConditionsEnabled,isScopeEnabled=_state.isScopeEnabled;if(false===isFlyoutVisible)return null;var flyout=void 0;if(-1===ruleIndex)flyout=_react2.default.createElement(_eui.EuiFlyout,{className:"ml-rule-editor-flyout",onClose:this.closeFlyout,"aria-labelledby":"flyoutTitle"},_react2.default.createElement(_eui.EuiFlyoutHeader,{hasBorder:true},_react2.default.createElement(_eui.EuiTitle,{size:"l"},_react2.default.createElement("h1",{id:"flyoutTitle"},"Edit Rules"))),_react2.default.createElement(_eui.EuiFlyoutBody,null,_react2.default.createElement(_select_rule_action.SelectRuleAction,{job:job,anomaly:anomaly,detectorIndex:anomaly.detectorIndex,setEditRuleIndex:this.setEditRuleIndex,deleteRuleAtIndex:this.deleteRuleAtIndex})),_react2.default.createElement(_eui.EuiFlyoutFooter,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{iconType:"cross",onClick:this.closeFlyout,flush:"left"},"Close")))));else{var detectorIndex=anomaly.detectorIndex;var detector=job.analysis_config.detectors[detectorIndex];var rules=detector.custom_rules;var isCreate=void 0===rules||ruleIndex>=rules.length;var hasPartitioningFields=this.partitioningFieldNames&&this.partitioningFieldNames.length>0;var conditionSupported=-1===_detector_rule.CONDITIONS_NOT_SUPPORTED_FUNCTIONS.indexOf(anomaly.source.function);var conditionsText="Add numeric conditions for when the rule applies. Multiple conditions are combined using AND.";flyout=_react2.default.createElement(_eui.EuiFlyout,{className:"ml-rule-editor-flyout",onClose:this.closeFlyout,"aria-labelledby":"flyoutTitle"},_react2.default.createElement(_eui.EuiFlyoutHeader,{hasBorder:true},_react2.default.createElement(_eui.EuiTitle,{size:"l"},_react2.default.createElement("h1",{id:"flyoutTitle"},true===isCreate?"Create Rule":"Edit Rule"))),_react2.default.createElement(_eui.EuiFlyoutBody,null,_react2.default.createElement(_detector_description_list.DetectorDescriptionList,{job:job,detector:detector}),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("p",null,"Rules instruct anomaly detectors to change their behavior based on domain-specific knowledge that you provide. When you create a rule, you can specify conditions, scope, and actions. When the conditions of a rule are satisfied, its actions are triggered. ",_react2.default.createElement(_eui.EuiLink,{href:docsUrl,target:"_blank"},"Learn more"))),_react2.default.createElement(_eui.EuiSpacer,null),_react2.default.createElement(_eui.EuiTitle,null,_react2.default.createElement("h2",null,"Action")),_react2.default.createElement(_actions_section.ActionsSection,{actions:rule.actions,onSkipResultChange:this.onSkipResultChange,onSkipModelUpdateChange:this.onSkipModelUpdateChange}),_react2.default.createElement(_eui.EuiSpacer,{size:"xl"}),_react2.default.createElement(_eui.EuiTitle,null,_react2.default.createElement("h2",null,"Conditions")),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),true===conditionSupported?_react2.default.createElement(_eui.EuiCheckbox,{id:"enable_conditions_checkbox",className:"scope-enable-checkbox",label:conditionsText,checked:isConditionsEnabled,onChange:this.onConditionsEnabledChange,disabled:!conditionSupported||!hasPartitioningFields}):_react2.default.createElement(_eui.EuiCallOut,{title:"Conditions are not supported for detectors using the "+anomaly.source.function+" function",iconType:"iInCircle"}),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_conditions_section.ConditionsSection,{isEnabled:isConditionsEnabled,conditions:rule.conditions,addCondition:this.addCondition,updateCondition:this.updateCondition,deleteCondition:this.deleteCondition}),_react2.default.createElement(_eui.EuiSpacer,{size:"xl"}),_react2.default.createElement(_scope_section.ScopeSection,{isEnabled:isScopeEnabled,onEnabledChange:this.onScopeEnabledChange,partitioningFieldNames:this.partitioningFieldNames,filterListIds:filterListIds,scope:rule.scope,updateScope:this.updateScope}),_react2.default.createElement(_eui.EuiCallOut,{title:"Rerun job",color:"warning",iconType:"help"},_react2.default.createElement("p",null,"Changes to rules take effect for new results only."),_react2.default.createElement("p",null,"To apply these changes to existing results you must clone and rerun the job. Note rerunning the job may take some time and should only be done once you have completed all your changes to the rules for this job."))),_react2.default.createElement(_eui.EuiFlyoutFooter,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{iconType:"cross",onClick:this.closeFlyout,flush:"left"},"Close")),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{onClick:this.saveEdit,isDisabled:!(0,_utils.isValidRule)(rule),fill:true},"Save")))))}return _react2.default.createElement(_react2.default.Fragment,null,flyout)}}]);return RuleEditorFlyout}(_react.Component);RuleEditorFlyout.propTypes={setShowFunction:_propTypes2.default.func.isRequired,unsetShowFunction:_propTypes2.default.func.isRequired}},3863:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DetectorDescriptionList=DetectorDescriptionList;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);__webpack_require__(3864);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function DetectorDescriptionList(_ref){var job=_ref.job,detector=_ref.detector;var listItems=[{title:"job ID",description:job.job_id},{title:"detector",description:detector.detector_description}];return _react2.default.createElement(_eui.EuiDescriptionList,{className:"rule-detector-description-list",type:"column",listItems:listItems})}DetectorDescriptionList.propTypes={job:_propTypes2.default.object.isRequired,detector:_propTypes2.default.object.isRequired}},3864:function(module,exports){},3865:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ActionsSection=ActionsSection;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _detector_rule=__webpack_require__(423);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ActionsSection(_ref){var actions=_ref.actions,onSkipResultChange=_ref.onSkipResultChange,onSkipModelUpdateChange=_ref.onSkipModelUpdateChange;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("p",null,"Choose the action(s) to take when the rule matches an anomaly.")),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiCheckbox,{id:"skip_result_cb",label:"Skip result (recommended)",checked:actions.indexOf(_detector_rule.ACTION.SKIP_RESULT)>-1,onChange:onSkipResultChange})),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiIconTip,{content:"The result will not be created.",size:"s",position:"right"}))),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"center",gutterSize:"s",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiCheckbox,{id:"skip_model_update_cb",label:"Skip model update",checked:actions.indexOf(_detector_rule.ACTION.SKIP_MODEL_UPDATE)>-1,onChange:onSkipModelUpdateChange})),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiIconTip,{content:"The value for that series will not be used to update the model.",size:"s",position:"right"}))))}ActionsSection.propTypes={actions:_propTypes2.default.array.isRequired,onSkipResultChange:_propTypes2.default.func.isRequired,onSkipModelUpdateChange:_propTypes2.default.func.isRequired}},3866:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ConditionsSection=ConditionsSection;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _condition_expression=__webpack_require__(3867);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ConditionsSection(_ref){var isEnabled=_ref.isEnabled,conditions=_ref.conditions,addCondition=_ref.addCondition,updateCondition=_ref.updateCondition,deleteCondition=_ref.deleteCondition;if(false===isEnabled)return null;var expressions=[];void 0!==conditions&&(expressions=conditions.map(function(condition,index){return _react2.default.createElement(_condition_expression.ConditionExpression,{key:index,index:index,appliesTo:condition.applies_to,operator:condition.operator,value:condition.value,updateCondition:updateCondition,deleteCondition:deleteCondition})}));return _react2.default.createElement(_react2.default.Fragment,null,expressions,_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_eui.EuiButtonEmpty,{onClick:function onClick(){return addCondition()}},"Add new condition"))}ConditionsSection.propTypes={isEnabled:_propTypes2.default.bool.isRequired,conditions:_propTypes2.default.array,addCondition:_propTypes2.default.func.isRequired,updateCondition:_propTypes2.default.func.isRequired,deleteCondition:_propTypes2.default.func.isRequired}},3867:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ConditionExpression=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _detector_rule=__webpack_require__(423);var _utils=__webpack_require__(502);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var POPOVER_STYLE={zIndex:"200"};var ConditionExpression=exports.ConditionExpression=function(_Component){_inherits(ConditionExpression,_Component);function ConditionExpression(props){_classCallCheck(this,ConditionExpression);var _this=_possibleConstructorReturn(this,(ConditionExpression.__proto__||Object.getPrototypeOf(ConditionExpression)).call(this,props));_this.openAppliesTo=function(){_this.setState({isAppliesToOpen:true,isOperatorValueOpen:false})};_this.closeAppliesTo=function(){_this.setState({isAppliesToOpen:false})};_this.openOperatorValue=function(){_this.setState({isAppliesToOpen:false,isOperatorValueOpen:true})};_this.closeOperatorValue=function(){_this.setState({isOperatorValueOpen:false})};_this.changeAppliesTo=function(event){var _this$props=_this.props,index=_this$props.index,operator=_this$props.operator,value=_this$props.value,updateCondition=_this$props.updateCondition;updateCondition(index,event.target.value,operator,value)};_this.changeOperator=function(event){var _this$props2=_this.props,index=_this$props2.index,appliesTo=_this$props2.appliesTo,value=_this$props2.value,updateCondition=_this$props2.updateCondition;updateCondition(index,appliesTo,event.target.value,value)};_this.changeValue=function(event){var _this$props3=_this.props,index=_this$props3.index,appliesTo=_this$props3.appliesTo,operator=_this$props3.operator,updateCondition=_this$props3.updateCondition;updateCondition(index,appliesTo,operator,+event.target.value)};_this.state={isAppliesToOpen:false,isOperatorValueOpen:false};return _this}_createClass(ConditionExpression,[{key:"renderAppliesToPopover",value:function renderAppliesToPopover(){return _react2.default.createElement("div",{style:POPOVER_STYLE},_react2.default.createElement(_eui.EuiPopoverTitle,null,"When"),_react2.default.createElement(_eui.EuiExpression,{style:{width:200}},_react2.default.createElement(_eui.EuiSelect,{value:this.props.appliesTo,onChange:this.changeAppliesTo,options:[{value:_detector_rule.APPLIES_TO.ACTUAL,text:(0,_utils.appliesToText)(_detector_rule.APPLIES_TO.ACTUAL)},{value:_detector_rule.APPLIES_TO.TYPICAL,text:(0,_utils.appliesToText)(_detector_rule.APPLIES_TO.TYPICAL)},{value:_detector_rule.APPLIES_TO.DIFF_FROM_TYPICAL,text:(0,_utils.appliesToText)(_detector_rule.APPLIES_TO.DIFF_FROM_TYPICAL)}]})))}},{key:"renderOperatorValuePopover",value:function renderOperatorValuePopover(){return _react2.default.createElement("div",{style:POPOVER_STYLE},_react2.default.createElement(_eui.EuiPopoverTitle,null,"Is"),_react2.default.createElement(_eui.EuiExpression,null,_react2.default.createElement(_eui.EuiFlexGroup,{style:{maxWidth:450}},_react2.default.createElement(_eui.EuiFlexItem,{grow:false,style:{width:250}},_react2.default.createElement(_eui.EuiSelect,{value:this.props.operator,onChange:this.changeOperator,options:[{value:_detector_rule.OPERATOR.LESS_THAN,text:(0,_utils.operatorToText)(_detector_rule.OPERATOR.LESS_THAN)},{value:_detector_rule.OPERATOR.LESS_THAN_OR_EQUAL,text:(0,_utils.operatorToText)(_detector_rule.OPERATOR.LESS_THAN_OR_EQUAL)},{value:_detector_rule.OPERATOR.GREATER_THAN,text:(0,_utils.operatorToText)(_detector_rule.OPERATOR.GREATER_THAN)},{value:_detector_rule.OPERATOR.GREATER_THAN_OR_EQUAL,text:(0,_utils.operatorToText)(_detector_rule.OPERATOR.GREATER_THAN_OR_EQUAL)}]})),_react2.default.createElement(_eui.EuiFlexItem,{grow:false,style:{width:200}},_react2.default.createElement(_eui.EuiFieldNumber,{value:+this.props.value,onChange:this.changeValue})))))}},{key:"render",value:function render(){var _props=this.props,index=_props.index,appliesTo=_props.appliesTo,operator=_props.operator,value=_props.value,deleteCondition=_props.deleteCondition;return _react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"m"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiPopover,{id:"appliesToPopover",button:_react2.default.createElement(_eui.EuiExpressionButton,{description:"when",buttonValue:(0,_utils.appliesToText)(appliesTo),isActive:this.state.isAppliesToOpen,onClick:this.openAppliesTo}),isOpen:this.state.isAppliesToOpen,closePopover:this.closeAppliesTo,panelPaddingSize:"none",ownFocus:true,withTitle:true,anchorPosition:"downLeft"},this.renderAppliesToPopover())),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiPopover,{id:"operatorValuePopover",button:_react2.default.createElement(_eui.EuiExpressionButton,{description:"is "+(0,_utils.operatorToText)(operator),buttonValue:""+value,isActive:this.state.isOperatorValueOpen,onClick:this.openOperatorValue}),isOpen:this.state.isOperatorValueOpen,closePopover:this.closeOperatorValue,panelPaddingSize:"none",ownFocus:true,withTitle:true,anchorPosition:"downLeft"},this.renderOperatorValuePopover())),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonIcon,{size:"s",color:"danger",onClick:function onClick(){return deleteCondition(index)},iconType:"trash","aria-label":"Next"})))}}]);return ConditionExpression}(_react.Component);ConditionExpression.propTypes={index:_propTypes2.default.number.isRequired,appliesTo:_propTypes2.default.oneOf([_detector_rule.APPLIES_TO.ACTUAL,_detector_rule.APPLIES_TO.TYPICAL,_detector_rule.APPLIES_TO.DIFF_FROM_TYPICAL]),operator:_propTypes2.default.oneOf([_detector_rule.OPERATOR.LESS_THAN,_detector_rule.OPERATOR.LESS_THAN_OR_EQUAL,_detector_rule.OPERATOR.GREATER_THAN,_detector_rule.OPERATOR.GREATER_THAN_OR_EQUAL]),value:_propTypes2.default.number.isRequired,updateCondition:_propTypes2.default.func.isRequired,deleteCondition:_propTypes2.default.func.isRequired}},3868:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ScopeSection=ScopeSection;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _scope_expression=__webpack_require__(3869);var _check_privilege=__webpack_require__(35);var _utils=__webpack_require__(502);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function NoFilterListsCallOut(){return _react2.default.createElement(_eui.EuiCallOut,{title:"No filter lists configured",iconType:"gear"},_react2.default.createElement("p",null,"To configure scope, you must first use the ",_react2.default.createElement(_eui.EuiLink,{href:"#/settings/filter_lists"},"Filter Lists")," settings page to create the list of values you want to include or exclude in the rule."))}function NoPermissionCallOut(){return _react2.default.createElement(_eui.EuiCallOut,{title:"You do not have permission to view filter lists",iconType:"gear"})}function ScopeSection(_ref){var isEnabled=_ref.isEnabled,onEnabledChange=_ref.onEnabledChange,partitioningFieldNames=_ref.partitioningFieldNames,filterListIds=_ref.filterListIds,scope=_ref.scope,updateScope=_ref.updateScope;var canGetFilters=(0,_check_privilege.checkPermission)("canGetFilters");if(null===partitioningFieldNames||0===partitioningFieldNames.length)return null;var content=void 0;content=filterListIds.length>0?partitioningFieldNames.map(function(fieldName,index){var filterValues=void 0;filterValues=void 0!==scope&&void 0!==scope[fieldName]?scope[fieldName]:(0,_utils.getScopeFieldDefaults)(filterListIds);return _react2.default.createElement(_scope_expression.ScopeExpression,{key:index,fieldName:fieldName,filterId:filterValues.filter_id,filterType:filterValues.filter_type,enabled:filterValues.enabled,filterListIds:filterListIds,updateScope:updateScope})}):false===canGetFilters?_react2.default.createElement(NoPermissionCallOut,null):_react2.default.createElement(NoFilterListsCallOut,null);return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiTitle,null,_react2.default.createElement("h2",null,"Scope")),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_eui.EuiCheckbox,{id:"enable_scope_checkbox",label:"Add a filter list to limit where the rule applies.",checked:isEnabled,onChange:onEnabledChange}),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),isEnabled&&_react2.default.createElement(_react2.default.Fragment,null,content),_react2.default.createElement(_eui.EuiSpacer,{size:"xxl"}))}ScopeSection.propTypes={isEnabled:_propTypes2.default.bool.isRequired,onEnabledChange:_propTypes2.default.func.isRequired,partitioningFieldNames:_propTypes2.default.array.isRequired,filterListIds:_propTypes2.default.array.isRequired,scope:_propTypes2.default.object,updateScope:_propTypes2.default.func.isRequired}},3869:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ScopeExpression=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _detector_rule=__webpack_require__(423);var _utils=__webpack_require__(502);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var POPOVER_STYLE={zIndex:"200"};function getFilterListOptions(filterListIds){return filterListIds.map(function(filterId){return{value:filterId,text:filterId}})}var ScopeExpression=exports.ScopeExpression=function(_Component){_inherits(ScopeExpression,_Component);function ScopeExpression(props){_classCallCheck(this,ScopeExpression);var _this=_possibleConstructorReturn(this,(ScopeExpression.__proto__||Object.getPrototypeOf(ScopeExpression)).call(this,props));_this.openFilterList=function(){_this.setState({isFilterListOpen:true})};_this.closeFilterList=function(){_this.setState({isFilterListOpen:false})};_this.onChangeFilterType=function(event){var _this$props=_this.props,fieldName=_this$props.fieldName,filterId=_this$props.filterId,enabled=_this$props.enabled,updateScope=_this$props.updateScope;updateScope(fieldName,filterId,event.target.value,enabled)};_this.onChangeFilterId=function(event){var _this$props2=_this.props,fieldName=_this$props2.fieldName,filterType=_this$props2.filterType,enabled=_this$props2.enabled,updateScope=_this$props2.updateScope;updateScope(fieldName,event.target.value,filterType,enabled)};_this.onEnableChange=function(event){var _this$props3=_this.props,fieldName=_this$props3.fieldName,filterId=_this$props3.filterId,filterType=_this$props3.filterType,updateScope=_this$props3.updateScope;updateScope(fieldName,filterId,filterType,event.target.checked)};_this.state={isFilterListOpen:false};return _this}_createClass(ScopeExpression,[{key:"renderFilterListPopover",value:function renderFilterListPopover(){var _props=this.props,filterId=_props.filterId,filterType=_props.filterType,filterListIds=_props.filterListIds;return _react2.default.createElement("div",{style:POPOVER_STYLE},_react2.default.createElement(_eui.EuiPopoverTitle,null,"Is"),_react2.default.createElement(_eui.EuiExpression,null,_react2.default.createElement(_eui.EuiFlexGroup,{style:{maxWidth:450}},_react2.default.createElement(_eui.EuiFlexItem,{grow:false,style:{width:150}},_react2.default.createElement(_eui.EuiSelect,{value:filterType,onChange:this.onChangeFilterType,options:[{value:_detector_rule.FILTER_TYPE.INCLUDE,text:(0,_utils.filterTypeToText)(_detector_rule.FILTER_TYPE.INCLUDE)},{value:_detector_rule.FILTER_TYPE.EXCLUDE,text:(0,_utils.filterTypeToText)(_detector_rule.FILTER_TYPE.EXCLUDE)}]})),_react2.default.createElement(_eui.EuiFlexItem,{grow:false,style:{width:300}},_react2.default.createElement(_eui.EuiSelect,{value:filterId,onChange:this.onChangeFilterId,options:getFilterListOptions(filterListIds)})))))}},{key:"render",value:function render(){var _props2=this.props,fieldName=_props2.fieldName,filterId=_props2.filterId,filterType=_props2.filterType,enabled=_props2.enabled,filterListIds=_props2.filterListIds;return _react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"m"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false,className:"scope-field-checkbox"},_react2.default.createElement(_eui.EuiCheckbox,{id:"scope_cb_"+fieldName,checked:enabled,onChange:this.onEnableChange})),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiExpressionButton,{className:"scope-field-button",description:"when",buttonValue:fieldName,isActive:false,onClick:function onClick(event){return event.preventDefault()}})),void 0!==filterListIds&&filterListIds.length>0&&_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiPopover,{id:"operatorValuePopover",button:_react2.default.createElement(_eui.EuiExpressionButton,{description:"is "+(0,_utils.filterTypeToText)(filterType),buttonValue:filterId,isActive:this.state.isFilterListOpen,onClick:this.openFilterList}),isOpen:this.state.isFilterListOpen,closePopover:this.closeFilterList,panelPaddingSize:"none",ownFocus:true,withTitle:true,anchorPosition:"downLeft"},this.renderFilterListPopover())))}}]);return ScopeExpression}(_react.Component);ScopeExpression.propTypes={fieldName:_propTypes2.default.string.isRequired,filterId:_propTypes2.default.string,filterType:_propTypes2.default.oneOf([_detector_rule.FILTER_TYPE.INCLUDE,_detector_rule.FILTER_TYPE.EXCLUDE]),enabled:_propTypes2.default.bool.isRequired,filterListIds:_propTypes2.default.array.isRequired,updateScope:_propTypes2.default.func.isRequired}},3870:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _select_rule_action=__webpack_require__(3871);Object.defineProperty(exports,"SelectRuleAction",{enumerable:true,get:function get(){return _select_rule_action.SelectRuleAction}})},3871:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SelectRuleAction=SelectRuleAction;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _detector_description_list=__webpack_require__(1446);var _rule_action_panel=__webpack_require__(3872);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function SelectRuleAction(_ref){var job=_ref.job,anomaly=_ref.anomaly,detectorIndex=_ref.detectorIndex,setEditRuleIndex=_ref.setEditRuleIndex,deleteRuleAtIndex=_ref.deleteRuleAtIndex;var detector=job.analysis_config.detectors[detectorIndex];var rules=detector.custom_rules||[];var ruleActionPanels=void 0;rules.length>0&&(ruleActionPanels=rules.map(function(rule,index){return _react2.default.createElement(_react2.default.Fragment,{key:"rule_panel_"+index},_react2.default.createElement(_rule_action_panel.RuleActionPanel,{job:job,detectorIndex:detectorIndex,ruleIndex:index,anomaly:anomaly,setEditRuleIndex:setEditRuleIndex,deleteRuleAtIndex:deleteRuleAtIndex}),_react2.default.createElement(_eui.EuiSpacer,{size:"l"}))}));return _react2.default.createElement("div",{className:"select-rule-action"},rules.length>0&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_detector_description_list.DetectorDescriptionList,{job:job,detector:detector}),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),ruleActionPanels,_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiText,{style:{display:"inline"}},"or ")),_react2.default.createElement(_eui.EuiLink,{onClick:function onClick(){return setEditRuleIndex(rules.length)}},"create a rule"))}SelectRuleAction.propTypes={job:_propTypes2.default.object.isRequired,anomaly:_propTypes2.default.object.isRequired,detectorIndex:_propTypes2.default.number.isRequired,setEditRuleIndex:_propTypes2.default.func.isRequired,deleteRuleAtIndex:_propTypes2.default.func.isRequired}},3872:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.RuleActionPanel=RuleActionPanel;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _delete_rule_modal=__webpack_require__(3873);var _utils=__webpack_require__(502);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getEditRuleLink(ruleIndex,setEditRuleIndex){return _react2.default.createElement(_eui.EuiLink,{onClick:function onClick(){return setEditRuleIndex(ruleIndex)}},"Edit rule")}function getDeleteRuleLink(ruleIndex,deleteRuleAtIndex){return _react2.default.createElement(_delete_rule_modal.DeleteRuleModal,{ruleIndex:ruleIndex,deleteRuleAtIndex:deleteRuleAtIndex})}function RuleActionPanel(_ref){var job=_ref.job,detectorIndex=_ref.detectorIndex,ruleIndex=_ref.ruleIndex,setEditRuleIndex=_ref.setEditRuleIndex,deleteRuleAtIndex=_ref.deleteRuleAtIndex;var detector=job.analysis_config.detectors[detectorIndex];var rules=detector.custom_rules;if(void 0===rules||ruleIndex>=rules.length)return null;var rule=rules[ruleIndex];var descriptionListItems=[{title:"rule",description:(0,_utils.buildRuleDescription)(rule)},{title:"actions",description:getEditRuleLink(ruleIndex,setEditRuleIndex)},{title:"",description:getDeleteRuleLink(ruleIndex,deleteRuleAtIndex)}];return _react2.default.createElement(_eui.EuiPanel,{paddingSize:"m",className:"select-rule-action-panel"},_react2.default.createElement(_eui.EuiDescriptionList,{type:"column",listItems:descriptionListItems}))}RuleActionPanel.propTypes={detectorIndex:_propTypes2.default.number.isRequired,ruleIndex:_propTypes2.default.number.isRequired,setEditRuleIndex:_propTypes2.default.func.isRequired,deleteRuleAtIndex:_propTypes2.default.func.isRequired}},3873:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DeleteRuleModal=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var DeleteRuleModal=exports.DeleteRuleModal=function(_Component){_inherits(DeleteRuleModal,_Component);function DeleteRuleModal(props){_classCallCheck(this,DeleteRuleModal);var _this=_possibleConstructorReturn(this,(DeleteRuleModal.__proto__||Object.getPrototypeOf(DeleteRuleModal)).call(this,props));_this.deleteRule=function(){var _this$props=_this.props,ruleIndex=_this$props.ruleIndex,deleteRuleAtIndex=_this$props.deleteRuleAtIndex;deleteRuleAtIndex(ruleIndex);_this.closeModal()};_this.closeModal=function(){_this.setState({isModalVisible:false})};_this.showModal=function(){_this.setState({isModalVisible:true})};_this.state={isModalVisible:false};return _this}_createClass(DeleteRuleModal,[{key:"render",value:function render(){var _this2=this;var modal=void 0;this.state.isModalVisible&&(modal=_react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_eui.EuiConfirmModal,{title:"Delete rule",onCancel:this.closeModal,onConfirm:this.deleteRule,cancelButtonText:"Cancel",confirmButtonText:"Delete",defaultFocusedButton:_eui.EUI_MODAL_CONFIRM_BUTTON},_react2.default.createElement("p",null,"Are you sure you want to delete this rule?"))));return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiLink,{color:"danger",onClick:function onClick(){return _this2.showModal()}},"Delete rule"),modal)}}]);return DeleteRuleModal}(_react.Component);DeleteRuleModal.propTypes={ruleIndex:_propTypes2.default.number.isRequired,deleteRuleAtIndex:_propTypes2.default.func.isRequired}},3874:function(module,exports){},3875:function(module,exports){},3876:function(module,exports){},3877:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3878)},3878:function(module,exports,__webpack_require__){"use strict";__webpack_require__(93);var _state_factory=__webpack_require__(498);var _modules=__webpack_require__(2);var _checkbox_showcharts=__webpack_require__(3879);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.service("mlCheckboxShowChartsService",function(Private){var stateFactory=Private(_state_factory.stateFactoryProvider);this.state=stateFactory("mlCheckboxShowCharts",{showCharts:true})}).directive("mlCheckboxShowCharts",function($injector){var reactDirective=$injector.get("reactDirective");var mlCheckboxShowChartsService=$injector.get("mlCheckboxShowChartsService");return reactDirective(_checkbox_showcharts.CheckboxShowCharts,void 0,{restrict:"E"},{mlCheckboxShowChartsService:mlCheckboxShowChartsService})})},3879:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CheckboxShowCharts=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _make_id=__webpack_require__(554);var _make_id2=_interopRequireDefault(_make_id);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var CheckboxShowCharts=function(_Component){_inherits(CheckboxShowCharts,_Component);function CheckboxShowCharts(props){_classCallCheck(this,CheckboxShowCharts);var _this=_possibleConstructorReturn(this,(CheckboxShowCharts.__proto__||Object.getPrototypeOf(CheckboxShowCharts)).call(this,props));_initialiseProps.call(_this);_this.mlCheckboxShowChartsService=_this.props.mlCheckboxShowChartsService;var showCharts=_this.mlCheckboxShowChartsService.state.get("showCharts");_this.state={checked:showCharts};return _this}_createClass(CheckboxShowCharts,[{key:"render",value:function render(){return _react2.default.createElement(_eui.EuiCheckbox,{id:(0,_make_id2.default)(),label:"Show charts",checked:this.state.checked,onChange:this.onChange})}}]);return CheckboxShowCharts}(_react.Component);var _initialiseProps=function _initialiseProps(){var _this2=this;this.onChange=function(e){var showCharts=e.target.checked;_this2.mlCheckboxShowChartsService.state.set("showCharts",showCharts);_this2.mlCheckboxShowChartsService.state.changed();_this2.setState({checked:showCharts})}};exports.CheckboxShowCharts=CheckboxShowCharts},3880:function(module,exports){},3881:function(module,exports,__webpack_require__){"use strict";var _controls_select=__webpack_require__(3882);var _controls_select2=_interopRequireDefault(_controls_select);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlControlsSelect",function(){return{restrict:"E",scope:{identifier:"@",label:"@",narrowStyle:"=",options:"=",showIcons:"=",selected:"=",updateFn:"="},template:_controls_select2.default,link:function link(scope){scope.setOption=function(d){"function"===typeof scope.updateFn&&scope.updateFn(d)}}}})},3882:function(module,exports){module.exports='<label for="select{{identifier}}" class="kuiLabel">{{label}}:</label>\n<div class="dropdown-group" dropdown>\n  <button id="select{{identifier}}" type="button" class="form-control dropdown-toggle" ng-class="{ \'dropdown-toggle-narrow\': narrowStyle }" dropdown-toggle ng-disabled="disabled">\n    <span><i ng-if="showIcons" class="fa fa-exclamation-triangle ml-icon-severity-{{selected.display}}"></i> {{selected.display}}</span> <span class="caret"></span>\n  </button>\n  <ul class="dropdown-menu" role="menu">\n    <li ng-repeat="option in options">\n      <a href="" ng-click="setOption(option)"><i ng-if="showIcons" class="fa fa-exclamation-triangle ml-icon-severity-{{option.display}}"></i> {{option.display}}</a>\n    </li>\n  </ul>\n</div>\n'},3883:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3884)},3884:function(module,exports,__webpack_require__){"use strict";__webpack_require__(93);var _state_factory=__webpack_require__(498);var _modules=__webpack_require__(2);var _select_interval=__webpack_require__(3885);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.service("mlSelectIntervalService",function(Private){var stateFactory=Private(_state_factory.stateFactoryProvider);this.state=stateFactory("mlSelectInterval",{interval:{display:"Auto",val:"auto"}})}).directive("mlSelectInterval",function($injector){var reactDirective=$injector.get("reactDirective");var mlSelectIntervalService=$injector.get("mlSelectIntervalService");return reactDirective(_select_interval.SelectInterval,void 0,{restrict:"E"},{mlSelectIntervalService:mlSelectIntervalService})})},3885:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.SelectInterval=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var OPTIONS=[{value:"auto",text:"Auto"},{value:"hour",text:"1 hour"},{value:"day",text:"1 day"},{value:"second",text:"Show all"}];function optionValueToInterval(value){var option=OPTIONS.find(function(opt){return opt.value===value});var interval=OPTIONS[0];void 0!==option&&(interval={display:option.text,val:option.value});return interval}var SelectInterval=function(_Component){_inherits(SelectInterval,_Component);function SelectInterval(props){_classCallCheck(this,SelectInterval);var _this=_possibleConstructorReturn(this,(SelectInterval.__proto__||Object.getPrototypeOf(SelectInterval)).call(this,props));_initialiseProps.call(_this);_this.mlSelectIntervalService=_this.props.mlSelectIntervalService;var intervalState=_this.mlSelectIntervalService.state.get("interval");var intervalValue=_lodash2.default.get(intervalState,"val","auto");var interval=optionValueToInterval(intervalValue);_this.mlSelectIntervalService.state.set("interval",interval);_this.state={value:interval.val};return _this}_createClass(SelectInterval,[{key:"render",value:function render(){return _react2.default.createElement(_eui.EuiSelect,{options:OPTIONS,className:"ml-select-interval",value:this.state.value,onChange:this.onChange})}}]);return SelectInterval}(_react.Component);var _initialiseProps=function _initialiseProps(){var _this2=this;this.onChange=function(e){_this2.setState({value:e.target.value});var interval=optionValueToInterval(e.target.value);_this2.mlSelectIntervalService.state.set("interval",interval).changed()}};exports.SelectInterval=SelectInterval},3886:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3887)},3887:function(module,exports,__webpack_require__){"use strict";__webpack_require__(93);var _state_factory=__webpack_require__(498);var _modules=__webpack_require__(2);var _select_severity=__webpack_require__(1414);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.service("mlSelectSeverityService",function(Private){var stateFactory=Private(_state_factory.stateFactoryProvider);this.state=stateFactory("mlSelectSeverity",{threshold:{display:"warning",val:0}})}).directive("mlSelectSeverity",function($injector){var reactDirective=$injector.get("reactDirective");var mlSelectSeverityService=$injector.get("mlSelectSeverityService");return reactDirective(_select_severity.SelectSeverity,void 0,{restrict:"E"},{mlSelectSeverityService:mlSelectSeverityService})})},3888:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3889);__webpack_require__(3892)},3889:function(module,exports,__webpack_require__){"use strict";__webpack_require__(93);var _modules=__webpack_require__(2);var _influencers_list=__webpack_require__(3890);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlInfluencersList",function($injector){var reactDirective=$injector.get("reactDirective");return reactDirective(_influencers_list.InfluencersList,void 0,{restrict:"E"})})},3890:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.InfluencersList=InfluencersList;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _abbreviate_whole_number=__webpack_require__(3891);var _anomaly_utils=__webpack_require__(299);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getTooltipContent(maxScoreLabel,totalScoreLabel){return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement("p",null,"Maximum anomaly score: ",maxScoreLabel),_react2.default.createElement("p",null,"Total anomaly score: ",totalScoreLabel))}function Influencer(_ref){var influencerFieldName=_ref.influencerFieldName,valueData=_ref.valueData;var maxScorePrecise=valueData.maxAnomalyScore;var maxScore=parseInt(maxScorePrecise);var maxScoreLabel=0!==maxScore?maxScore:"< 1";var severity=(0,_anomaly_utils.getSeverity)(maxScore);var totalScore=parseInt(valueData.sumAnomalyScore);var totalScoreLabel=0!==totalScore?totalScore:"< 1";var barScore=0!==maxScore?maxScore:1;var barStyle={width:barScore+"%"};var tooltipContent=getTooltipContent(maxScoreLabel,totalScoreLabel);return _react2.default.createElement("div",null,_react2.default.createElement("div",{className:"field-label"},"mlcategory"!==influencerFieldName?_react2.default.createElement("div",{className:"field-value"},valueData.influencerFieldValue):_react2.default.createElement("div",{className:"field-value"},"mlcategory ",valueData.influencerFieldValue)),_react2.default.createElement("div",{className:"progress "+severity,value:"{valueData.maxAnomalyScore}",max:"100"},_react2.default.createElement("div",{className:"progress-bar-holder"},_react2.default.createElement("div",{className:"progress-bar",style:barStyle})),_react2.default.createElement("div",{className:"score-label"},_react2.default.createElement(_eui.EuiToolTip,{position:"right",className:"ml-influencers-list-tooltip",title:influencerFieldName+": "+valueData.influencerFieldValue,content:tooltipContent},_react2.default.createElement("span",null,maxScoreLabel)))),_react2.default.createElement("div",{className:"total-score-label"},_react2.default.createElement(_eui.EuiToolTip,{position:"right",className:"ml-influencers-list-tooltip",title:influencerFieldName+": "+valueData.influencerFieldValue,content:tooltipContent},_react2.default.createElement("span",null,totalScore>0?(0,_abbreviate_whole_number.abbreviateWholeNumber)(totalScore,4):totalScoreLabel))))}Influencer.propTypes={influencerFieldName:_propTypes2.default.string.isRequired,valueData:_propTypes2.default.object.isRequired};function InfluencersByName(_ref2){var influencerFieldName=_ref2.influencerFieldName,fieldValues=_ref2.fieldValues;var influencerValues=fieldValues.map(function(valueData){return _react2.default.createElement(Influencer,{key:valueData.influencerFieldValue,influencerFieldName:influencerFieldName,valueData:valueData})});return _react2.default.createElement(_react2.default.Fragment,{key:influencerFieldName},_react2.default.createElement(_eui.EuiTitle,{size:"xs"},_react2.default.createElement("h4",null,influencerFieldName)),_react2.default.createElement(_eui.EuiSpacer,{size:"xs"}),influencerValues)}InfluencersByName.propTypes={influencerFieldName:_propTypes2.default.string.isRequired,fieldValues:_propTypes2.default.array.isRequired};function InfluencersList(_ref3){var influencers=_ref3.influencers;if(void 0===influencers||0===Object.keys(influencers).length)return _react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceAround"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiSpacer,{size:"xxl"}),_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("h4",null,"No influencers found"))));var influencersByName=Object.keys(influencers).map(function(influencerFieldName){return _react2.default.createElement(InfluencersByName,{key:influencerFieldName,influencerFieldName:influencerFieldName,fieldValues:influencers[influencerFieldName]})});return _react2.default.createElement("div",{className:"ml-influencers-list"},influencersByName)}InfluencersList.propTypes={influencers:_propTypes2.default.object}},3891:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.abbreviateWholeNumber=abbreviateWholeNumber;var _numeral=__webpack_require__(88);var _numeral2=_interopRequireDefault(_numeral);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function abbreviateWholeNumber(value,maxDigits){var maxNumDigits=void 0!==maxDigits?maxDigits:3;return Math.abs(value)<Math.pow(10,maxNumDigits)?value:(0,_numeral2.default)(value).format("0a")}},3892:function(module,exports){},3893:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _d=__webpack_require__(19);var _d2=_interopRequireDefault(_d);var _job_select_list=__webpack_require__(3894);var _job_select_list2=_interopRequireDefault(_job_select_list);var _job_utils=__webpack_require__(41);var _job_service=__webpack_require__(24);var _job_select_service=__webpack_require__(503);var _timefilter=__webpack_require__(14);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlJobSelectList",function(Private){return{restrict:"AE",replace:true,transclude:true,template:_job_select_list2.default,controller:function controller($scope){var mlJobSelectService=Private(_job_select_service.JobSelectServiceProvider);$scope.jobs=[];$scope.groups=[];$scope.homelessJobs=[];$scope.singleSelection=false;$scope.timeSeriesOnly=false;$scope.noJobsCreated=void 0;$scope.applyTimeRange=mlJobSelectService.jobSelectListState.applyTimeRange;$scope.urlSelectedIds={};$scope.selected={};$scope.allGroupsSelected=false;$scope.allJobsSelected=false;$scope.selectedJobRadio="";$scope.selectedCount=0;_job_service.mlJobService.loadJobs().then(function(resp){if(resp.jobs.length>0){$scope.noJobsCreated=false;var jobs=[];resp.jobs.forEach(function(job){job.groups&&job.groups.length?job.groups.forEach(function(group){jobs.push(createJob(group+"."+job.job_id,group,job))}):jobs.push(createJob(job.job_id,null,job))});normalizeTimes(jobs);$scope.jobs=jobs;var _createGroups=createGroups($scope.jobs),groups=_createGroups.groups,homeless=_createGroups.homeless;$scope.groups=groups;$scope.homelessJobs=homeless;$scope.selected={groups:[],jobs:[]};var jobCount=resp.jobs.reduce(function(sum,job){return sum+(void 0===job.groups?1:job.groups.length)},0);var selectAll=jobCount===$scope.urlSelectedIds.jobs.length;groups.forEach(function(group){$scope.selected.groups.push({id:group.id,selected:group.selected,selectable:group.selectable,timeRange:group.timeRange,isGroup:true})});jobs.forEach(function(job){void 0===$scope.selected.jobs.find(function(j){return j.id===job.name})&&$scope.selected.jobs.push({id:job.name,selected:selectAll||job.selected,disabled:job.disabled,timeRange:job.timeRange,running:job.running,isGroup:false})});$scope.allJobsSelected=areAllJobsSelected();$scope.allGroupsSelected=areAllGroupsSelected();createSelectedCount();true===$scope.singleSelection&&$scope.jobs.forEach(function(j){j.selected&&($scope.selectedJobRadio=j.name)})}else $scope.noJobsCreated=true}).catch(function(resp){console.log("mlJobSelectList controller - error getting job info from ES:",resp)});function createJob(jobId,groupId,job){return{id:jobId,name:job.job_id,group:groupId,isGroup:false,selected:_lodash2.default.includes($scope.urlSelectedIds.jobs,job.job_id),disabled:!(false===$scope.timeSeriesOnly||true===(0,_job_utils.isTimeSeriesViewJob)(job)),running:job.datafeed_config&&"started"===job.datafeed_config.state,timeRange:{to:job.data_counts.latest_record_timestamp,from:job.data_counts.earliest_record_timestamp,fromPx:0,toPx:0,widthPx:0,label:""}}}function createGroups(jobsIn){var jobGroups={};var homeless=[];jobsIn.forEach(function(job){null!==job.group?void 0===jobGroups[job.group]?jobGroups[job.group]=[job]:jobGroups[job.group].push(job):homeless.push(job)});var groups=_lodash2.default.map(jobGroups,function(jobs,id){var group={id:id,selected:false,selectable:true,expanded:false,isGroup:true,jobs:jobs};false===$scope.singleSelection&&(group.selected=_lodash2.default.includes($scope.urlSelectedIds.groups,id));var timeRange={to:null,toMoment:null,from:null,fromMoment:null,fromPx:null,toPx:null,widthPx:null};jobs.forEach(function(job){job.group=group;if(null===timeRange.to||job.timeRange.to>timeRange.to){timeRange.to=job.timeRange.to;timeRange.toMoment=job.timeRange.toMoment}if(null===timeRange.from||job.timeRange.from<timeRange.from){timeRange.from=job.timeRange.from;timeRange.fromMoment=job.timeRange.fromMoment}(null===timeRange.toPx||job.timeRange.toPx>timeRange.toPx)&&(timeRange.toPx=job.timeRange.toPx);(null===timeRange.fromPx||job.timeRange.fromPx<timeRange.fromPx)&&(timeRange.fromPx=job.timeRange.fromPx)});timeRange.widthPx=timeRange.toPx-timeRange.fromPx;timeRange.toMoment=(0,_moment2.default)(timeRange.to);timeRange.fromMoment=(0,_moment2.default)(timeRange.from);var fromString=timeRange.fromMoment.format("MMM Do YYYY, HH:mm");var toString=timeRange.toMoment.format("MMM Do YYYY, HH:mm");timeRange.label=fromString+" to "+toString;group.timeRange=timeRange;return group});return{groups:groups,homeless:homeless}}$scope.apply=function(){var selectedJobs=[];if($scope.singleSelection)selectedJobs.push.apply(selectedJobs,_toConsumableArray($scope.selected.jobs.filter(function(j){return j.id===$scope.selectedJobRadio})));else{selectedJobs.push.apply(selectedJobs,_toConsumableArray($scope.selected.jobs.filter(function(j){return j.selected})));selectedJobs.push.apply(selectedJobs,_toConsumableArray($scope.selected.groups.filter(function(g){return g.selected})))}if(areAllJobsSelected())mlJobSelectService.setJobIds(["*"]);else{var jobIds=selectedJobs.map(function(j){return j.isGroup?j.id+".*":j.id});mlJobSelectService.setJobIds(jobIds)}if($scope.applyTimeRange){var times=[];selectedJobs.forEach(function(job){void 0!==job.timeRange.from&&times.push(job.timeRange.from);void 0!==job.timeRange.to&&times.push(job.timeRange.to)});if(times.length){var min=_lodash2.default.min(times);var max=_lodash2.default.max(times);_timefilter.timefilter.setTime({from:(0,_moment2.default)(min).toISOString(),to:(0,_moment2.default)(max).toISOString()})}}mlJobSelectService.jobSelectListState.applyTimeRange=$scope.applyTimeRange;$scope.closePopover()};$scope.toggleSelection=function(){$scope.allJobsSelected=areAllJobsSelected();$scope.allGroupsSelected=areAllGroupsSelected();createSelectedCount()};$scope.toggleAllJobsSelection=function(){var allJobsSelected=areAllJobsSelected();$scope.allJobsSelected=!allJobsSelected;$scope.selected.jobs.forEach(function(job){job.selected=$scope.allJobsSelected});createSelectedCount()};$scope.toggleGroupSelection=function(){$scope.allGroupsSelected=areAllGroupsSelected();createSelectedCount()};$scope.toggleAllGroupsSelection=function(){var allGroupsSelected=areAllGroupsSelected();$scope.allGroupsSelected=!allGroupsSelected;$scope.selected.groups.forEach(function(group){group.selected=$scope.allGroupsSelected});createSelectedCount()};function areAllJobsSelected(){var allSelected=true;$scope.selected.jobs.forEach(function(job){false===job.selected&&(allSelected=false)});return allSelected}function areAllGroupsSelected(){var allSelected=true;$scope.selected.groups.forEach(function(group){false===group.selected&&(allSelected=false)});return allSelected}function createSelectedCount(){$scope.selectedCount=0;$scope.selected.jobs.forEach(function(job){job.selected&&$scope.selectedCount++});$scope.selected.groups.forEach(function(group){group.selected&&$scope.selectedCount++})}function normalizeTimes(jobs){var min=_lodash2.default.min(jobs,function(job){return+job.timeRange.from});var max=_lodash2.default.max(jobs,function(job){return+job.timeRange.to});var gantScale=_d2.default.scale.linear().domain([min.timeRange.from,max.timeRange.to]).range([1,299]);jobs.forEach(function(job){if(void 0!==job.timeRange.to&&void 0!==job.timeRange.from){job.timeRange.fromPx=gantScale(job.timeRange.from);job.timeRange.toPx=gantScale(job.timeRange.to);job.timeRange.widthPx=job.timeRange.toPx-job.timeRange.fromPx;job.timeRange.toMoment=(0,_moment2.default)(job.timeRange.to);job.timeRange.fromMoment=(0,_moment2.default)(job.timeRange.from);var fromString=job.timeRange.fromMoment.format("MMM Do YYYY, HH:mm");var _toString=job.timeRange.toMoment.format("MMM Do YYYY, HH:mm");job.timeRange.label=fromString+" to "+_toString}})}$scope.useTimeRange=function(job){_timefilter.timefilter.setTime({from:job.timeRange.fromMoment.toISOString(),to:job.timeRange.toMoment.toISOString()})}},link:function link(scope,element,attrs){var mlJobSelectService=Private(_job_select_service.JobSelectServiceProvider);scope.timeSeriesOnly=false;"true"===attrs.timeseriesonly&&(scope.timeSeriesOnly=true);"true"===attrs.singleSelection&&(scope.singleSelection=true);scope.urlSelectedIds={groups:[].concat(_toConsumableArray(mlJobSelectService.groupIds)),jobs:[].concat(_toConsumableArray(mlJobSelectService.jobIdsWithGroup))};(0,_jquery2.default)(".ml-select-list",element).focus()}}})},3894:function(module,exports){module.exports='<div class=\'ml-job-selector\'>\n  <div class="header">\n    Job Selection\n  </div>\n\n  <ml-loading-indicator\n    label="Loading jobs"\n    is-loading="noJobsCreated===undefined"\n  />\n  <div class="select-list" ng-show=\'noJobsCreated!==undefined\'>\n    <div ng-if="groups.length && singleSelection !== true">\n      <div class="list-section-title">\n        <input\n          ng-if="singleSelection !== true"\n          type="checkbox"\n          ng-checked="allGroupsSelected"\n          aria-label="Select all groups checkbox"\n          ng-click="toggleAllGroupsSelection()" />\n        Groups\n      </div>\n      <div class="list-section">\n        <div class=\'group\' ng-repeat="group in selected.groups">\n          <div class=\'group-title job-row\'>\n            <div class="job-row-inner">\n              <label class="kuiFormLabel">\n                <div >\n                  <input\n                    ng-if="singleSelection !== true && group.selectable === true" type="checkbox"\n                    ng-model="group.selected"\n                    ng-click="toggleGroupSelection()" />\n                  {{group.id}}\n                </div>\n                <div ng-if="group.selectable !== false">\n                  <div class=\'gant-back-edge\'>\n                    <div></div>\n                  </div>\n                  <div\n                    class=\'gant-bar\'\n                    ng-class="{\'disabled-job\': job.disabled, \'gant-bar-running\': job.running}"\n                    tooltip=\'{{group.timeRange.label}}\'\n                    tooltip-placement="bottom"\n                    tooltip-append-to-body="true"\n                    ng-attr-style=\'margin-left:{{group.timeRange.fromPx}}px; width: {{group.timeRange.widthPx}}px;\'>\n                  </div>\n                </div>\n              </label>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n    <div class="list-section-title" ng-if="singleSelection !== true">\n      <input type="checkbox"\n        ng-checked="allJobsSelected"\n        aria-label="Select all jobs checkbox"\n        ng-click="toggleAllJobsSelection()" />\n      Jobs\n    </div>\n    <div class="list-section" ng-class="{\'list-section-single\': singleSelection}">\n      <div class=\'job-row\' ng-repeat="job in selected.jobs">\n        <div class=\'job-row-inner\'>\n          <label class="kuiFormLabel">\n            <div>\n              <span>\n                <input ng-if="singleSelection !== true" type="checkbox"\n                  ng-model="job.selected"\n                  ng-disabled=\'job.disabled\'\n                  ng-click="toggleSelection()" />\n                <input ng-if="singleSelection === true" type="radio"\n                  name="job-group"\n                  value="{{job.id}}"\n                  ng-model="$parent.$parent.selectedJobRadio"\n                  ng-disabled=\'job.disabled\' />\n                <span ng-class="{\'disabled-job\': job.disabled}">{{job.id}}</span>\n              </span>\n            </div>\n            <div>\n              <div class=\'gant-back-edge\' >\n                <div ></div>\n              </div>\n              <div\n                class=\'gant-bar\'\n                ng-class="{\'disabled-job\': job.disabled, \'gant-bar-running\': job.running}"\n                tooltip=\'{{job.timeRange.label}}\'\n                tooltip-placement="bottom"\n                tooltip-append-to-body="true"\n                ng-attr-style=\'margin-left:{{job.timeRange.fromPx}}px; width: {{job.timeRange.widthPx}}px;\'>\n\n              </div>\n            </div>\n          </label>\n        </div>\n      </div>\n    </div>\n  </div>\n\n\n  <div class=\'footer\'>\n    <button\n      ng-click="apply()"\n      class="kuiButton kuiButton--primary"\n      aria-label="Apply"\n      ng-disabled="selectedCount===0"\n      >\n      Apply\n    </button>\n    <button ng-click="closePopover()" class="kuiButton kuiButton--primary" aria-label="Cancel">Cancel</button>\n  </div>\n\n  <div class=\'apply-time-range\'>\n    <label class="kuiFormLabel">\n    <input type="checkbox"\n      ng-model="applyTimeRange"/>\n      Also apply time range\n  </label>\n  </div>\n\n</div>\n'},3895:function(module,exports,__webpack_require__){"use strict";var _job_select_button=__webpack_require__(3896);var _job_select_button2=_interopRequireDefault(_job_select_button);__webpack_require__(1328);var _modules=__webpack_require__(2);var _job_select_service=__webpack_require__(503);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("jobSelectButton",function(Private){var mlJobSelectService=Private(_job_select_service.JobSelectServiceProvider);function link(scope){scope.selectJobBtnJobIdLabel="";scope.unsafeHtml="";scope.description=scope.singleSelection?mlJobSelectService.singleJobDescription:mlJobSelectService.description;scope.createMenu=function(){var txt="<ml-job-select-list ";scope.timeseriesonly&&(txt+='timeseriesonly="true" ');scope.singleSelection&&(txt+='single-selection="true" ');txt+="></ml-job-select-list>";scope.unsafeHtml=txt}}return{scope:{timeseriesonly:"=",singleSelection:"="},link:link,replace:true,template:_job_select_button2.default}})},3896:function(module,exports){module.exports='<div style=\'display: flex;\' class="ml-job-select-btn-container">\n  <div class="ml-job-select-btn-label">Job</div>\n  <div style="flex:0 0 auto;">\n    <div  popover-placement="bottom"\n          popover-placement="bottom"\n          popover-html-unsafe="{{unsafeHtml}}"\n          popover-append-to-body="false"\n          popover-trigger="click"\n          class="ml-job-select-btn"\n          tooltip="{{description.txt}} selected"\n          aria-label="Job selection menu"\n          ng-click=\'createMenu()\'\n          kbn-accessible-click>\n    <span class="ml-job-select-btn-text">{{description.txt}}</span>\n    <span class="caret"></span>\n  </div>\n  </div>\n</div>\n'},3897:function(module,exports){},3898:function(module,exports){module.exports='<ml-nav-menu name="explorer"></ml-nav-menu>\n<ml-chart-tooltip></ml-chart-tooltip>\n<div class="ml-explorer" ng-controller="MlExplorerController">\n  <navbar ng-show="jobs.length > 0 && chrome.getVisible()">\n    <job-select-button></job-select-button>\n  </navbar>\n\n  <filter-bar\n    ng-show="queryFilters.length"\n    state="appState">\n  </filter-bar>\n\n  <ml-loading-indicator\n    label="Loading"\n    is-loading="loading === true"\n  />\n\n  <div class="no-results-container" ng-if="jobs.length === 0 && loading === false">\n    <div class="no-results euiText">\n      <div><i class="fa fa-exclamation-triangle" ></i>No jobs found</div>\n      <div><a href="ml#/jobs">Create new job</a></div>\n    </div>\n  </div>\n\n  <div class="no-results-container" ng-show="jobs.length > 0 && loading === false && hasResults === false">\n    <div class="no-results euiText">\n      <div><i class="fa fa-info-circle" ></i>No results found</div>\n      <div>Try widening the time selection or moving further back in time</div>\n    </div>\n  </div>\n\n  <div ng-if="jobs.length > 0 && loading === false && hasResults === true">\n    <div class="results-container">\n\n      <div ng-if="noInfluencersConfigured === true" class="no-influencers-warning">\n        <i aria-hidden="true" class="fa fa-info-circle" tooltip-placement="right" tooltip-append-to-body="true"\n          tooltip-html-unsafe="The Top Influencers list is hidden because no influencers have been configured for the selected jobs." ></i>\n      </div>\n\n      <div ng-if="noInfluencersConfigured === false" class="column col-xs-2 euiText">\n        <span class="panel-title">\n          Top Influencers\n        </span>\n        <ml-influencers-list\n          influencers="influencers"\n        />\n      </div>\n\n      <div class="column" ng-class="noInfluencersConfigured === true ? \'col-xs-12\' : \'col-xs-10\'">\n        <span class="panel-title euiText">\n          Anomaly timeline\n        </span>\n        <div\n          class="ml-explorer-swimlane euiText"\n          ng-mouseenter="setSwimlaneSelectActive(true)"\n          ng-mouseleave="setSwimlaneSelectActive(false)"\n        >\n          <ml-explorer-swimlane\n            swimlane-type="overall"\n            swimlane-data="overallSwimlaneData"\n            selected-job-ids="selectedJobIds"\n            chart-width="swimlaneWidth"\n            app-state="appState"\n            style="width: 100%; height: 250px;">\n          </ml-explorer-swimlane>\n        </div>\n\n        <div ng-if="viewBySwimlaneOptions.length > 0">\n          <div class="ml-controls">\n            <label for="selectViewBy" class="kuiLabel">View by:</label>\n            <div class="kuiButtonGroup" dropdown>\n              <button id="selectViewBy" type="button" class="form-control dropdown-toggle" dropdown-toggle ng-disabled="disabled">\n                <span>{{swimlaneViewByFieldName}}</span> <span class="caret"></span>\n              </button>\n              <ul class="dropdown-menu" role="menu">\n                <li ng-repeat="swimlaneOption in viewBySwimlaneOptions">\n                  <a href="" ng-click="setSwimlaneViewBy(swimlaneOption)">{{swimlaneOption}}</a>\n                </li>\n              </ul>\n            </div>\n\n            <ml-select-limit />\n\n            <span ng-if="viewByLoadedForTimeFormatted" class="panel-sub-title">\n              (Sorted by max anomaly score for {{viewByLoadedForTimeFormatted}})\n            </span>\n            <span ng-if="!viewByLoadedForTimeFormatted" class="panel-sub-title">\n              (Sorted by max anomaly score)\n            </span>\n          </div>\n\n          <div\n            class="ml-explorer-swimlane euiText"\n            ng-if="showViewBySwimlane()"\n            ng-mouseenter="setSwimlaneSelectActive(true)"\n            ng-mouseleave="setSwimlaneSelectActive(false)"\n          >\n            <ml-explorer-swimlane\n              swimlane-type="viewBy"\n              swimlane-data="viewBySwimlaneData"\n              selected-job-ids="selectedJobIds"\n              chart-width="swimlaneWidth"\n              app-state="appState"\n              style="width: 100%; height: 250px;">\n            </ml-explorer-swimlane>\n          </div>\n\n          <div ng-if="!showViewBySwimlane()" class="text-center visualize-error euiText">\n            <div class="item top"></div>\n            <div class="item">\n              <h4 class="euiTitle euiTitle--small">No {{swimlaneViewByFieldName}} influencers found</h4>\n            </div>\n            <div class="item bottom"></div>\n          </div>\n\n        </div>\n\n        <span class="panel-title euiText">\n          Anomalies\n        </span>\n\n        <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--directionRow euiFlexGroup--responsive ml-anomalies-controls">\n          <div class="euiFlexItem euiFlexItem--flexGrowZero" style="width:170px">\n            <div class="euiFormRow" id="select_severity_control">\n              <label class="euiFormLabel" for="select_severity">Severity threshold</label>\n              <div class="euiFormControlLayout">\n                <ml-select-severity id="select_severity" />\n              </div>\n            </div>\n          </div>\n          <div class="euiFlexItem euiFlexItem--flexGrowZero" style="width:170px">\n            <div class="euiFormRow" id="select_interval_control">\n              <label class="euiFormLabel" for="select_interval">Interval</label>\n              <div class="euiFormControlLayout">\n                <ml-select-interval id="select_interval" />\n              </div>\n            </div>\n          </div>\n          <div class="euiFlexItem euiFlexItem--flexGrowZero" ng-show="anomalyChartRecords.length > 0">\n            <div class="euiFormRow" id="show_charts_checkbox_control">\n              <div class="euiFormControlLayout">\n                <ml-checkbox-show-charts id="show_charts_checkbox" />\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div ng-controller="MlExplorerChartsContainerController" class="euiText">\n          <ml-explorer-charts-container\n            series-to-plot="seriesToPlot"\n            time-field-name="timeFieldName"\n            plot-earliest="plotEarliest"\n            plot-latest="plotLatest"\n            selected-earliest="selectedEarliest"\n            selected-latest="selectedLatest"\n            charts-per-row="chartsPerRow"\n            layout-cells-per-chart="layoutCellsPerChart"\n            too-many-buckets="tooManyBuckets">\n          </ml-explorer-charts-container>\n        </div>\n\n        <ml-anomalies-table\n          table-data="tableData"\n        />\n\n      </div>\n\n    </div>\n  </div>\n\n</div>\n'},3899:function(module,exports,__webpack_require__){"use strict";var _modules=__webpack_require__(2);var _listener_factory=__webpack_require__(626);var _module=_modules.uiModules.get("apps/ml");_module.service("mlExplorerDashboardService",function(){this.allowCellRangeSelection=false;var listenerFactory=(0,_listener_factory.listenerFactoryProvider)();var dragSelect=this.dragSelect=listenerFactory();var swimlaneCellClick=this.swimlaneCellClick=listenerFactory();var swimlaneDataChange=this.swimlaneDataChange=listenerFactory();var swimlaneRenderDone=this.swimlaneRenderDone=listenerFactory();this.anomalyDataChange=listenerFactory();this.init=function(){dragSelect.unwatchAll();swimlaneCellClick.unwatchAll();swimlaneDataChange.unwatchAll();swimlaneRenderDone.unwatchAll()}})},3900:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _d=__webpack_require__(19);var _d2=_interopRequireDefault(_d);var _anomaly_utils=__webpack_require__(299);var _chart_utils=__webpack_require__(256);var _ml_time_buckets=__webpack_require__(277);var _string_utils=__webpack_require__(40);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlExplorerSwimlane",function($compile,Private,mlExplorerDashboardService,mlChartTooltipService){function link(scope,element){mlExplorerDashboardService.allowCellRangeSelection||element.addClass("ml-hide-range-selection");var cellMouseoverActive=true;function dragSelectListener(_ref){var action=_ref.action,_ref$elements=_ref.elements,elements=void 0===_ref$elements?[]:_ref$elements;if("newSelection"===action&&elements.length>0){var firstCellData=(0,_jquery2.default)(elements[0]).data("click");if("undefined"!==typeof firstCellData&&scope.swimlaneType===firstCellData.swimlaneType){var selectedData=elements.reduce(function(d,e){var cellData=(0,_jquery2.default)(e).data("click");d.bucketScore=Math.max(d.bucketScore,cellData.bucketScore);d.laneLabels.push(cellData.laneLabel);d.times.push(cellData.time);return d},{bucketScore:0,laneLabels:[],times:[]});selectedData.laneLabels=_lodash2.default.uniq(selectedData.laneLabels);selectedData.times=_lodash2.default.uniq(selectedData.times);cellClick(elements,selectedData)}cellMouseoverActive=true}else{if("elementSelect"===action){element.addClass("ml-dragselect-dragging");return}if("dragStart"===action){cellMouseoverActive=false;return}}element.removeClass("ml-dragselect-dragging");elements.map(function(e){return(0,_jquery2.default)(e).removeClass("ds-selected")})}mlExplorerDashboardService.dragSelect.watch(dragSelectListener);function swimlaneDataChangeListener(swimlaneType){if(swimlaneType===scope.swimlaneType){render();checkForSelection()}}mlExplorerDashboardService.swimlaneDataChange.watch(swimlaneDataChangeListener);element.on("$destroy",function(){mlExplorerDashboardService.dragSelect.unwatch(dragSelectListener);mlExplorerDashboardService.swimlaneDataChange.unwatch(swimlaneDataChangeListener);scope.$destroy()});var MlTimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);function cellClick(cellsToSelect,_ref2){var laneLabels=_ref2.laneLabels,bucketScore=_ref2.bucketScore,times=_ref2.times;cellsToSelect.length>1||bucketScore>0?selectCell(cellsToSelect,laneLabels,times,bucketScore,true):clearSelection()}function render(){if(void 0===scope.swimlaneData)return;var lanes=scope.swimlaneData.laneLabels;var startTime=scope.swimlaneData.earliest;var endTime=scope.swimlaneData.latest;var stepSecs=scope.swimlaneData.interval;var points=scope.swimlaneData.points;function colorScore(value){return(0,_anomaly_utils.getSeverityColor)(value)}var numBuckets=parseInt((endTime-startTime)/stepSecs);var cellHeight=30;var height=(lanes.length+1)*cellHeight-10;var laneLabelWidth=170;element.css("height",height+20+"px");var $swimlanes=element.find(".ml-swimlanes").first();$swimlanes.empty();var cellWidth=Math.floor(scope.chartWidth/numBuckets);var xAxisWidth=cellWidth*numBuckets;var xAxisScale=_d2.default.time.scale().domain([new Date(1e3*startTime),new Date(1e3*endTime)]).range([0,xAxisWidth]);var timeBuckets=new MlTimeBuckets;timeBuckets.setInterval(stepSecs+"s");var xAxisTickFormat=timeBuckets.getScaledDateFormat();function cellMouseover($event,laneLabel,bucketScore,index,time){if(void 0===bucketScore||false===cellMouseoverActive)return;var displayScore=bucketScore>1?parseInt(bucketScore):"< 1";var formattedDate=(0,_moment2.default)(1e3*time).format("MMMM Do YYYY, HH:mm");var contents=formattedDate+"<br/><hr/>";void 0!==scope.swimlaneData.fieldName&&(contents+=(0,_string_utils.mlEscape)(scope.swimlaneData.fieldName)+": "+(0,_string_utils.mlEscape)(laneLabel)+"<br/><hr/>");contents+="Max anomaly score: "+displayScore;var offsets="sl-cell-inner"===$event.target.className?{x:0,y:0}:{x:2,y:1};mlChartTooltipService.show(contents,$event.target,{x:$event.target.offsetWidth-offsets.x,y:10+offsets.y})}function cellMouseleave(){mlChartTooltipService.hide()}_lodash2.default.each(lanes,function(lane){var rowScope=scope.$new();rowScope.cellMouseover=cellMouseover;rowScope.cellMouseleave=cellMouseleave;var $lane=(0,_jquery2.default)("<div>",{class:"lane"});var label=(0,_string_utils.mlEscape)(lane);var fieldName=(0,_string_utils.mlEscape)(scope.swimlaneData.fieldName);var laneDivProps={class:"lane-label",css:{width:laneLabelWidth+"px"},html:label};if(void 0!==scope.swimlaneData.fieldName){laneDivProps["tooltip-html-unsafe"]=fieldName+": "+label;laneDivProps["tooltip-placement"]="right";laneDivProps["aria-label"]=fieldName+": "+label}var $label=(0,_jquery2.default)("<div>",laneDivProps);$label.on("click",function(){"undefined"!==typeof scope.appState.mlExplorerSwimlane.selectedLanes&&clearSelection()});$lane.append($label);var $cellsContainer=(0,_jquery2.default)("<div>",{class:"cells-container"});$lane.append($cellsContainer);var time=startTime;for(var i=0;i<numBuckets;i++){var $cell=(0,_jquery2.default)("<div>",{class:"sl-cell ",css:{width:cellWidth+"px"},"data-lane-label":label,"data-time":time});var color="none";var bucketScore=0;for(var j=0;j<points.length;j++)if(points[j].value>0&&points[j].laneLabel===lane&&points[j].time===time){bucketScore=points[j].value;color=colorScore(bucketScore);$cell.append((0,_jquery2.default)("<div>",{class:"sl-cell-inner",css:{"background-color":color}}));$cell.attr({"data-score":bucketScore});$cell.find(".sl-cell-inner-dragselect").remove()}else 0===$cell.find(".sl-cell-inner-dragselect").length&&0===$cell.find(".sl-cell-inner").length&&$cell.append((0,_jquery2.default)("<div>",{class:"sl-cell-inner-dragselect"}));$cell.data({click:{bucketScore:bucketScore,laneLabel:lane,swimlaneType:scope.swimlaneType,time:time}});if(bucketScore>0){var safeLaneTxt=lane.replace(/(['\\])/g,"\\$1");var cellMouseoverTxt="cellMouseover($event, '"+safeLaneTxt+"', "+bucketScore+", "+i+", "+time+")";var cellMouseleaveTxt="cellMouseleave()";$cell.attr({"ng-mouseover":cellMouseoverTxt,"ng-mouseleave":cellMouseleaveTxt})}$cellsContainer.append($cell);time+=stepSecs}$swimlanes.append($lane);$compile($lane)(rowScope)});var laneTimes=_d2.default.select($swimlanes.get(0)).append("div").classed("time-tick-labels",true);var svgHeight=25;var svg=laneTimes.append("svg").attr("width",scope.chartWidth).attr("height",svgHeight);var xAxis=_d2.default.svg.axis().scale(xAxisScale).ticks((0,_chart_utils.numTicksForDateFormat)(scope.chartWidth,xAxisTickFormat)).tickFormat(function(tick){return(0,_moment2.default)(tick).format(xAxisTickFormat)});var gAxis=svg.append("g").attr("class","x axis").call(xAxis);var overlapCheck=0;gAxis.selectAll("g.tick").each(function(){var tick=_d2.default.select(this);var xTransform=_d2.default.transform(tick.attr("transform")).translate[0];var tickWidth=tick.select("text").node().getBBox().width;var xMinOffset=xTransform-tickWidth/2;var xMaxOffset=xTransform+tickWidth/2;xMinOffset<overlapCheck?tick.remove():overlapCheck=xTransform+tickWidth/2;xMaxOffset>scope.chartWidth&&tick.remove()});mlExplorerDashboardService.swimlaneRenderDone.changed()}function checkForSelection(){var selectionState=scope.appState.mlExplorerSwimlane;var selectedType=_lodash2.default.get(selectionState,"selectedType",void 0);var viewBy=_lodash2.default.get(selectionState,"viewBy","");if(scope.swimlaneType!==selectedType&&void 0!==selectedType){(0,_jquery2.default)(".lane-label",element).addClass("lane-label-masked");(0,_jquery2.default)(".sl-cell-inner",element).addClass("sl-cell-inner-masked")}if(scope.swimlaneType!==selectedType||void 0!==scope.swimlaneData.fieldName&&scope.swimlaneData.fieldName!==viewBy)return;var cellsToSelect=[];var selectedLanes=_lodash2.default.get(selectionState,"selectedLanes",[]);var selectedTimes=_lodash2.default.get(selectionState,"selectedTimes",[]);var selectedTimeExtent=_d2.default.extent(selectedTimes);var lanes=scope.swimlaneData.laneLabels;var startTime=scope.swimlaneData.earliest;var endTime=scope.swimlaneData.latest;selectedLanes.forEach(function(selectedLane){if(lanes.indexOf(selectedLane)>-1&&selectedTimeExtent[0]>=startTime&&selectedTimeExtent[1]<=endTime){var $swimlanes=element.find(".ml-swimlanes").first();var laneCells=(0,_jquery2.default)('div[data-lane-label="'+(0,_string_utils.mlEscape)(selectedLane)+'"]',$swimlanes);if(0===laneCells.length)return;for(var i=0;i<laneCells.length;i++){var cell=laneCells[i];var cellTime=(0,_jquery2.default)(cell).attr("data-time");cellTime>=selectedTimeExtent[0]&&cellTime<=selectedTimeExtent[1]&&cellsToSelect.push(cell)}}});var selectedMaxBucketScore=cellsToSelect.reduce(function(maxBucketScore,cell){return Math.max(maxBucketScore,+(0,_jquery2.default)(cell).attr("data-score")||0)},0);cellsToSelect.length>1||selectedMaxBucketScore>0?selectCell(cellsToSelect,selectedLanes,selectedTimes,selectedMaxBucketScore):clearSelection()}function selectCell(cellsToSelect,laneLabels,times,bucketScore){var checkEqualSelection=arguments.length>4&&void 0!==arguments[4]&&arguments[4];(0,_jquery2.default)(".lane-label",".ml-explorer-swimlane").addClass("lane-label-masked");(0,_jquery2.default)(".sl-cell-inner,.sl-cell-inner-dragselect",".ml-explorer-swimlane").addClass("sl-cell-inner-masked");(0,_jquery2.default)(".sl-cell-inner.sl-cell-inner-selected,.sl-cell-inner-dragselect.sl-cell-inner-selected",".ml-explorer-swimlane").removeClass("sl-cell-inner-selected");(0,_jquery2.default)(cellsToSelect).find(".sl-cell-inner,.sl-cell-inner-dragselect").removeClass("sl-cell-inner-masked").addClass("sl-cell-inner-selected");(0,_jquery2.default)(".lane-label").filter(function(){return laneLabels.indexOf((0,_jquery2.default)(this).text())>-1}).removeClass("lane-label-masked");if("viewBy"===scope.swimlaneType){var overallSwimlane=(0,_jquery2.default)('ml-explorer-swimlane[swimlane-type="overall"]');times.forEach(function(time){var overallCell=(0,_jquery2.default)('div[data-time="'+time+'"]',overallSwimlane).find(".sl-cell-inner,.sl-cell-inner-dragselect");overallCell.addClass("sl-cell-inner-selected")})}if(checkEqualSelection&&_lodash2.default.isEqual({selectedType:scope.appState.mlExplorerSwimlane.selectedType,selectedLanes:scope.appState.mlExplorerSwimlane.selectedLanes,selectedTimes:scope.appState.mlExplorerSwimlane.selectedTimes},{selectedType:scope.swimlaneType,selectedLanes:laneLabels,selectedTimes:times}))clearSelection();else{scope.appState.mlExplorerSwimlane.selectedType=scope.swimlaneType;scope.appState.mlExplorerSwimlane.selectedLanes=laneLabels;scope.appState.mlExplorerSwimlane.selectedTimes=times;scope.appState.save();mlExplorerDashboardService.swimlaneCellClick.changed({fieldName:scope.swimlaneData.fieldName,laneLabels:laneLabels,time:_d2.default.extent(times),interval:scope.swimlaneData.interval,score:bucketScore})}}function clearSelection(){(0,_jquery2.default)(".lane-label",".ml-explorer-swimlane").removeClass("lane-label-masked");(0,_jquery2.default)(".sl-cell-inner",".ml-explorer-swimlane").removeClass("sl-cell-inner-masked");(0,_jquery2.default)(".sl-cell-inner.sl-cell-inner-selected",".ml-explorer-swimlane").removeClass("sl-cell-inner-selected");(0,_jquery2.default)(".sl-cell-inner-dragselect.sl-cell-inner-selected",".ml-explorer-swimlane").removeClass("sl-cell-inner-selected");(0,_jquery2.default)(".ds-selected",".ml-explorer-swimlane").removeClass("ds-selected");delete scope.appState.mlExplorerSwimlane.selectedType;delete scope.appState.mlExplorerSwimlane.selectedLanes;delete scope.appState.mlExplorerSwimlane.selectedTimes;scope.appState.save();mlExplorerDashboardService.swimlaneCellClick.changed({})}}var template='<div class="ml-swimlanes"></div>';return{scope:{swimlaneType:"@",swimlaneData:"=",selectedJobIds:"=",chartWidth:"=",appState:"="},link:link,template:template}})},3901:function(module,exports){},3902:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3903);__webpack_require__(3905);__webpack_require__(3908);__webpack_require__(636)},3903:function(module,exports,__webpack_require__){"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _modules=__webpack_require__(2);var _explorer_chart_config_builder=__webpack_require__(3904);var _chart_utils=__webpack_require__(256);var _job_utils=__webpack_require__(41);var _results_service=__webpack_require__(426);var _job_service=__webpack_require__(24);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.controller("MlExplorerChartsContainerController",function($scope,$injector){var Private=$injector.get("Private");var mlExplorerDashboardService=$injector.get("mlExplorerDashboardService");var mlSelectSeverityService=$injector.get("mlSelectSeverityService");$scope.seriesToPlot=[];var $chartContainer=(0,_jquery2.default)(".explorer-charts");var FUNCTION_DESCRIPTIONS_TO_PLOT=["mean","min","max","sum","count","distinct_count","median"];var CHART_MAX_POINTS=500;var ANOMALIES_MAX_RESULTS=500;var MAX_SCHEDULED_EVENTS=10;var ML_TIME_FIELD_NAME="timestamp";var USE_OVERALL_CHART_LIMITS=false;var anomalyDataChangeListener=function anomalyDataChangeListener(anomalyRecords,earliestMs,latestMs){var threshold=mlSelectSeverityService.state.get("threshold");var filteredRecords=_lodash2.default.filter(anomalyRecords,function(record){return Number(record.record_score)>=threshold.val});var allSeriesRecords=processRecordsForDisplay(filteredRecords);var chartsContainerWidth=$chartContainer.width();var chartsPerRow=Math.min(Math.max(Math.floor(chartsContainerWidth/550),1),4);$scope.chartsPerRow=chartsPerRow;$scope.layoutCellsPerChart=12/$scope.chartsPerRow;var maxSeriesToPlot=Math.max(2*chartsPerRow,6);var recordsToPlot=allSeriesRecords.slice(0,maxSeriesToPlot);var seriesConfigs=buildDataConfigs(recordsToPlot);$scope.tooManyBuckets=false;var chartRange=calculateChartRange(seriesConfigs,earliestMs,latestMs,Math.floor(chartsContainerWidth/chartsPerRow),recordsToPlot);$scope.seriesToPlot=seriesConfigs.map(function(config){return _extends({},config,{loading:true,chartData:null})});function getMetricData(config,range){var datafeedQuery=_lodash2.default.get(config,"datafeedConfig.query",null);return _results_service.mlResultsService.getMetricData(config.datafeedConfig.indices,config.datafeedConfig.types,config.entityFields,datafeedQuery,config.metricFunction,config.metricFieldName,config.timeField,range.min,range.max,config.interval)}function getRecordsForCriteria(config,range){var criteria=[];criteria.push({fieldName:"detector_index",fieldValue:config.detectorIndex});criteria=criteria.concat(config.entityFields);return _results_service.mlResultsService.getRecordsForCriteria([config.jobId],criteria,0,range.min,range.max,ANOMALIES_MAX_RESULTS)}function getScheduledEvents(config,range){return _results_service.mlResultsService.getScheduledEventsByBucket([config.jobId],range.min,range.max,config.interval,1,MAX_SCHEDULED_EVENTS)}var seriesPromises=seriesConfigs.map(function(seriesConfig){return Promise.all([getMetricData(seriesConfig,chartRange),getRecordsForCriteria(seriesConfig,chartRange),getScheduledEvents(seriesConfig,chartRange)])});function processChartData(response,seriesIndex){var metricData=response[0].results;var records=response[1].records;var jobId=seriesConfigs[seriesIndex].jobId;var scheduledEvents=response[2].events[jobId];if(void 0===metricData||0===_lodash2.default.keys(metricData).length)return[];var chartData=_lodash2.default.map(metricData,function(value,time){return{date:+time,value:value}});_lodash2.default.each(records,function(record){var recordTime=record[ML_TIME_FIELD_NAME];var chartPoint=findNearestChartPointToTime(chartData,recordTime);if(void 0===chartPoint){var lastChartPoint=chartData[chartData.length-1];var lastChartPointScore=lastChartPoint.anomalyScore||0;record.record_score>lastChartPointScore&&(chartPoint=lastChartPoint)}if(void 0!==chartPoint){chartPoint.anomalyScore=record.record_score;if(_lodash2.default.has(record,"actual")){chartPoint.actual=record.actual;chartPoint.typical=record.typical}else{var causes=_lodash2.default.get(record,"causes",[]);if(causes.length>0){chartPoint.byFieldName=record.by_field_name;chartPoint.numberOfCauses=causes.length;if(1===causes.length){var cause=_lodash2.default.first(record.causes);chartPoint.actual=cause.actual;chartPoint.typical=cause.typical}}}}});void 0!==scheduledEvents&&_lodash2.default.each(scheduledEvents,function(events,time){var chartPoint=findNearestChartPointToTime(chartData,time);void 0!==chartPoint&&(chartPoint.scheduledEvents=events)});return chartData}function findNearestChartPointToTime(chartData,time){var chartPoint=void 0;for(var i=0;i<chartData.length;i++)if(chartData[i].date===time){chartPoint=chartData[i];break}if(void 0===chartPoint){var foundItem=void 0;for(var _i=0;_i<chartData.length;_i++){var itemTime=chartData[_i].date;if(itemTime>time&&_i>0){var item=chartData[_i];var previousItem=_i>0?chartData[_i-1]:null;var diff1=Math.abs(time-previousItem.date);var diff2=Math.abs(time-itemTime);foundItem=null===previousItem||diff1>diff2?item:previousItem;break}}chartPoint=foundItem}return chartPoint}Promise.all(seriesPromises).then(function(response){var processedData=response.map(processChartData);var allDataPoints=_lodash2.default.reduce(processedData,function(datapoints,series){_lodash2.default.each(series,function(d){return datapoints.push(d)});return datapoints},[]);var overallChartLimits=(0,_chart_utils.chartLimits)(allDataPoints);$scope.seriesToPlot=response.map(function(d,i){return _extends({},seriesConfigs[i],{loading:false,chartData:processedData[i],plotEarliest:chartRange.min,plotLatest:chartRange.max,selectedEarliest:earliestMs,selectedLatest:latestMs,chartLimits:USE_OVERALL_CHART_LIMITS?overallChartLimits:(0,_chart_utils.chartLimits)(processedData[i])})})}).catch(function(error){console.error(error)})};mlExplorerDashboardService.anomalyDataChange.watch(anomalyDataChangeListener);$scope.$on("$destroy",function(){mlExplorerDashboardService.anomalyDataChange.unwatch(anomalyDataChangeListener)});function processRecordsForDisplay(anomalyRecords){if(0===anomalyRecords.length)return[];var aggregatedData={};_lodash2.default.each(anomalyRecords,function(record){var job=_job_service.mlJobService.getJob(record.job_id);if(false===(0,_job_utils.isTimeSeriesViewDetector)(job,record.detector_index)||-1===_lodash2.default.indexOf(FUNCTION_DESCRIPTIONS_TO_PLOT,record.function_description))return;var jobId=record.job_id;_lodash2.default.has(aggregatedData,jobId)||(aggregatedData[jobId]={});var detectorsForJob=aggregatedData[jobId];var detectorIndex=record.detector_index;_lodash2.default.has(detectorsForJob,detectorIndex)||(detectorsForJob[detectorIndex]={});var firstFieldName=record.partition_field_name||record.by_field_name||record.over_field_name;var firstFieldValue=record.partition_field_value||record.by_field_value||record.over_field_value;if(void 0!==firstFieldName){var groupsForDetector=detectorsForJob[detectorIndex];_lodash2.default.has(groupsForDetector,firstFieldName)||(groupsForDetector[firstFieldName]={});var valuesForGroup=groupsForDetector[firstFieldName];_lodash2.default.has(valuesForGroup,firstFieldValue)||(valuesForGroup[firstFieldValue]={});var dataForGroupValue=valuesForGroup[firstFieldValue];var isSecondSplit=false;if(void 0!==record.partition_field_name){var splitFieldName=record.over_field_name||record.by_field_name;void 0!==splitFieldName&&(isSecondSplit=true)}if(false===isSecondSplit)if(_lodash2.default.has(dataForGroupValue,"maxScoreRecord")){if(record.record_score>dataForGroupValue.maxScore){dataForGroupValue.maxScore=record.record_score;dataForGroupValue.maxScoreRecord=record}}else{dataForGroupValue.maxScore=record.record_score;dataForGroupValue.maxScoreRecord=record}else{var secondFieldName=record.over_field_name||record.by_field_name;var secondFieldValue=record.over_field_value||record.by_field_value;_lodash2.default.has(dataForGroupValue,secondFieldName)||(dataForGroupValue[secondFieldName]={});var splitsForGroup=dataForGroupValue[secondFieldName];_lodash2.default.has(splitsForGroup,secondFieldValue)||(splitsForGroup[secondFieldValue]={});var dataForSplitValue=splitsForGroup[secondFieldValue];if(_lodash2.default.has(dataForSplitValue,"maxScoreRecord")){if(record.record_score>dataForSplitValue.maxScore){dataForSplitValue.maxScore=record.record_score;dataForSplitValue.maxScoreRecord=record}}else{dataForSplitValue.maxScore=record.record_score;dataForSplitValue.maxScoreRecord=record}}}else{var dataForDetector=detectorsForJob[detectorIndex];if(_lodash2.default.has(dataForDetector,"maxScoreRecord")){if(record.record_score>dataForDetector.maxScore){dataForDetector.maxScore=record.record_score;dataForDetector.maxScoreRecord=record}}else{dataForDetector.maxScore=record.record_score;dataForDetector.maxScoreRecord=record}}});console.log("explorer charts aggregatedData is:",aggregatedData);var recordsForSeries=[];_lodash2.default.each(aggregatedData,function(detectorsForJob){_lodash2.default.each(detectorsForJob,function(groupsForDetector){_lodash2.default.has(groupsForDetector,"maxScoreRecord")?recordsForSeries.push(groupsForDetector.maxScoreRecord):_lodash2.default.each(groupsForDetector,function(valuesForGroup){_lodash2.default.each(valuesForGroup,function(dataForGroupValue){_lodash2.default.has(dataForGroupValue,"maxScoreRecord")?recordsForSeries.push(dataForGroupValue.maxScoreRecord):_lodash2.default.each(dataForGroupValue,function(splitsForGroup){_lodash2.default.each(splitsForGroup,function(dataForSplitValue){recordsForSeries.push(dataForSplitValue.maxScoreRecord)})})})})})});recordsForSeries=_lodash2.default.sortBy(recordsForSeries,"record_score").reverse();return recordsForSeries}function buildDataConfigs(anomalyRecords){var configBuilder=Private(_explorer_chart_config_builder.explorerChartConfigBuilder);return anomalyRecords.map(configBuilder.buildConfig)}function calculateChartRange(seriesConfigs,earliestMs,latestMs,chartWidth,recordsToPlot){var midpointMs=Math.ceil((earliestMs+latestMs)/2);var maxBucketSpanMs=1e3*Math.max.apply(null,_lodash2.default.pluck(seriesConfigs,"bucketSpanSeconds"));var pointsToPlotFullSelection=Math.ceil((latestMs-earliestMs)/maxBucketSpanMs);var optimumPointSpacing=5;var optimumNumPoints=chartWidth/optimumPointSpacing;var plotPoints=Math.max(optimumNumPoints,pointsToPlotFullSelection);var halfPoints=Math.ceil(plotPoints/2);var chartRange={min:midpointMs-halfPoints*maxBucketSpanMs,max:midpointMs+halfPoints*maxBucketSpanMs};if(plotPoints>CHART_MAX_POINTS){$scope.tooManyBuckets=true;var maxTimeSpan=maxBucketSpanMs*CHART_MAX_POINTS;var minMs=recordsToPlot[0][$scope.timeFieldName];var maxMs=recordsToPlot[0][$scope.timeFieldName];_lodash2.default.each(recordsToPlot,function(record){var diffMs=maxMs-minMs;if(diffMs<maxTimeSpan){var recordTime=record[$scope.timeFieldName];recordTime<minMs&&maxMs-recordTime<=maxTimeSpan&&(minMs=recordTime);recordTime>maxMs&&recordTime-minMs<=maxTimeSpan&&(maxMs=recordTime)}});if(maxMs-minMs<maxTimeSpan){minMs=Math.max(earliestMs,maxMs-maxTimeSpan);maxMs=Math.min(latestMs,minMs+maxTimeSpan)}chartRange={min:minMs,max:maxMs}}return chartRange}})},3904:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.explorerChartConfigBuilder=explorerChartConfigBuilder;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _parse_interval=__webpack_require__(117);var _chart_config_builder=__webpack_require__(1450);var _string_utils=__webpack_require__(40);var _job_service=__webpack_require__(24);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function explorerChartConfigBuilder(){var compiledTooltip=_lodash2.default.template('<div class="explorer-chart-info-tooltip">job ID: <%= jobId %><br/>aggregation interval: <%= aggregationInterval %><br/>chart function: <%= chartFunction %><% for(let i = 0; i < entityFields.length; ++i) { %><br/><%= entityFields[i].fieldName %>: <%= entityFields[i].fieldValue %><% } %></div>');function buildConfig(record){var job=_job_service.mlJobService.getJob(record.job_id);var detectorIndex=record.detector_index;var config=(0,_chart_config_builder.buildConfigFromDetector)(job,detectorIndex);config.functionDescription=record.function_description;config.bucketSpanSeconds=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span).asSeconds();config.detectorLabel=record.function;_lodash2.default.has(_job_service.mlJobService.detectorsByJob,record.job_id)&&detectorIndex<_job_service.mlJobService.detectorsByJob[record.job_id].length?config.detectorLabel=_job_service.mlJobService.detectorsByJob[record.job_id][detectorIndex].detector_description:void 0!==record.field_name&&(config.detectorLabel+=" "+config.fieldName);if(void 0!==record.field_name){config.fieldName=record.field_name;config.metricFieldName=record.field_name}config.entityFields=[];_lodash2.default.has(record,"partition_field_name")&&config.entityFields.push({fieldName:record.partition_field_name,fieldValue:record.partition_field_value});_lodash2.default.has(record,"over_field_name")&&config.entityFields.push({fieldName:record.over_field_name,fieldValue:record.over_field_value});_lodash2.default.has(record,"by_field_name")&&!_lodash2.default.has(record,"over_field_name")&&config.entityFields.push({fieldName:record.by_field_name,fieldValue:record.by_field_value});var functionLabel=config.metricFunction;void 0!==config.metricFieldName&&(functionLabel+=" "+(0,_string_utils.mlEscape)(config.metricFieldName));config.infoTooltip=compiledTooltip({jobId:record.job_id,aggregationInterval:config.interval,chartFunction:functionLabel,entityFields:config.entityFields.map(function(f){return{fieldName:(0,_string_utils.mlEscape)(f.fieldName),fieldValue:(0,_string_utils.mlEscape)(f.fieldValue)}})});return config}return{buildConfig:buildConfig}}},3905:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3906);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _risonNode=__webpack_require__(254);var _risonNode2=_interopRequireDefault(_risonNode);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _timefilter=__webpack_require__(14);var _explorer_charts_container=__webpack_require__(3907);var _explorer_charts_container2=_interopRequireDefault(_explorer_charts_container);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlExplorerChartsContainer",function($window){function link(scope,element){(0,_jquery2.default)(".ml-explorer-charts-tooltip").remove();(0,_jquery2.default)("body").append('<div class="ml-explorer-tooltip ml-explorer-charts-tooltip" style="opacity:0; display: none;">');element.on("$destroy",function(){scope.$destroy()});scope.exploreSeries=function(series){var bounds=_timefilter.timefilter.getActiveBounds();var from=bounds.min.toISOString();var to=bounds.max.toISOString();var zoomFrom=(0,_moment2.default)(series.plotEarliest).toISOString();var zoomTo=(0,_moment2.default)(series.plotLatest).toISOString();var entityCondition={};_lodash2.default.each(series.entityFields,function(entity){entityCondition[entity.fieldName]=entity.fieldValue});var _g=_risonNode2.default.encode({ml:{jobIds:[series.jobId]},refreshInterval:{display:"Off",pause:false,value:0},time:{from:from,to:to,mode:"absolute"}});var _a=_risonNode2.default.encode({mlTimeSeriesExplorer:{zoom:{from:zoomFrom,to:zoomTo},detectorIndex:series.detectorIndex,entities:entityCondition},filters:[],query:{query_string:{analyze_wildcard:true,query:"*"}}});var path=_chrome2.default.getBasePath();path+="/app/ml#/timeseriesexplorer";path+="?_g="+_g;path+="&_a="+encodeURIComponent(_a);$window.open(path,"_blank")}}return{restrict:"E",scope:{seriesToPlot:"=",chartsPerRow:"=",layoutCellsPerChart:"=",tooManyBuckets:"="},link:link,template:_explorer_charts_container2.default}})},3906:function(module,exports){},3907:function(module,exports){module.exports='<div class="explorer-charts">\n  <div class="row" ng-hide="seriesToPlot.length === 0">\n\n    <div ng-repeat="series in seriesToPlot" class="ml-explorer-chart-container col-md-{{layoutCellsPerChart}}">\n      <div class="explorer-chart-label">\n        <div class="explorer-chart-label-fields">\n          <span ng-if="series.entityFields.length > 0">{{series.detectorLabel}} - </span>\n          <span ng-if="series.entityFields.length === 0">{{series.detectorLabel}}</span>\n          <span ng-repeat=\'entity in series.entityFields\'>\n            {{entity.fieldName}} {{entity.fieldValue}}\n          </span>\n        </div>\n        <i aria-hidden="true" class="fa fa-info-circle" tooltip-placement="left" tooltip-html-unsafe="{{series.infoTooltip}}" tooltip-append-to-body="false"></i>\n        <i ng-if="tooManyBuckets" aria-hidden="true" class="fa fa-exclamation-triangle text-warning" tooltip-placement="bottom" tooltip-append-to-body="true"\n          tooltip-html-unsafe="This selection contains too many buckets to be displayed. The dashboard is best viewed over a shorter time range." ></i>\n        <a class="kuiLink" ng-click="exploreSeries(series)" data-toggle="tooltip" tooltip="View series in Single Metric Viewer">\n          View <i class="fa fa-external-link" aria-hidden="true"></i>\n        </a>\n      </div>\n      <ml-explorer-chart series-config="series" />\n    </div>\n\n  </div>\n\n</div>\n'},3908:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3909);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _d=__webpack_require__(19);var _d2=_interopRequireDefault(_d);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _format_value=__webpack_require__(637);var _anomaly_utils=__webpack_require__(299);var _chart_utils=__webpack_require__(256);var _time_buckets=__webpack_require__(273);var _loading_indicator_wrapper=__webpack_require__(3910);var _loading_indicator_wrapper2=_interopRequireDefault(_loading_indicator_wrapper);var _string_utils=__webpack_require__(40);var _field_format_service=__webpack_require__(255);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlExplorerChart",function(mlChartTooltipService,Private,mlSelectSeverityService){function link(scope,element){console.log("ml-explorer-chart directive link series config:",scope.seriesConfig);if("undefined"===typeof scope.seriesConfig)return;var config=scope.seriesConfig;var fieldFormat=_field_format_service.mlFieldFormatService.getFieldFormat(config.jobId,config.detectorIndex);var vizWidth=0;var chartHeight=170;var LINE_CHART_ANOMALY_RADIUS=7;var SCHEDULED_EVENT_MARKER_HEIGHT=5;var margin={top:10,right:0,bottom:30,left:60};var lineChartXScale=null;var lineChartYScale=null;var lineChartGroup=void 0;var lineChartValuesLine=null;scope.isLoading=config.loading;Array.isArray(config.chartData)&&scope.$evalAsync(function(){init(config.chartLimits);drawLineChart(config.chartData)});element.on("$destroy",function(){scope.$destroy()});function init(chartLimits){var $el=_angular2.default.element("ml-explorer-chart");var chartElement=_d2.default.select(element.get(0)).select(".content-wrapper");chartElement.select("svg").remove();var svgWidth=$el.width();var svgHeight=chartHeight+margin.top+margin.bottom;var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);lineChartYScale=_d2.default.scale.linear().range([chartHeight,0]).domain([chartLimits.min,chartLimits.max]).nice();var yAxis=_d2.default.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);var maxYAxisLabelWidth=0;var tempLabelText=svg.append("g").attr("class","temp-axis-label tick");tempLabelText.selectAll("text.temp.axis").data(lineChartYScale.ticks()).enter().append("text").text(function(d){return void 0!==fieldFormat?fieldFormat.convert(d,"text"):lineChartYScale.tickFormat()(d)}).each(function(){maxYAxisLabelWidth=Math.max(this.getBBox().width+yAxis.tickPadding(),maxYAxisLabelWidth)}).remove();_d2.default.select(".temp-axis-label").remove();margin.left=Math.max(maxYAxisLabelWidth,40);vizWidth=svgWidth-margin.left-margin.right;lineChartXScale=_d2.default.time.scale().range([0,vizWidth]).domain([config.plotEarliest,config.plotLatest]);lineChartValuesLine=_d2.default.svg.line().x(function(d){return lineChartXScale(d.date)}).y(function(d){return lineChartYScale(d.value)}).defined(function(d){return null!==d.value});lineChartGroup=svg.append("g").attr("class","line-chart").attr("transform","translate("+margin.left+","+margin.top+")")}function drawLineChart(data){lineChartGroup.append("rect").attr("x",0).attr("y",0).attr("height",chartHeight).attr("width",vizWidth).style("stroke","#cccccc").style("fill","none").style("stroke-width",1);drawLineChartAxes();drawLineChartHighlightedSpan();drawLineChartPaths(data);(0,_chart_utils.drawLineChartDots)(data,lineChartGroup,lineChartValuesLine);drawLineChartMarkers(data)}function drawLineChartAxes(){var timeBuckets=new _time_buckets.TimeBuckets;var bounds={min:(0,_moment2.default)(config.plotEarliest),max:(0,_moment2.default)(config.plotLatest)};timeBuckets.setBounds(bounds);timeBuckets.setInterval("auto");var xAxisTickFormat=timeBuckets.getScaledDateFormat();var xAxis=_d2.default.svg.axis().scale(lineChartXScale).orient("bottom").innerTickSize(-chartHeight).outerTickSize(0).tickPadding(10).ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)});var yAxis=_d2.default.svg.axis().scale(lineChartYScale).orient("left").innerTickSize(0).outerTickSize(0).tickPadding(10);void 0!==fieldFormat&&yAxis.tickFormat(function(d){return fieldFormat.convert(d,"text")});var axes=lineChartGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0,"+chartHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis)}function drawLineChartHighlightedSpan(){var rectStart=Math.max(config.selectedEarliest,config.plotEarliest);var rectEnd=Math.min(config.selectedLatest,config.plotLatest);var rectWidth=lineChartXScale(rectEnd)-lineChartXScale(rectStart);lineChartGroup.append("rect").attr("class","selected-interval").attr("x",lineChartXScale(new Date(rectStart))).attr("y",1).attr("width",rectWidth).attr("height",chartHeight-1)}function drawLineChartPaths(data){lineChartGroup.append("path").attr("class","values-line").attr("d",lineChartValuesLine(data))}function drawLineChartMarkers(data){var dots=lineChartGroup.append("g").attr("class","chart-markers").selectAll(".metric-value").data(data.filter(function(d){return null!==d.value}));dots.exit().remove();dots.enter().append("circle").attr("r",LINE_CHART_ANOMALY_RADIUS).on("mouseover",function(d){showLineChartTooltip(d,this)}).on("mouseout",function(){return mlChartTooltipService.hide()});var threshold=mlSelectSeverityService.state.get("threshold");dots.attr("cx",function(d){return lineChartXScale(d.date)}).attr("cy",function(d){return lineChartYScale(d.value)}).attr("class",function(d){var markerClass="metric-value";if(_lodash2.default.has(d,"anomalyScore")&&Number(d.anomalyScore)>=threshold.val){markerClass+=" anomaly-marker ";markerClass+=(0,_anomaly_utils.getSeverityWithLow)(d.anomalyScore)}return markerClass});var scheduledEventMarkers=lineChartGroup.select(".chart-markers").selectAll(".scheduled-event-marker").data(data.filter(function(d){return void 0!==d.scheduledEvents}));scheduledEventMarkers.exit().remove();scheduledEventMarkers.enter().append("rect").attr("width",2*LINE_CHART_ANOMALY_RADIUS).attr("height",SCHEDULED_EVENT_MARKER_HEIGHT).attr("class","scheduled-event-marker").attr("rx",1).attr("ry",1);scheduledEventMarkers.attr("x",function(d){return lineChartXScale(d.date)-LINE_CHART_ANOMALY_RADIUS}).attr("y",function(d){return lineChartYScale(d.value)-SCHEDULED_EVENT_MARKER_HEIGHT/2})}function showLineChartTooltip(marker,circle){var formattedDate=(0,_moment2.default)(marker.date).format("MMMM Do YYYY, HH:mm");var contents=formattedDate+"<br/><hr/>";if(_lodash2.default.has(marker,"anomalyScore")){var score=parseInt(marker.anomalyScore);var displayScore=score>0?score:"< 1";contents+="anomaly score: "+displayScore;if(_lodash2.default.has(marker,"actual")){contents+="<br/>actual: "+(0,_format_value.formatValue)(marker.actual,config.functionDescription,fieldFormat);contents+="<br/>typical: "+(0,_format_value.formatValue)(marker.typical,config.functionDescription,fieldFormat)}else{contents+="<br/>value: "+(0,_format_value.formatValue)(marker.value,config.functionDescription,fieldFormat);if(_lodash2.default.has(marker,"byFieldName")&&_lodash2.default.has(marker,"numberOfCauses")){var numberOfCauses=marker.numberOfCauses;var byFieldName=(0,_string_utils.mlEscape)(marker.byFieldName);contents+=numberOfCauses<10?"<br/> "+numberOfCauses+" unusual "+byFieldName+" values":"<br/> "+numberOfCauses+"+ unusual "+byFieldName+" values"}}}else contents+="value: "+(0,_format_value.formatValue)(marker.value,config.functionDescription,fieldFormat);_lodash2.default.has(marker,"scheduledEvents")&&(contents+="<br/><hr/>Scheduled events:<br/>"+marker.scheduledEvents.map(_string_utils.mlEscape).join("<br/>"));mlChartTooltipService.show(contents,circle,{x:2*LINE_CHART_ANOMALY_RADIUS,y:0})}}return{restrict:"E",scope:{seriesConfig:"="},link:link,template:_loading_indicator_wrapper2.default}})},3909:function(module,exports){},3910:function(module,exports){module.exports='<ml-loading-indicator is-loading="isLoading" height="height" />\n<div class="content-wrapper" />\n'},3911:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3912)},3912:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _state_factory=__webpack_require__(498);var _select_limit=__webpack_require__(3913);var _select_limit2=_interopRequireDefault(_select_limit);__webpack_require__(1448);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.service("mlSelectLimitService",function(Private){var stateFactory=Private(_state_factory.stateFactoryProvider);this.state=stateFactory("mlSelectLimit",{limit:{display:"10",val:10}})}).directive("mlSelectLimit",function(mlSelectLimitService){return{restrict:"E",template:_select_limit2.default,link:function link(scope,element){scope.limitOptions=[{display:"5",val:5},{display:"10",val:10},{display:"25",val:25},{display:"50",val:50}];var limitState=mlSelectLimitService.state.get("limit");var limitValue=_lodash2.default.get(limitState,"val",0);var limitOption=scope.limitOptions.find(function(d){return d.val===limitValue});void 0===limitOption&&(limitOption=scope.limitOptions.find(function(d){return 10===d.val}));scope.limit=limitOption;mlSelectLimitService.state.set("limit",scope.limit);scope.setLimit=function(limit){if(!_lodash2.default.isEqual(scope.limit,limit)){scope.limit=limit;mlSelectLimitService.state.set("limit",scope.limit).changed()}};function setLimit(){scope.setLimit(mlSelectLimitService.state.get("limit"))}mlSelectLimitService.state.watch(setLimit);element.on("$destroy",function(){mlSelectLimitService.state.unwatch(setLimit);scope.$destroy()})}}})},3913:function(module,exports){module.exports='<ml-controls-select\n  identifier="Limit"\n  label="Limit"\n  narrow-style="true"\n  options="limitOptions"\n  selected="limit"\n  show-icons="false"\n  update-fn="setLimit"\n/>\n'},3914:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3915);__webpack_require__(3926);__webpack_require__(1453);__webpack_require__(3928);__webpack_require__(3932);__webpack_require__(877);__webpack_require__(636)},3915:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3916);__webpack_require__(3925)},3916:function(module,exports,__webpack_require__){"use strict";__webpack_require__(93);var _timefilter=__webpack_require__(14);var _modules=__webpack_require__(2);var _forecasting_modal=__webpack_require__(3917);var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlForecastingModal",function($injector){var reactDirective=$injector.get("reactDirective");return reactDirective(_forecasting_modal.ForecastingModal,void 0,{restrict:"E"},{timefilter:_timefilter.timefilter})})},3917:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ForecastingModal=void 0;var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _states=__webpack_require__(321);var _message_levels=__webpack_require__(1451);var _job_utils=__webpack_require__(41);var _parse_interval=__webpack_require__(127);var _modal=__webpack_require__(3918);var _progress_states=__webpack_require__(878);var _ml_api_service=__webpack_require__(23);var _job_service=__webpack_require__(24);var _forecast_service=__webpack_require__(627);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var FORECAST_JOB_MIN_VERSION="6.1.0";var FORECASTS_VIEW_MAX=5;var FORECAST_DURATION_MAX_MS=48384e5;var WARN_NUM_PARTITIONS=100;var FORECAST_STATS_POLL_FREQUENCY=250;var WARN_NO_PROGRESS_MS=12e4;function getDefaultState(){return{isModalVisible:false,previousForecasts:[],isForecastRequested:false,forecastProgress:_progress_states.PROGRESS_STATES.UNSET,jobOpeningState:_progress_states.PROGRESS_STATES.UNSET,jobClosingState:_progress_states.PROGRESS_STATES.UNSET,newForecastDuration:"1d",isNewForecastDurationValid:true,newForecastDurationErrors:[],messages:[]}}var ForecastingModal=function(_Component){_inherits(ForecastingModal,_Component);function ForecastingModal(props){_classCallCheck(this,ForecastingModal);var _this=_possibleConstructorReturn(this,(ForecastingModal.__proto__||Object.getPrototypeOf(ForecastingModal)).call(this,props));_this.addMessage=function(message,status){var clearFirst=arguments.length>2&&void 0!==arguments[2]&&arguments[2];var msg={message:message,status:status};_this.setState(function(prevState){return{messages:clearFirst?[msg]:[].concat(_toConsumableArray(prevState.messages),[msg])}})};_this.viewForecast=function(forecastId){_this.props.loadForForecastId(forecastId);_this.closeModal()};_this.onNewForecastDurationChange=function(event){var newForecastDurationErrors=[];var isNewForecastDurationValid=true;var duration=(0,_parse_interval.parseInterval)(event.target.value);if(null===duration){isNewForecastDurationValid=false;newForecastDurationErrors.push("Invalid duration format")}else if(duration.asMilliseconds()>FORECAST_DURATION_MAX_MS){isNewForecastDurationValid=false;newForecastDurationErrors.push("Forecast duration must not be greater than 8 weeks")}else if(0===duration.asMilliseconds()){isNewForecastDurationValid=false;newForecastDurationErrors.push("Forecast duration must not be zero")}_this.setState({newForecastDuration:event.target.value,isNewForecastDurationValid:isNewForecastDurationValid,newForecastDurationErrors:newForecastDurationErrors})};_this.checkJobStateAndRunForecast=function(){_this.setState({isForecastRequested:true,messages:[]});_this.props.job.state===_states.JOB_STATE.CLOSED?_this.openJobAndRunForecast():_this.runForecast(false)};_this.openJobAndRunForecast=function(){_this.setState({jobOpeningState:_progress_states.PROGRESS_STATES.WAITING});_job_service.mlJobService.openJob(_this.props.job.job_id).then(function(){_this.setState({jobOpeningState:_progress_states.PROGRESS_STATES.DONE});_this.runForecast(true)}).catch(function(resp){console.log("Time series forecast modal - could not open job:",resp);_this.addMessage("Error opening job before running forecast",_message_levels.MESSAGE_LEVEL.ERROR);_this.setState({jobOpeningState:_progress_states.PROGRESS_STATES.ERROR})})};_this.runForecastErrorHandler=function(resp){_this.setState({forecastProgress:_progress_states.PROGRESS_STATES.ERROR});console.log("Time series forecast modal - error running forecast:",resp);resp&&resp.message?_this.addMessage(resp.message,_message_levels.MESSAGE_LEVEL.ERROR,true):_this.addMessage("Unexpected response from running forecast. The request may have failed.",_message_levels.MESSAGE_LEVEL.ERROR,true)};_this.runForecast=function(closeJobAfterRunning){_this.setState({forecastProgress:0});var durationInSeconds=(0,_parse_interval.parseInterval)(_this.state.newForecastDuration).asSeconds();_forecast_service.mlForecastService.runForecast(_this.props.job.job_id,durationInSeconds+"s").then(function(resp){void 0!==resp.forecast_id?_this.waitForForecastResults(resp.forecast_id,closeJobAfterRunning):_this.runForecastErrorHandler(resp)}).catch(_this.runForecastErrorHandler)};_this.waitForForecastResults=function(forecastId,closeJobAfterRunning){var previousProgress=0;var noProgressMs=0;_this.forecastChecker=setInterval(function(){_forecast_service.mlForecastService.getForecastRequestStats(_this.props.job,forecastId).then(function(resp){var progress=_lodash2.default.get(resp,["stats","forecast_progress"],previousProgress);var status=_lodash2.default.get(resp,["stats","forecast_status"]);_this.setState({forecastProgress:Math.round(100*progress)});var messages=_lodash2.default.get(resp,["stats","forecast_messages"],[]);messages=messages.map(function(message){return{message:message,status:_message_levels.MESSAGE_LEVEL.WARNING}});_this.setState({messages:messages});if(status===_states.FORECAST_REQUEST_STATE.FINISHED){clearInterval(_this.forecastChecker);if(true===closeJobAfterRunning){_this.setState({jobClosingState:_progress_states.PROGRESS_STATES.WAITING});_job_service.mlJobService.closeJob(_this.props.job.job_id).then(function(){_this.setState({jobClosingState:_progress_states.PROGRESS_STATES.DONE});_this.props.loadForForecastId(forecastId);_this.closeAfterRunningForecast()}).catch(function(response){console.log("Time series forecast modal - could not close job:",response);_this.addMessage("Error closing job after running forecast",_message_levels.MESSAGE_LEVEL.ERROR);_this.setState({jobClosingState:_progress_states.PROGRESS_STATES.ERROR});_this.props.loadForForecastId(forecastId)})}else{_this.props.loadForForecastId(forecastId);_this.closeAfterRunningForecast()}}else if(progress===previousProgress){noProgressMs+=FORECAST_STATS_POLL_FREQUENCY;if(noProgressMs>WARN_NO_PROGRESS_MS){console.log("Forecast request has not progressed for "+WARN_NO_PROGRESS_MS+"ms. Cancelling check.");_this.addMessage("No progress reported for the new forecast for "+WARN_NO_PROGRESS_MS+"ms. An error may have occurred whilst running the forecast.",_message_levels.MESSAGE_LEVEL.ERROR);_this.props.loadForForecastId(forecastId);_this.setState({forecastProgress:_progress_states.PROGRESS_STATES.ERROR});clearInterval(_this.forecastChecker)}}else previousProgress=progress}).catch(function(resp){console.log("Time series forecast modal - error loading stats of forecast from elasticsearch:",resp);_this.addMessage("Error loading stats of running forecast.",_message_levels.MESSAGE_LEVEL.ERROR);_this.setState({forecastProgress:_progress_states.PROGRESS_STATES.ERROR});clearInterval(_this.forecastChecker)})},FORECAST_STATS_POLL_FREQUENCY)};_this.openModal=function(){var job=_this.props.job;if("object"===("undefined"===typeof job?"undefined":_typeof(job))){var bounds=_this.props.timefilter.getActiveBounds();var statusFinishedQuery={term:{forecast_status:_states.FORECAST_REQUEST_STATE.FINISHED}};_forecast_service.mlForecastService.getForecastsSummary(job,statusFinishedQuery,bounds.min.valueOf(),FORECASTS_VIEW_MAX).then(function(resp){_this.setState({previousForecasts:resp.forecasts})}).catch(function(resp){console.log("Time series forecast modal - error obtaining forecasts summary:",resp);_this.addMessage("Error obtaining list of previous forecasts",_message_levels.MESSAGE_LEVEL.ERROR)});var entityFieldNames=_this.props.entities.map(function(entity){return entity.fieldName});entityFieldNames.length>0&&_ml_api_service.ml.getCardinalityOfFields({index:job.datafeed_config.indices,types:job.datafeed_config.types,fieldNames:entityFieldNames,query:job.datafeed_config.query,timeFieldName:job.data_description.time_field,earliestMs:job.data_counts.earliest_record_timestamp,latestMs:job.data_counts.latest_record_timestamp}).then(function(results){var numPartitions=1;Object.values(results).forEach(function(cardinality){numPartitions*=cardinality});numPartitions>WARN_NUM_PARTITIONS&&_this.addMessage("Note that this data contains more than "+WARN_NUM_PARTITIONS+" partitions so running a forecast may take a long time and consume a high amount of resource",_message_levels.MESSAGE_LEVEL.WARNING)}).catch(function(resp){console.log("Time series forecast modal - error obtaining cardinality of fields:",resp)});_this.setState({isModalVisible:true})}};_this.closeAfterRunningForecast=function(){0===_this.state.messages.length&&setTimeout(function(){_this.closeModal()},1e3)};_this.closeModal=function(){null!==_this.forecastChecker&&clearInterval(_this.forecastChecker);_this.setState(getDefaultState())};_this.state=getDefaultState();_this.forecastChecker=null;return _this}_createClass(ForecastingModal,[{key:"render",value:function render(){var isForecastingDisabled=false;var forecastingDisabledMessage=null;var job=this.props.job;if(void 0!==job){var detector=job.analysis_config.detectors[this.props.detectorIndex];var overFieldName=detector.over_field_name;if(void 0!==overFieldName){isForecastingDisabled=true;forecastingDisabledMessage="Forecasting is not available for population detectors with an over field"}else if(false===(0,_job_utils.isJobVersionGte)(job,FORECAST_JOB_MIN_VERSION)){isForecastingDisabled=true;forecastingDisabledMessage="Forecasting is only available for jobs created in version "+FORECAST_JOB_MIN_VERSION+" or later"}}var forecastButton=_react2.default.createElement(_eui.EuiButton,{onClick:this.openModal,size:"s",isDisabled:isForecastingDisabled,fill:true},"Forecast");return _react2.default.createElement("div",null,isForecastingDisabled?_react2.default.createElement(_eui.EuiToolTip,{position:"left",content:forecastingDisabledMessage},forecastButton):forecastButton,this.state.isModalVisible&&_react2.default.createElement(_modal.Modal,{job:this.props.job,forecasts:this.state.previousForecasts,close:this.closeModal,viewForecast:this.viewForecast,runForecast:this.checkJobStateAndRunForecast,newForecastDuration:this.state.newForecastDuration,onNewForecastDurationChange:this.onNewForecastDurationChange,isNewForecastDurationValid:this.state.isNewForecastDurationValid,newForecastDurationErrors:this.state.newForecastDurationErrors,isForecastRequested:this.state.isForecastRequested,forecastProgress:this.state.forecastProgress,jobOpeningState:this.state.jobOpeningState,jobClosingState:this.state.jobClosingState,messages:this.state.messages}))}}]);return ForecastingModal}(_react.Component);ForecastingModal.propTypes={isDisabled:_propTypes2.default.bool,job:_propTypes2.default.object,detectorIndex:_propTypes2.default.number,entities:_propTypes2.default.array,loadForForecastId:_propTypes2.default.func,timefilter:_propTypes2.default.object};exports.ForecastingModal=ForecastingModal},3918:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Modal=Modal;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _message_call_out=__webpack_require__(3919);var _forecasts_list=__webpack_require__(3921);var _run_controls=__webpack_require__(3922);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function Modal(props){return _react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_eui.EuiModal,{onClose:props.close,className:"forecast-modal"},_react2.default.createElement(_eui.EuiModalHeader,null,_react2.default.createElement(_eui.EuiModalHeaderTitle,null,"Forecasting")),_react2.default.createElement(_eui.EuiModalBody,null,props.messages.map(function(message,i){return _react2.default.createElement(_react2.default.Fragment,{key:i},_react2.default.createElement(_message_call_out.MessageCallOut,message),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}))}),props.forecasts.length>0&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_forecasts_list.ForecastsList,{forecasts:props.forecasts,viewForecast:props.viewForecast}),_react2.default.createElement(_eui.EuiSpacer,null)),_react2.default.createElement(_run_controls.RunControls,props)),_react2.default.createElement(_eui.EuiModalFooter,null,_react2.default.createElement(_eui.EuiButtonEmpty,{onClick:props.close,size:"s"},"Close"))))}Modal.propType={job:_propTypes2.default.object,forecasts:_propTypes2.default.array,close:_propTypes2.default.func.isRequired,viewForecast:_propTypes2.default.func.isRequired,runForecast:_propTypes2.default.func.isRequired,newForecastDuration:_propTypes2.default.string,isNewForecastDurationValid:_propTypes2.default.bool,newForecastDurationErrors:_propTypes2.default.array,onNewForecastDurationChange:_propTypes2.default.func.isRequired,isForecastRequested:_propTypes2.default.bool,forecastProgress:_propTypes2.default.number,jobOpeningState:_propTypes2.default.number,jobClosingState:_propTypes2.default.number,messages:_propTypes2.default.array}},3919:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _message_call_out=__webpack_require__(3920);Object.defineProperty(exports,"MessageCallOut",{enumerable:true,get:function get(){return _message_call_out.MessageCallOut}})},3920:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};exports.MessageCallOut=MessageCallOut;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _eui=__webpack_require__(3);var _message_levels=__webpack_require__(1451);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function getCallOutAttributes(message,status){switch(status){case _message_levels.MESSAGE_LEVEL.ERROR:return{title:message,iconType:"cross",color:"danger"};case _message_levels.MESSAGE_LEVEL.WARNING:return{title:message,iconType:"alert",color:"warning"};case _message_levels.MESSAGE_LEVEL.SUCCESS:return{title:message,iconType:"check",color:"success"};case _message_levels.MESSAGE_LEVEL.INFO:return{title:message,iconType:"iInCircle",color:"primary"}}}function MessageCallOut(_ref){var message=_ref.message,status=_ref.status,rest=_objectWithoutProperties(_ref,["message","status"]);return _react2.default.createElement(_eui.EuiCallOut,_extends({size:"s"},getCallOutAttributes(message,status),rest))}MessageCallOut.propTypes={message:_propTypes2.default.string,status:_propTypes2.default.oneOf([_message_levels.MESSAGE_LEVEL.ERROR,_message_levels.MESSAGE_LEVEL.WARNING,_message_levels.MESSAGE_LEVEL.SUCCESS,_message_levels.MESSAGE_LEVEL.INFO])}},3921:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ForecastsList=ForecastsList;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _format=__webpack_require__(286);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var TIME_FORMAT="MMMM Do YYYY, HH:mm:ss";function getColumns(viewForecast){return[{field:"forecast_create_timestamp",name:"Created",dataType:"date",render:function render(date){return(0,_format.formatDate)(date,TIME_FORMAT)},sortable:true},{field:"forecast_start_timestamp",name:"From",dataType:"date",render:function render(date){return(0,_format.formatDate)(date,TIME_FORMAT)},sortable:true},{field:"forecast_end_timestamp",name:"To",dataType:"date",render:function render(date){return(0,_format.formatDate)(date,TIME_FORMAT)},sortable:true},{name:"View",render:function render(forecast){return _react2.default.createElement(_eui.EuiButton,{className:"view-forecast-btn",onClick:function onClick(){return viewForecast(forecast.forecast_id)}},_react2.default.createElement("i",{"aria-hidden":"true",className:"fa fa-line-chart"}))}}]}function ForecastsList(_ref){var forecasts=_ref.forecasts,viewForecast=_ref.viewForecast;return _react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("h3",{"aria-describedby":"ml_aria_description_forecasting_modal_view_list",style:{display:"inline",paddingRight:"5px"}},"Previous forecasts"),_react2.default.createElement(_eui.EuiToolTip,{position:"right",content:"Lists a maximum of five of the most recently run forecasts."},_react2.default.createElement(_eui.EuiIcon,{type:"questionInCircle",size:"s"})),_react2.default.createElement(_eui.EuiInMemoryTable,{items:forecasts,columns:getColumns(viewForecast),pagination:false}))}ForecastsList.propType={forecasts:_propTypes2.default.array,viewForecast:_propTypes2.default.func.isRequired}},3922:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.RunControls=RunControls;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _states=__webpack_require__(321);var _forecast_progress=__webpack_require__(3923);var _check_ml_nodes=__webpack_require__(69);var _check_privilege=__webpack_require__(35);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getRunInputDisabledState(job,isForecastRequested){if(false===(0,_check_ml_nodes.mlNodesAvailable)())return{isDisabled:true,isDisabledToolTipText:"There are no ML nodes available."};if(false===(0,_check_privilege.checkPermission)("canForecastJob"))return{isDisabled:true,isDisabledToolTipText:(0,_check_privilege.createPermissionFailureMessage)("canForecastJob")};if(job.state!==_states.JOB_STATE.OPENED&&job.state!==_states.JOB_STATE.CLOSED)return{isDisabled:true,isDisabledToolTipText:"Forecasts cannot be run on "+job.state+" jobs"};return{isDisabled:isForecastRequested}}function RunControls(_ref){var job=_ref.job,newForecastDuration=_ref.newForecastDuration,isNewForecastDurationValid=_ref.isNewForecastDurationValid,newForecastDurationErrors=_ref.newForecastDurationErrors,onNewForecastDurationChange=_ref.onNewForecastDurationChange,runForecast=_ref.runForecast,isForecastRequested=_ref.isForecastRequested,forecastProgress=_ref.forecastProgress,jobOpeningState=_ref.jobOpeningState,jobClosingState=_ref.jobClosingState;var disabledState=getRunInputDisabledState(job,isForecastRequested);var durationInput=_react2.default.createElement(_eui.EuiFieldText,{name:"forecastDuration",value:newForecastDuration,disabled:disabledState.isDisabled,isInvalid:!isNewForecastDurationValid,onChange:onNewForecastDurationChange,fullWidth:true});var runButton=_react2.default.createElement(_eui.EuiButton,{onClick:runForecast,isDisabled:disabledState.isDisabled||!isNewForecastDurationValid},"Run");return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("h3",null,"Run a new forecast")),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_eui.EuiForm,null,_react2.default.createElement(_eui.EuiFlexGroup,null,_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiFormRow,{label:"Duration",fullWidth:true,isInvalid:!isNewForecastDurationValid,error:newForecastDurationErrors,helpText:"Length of forecast, up to a maximum of 8 weeks. Use s for seconds, m for minutes, h for hours, d for days, w for weeks."},void 0===disabledState.isDisabledToolTipText?durationInput:_react2.default.createElement(_eui.EuiToolTip,{position:"right",content:disabledState.isDisabledToolTipText},durationInput))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFormRow,{hasEmptyLabelSpace:true},void 0===disabledState.isDisabledToolTipText?runButton:_react2.default.createElement(_eui.EuiToolTip,{position:"left",content:disabledState.isDisabledToolTipText},runButton))))),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),true===isForecastRequested&&_react2.default.createElement(_forecast_progress.ForecastProgress,{forecastProgress:forecastProgress,jobOpeningState:jobOpeningState,jobClosingState:jobClosingState}))}RunControls.propType={job:_propTypes2.default.object,newForecastDuration:_propTypes2.default.string,isNewForecastDurationValid:_propTypes2.default.bool,newForecastDurationErrors:_propTypes2.default.array,onNewForecastDurationChange:_propTypes2.default.func.isRequired,runForecast:_propTypes2.default.func.isRequired,isForecastRequested:_propTypes2.default.bool,forecastProgress:_propTypes2.default.number,jobOpeningState:_propTypes2.default.number,jobClosingState:_propTypes2.default.number}},3923:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ForecastProgress=ForecastProgress;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _progress_icon=__webpack_require__(3924);var _progress_states=__webpack_require__(878);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ForecastProgress(_ref){var forecastProgress=_ref.forecastProgress,jobOpeningState=_ref.jobOpeningState,jobClosingState=_ref.jobClosingState;return _react2.default.createElement("div",null,jobOpeningState!==_progress_states.PROGRESS_STATES.UNSET&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiText,{size:"xs"},_react2.default.createElement("h3",null,"Opening job..."))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_progress_icon.ProgressIcon,{state:jobOpeningState}))),_react2.default.createElement(_eui.EuiSpacer,{size:"s"})),forecastProgress!==_progress_states.PROGRESS_STATES.UNSET&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiText,{size:"xs"},_react2.default.createElement("h3",null,"Running forecast..."))),forecastProgress>=0&&_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiToolTip,{position:"top",content:forecastProgress+"%"},_react2.default.createElement(_eui.EuiProgress,{size:"l",value:forecastProgress,max:100}))),forecastProgress===_progress_states.PROGRESS_STATES.ERROR&&_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_progress_icon.ProgressIcon,{state:_progress_states.PROGRESS_STATES.ERROR}))),_react2.default.createElement(_eui.EuiSpacer,{size:"s"})),jobClosingState!==_progress_states.PROGRESS_STATES.UNSET&&_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{gutterSize:"s",alignItems:"center"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiText,{size:"xs"},_react2.default.createElement("h3",null,"Closing job..."))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_progress_icon.ProgressIcon,{state:jobClosingState})))))}ForecastProgress.propType={forecastProgress:_propTypes2.default.number,jobOpeningState:_propTypes2.default.number,jobClosingState:_propTypes2.default.number}},3924:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ProgressIcon=ProgressIcon;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _progress_states=__webpack_require__(878);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ProgressIcon(_ref){var state=_ref.state;if(state===_progress_states.PROGRESS_STATES.WAITING)return _react2.default.createElement(_eui.EuiLoadingSpinner,{size:"m"});if(state===_progress_states.PROGRESS_STATES.DONE)return _react2.default.createElement(_eui.EuiIcon,{type:"check",size:"m",color:"primary"});if(state===_progress_states.PROGRESS_STATES.ERROR)return _react2.default.createElement(_eui.EuiIcon,{type:"cross",size:"m",color:"danger"})}ProgressIcon.propTypes={state:_propTypes2.default.number}},3925:function(module,exports){},3926:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);__webpack_require__(1444);__webpack_require__(1447);var _notify=__webpack_require__(9);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _timefilter=__webpack_require__(14);var _parse_interval=__webpack_require__(117);var _check_license=__webpack_require__(68);var _check_privilege=__webpack_require__(35);var _job_utils=__webpack_require__(41);var _index_utils=__webpack_require__(128);var _timeseriesexplorer_utils=__webpack_require__(1452);var _refresh_interval_watcher=__webpack_require__(1449);var _ml_time_buckets=__webpack_require__(277);var _results_service=__webpack_require__(426);var _timeseriesexplorer=__webpack_require__(3927);var _timeseriesexplorer2=_interopRequireDefault(_timeseriesexplorer);var _check_ml_nodes=__webpack_require__(69);var _ml_api_service=__webpack_require__(23);var _job_service=__webpack_require__(24);var _field_format_service=__webpack_require__(255);var _job_select_service=__webpack_require__(503);var _forecast_service=__webpack_require__(627);var _timeseries_search_service=__webpack_require__(1453);var _promise=__webpack_require__(89);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}_routes2.default.when("/timeseriesexplorer/?",{template:_timeseriesexplorer2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,indexPatterns:_index_utils.loadIndexPatterns,mlNodeCount:_check_ml_nodes.getMlNodeCount,initPromise:(0,_promise.initPromise)(true)}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlTimeSeriesExplorerController",function($scope,$route,$timeout,Private,AppState,mlSelectIntervalService,mlSelectSeverityService){$scope.timeFieldName="timestamp";_timefilter.timefilter.enableTimeRangeSelector();_timefilter.timefilter.enableAutoRefreshSelector();var CHARTS_POINT_TARGET=500;var ANOMALIES_MAX_RESULTS=500;var MAX_SCHEDULED_EVENTS=10;var TimeBuckets=Private(_ml_time_buckets.IntervalHelperProvider);var mlJobSelectService=Private(_job_select_service.JobSelectServiceProvider);$scope.jobPickerSelections=[];$scope.selectedJob;$scope.detectors=[];$scope.loading=true;$scope.loadCounter=0;$scope.hasResults=false;$scope.anomalyRecords=[];$scope.modelPlotEnabled=false;$scope.showModelBounds=true;$scope.showModelBoundsCheckbox=false;$scope.showForecast=true;$scope.showForecastCheckbox=false;$scope.permissions={canForecastJob:(0,_check_privilege.checkPermission)("canForecastJob")};$scope.initializeVis=function(){var stateDefaults={mlTimeSeriesExplorer:{}};$scope.appState=new AppState(stateDefaults);$scope.jobs=[];_job_service.mlJobService.loadJobs().then(function(resp){if(resp.jobs.length>0){$scope.jobs=(0,_timeseriesexplorer_utils.createTimeSeriesJobData)(resp.jobs);var timeSeriesJobIds=$scope.jobs.map(function(j){return j.id});var selectedJobIds=mlJobSelectService.getSelectedJobIds(true);var invalidIds=_lodash2.default.difference(selectedJobIds,timeSeriesJobIds);selectedJobIds=_lodash2.default.without.apply(_lodash2.default,[selectedJobIds].concat(_toConsumableArray(invalidIds)));if(invalidIds.length>0){var s=1===invalidIds.length?"":"s";var warningText="You can't view requested job"+s+" "+invalidIds+" in this dashboard";0===selectedJobIds.length&&timeSeriesJobIds.length>0&&(warningText+=", auto selecting first job");_notify.toastNotifications.addWarning(warningText)}if(selectedJobIds.length>1||mlJobSelectService.groupIds.length)if(selectedJobIds.length>1){_notify.toastNotifications.addWarning("You can only view one job at a time in this dashboard");mlJobSelectService.setJobIds([selectedJobIds[0]])}else if(selectedJobIds.length>0){_notify.toastNotifications.addWarning("You can only view one job at a time in this dashboard");mlJobSelectService.setJobIds([selectedJobIds[0]])}else $scope.jobs.length>0?mlJobSelectService.setJobIds([$scope.jobs[0].id]):$scope.loading=false;else invalidIds.length>0&&selectedJobIds.length>0?mlJobSelectService.setJobIds([selectedJobIds[0]]):selectedJobIds.length>0?loadForJobId(selectedJobIds[0]):0===selectedJobIds.length&&$scope.jobs.length>0?mlJobSelectService.setJobIds([$scope.jobs[0].id]):$scope.loading=false}else $scope.loading=false}).catch(function(resp){console.log("Time series explorer - error getting job info from elasticsearch:",resp)})};$scope.refresh=function(){if(void 0===$scope.selectedJob)return;$scope.loading=true;$scope.hasResults=false;delete $scope.chartDetails;delete $scope.contextChartData;delete $scope.focusChartData;delete $scope.contextForecastData;delete $scope.focusForecastData;$scope.loadCounter++;var awaitingCount=3;function finish(counterVar){awaitingCount--;if(0===awaitingCount&&counterVar===$scope.loadCounter){$scope.contextChartData&&$scope.contextChartData.length||$scope.contextForecastData&&$scope.contextForecastData.length?$scope.hasResults=true:$scope.hasResults=false;$scope.loading=false;if($scope.contextChartData.length){var focusRange=calculateInitialFocusRange();$scope.zoomFrom=focusRange[0];$scope.zoomTo=focusRange[1]}($scope.contextChartData&&$scope.contextChartData.length||$scope.contextForecastData&&$scope.contextForecastData.length)&&$timeout(function(){$scope.$broadcast("render")},0)}}var bounds=_timefilter.timefilter.getActiveBounds();var detectorIndex=+$scope.detectorId;$scope.modelPlotEnabled=(0,_job_utils.isModelPlotEnabled)($scope.selectedJob,detectorIndex,$scope.entities);var nonBlankEntities=_lodash2.default.filter($scope.entities,function(entity){return entity.fieldValue.length>0});$scope.criteriaFields=[{fieldName:"detector_index",fieldValue:detectorIndex}].concat(nonBlankEntities);$scope.contextAggregationInterval=calculateAggregationInterval(bounds,CHARTS_POINT_TARGET,CHARTS_POINT_TARGET);console.log("aggregationInterval for context data (s):",$scope.contextAggregationInterval.asSeconds());var searchBounds=(0,_ml_time_buckets.getBoundsRoundedToInterval)(bounds,$scope.contextAggregationInterval,false);var counter=$scope.loadCounter;_timeseries_search_service.mlTimeSeriesSearchService.getMetricData($scope.selectedJob,detectorIndex,nonBlankEntities,searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.contextAggregationInterval.expression).then(function(resp){var fullRangeChartData=(0,_timeseriesexplorer_utils.processMetricPlotResults)(resp.results,$scope.modelPlotEnabled);$scope.contextChartData=fullRangeChartData;console.log("Time series explorer context chart data set:",$scope.contextChartData);finish(counter)}).catch(function(resp){console.log("Time series explorer - error getting metric data from elasticsearch:",resp)});_results_service.mlResultsService.getRecordMaxScoreByTime($scope.selectedJob.job_id,$scope.criteriaFields,searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.contextAggregationInterval.expression).then(function(resp){var fullRangeRecordScoreData=(0,_timeseriesexplorer_utils.processRecordScoreResults)(resp.results);$scope.swimlaneData=fullRangeRecordScoreData;console.log("Time series explorer swimlane anomalies data set:",$scope.swimlaneData);finish(counter)}).catch(function(resp){console.log("Time series explorer - error getting bucket anomaly scores from elasticsearch:",resp)});_timeseries_search_service.mlTimeSeriesSearchService.getChartDetails($scope.selectedJob,detectorIndex,$scope.entities,searchBounds.min.valueOf(),searchBounds.max.valueOf()).then(function(resp){$scope.chartDetails=resp.results;finish(counter)}).catch(function(resp){console.log("Time series explorer - error getting entity counts from elasticsearch:",resp)});var forecastId=_lodash2.default.get($scope,"appState.mlTimeSeriesExplorer.forecastId");if(void 0!==forecastId){awaitingCount++;var aggType=void 0;var detector=$scope.selectedJob.analysis_config.detectors[detectorIndex];var esAgg=(0,_job_utils.mlFunctionToESAggregation)(detector.function);false!==$scope.modelPlotEnabled||"sum"!==esAgg&&"count"!==esAgg||(aggType={avg:"sum",max:"sum",min:"sum"});_forecast_service.mlForecastService.getForecastData($scope.selectedJob,detectorIndex,forecastId,nonBlankEntities,searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.contextAggregationInterval.expression,aggType).then(function(resp){$scope.contextForecastData=(0,_timeseriesexplorer_utils.processForecastResults)(resp.results);finish(counter)}).catch(function(resp){console.log("Time series explorer - error loading data for forecast ID "+forecastId,resp)})}loadEntityValues()};$scope.refreshFocusData=function(fromDate,toDate){var awaitingCount=3;var refreshFocusData={};function finish(){awaitingCount--;if(0===awaitingCount){refreshFocusData.focusChartData=(0,_timeseriesexplorer_utils.processDataForFocusAnomalies)(refreshFocusData.focusChartData,refreshFocusData.anomalyRecords,$scope.timeFieldName);refreshFocusData.focusChartData=(0,_timeseriesexplorer_utils.processScheduledEventsForChart)(refreshFocusData.focusChartData,refreshFocusData.scheduledEvents);$scope.$evalAsync(function(){$scope=Object.assign($scope,refreshFocusData);console.log("Time series explorer focus chart data set:",$scope.focusChartData);$scope.loading=false})}}var detectorIndex=+$scope.detectorId;var nonBlankEntities=_lodash2.default.filter($scope.entities,function(entity){return entity.fieldValue.length>0});var bounds={min:(0,_moment2.default)(fromDate),max:(0,_moment2.default)(toDate)};$scope.focusAggregationInterval=calculateAggregationInterval(bounds,CHARTS_POINT_TARGET,CHARTS_POINT_TARGET);var searchBounds=(0,_ml_time_buckets.getBoundsRoundedToInterval)(bounds,$scope.focusAggregationInterval,false);_timeseries_search_service.mlTimeSeriesSearchService.getMetricData($scope.selectedJob,detectorIndex,nonBlankEntities,searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.focusAggregationInterval.expression).then(function(resp){refreshFocusData.focusChartData=(0,_timeseriesexplorer_utils.processMetricPlotResults)(resp.results,$scope.modelPlotEnabled);$scope.showModelBoundsCheckbox=true===$scope.modelPlotEnabled&&refreshFocusData.focusChartData.length>0;finish()}).catch(function(resp){console.log("Time series explorer - error getting metric data from elasticsearch:",resp)});_results_service.mlResultsService.getRecordsForCriteria([$scope.selectedJob.job_id],$scope.criteriaFields,0,searchBounds.min.valueOf(),searchBounds.max.valueOf(),ANOMALIES_MAX_RESULTS).then(function(resp){refreshFocusData.anomalyRecords=_lodash2.default.chain(resp.records).sortBy(function(record){return record[$scope.timeFieldName]}).reverse().value();console.log("Time series explorer anomalies:",refreshFocusData.anomalyRecords);finish()});_results_service.mlResultsService.getScheduledEventsByBucket([$scope.selectedJob.job_id],searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.focusAggregationInterval.expression,1,MAX_SCHEDULED_EVENTS).then(function(resp){refreshFocusData.scheduledEvents=resp.events[$scope.selectedJob.job_id];finish()}).catch(function(resp){console.log("Time series explorer - error getting scheduled events from elasticsearch:",resp)});var forecastId=_lodash2.default.get($scope,"appState.mlTimeSeriesExplorer.forecastId");if(void 0!==forecastId){awaitingCount++;var aggType=void 0;var detector=$scope.selectedJob.analysis_config.detectors[detectorIndex];var esAgg=(0,_job_utils.mlFunctionToESAggregation)(detector.function);false!==$scope.modelPlotEnabled||"sum"!==esAgg&&"count"!==esAgg||(aggType={avg:"sum",max:"sum",min:"sum"});_forecast_service.mlForecastService.getForecastData($scope.selectedJob,detectorIndex,forecastId,nonBlankEntities,searchBounds.min.valueOf(),searchBounds.max.valueOf(),$scope.focusAggregationInterval.expression,aggType).then(function(resp){refreshFocusData.focusForecastData=(0,_timeseriesexplorer_utils.processForecastResults)(resp.results);refreshFocusData.showForecastCheckbox=refreshFocusData.focusForecastData.length>0;finish()}).catch(function(resp){console.log("Time series explorer - error loading data for forecast ID "+forecastId,resp)})}loadAnomaliesTableData(searchBounds.min.valueOf(),searchBounds.max.valueOf())};$scope.saveSeriesPropertiesAndRefresh=function(){$scope.appState.mlTimeSeriesExplorer.detectorIndex=+$scope.detectorId;$scope.appState.mlTimeSeriesExplorer.entities={};_lodash2.default.each($scope.entities,function(entity){$scope.appState.mlTimeSeriesExplorer.entities[entity.fieldName]=entity.fieldValue});$scope.appState.save();$scope.refresh()};$scope.filter=function(field,value,operator){var entity=_lodash2.default.find($scope.entities,{fieldName:field});if(void 0!==entity)if("+"===operator&&entity.fieldValue!==value){entity.fieldValue=value;$scope.saveSeriesPropertiesAndRefresh()}else if("-"===operator&&entity.fieldValue===value){entity.fieldValue="";$scope.saveSeriesPropertiesAndRefresh()}};$scope.loadForForecastId=function(forecastId){_forecast_service.mlForecastService.getForecastDateRange($scope.selectedJob,forecastId).then(function(resp){var bounds=_timefilter.timefilter.getActiveBounds();var earliest=(0,_moment2.default)(resp.earliest||_timefilter.timefilter.getTime().from);var latest=(0,_moment2.default)(resp.latest||_timefilter.timefilter.getTime().to);$scope.appState.mlTimeSeriesExplorer.forecastId=forecastId;var earliestDataDate=_lodash2.default.first($scope.contextChartData).date;var zoomLatestMs=resp.latest;var zoomEarliestMs=Math.max(earliestDataDate.getTime(),zoomLatestMs-$scope.autoZoomDuration);var zoomState={from:(0,_moment2.default)(zoomEarliestMs).toISOString(),to:(0,_moment2.default)(zoomLatestMs).toISOString()};$scope.appState.mlTimeSeriesExplorer.zoom=zoomState;$scope.appState.save();$scope.showForecast=true;if(earliest.isBefore(bounds.min)||latest.isAfter(bounds.max)){var earliestMs=Math.min(earliest.valueOf(),bounds.min.valueOf());var latestMs=Math.max(latest.valueOf(),bounds.max.valueOf());_timefilter.timefilter.setTime({from:(0,_moment2.default)(earliestMs).toISOString(),to:(0,_moment2.default)(latestMs).toISOString()})}else $scope.refresh()}).catch(function(resp){console.log("Time series explorer - error loading time range of forecast from elasticsearch:",resp)})};$scope.detectorIndexChanged=function(){updateControlsForDetector();loadEntityValues()};$scope.toggleShowModelBounds=function(){$timeout(function(){$scope.showModelBounds=!$scope.showModelBounds},0)};$scope.toggleShowForecast=function(){$timeout(function(){$scope.showForecast=!$scope.showForecast},0)};$scope.$listenAndDigestAsync(_timefilter.timefilter,"fetch",$scope.refresh);var refreshWatcher=Private(_refresh_interval_watcher.refreshIntervalWatcher);refreshWatcher.init(function(){$scope.refresh()});var tableControlsListener=function tableControlsListener(){void 0!==$scope.zoomFrom&&void 0!==$scope.zoomTo&&loadAnomaliesTableData($scope.zoomFrom.getTime(),$scope.zoomTo.getTime())};mlSelectIntervalService.state.watch(tableControlsListener);mlSelectSeverityService.state.watch(tableControlsListener);$scope.$on("$destroy",function(){refreshWatcher.cancel();mlSelectIntervalService.state.unwatch(tableControlsListener);mlSelectSeverityService.state.unwatch(tableControlsListener)});mlJobSelectService.listenJobSelectionChange($scope,function(event,selections){if(selections.length>0){delete $scope.appState.mlTimeSeriesExplorer.detectorIndex;delete $scope.appState.mlTimeSeriesExplorer.entities;delete $scope.appState.mlTimeSeriesExplorer.forecastId;$scope.appState.save();$scope.showForecastCheckbox=false;loadForJobId(selections[0])}});$scope.$on("contextChartSelected",function(event,selection){if((void 0===$scope.contextChartData||0===$scope.contextChartData.length)&&(void 0===$scope.contextForecastData||0===$scope.contextForecastData.length))return;var defaultRange=calculateDefaultFocusRange();if(selection.from.getTime()===defaultRange[0].getTime()&&selection.to.getTime()===defaultRange[1].getTime()||false!==isNaN(Date.parse(selection.from))||false!==isNaN(Date.parse(selection.to)))delete $scope.appState.mlTimeSeriesExplorer.zoom;else{var zoomState={from:selection.from.toISOString(),to:selection.to.toISOString()};$scope.appState.mlTimeSeriesExplorer.zoom=zoomState}$scope.appState.save();void 0!==$scope.focusChartData&&$scope.zoomFrom.getTime()===selection.from.getTime()&&$scope.zoomTo.getTime()===selection.to.getTime()||$scope.refreshFocusData(selection.from,selection.to);$scope.zoomFrom=selection.from;$scope.zoomTo=selection.to});function loadForJobId(jobId){var jobPickerSelectedJob=_lodash2.default.find($scope.jobs,{id:jobId});if(void 0===jobPickerSelectedJob){var newJobs=[];_lodash2.default.each(_job_service.mlJobService.jobs,function(job){if(true===(0,_job_utils.isTimeSeriesViewJob)(job)){var bucketSpan=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span);newJobs.push({id:job.job_id,selected:false,bucketSpanSeconds:bucketSpan.asSeconds()})}});$scope.jobs=newJobs;jobPickerSelectedJob=_lodash2.default.find(newJobs,{id:jobId})}$scope.selectedJob=_job_service.mlJobService.getJob(jobId);$scope.jobPickerSelections=[jobPickerSelectedJob];var jobDetectors=$scope.selectedJob.analysis_config.detectors;var viewableDetectors=[];_lodash2.default.each(jobDetectors,function(dtr,index){(0,_job_utils.isTimeSeriesViewDetector)($scope.selectedJob,index)&&viewableDetectors.push({index:""+index,detector_description:dtr.detector_description})});$scope.detectors=viewableDetectors;var appStateDtrIdx=$scope.appState.mlTimeSeriesExplorer.detectorIndex;var detectorIndex=void 0!==appStateDtrIdx?appStateDtrIdx:+viewableDetectors[0].index;if(void 0===_lodash2.default.find(viewableDetectors,{index:""+detectorIndex})){var warningText="Requested detector index "+detectorIndex+" is not valid for job "+$scope.selectedJob.job_id;_notify.toastNotifications.addWarning(warningText);detectorIndex=+viewableDetectors[0].index;$scope.appState.mlTimeSeriesExplorer.detectorIndex=detectorIndex;$scope.appState.save()}$scope.detectorId=""+detectorIndex;updateControlsForDetector();_field_format_service.mlFieldFormatService.populateFormats([jobId],(0,_index_utils.getIndexPatterns)()).finally(function(){$scope.refresh()})}function loadAnomaliesTableData(earliestMs,latestMs){_ml_api_service.ml.results.getAnomaliesTableData([$scope.selectedJob.job_id],$scope.criteriaFields,[],mlSelectIntervalService.state.get("interval").val,mlSelectSeverityService.state.get("threshold").val,earliestMs,latestMs,ANOMALIES_MAX_RESULTS).then(function(resp){var anomalies=resp.anomalies;var detectorsByJob=_job_service.mlJobService.detectorsByJob;anomalies.forEach(function(anomaly){var jobId=anomaly.jobId;var detector=_lodash2.default.get(detectorsByJob,[jobId,anomaly.detectorIndex]);anomaly.detector=_lodash2.default.get(detector,["detector_description"],anomaly.source.function_description);var customRules=detector.custom_rules;void 0!==customRules&&(anomaly.rulesLength=customRules.length);_lodash2.default.has(_job_service.mlJobService.customUrlsByJob,jobId)&&(anomaly.customUrls=_job_service.mlJobService.customUrlsByJob[jobId])});$scope.$evalAsync(function(){$scope.tableData={anomalies:anomalies,interval:resp.interval,examplesByJobId:resp.examplesByJobId,showViewSeriesLink:false}})}).catch(function(resp){console.log("Time series explorer - error loading data for anomalies table:",resp)})}function updateControlsForDetector(){var detectorIndex=+$scope.detectorId;var detector=$scope.selectedJob.analysis_config.detectors[detectorIndex];var entities=[];var entitiesState=$scope.appState.mlTimeSeriesExplorer.entities||{};var partitionFieldName=_lodash2.default.get(detector,"partition_field_name");var overFieldName=_lodash2.default.get(detector,"over_field_name");var byFieldName=_lodash2.default.get(detector,"by_field_name");if(void 0!==partitionFieldName){var partitionFieldValue=_lodash2.default.get(entitiesState,partitionFieldName,"");entities.push({fieldName:partitionFieldName,fieldValue:partitionFieldValue})}if(void 0!==overFieldName){var overFieldValue=_lodash2.default.get(entitiesState,overFieldName,"");entities.push({fieldName:overFieldName,fieldValue:overFieldValue})}if(void 0!==byFieldName&&void 0===overFieldName){var byFieldValue=_lodash2.default.get(entitiesState,byFieldName,"");entities.push({fieldName:byFieldName,fieldValue:byFieldValue})}$scope.entities=entities}function loadEntityValues(){var bounds=_timefilter.timefilter.getActiveBounds();var detectorIndex=+$scope.detectorId;_results_service.mlResultsService.getRecordsForCriteria([$scope.selectedJob.job_id],[{fieldName:"detector_index",fieldValue:detectorIndex}],0,bounds.min.valueOf(),bounds.max.valueOf(),ANOMALIES_MAX_RESULTS).then(function(resp){if(resp.records&&resp.records.length>0){var firstRec=resp.records[0];_lodash2.default.each($scope.entities,function(entity){firstRec.partition_field_name===entity.fieldName&&(entity.fieldValues=_lodash2.default.chain(resp.records).pluck("partition_field_value").uniq().value());firstRec.over_field_name===entity.fieldName&&(entity.fieldValues=_lodash2.default.chain(resp.records).pluck("over_field_value").uniq().value());firstRec.by_field_name===entity.fieldName&&(entity.fieldValues=_lodash2.default.chain(resp.records).pluck("by_field_value").uniq().value())})}})}function calculateInitialFocusRange(){var zoomState=$scope.appState.mlTimeSeriesExplorer.zoom;if(void 0!==zoomState){$scope.autoZoomDuration=getAutoZoomDuration();var zoomFrom=(0,_moment2.default)(zoomState.from,"YYYY-MM-DDTHH:mm:ss.SSSZ",true);var zoomTo=(0,_moment2.default)(zoomState.to,"YYYY-MM-DDTHH:mm:ss.SSSZ",true);var aggIntervalMs=$scope.contextAggregationInterval.asMilliseconds();var bounds=_timefilter.timefilter.getActiveBounds();var earliest=bounds.min;var latest=(0,_moment2.default)(bounds.max).add(aggIntervalMs,"ms");if(zoomFrom.isValid()&&zoomTo.isValid&&zoomTo.isAfter(zoomFrom)&&zoomFrom.isBetween(earliest,latest,null,"[]")&&zoomTo.isBetween(earliest,latest,null,"[]"))return[zoomFrom.toDate(),zoomTo.toDate()]}return calculateDefaultFocusRange()}function calculateDefaultFocusRange(){$scope.autoZoomDuration=getAutoZoomDuration();var combinedData=void 0===$scope.contextForecastData?$scope.contextChartData:$scope.contextChartData.concat($scope.contextForecastData);var earliestDataDate=_lodash2.default.first(combinedData).date;var latestDataDate=_lodash2.default.last(combinedData).date;var latestMsToLoad=latestDataDate.getTime()+$scope.contextAggregationInterval.asMilliseconds();var earliestMsToLoad=Math.max(earliestDataDate.getTime(),latestMsToLoad-$scope.autoZoomDuration);return[new Date(earliestMsToLoad),new Date(latestMsToLoad)]}function calculateAggregationInterval(bounds,bucketsTarget){var barTarget=void 0!==bucketsTarget?bucketsTarget:100;var maxBars=Math.floor(1.1*barTarget);var buckets=new TimeBuckets;buckets.setInterval("auto");buckets.setBounds(bounds);buckets.setBarTarget(Math.floor(barTarget));buckets.setMaxBars(maxBars);var bucketSpanSeconds=_lodash2.default.find($scope.jobs,{id:$scope.selectedJob.job_id}).bucketSpanSeconds;var aggInterval=buckets.getIntervalToNearestMultiple(bucketSpanSeconds);var secs=aggInterval.asSeconds();if(secs<bucketSpanSeconds){buckets.setInterval(bucketSpanSeconds+"s");aggInterval=buckets.getInterval()}console.log("calculateAggregationInterval() barTarget,maxBars,returning:",bucketsTarget,maxBars,bounds.max.diff(bounds.min)/aggInterval.asMilliseconds());return aggInterval}function getAutoZoomDuration(){var bucketSpanSeconds=_lodash2.default.find($scope.jobs,{id:$scope.selectedJob.job_id}).bucketSpanSeconds;var autoZoomDuration=1e3*bucketSpanSeconds*(CHARTS_POINT_TARGET-1);var maxBars=Math.floor(1.1*CHARTS_POINT_TARGET);var buckets=new TimeBuckets;buckets.setInterval("auto");buckets.setBarTarget(Math.floor(CHARTS_POINT_TARGET));buckets.setMaxBars(maxBars);var nowMs=(new Date).getTime();var max=(0,_moment2.default)(nowMs);var min=(0,_moment2.default)(nowMs-autoZoomDuration);buckets.setBounds({min:min,max:max});var calculatedInterval=buckets.getIntervalToNearestMultiple(bucketSpanSeconds);var calculatedIntervalSecs=calculatedInterval.asSeconds();calculatedIntervalSecs!==bucketSpanSeconds&&(autoZoomDuration*=bucketSpanSeconds/calculatedIntervalSecs);return autoZoomDuration}$scope.initializeVis()})},3927:function(module,exports){module.exports='<ml-nav-menu name="timeseriesexplorer"></ml-nav-menu>\n<ml-chart-tooltip></ml-chart-tooltip>\n<div class="ml-time-series-explorer" ng-controller="MlTimeSeriesExplorerController">\n  <navbar ng-show="jobs.length > 0 && chrome.getVisible()">\n    <job-select-button\n      timeseriesonly="true"\n      single-selection="true">\n    </job-select-button>\n  </navbar>\n\n  <div class="no-results-container" ng-if="jobs.length === 0 && loading === false">\n    <div class="no-results">\n      <div><i class="fa fa-exclamation-triangle"></i>No single metric jobs found</div>\n      <div><a href="ml#/jobs">Create new single metric job</a></div>\n    </div>\n  </div>\n\n  <div class="series-controls" ng-show="jobs.length > 0">\n    <label for="selectDetector" class="kuiLabel">Detector:</label>\n    <select id="selectDetector" class="kuiSelect kuiSelect--large" ng-model="detectorId" ng-change="detectorIndexChanged()">\n      <option ng-repeat="detector in detectors track by detector.index" value="{{detector.index}}">{{detector.detector_description}}</option>\n    </select>\n\n    <div class="entity-controls" ng-repeat="entity in entities">\n      <datalist id="{{entity.fieldName}}_datalist">\n        <option ng-repeat="value in entity.fieldValues">{{value}}</option>\n      </datalist>\n\n      <label for="select{{entity.fieldName}}" class="kuiLabel">{{entity.fieldName}}:</label>\n      <input id="select{{entity.fieldName}}" class="kuiTextInput entity-input"\n        ng-class="{ \'entity-input-blank\': entity.fieldValue.length === 0 }"\n        ng-model="entity.fieldValue" ng-model-options="{ updateOn: \'blur\' }" placeholder="Enter value"\n        list=\'{{entity.fieldName}}_datalist\' />\n    </div>\n\n    <button class="kuiButton kuiButton--primary" ng-click="saveSeriesPropertiesAndRefresh()" aria-label="refresh">\n      <i class="fa fa-play" ></i>\n    </button>\n\n    <ml-forecasting-modal\n      job="selectedJob"\n      detectorIndex="+detectorId"\n      entities="entities"\n      loadForForecastId="loadForForecastId"\n      class="forecast-controls"\n    />\n\n  </div>\n\n  <ml-loading-indicator\n    label="Loading"\n    is-loading="loading === true"\n  />\n\n  <div class="no-results-container" ng-show="jobs.length > 0 && loading === false && hasResults === false">\n    <div class="no-results">\n      <div><i class="fa fa-info-circle" ></i>No results found</div>\n      <div>Try widening the time selection or moving further back in time</div>\n    </div>\n  </div>\n\n  <div ng-show="jobs.length > 0 && loading === false && hasResults === true">\n    <div class="results-container">\n\n      <span class="panel-title euiText">\n        Single time series analysis of {{chartDetails.functionLabel}}\n      </span>\n      <span ng-if="chartDetails.entityData.count === 1" class="entity-count-text">\n        <span ng-repeat="entity in chartDetails.entityData.entities">\n          {{$first ? \'(\' : \'\'}}{{entity.fieldName}}: {{entity.fieldValue}}{{$last ? \')\' : \', \'}}\n        </span>\n      </span>\n      <span ng-if="chartDetails.entityData.count !== 1" class="entity-count-text">\n        <span ng-repeat="countData in chartDetails.entityData.entities">\n          {{$first ? \'(\' : \'\'}}{{countData.cardinality}} distinct {{countData.fieldName}}{{countData.cardinality > 1 ? \' values\' : \'\'}}{{$last ? \')\' : \', \'}}\n        </span>\n      </span>\n\n      <div class="show-model-controls">\n        <div ng-show="showModelBoundsCheckbox === true">\n          <input id="toggleShowModelBoundsCheckbox"\n            type="checkbox"\n            class="kuiCheckBox"\n            ng-click="toggleShowModelBounds()"\n            ng-checked="showModelBounds === true">\n          <label for="toggleShowModelBoundsCheckbox" class="kuiCheckBoxLabel">show model bounds</label>\n        </div>\n\n        <div ng-show="showForecastCheckbox === true">\n          <input id="toggleShowForecastCheckbox"\n            type="checkbox"\n            class="kuiCheckBox"\n            ng-click="toggleShowForecast()"\n            ng-checked="showForecast === true">\n          <label for="toggleShowForecastCheckbox" class="kuiCheckBoxLabel">show forecast</label>\n        </div>\n      </div>\n\n      <div class="ml-timeseries-chart">\n\n        <ml-timeseries-chart  style="width: 1200px; height: 400px;"\n          selected-job="selectedJob"\n          detector-index="detectorId"\n          model-plot-enabled="modelPlotEnabled"\n          context-chart-data="contextChartData"\n          context-forecast-data="contextForecastData"\n          context-aggregation-interval="contextAggregationInterval"\n          swimlane-data="swimlaneData"\n          focus-chart-data="focusChartData"\n          focus-forecast-data="focusForecastData"\n          focus-aggregation-interval="focusAggregationInterval"\n          show-model-bounds="showModelBounds"\n          show-forecast="showForecast"\n          zoom-from="zoomFrom"\n          zoom-to="zoomTo"\n          auto-zoom-duration="autoZoomDuration">\n        </ml-timeseries-chart>\n      </div>\n\n      <span class="panel-title euiText">\n        Anomalies\n      </span>\n\n      <div class="euiFlexGroup euiFlexGroup--gutterLarge euiFlexGroup--directionRow euiFlexGroup--responsive ml-anomalies-controls">\n        <div class="euiFlexItem euiFlexItem--flexGrowZero" style="width:170px">\n          <div class="euiFormRow" id="select_severity_control">\n            <label class="euiFormLabel" for="select_severity">Severity threshold</label>\n            <div class="euiFormControlLayout">\n              <ml-select-severity id="select_severity" />\n            </div>\n          </div>\n        </div>\n        <div class="euiFlexItem euiFlexItem--flexGrowZero" style="width:170px">\n          <div class="euiFormRow" id="select_interval_control">\n            <label class="euiFormLabel" for="select_interval">Interval</label>\n            <div class="euiFormControlLayout">\n              <ml-select-interval id="select_interval" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <ml-anomalies-table\n        table-data="tableData"\n        filter="filter"\n      />\n\n    </div>\n  </div>\n\n</div>\n'},3928:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _d=__webpack_require__(19);var _d2=_interopRequireDefault(_d);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _timefilter=__webpack_require__(14);var _resize_checker=__webpack_require__(879);var _anomaly_utils=__webpack_require__(299);var _format_value=__webpack_require__(637);var _chart_utils=__webpack_require__(256);var _time_buckets=__webpack_require__(273);var _anomalies_table_service=__webpack_require__(876);var _context_chart_mask=__webpack_require__(3931);var _context_chart_mask2=_interopRequireDefault(_context_chart_mask);var _timeseriesexplorer_utils=__webpack_require__(1452);var _string_utils=__webpack_require__(40);var _field_format_service=__webpack_require__(255);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlTimeseriesChart",function($compile,$timeout,Private,mlChartTooltipService){function link(scope,element){var svgWidth=_angular2.default.element(".results-container").width();var focusZoomPanelHeight=25;var focusChartHeight=310;var focusHeight=focusZoomPanelHeight+focusChartHeight;var contextChartHeight=60;var contextChartLineTopMargin=3;var chartSpacing=25;var swimlaneHeight=30;var margin={top:20,right:10,bottom:15,left:40};var svgHeight=focusHeight+contextChartHeight+swimlaneHeight+chartSpacing+margin.top+margin.bottom;var vizWidth=svgWidth-margin.left-margin.right;var FOCUS_CHART_ANOMALY_RADIUS=7;var SCHEDULED_EVENT_MARKER_HEIGHT=5;var ZOOM_INTERVAL_OPTIONS=[{duration:_moment2.default.duration(1,"h"),label:"1h"},{duration:_moment2.default.duration(12,"h"),label:"12h"},{duration:_moment2.default.duration(1,"d"),label:"1d"},{duration:_moment2.default.duration(1,"w"),label:"1w"},{duration:_moment2.default.duration(2,"w"),label:"2w"},{duration:_moment2.default.duration(1,"M"),label:"1M"}];var anomalyColorScale=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#d2e9f7","#8bc8fb","#ffdd00","#ff7e00","#fe5050"]);var anomalyGrayScale=_d2.default.scale.threshold().domain([3,25,50,75,100]).range(["#dce7ed","#b0c5d6","#b1a34e","#b17f4e","#c88686"]);var focusXScale=_d2.default.time.scale().range([0,vizWidth]);var focusYScale=_d2.default.scale.linear().range([focusHeight,focusZoomPanelHeight]);var focusXAxis=_d2.default.svg.axis().scale(focusXScale).orient("bottom").innerTickSize(-focusChartHeight).outerTickSize(0).tickPadding(10);var focusYAxis=_d2.default.svg.axis().scale(focusYScale).orient("left").innerTickSize(-vizWidth).outerTickSize(0).tickPadding(10);var focusValuesLine=_d2.default.svg.line().x(function(d){return focusXScale(d.date)}).y(function(d){return focusYScale(d.value)}).defined(function(d){return null!==d.value});var focusBoundedArea=_d2.default.svg.area().x(function(d){return focusXScale(d.date)||1}).y0(function(d){return focusYScale(d.upper)}).y1(function(d){return focusYScale(d.lower)}).defined(function(d){return null!==d.lower&&null!==d.upper});var contextXScale=_d2.default.time.scale().range([0,vizWidth]);var contextYScale=_d2.default.scale.linear().range([contextChartHeight,contextChartLineTopMargin]);var fieldFormat=void 0;var brush=_d2.default.svg.brush();var mask=void 0;scope.$on("render",function(){fieldFormat=_field_format_service.mlFieldFormatService.getFieldFormat(scope.selectedJob.job_id,scope.detectorIndex);render();drawContextChartSelection()});scope.$watchCollection("focusForecastData",renderFocusChart);scope.$watchCollection("focusChartData",renderFocusChart);scope.$watchGroup(["showModelBounds","showForecast"],renderFocusChart);var resizeChecker=new _resize_checker.ResizeChecker(_angular2.default.element(".ml-timeseries-chart"));resizeChecker.on("resize",function(){scope.$evalAsync(function(){render();drawContextChartSelection();renderFocusChart()})});var tableRecordMousenterListener=function tableRecordMousenterListener(record){highlightFocusChartAnomaly(record)};var tableRecordMouseleaveListener=function tableRecordMouseleaveListener(record){unhighlightFocusChartAnomaly(record)};_anomalies_table_service.mlAnomaliesTableService.anomalyRecordMouseenter.watch(tableRecordMousenterListener);_anomalies_table_service.mlAnomaliesTableService.anomalyRecordMouseleave.watch(tableRecordMouseleaveListener);element.on("$destroy",function(){_anomalies_table_service.mlAnomaliesTableService.anomalyRecordMouseenter.unwatch(tableRecordMousenterListener);_anomalies_table_service.mlAnomaliesTableService.anomalyRecordMouseleave.unwatch(tableRecordMouseleaveListener);resizeChecker.destroy();scope.$destroy()});function render(){var chartElement=_d2.default.select(element.get(0));chartElement.selectAll("*").remove();if(void 0===scope.contextChartData)return;svgWidth=Math.max(_angular2.default.element(".results-container").width(),0);var svg=chartElement.append("svg").attr("width",svgWidth).attr("height",svgHeight);var contextDataMin=void 0;var contextDataMax=void 0;if(true===scope.modelPlotEnabled||void 0!==scope.contextForecastData&&scope.contextForecastData.length>0){var combinedData=void 0===scope.contextForecastData?scope.contextChartData:scope.contextChartData.concat(scope.contextForecastData);contextDataMin=_d2.default.min(combinedData,function(d){return Math.min(d.value,d.lower)});contextDataMax=_d2.default.max(combinedData,function(d){return Math.max(d.value,d.upper)})}else{contextDataMin=_d2.default.min(scope.contextChartData,function(d){return d.value});contextDataMax=_d2.default.max(scope.contextChartData,function(d){return d.value})}var ceiledMax=contextDataMax>0?Math.pow(10,Math.ceil(Math.log10(Math.abs(contextDataMax)))):contextDataMax;var flooredMin=contextDataMin>=0?contextDataMin:-1*Math.pow(10,Math.ceil(Math.log10(Math.abs(contextDataMin))));focusYScale.domain([flooredMin,ceiledMax]);var maxYAxisLabelWidth=0;var tempLabelText=svg.append("g").attr("class","temp-axis-label tick");tempLabelText.selectAll("text.temp.axis").data(focusYScale.ticks()).enter().append("text").text(function(d){return void 0!==fieldFormat?fieldFormat.convert(d,"text"):focusYScale.tickFormat()(d)}).each(function(){maxYAxisLabelWidth=Math.max(this.getBBox().width+focusYAxis.tickPadding(),maxYAxisLabelWidth)}).remove();_d2.default.select(".temp-axis-label").remove();margin.left=Math.max(maxYAxisLabelWidth,40);vizWidth=Math.max(svgWidth-margin.left-margin.right,0);focusXScale.range([0,vizWidth]);focusYAxis.innerTickSize(-vizWidth);var focus=svg.append("g").attr("class","focus-chart").attr("transform","translate("+margin.left+","+margin.top+")");var context=svg.append("g").attr("class","context-chart").attr("transform","translate("+margin.left+","+(focusHeight+margin.top+chartSpacing)+")");createFocusChart(focus,vizWidth,focusHeight);drawContextElements(context,vizWidth,contextChartHeight,swimlaneHeight)}function drawContextChartSelection(){if(void 0===scope.contextChartData)return;var focusLoadFrom=void 0;var focusLoadTo=void 0;var contextXMin=contextXScale.domain()[0].getTime();var contextXMax=contextXScale.domain()[1].getTime();var combinedData=scope.contextChartData;void 0!==scope.contextForecastData&&(combinedData=combinedData.concat(scope.contextForecastData));focusLoadFrom=scope.zoomFrom?scope.zoomFrom.getTime():_lodash2.default.reduce(combinedData,function(memo,point){return Math.min(memo,point.date.getTime())},new Date(2099,12,31).getTime());focusLoadFrom=Math.max(focusLoadFrom,contextXMin);focusLoadTo=scope.zoomTo?scope.zoomTo.getTime():_lodash2.default.reduce(combinedData,function(memo,point){return Math.max(memo,point.date.getTime())},0);focusLoadTo=Math.min(focusLoadTo,contextXMax);if(focusLoadFrom!==contextXMin||focusLoadTo!==contextXMax)setContextBrushExtent(new Date(focusLoadFrom),new Date(focusLoadTo),true);else{setBrushVisibility(false);var selectedBounds=contextXScale.domain();scope.selectedBounds={min:(0,_moment2.default)(new Date(selectedBounds[0])),max:(0,_moment2.default)(selectedBounds[1])};scope.$root.$broadcast("contextChartSelected",{from:selectedBounds[0],to:selectedBounds[1]})}}function createFocusChart(fcsGroup,fcsWidth,fcsHeight){var zoomGroup=fcsGroup.append("g").attr("class","focus-zoom");zoomGroup.append("rect").attr("x",0).attr("y",0).attr("width",fcsWidth).attr("height",focusZoomPanelHeight).attr("class","chart-border");createZoomInfoElements(zoomGroup,fcsWidth);fcsGroup.append("rect").attr("x",0).attr("y",focusZoomPanelHeight).attr("width",fcsWidth).attr("height",focusChartHeight).attr("class","chart-border");var xAxisBg=fcsGroup.append("g").attr("class","x-axis-background");xAxisBg.append("rect").attr("x",0).attr("y",fcsHeight).attr("width",fcsWidth).attr("height",chartSpacing);xAxisBg.append("line").attr("x1",0).attr("y1",fcsHeight).attr("x2",0).attr("y2",fcsHeight+chartSpacing);xAxisBg.append("line").attr("x1",fcsWidth).attr("y1",fcsHeight).attr("x2",fcsWidth).attr("y2",fcsHeight+chartSpacing);xAxisBg.append("line").attr("x1",0).attr("y1",fcsHeight+chartSpacing).attr("x2",fcsWidth).attr("y2",fcsHeight+chartSpacing);var axes=fcsGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0,"+fcsHeight+")");axes.append("g").attr("class","y axis");fcsGroup.append("path").attr("class","area bounds");fcsGroup.append("path").attr("class","values-line");fcsGroup.append("g").attr("class","focus-chart-markers");if(scope.contextForecastData){fcsGroup.append("path").attr("class","area forecast");fcsGroup.append("path").attr("class","values-line forecast");fcsGroup.append("g").attr("class","focus-chart-markers forecast")}fcsGroup.append("rect").attr("x",0).attr("y",0).attr("width",fcsWidth).attr("height",fcsHeight+24).attr("class","chart-border chart-border-highlight")}function renderFocusChart(){if(void 0===scope.focusChartData)return;var data=scope.focusChartData;var focusChart=_d2.default.select(".focus-chart");var focusAggInt=scope.focusAggregationInterval.expression;var bucketSpan=scope.selectedJob.analysis_config.bucket_span;_angular2.default.element(".zoom-aggregation-interval").text("(aggregation interval: "+focusAggInt+", bucket span: "+bucketSpan+")");var bounds=scope.selectedBounds;var aggMs=scope.focusAggregationInterval.asMilliseconds();var earliest=(0,_moment2.default)(Math.floor(bounds.min.valueOf()/aggMs)*aggMs);var latest=(0,_moment2.default)(Math.ceil(bounds.max.valueOf()/aggMs)*aggMs);focusXScale.domain([earliest.toDate(),latest.toDate()]);if(scope.focusChartData.length>0||void 0!==scope.focusForecastData&&scope.focusForecastData.length>0){void 0!==fieldFormat?focusYAxis.tickFormat(function(d){return fieldFormat.convert(d,"text")}):focusYAxis.tickFormat(null);var yMin=0;var yMax=0;var combinedData=data;void 0!==scope.focusForecastData&&scope.focusForecastData.length>0&&(combinedData=data.concat(scope.focusForecastData));yMin=_d2.default.min(combinedData,function(d){return void 0!==d.lower?Math.min(d.value,d.lower):d.value});yMax=_d2.default.max(combinedData,function(d){return void 0!==d.upper?Math.max(d.value,d.upper):d.value});if(yMax===yMin)if(contextYScale.domain()[0]!==contextYScale.domain()[1]&&yMin>=contextYScale.domain()[0]&&yMax<=contextYScale.domain()[1]){yMin=contextYScale.domain()[0];yMax=contextYScale.domain()[1]}else{yMin-=.05*yMin;yMax+=.05*yMax}focusYScale.domain([yMin,yMax])}else{focusYScale.domain([0,10]);focusYAxis.tickFormat("")}var timeBuckets=new _time_buckets.TimeBuckets;timeBuckets.setInterval("auto");timeBuckets.setBounds(bounds);var xAxisTickFormat=timeBuckets.getScaledDateFormat();focusChart.select(".x.axis").call(focusXAxis.ticks((0,_chart_utils.numTicksForDateFormat)(vizWidth),xAxisTickFormat).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)}));focusChart.select(".y.axis").call(focusYAxis);(0,_chart_utils.filterAxisLabels)(focusChart.select(".x.axis"),vizWidth);true===scope.modelPlotEnabled&&focusChart.select(".area.bounds").attr("d",focusBoundedArea(data)).classed("hidden",!scope.showModelBounds);focusChart.select(".values-line").attr("d",focusValuesLine(data));(0,_chart_utils.drawLineChartDots)(data,focusChart,focusValuesLine);var dots=_d2.default.select(".focus-chart-markers").selectAll(".metric-value").data(data.filter(function(d){return null!==d.value}));dots.exit().remove();dots.enter().append("circle").attr("r",FOCUS_CHART_ANOMALY_RADIUS).on("mouseover",function(d){showFocusChartTooltip(d,this)}).on("mouseout",function(){return mlChartTooltipService.hide()});dots.attr("cx",function(d){return focusXScale(d.date)}).attr("cy",function(d){return focusYScale(d.value)}).attr("class",function(d){var markerClass="metric-value";if(_lodash2.default.has(d,"anomalyScore")){markerClass+=" anomaly-marker ";markerClass+=(0,_anomaly_utils.getSeverityWithLow)(d.anomalyScore)}return markerClass});var scheduledEventMarkers=_d2.default.select(".focus-chart-markers").selectAll(".scheduled-event-marker").data(data.filter(function(d){return void 0!==d.scheduledEvents}));scheduledEventMarkers.exit().remove();scheduledEventMarkers.enter().append("rect").attr("width",2*FOCUS_CHART_ANOMALY_RADIUS).attr("height",SCHEDULED_EVENT_MARKER_HEIGHT).attr("class","scheduled-event-marker").attr("rx",1).attr("ry",1);scheduledEventMarkers.attr("x",function(d){return focusXScale(d.date)-FOCUS_CHART_ANOMALY_RADIUS}).attr("y",function(d){return focusYScale(d.value)-3});if(void 0!==scope.focusForecastData){focusChart.select(".area.forecast").attr("d",focusBoundedArea(scope.focusForecastData)).classed("hidden",!scope.showForecast);focusChart.select(".values-line.forecast").attr("d",focusValuesLine(scope.focusForecastData)).classed("hidden",!scope.showForecast);var forecastDots=_d2.default.select(".focus-chart-markers.forecast").selectAll(".metric-value").data(scope.focusForecastData);forecastDots.exit().remove();forecastDots.enter().append("circle").attr("r",FOCUS_CHART_ANOMALY_RADIUS).on("mouseover",function(d){showFocusChartTooltip(d,this)}).on("mouseout",function(){return mlChartTooltipService.hide()});forecastDots.attr("cx",function(d){return focusXScale(d.date)}).attr("cy",function(d){return focusYScale(d.value)}).attr("class","metric-value").classed("hidden",!scope.showForecast)}}function createZoomInfoElements(zoomGroup,fcsWidth){var bounds=_timefilter.timefilter.getActiveBounds();var boundsSecs=bounds.max.unix()-bounds.min.unix();var minSecs=10/vizWidth*boundsSecs;var xPos=10;var zoomLabel=zoomGroup.append("text").attr("x",xPos).attr("y",17).attr("class","zoom-info-text").text("Zoom:");var zoomOptions=[{durationMs:scope.autoZoomDuration,label:"auto"}];_lodash2.default.each(ZOOM_INTERVAL_OPTIONS,function(option){option.duration.asSeconds()>minSecs&&option.duration.asSeconds()<boundsSecs&&zoomOptions.push({durationMs:option.duration.asMilliseconds(),label:option.label})});xPos+=zoomLabel.node().getBBox().width+4;_lodash2.default.each(zoomOptions,function(option){var text=zoomGroup.append("a").attr("data-ms",option.durationMs).attr("href","").append("text").attr("x",xPos).attr("y",17).attr("class","zoom-info-text").text(option.label);xPos+=text.node().getBBox().width+4});zoomGroup.append("text").attr("x",xPos+6).attr("y",17).attr("class","zoom-info-text zoom-aggregation-interval").text("(aggregation interval: , bucket span: )");if(false===scope.modelPlotEnabled){var modelPlotLabel=zoomGroup.append("text").attr("x",300).attr("y",17).attr("class","zoom-info-text").text("Model bounds are not available");modelPlotLabel.attr("x",fcsWidth-(modelPlotLabel.node().getBBox().width+10))}(0,_jquery2.default)(".focus-zoom a").click(function(e){e.preventDefault();setZoomInterval((0,_jquery2.default)(this).attr("data-ms"))})}function drawContextElements(cxtGroup,cxtWidth,cxtChartHeight,swlHeight){var data=scope.contextChartData;contextXScale=_d2.default.time.scale().range([0,cxtWidth]).domain(calculateContextXAxisDomain());var combinedData=void 0===scope.contextForecastData?data:data.concat(scope.contextForecastData);var valuesRange={min:Number.MAX_VALUE,max:Number.MIN_VALUE};_lodash2.default.each(combinedData,function(item){valuesRange.min=Math.min(item.value,valuesRange.min);valuesRange.max=Math.max(item.value,valuesRange.max)});var dataMin=valuesRange.min;var dataMax=valuesRange.max;var chartLimits={min:dataMin,max:dataMax};if(true===scope.modelPlotEnabled||void 0!==scope.contextForecastData&&scope.contextForecastData.length>0){var boundsRange={min:Number.MAX_VALUE,max:Number.MIN_VALUE};_lodash2.default.each(combinedData,function(item){boundsRange.min=Math.min(item.lower,boundsRange.min);boundsRange.max=Math.max(item.upper,boundsRange.max)});dataMin=Math.min(dataMin,boundsRange.min);dataMax=Math.max(dataMax,boundsRange.max);if(valuesRange.max-valuesRange.min<.5*(dataMax-dataMin)){valuesRange.min>dataMin&&(chartLimits.min=valuesRange.min-.5*(valuesRange.max-valuesRange.min));valuesRange.max<dataMax&&(chartLimits.max=valuesRange.max+.5*(valuesRange.max-valuesRange.min))}}contextYScale=_d2.default.scale.linear().range([cxtChartHeight,contextChartLineTopMargin]).domain([chartLimits.min,chartLimits.max]);var borders=cxtGroup.append("g").attr("class","axis");borders.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",cxtChartHeight+swlHeight);borders.append("line").attr("x1",cxtWidth).attr("y1",0).attr("x2",cxtWidth).attr("y2",cxtChartHeight+swlHeight);var bounds=_timefilter.timefilter.getActiveBounds();var timeBuckets=new _time_buckets.TimeBuckets;timeBuckets.setInterval("auto");timeBuckets.setBounds(bounds);var xAxisTickFormat=timeBuckets.getScaledDateFormat();var xAxis=_d2.default.svg.axis().scale(contextXScale).orient("top").innerTickSize(-cxtChartHeight).outerTickSize(0).tickPadding(0).ticks((0,_chart_utils.numTicksForDateFormat)(cxtWidth,xAxisTickFormat)).tickFormat(function(d){return(0,_moment2.default)(d).format(xAxisTickFormat)});cxtGroup.datum(data);var contextBoundsArea=_d2.default.svg.area().x(function(d){return contextXScale(d.date)}).y0(function(d){return contextYScale(Math.min(chartLimits.max,Math.max(d.lower,chartLimits.min)))}).y1(function(d){return contextYScale(Math.max(chartLimits.min,Math.min(d.upper,chartLimits.max)))}).defined(function(d){return null!==d.lower&&null!==d.upper});true===scope.modelPlotEnabled&&cxtGroup.append("path").datum(data).attr("class","area context").attr("d",contextBoundsArea);var contextValuesLine=_d2.default.svg.line().x(function(d){return contextXScale(d.date)}).y(function(d){return contextYScale(d.value)}).defined(function(d){return null!==d.value});cxtGroup.append("path").datum(data).attr("class","values-line").attr("d",contextValuesLine);(0,_chart_utils.drawLineChartDots)(data,cxtGroup,contextValuesLine,1);if(void 0!==scope.contextForecastData){cxtGroup.append("path").datum(scope.contextForecastData).attr("class","area forecast").attr("d",contextBoundsArea);cxtGroup.append("path").datum(scope.contextForecastData).attr("class","values-line forecast").attr("d",contextValuesLine)}var swimlane=cxtGroup.append("g").attr("class","swimlane").attr("transform","translate(0,"+cxtChartHeight+")");drawSwimlane(swimlane,cxtWidth,swlHeight);mask=new _context_chart_mask2.default(cxtGroup,scope.contextChartData,scope.modelPlotEnabled,swlHeight).x(contextXScale).y(contextYScale);cxtGroup.append("g").attr("class","x axis context-chart-axis").call(xAxis);cxtGroup.selectAll(".x.context-chart-axis text").attr("dy",cxtChartHeight-5);(0,_chart_utils.filterAxisLabels)(cxtGroup.selectAll(".x.context-chart-axis"),cxtWidth);drawContextBrush(cxtGroup)}function drawContextBrush(contextGroup){brush.x(contextXScale).on("brush",brushing).on("brushend",brushed);contextGroup.append("g").attr("class","x brush").call(brush).selectAll("rect").attr("y",-1).attr("height",contextChartHeight+swimlaneHeight+1);contextGroup.selectAll(".w rect").attr("x",-10).attr("width",10);contextGroup.selectAll(".e rect").attr("x",0).attr("width",10);var topBorder=contextGroup.append("rect").attr("class","top-border").attr("y",-2).attr("height",contextChartLineTopMargin);var leftHandle=contextGroup.append("foreignObject").attr("width",10).attr("height",90).attr("class","brush-handle").html('<div class="brush-handle-inner brush-handle-inner-left"><i class="fa fa-caret-left"></i></div>');var rightHandle=contextGroup.append("foreignObject").attr("width",10).attr("height",90).attr("class","brush-handle").html('<div class="brush-handle-inner brush-handle-inner-right"><i class="fa fa-caret-right"></i></div>');setBrushVisibility(!brush.empty());function showBrush(show){if(true===show){var brushExtent=brush.extent();mask.reveal(brushExtent);leftHandle.attr("x",contextXScale(brushExtent[0])-10);rightHandle.attr("x",contextXScale(brushExtent[1])+0);topBorder.attr("x",contextXScale(brushExtent[0])+1);topBorder.attr("width",contextXScale(brushExtent[1])-contextXScale(brushExtent[0])-2)}setBrushVisibility(show)}function brushing(){var isEmpty=brush.empty();showBrush(!isEmpty)}function brushed(){var isEmpty=brush.empty();showBrush(!isEmpty);var selectedBounds=isEmpty?contextXScale.domain():brush.extent();var selectionMin=selectedBounds[0].getTime();var selectionMax=selectedBounds[1].getTime();contextGroup.selectAll(".swimlane-cell").style("fill",function(d){var cellMs=d.date.getTime();return cellMs<selectionMin||cellMs>selectionMax?anomalyGrayScale(d.score):anomalyColorScale(d.score)});scope.selectedBounds={min:(0,_moment2.default)(selectionMin),max:(0,_moment2.default)(selectionMax)};scope.$root.$broadcast("contextChartSelected",{from:selectedBounds[0],to:selectedBounds[1]})}}function setBrushVisibility(show){if(void 0!==mask){var visibility=show?"visible":"hidden";mask.style("visibility",visibility);_d2.default.selectAll(".brush").style("visibility",visibility);var brushHandles=_d2.default.selectAll(".brush-handle-inner");brushHandles.style("visibility",visibility);var topBorder=_d2.default.selectAll(".top-border");topBorder.style("visibility",visibility);var border=_d2.default.selectAll(".chart-border-highlight");border.style("visibility",visibility)}}function drawSwimlane(swlGroup,swlWidth,swlHeight){var data=scope.swimlaneData;var xAxisDomain=calculateContextXAxisDomain();var x=_d2.default.time.scale().range([0,swlWidth]).domain(xAxisDomain);var y=_d2.default.scale.linear().range([swlHeight,0]).domain([0,swlHeight]);var xAxis=_d2.default.svg.axis().scale(x).orient("bottom").innerTickSize(-swlHeight).outerTickSize(0);var yAxis=_d2.default.svg.axis().scale(y).orient("left").tickValues(y.domain()).innerTickSize(-swlWidth).outerTickSize(0);var axes=swlGroup.append("g");axes.append("g").attr("class","x axis").attr("transform","translate(0,"+swlHeight+")").call(xAxis);axes.append("g").attr("class","y axis").call(yAxis);var earliest=xAxisDomain[0].getTime();var latest=xAxisDomain[1].getTime();var swimlaneAggMs=scope.contextAggregationInterval.asMilliseconds();var cellWidth=swlWidth/((latest-earliest)/swimlaneAggMs);cellWidth<1&&(cellWidth=1);var cells=swlGroup.append("g").attr("class","swimlane-cells").selectAll("cells").data(data);cells.enter().append("rect").attr("x",function(d){return x(d.date)}).attr("y",0).attr("rx",0).attr("ry",0).attr("class",function(d){return d.score>0?"swimlane-cell":"swimlane-cell-hidden"}).attr("width",cellWidth).attr("height",swlHeight).style("fill",function(d){return anomalyColorScale(d.score)})}function calculateContextXAxisDomain(){var bounds=_timefilter.timefilter.getActiveBounds();var earliest=bounds.min.valueOf();void 0!==scope.swimlaneData&&scope.swimlaneData.length>0&&(earliest=Math.min(_lodash2.default.first(scope.swimlaneData).date.getTime(),bounds.min.valueOf()));var contextAggMs=scope.contextAggregationInterval.asMilliseconds();var earliestMs=Math.floor(earliest/contextAggMs)*contextAggMs;var latestMs=Math.ceil(bounds.max.valueOf()/contextAggMs)*contextAggMs;return[new Date(earliestMs),new Date(latestMs)]}function setContextBrushExtent(from,to,fireEvent){brush.extent([from,to]);brush(_d2.default.select(".brush"));fireEvent&&brush.event(_d2.default.select(".brush"))}function setZoomInterval(ms){var bounds=_timefilter.timefilter.getActiveBounds();var minBoundsMs=bounds.min.valueOf();var maxBoundsMs=bounds.max.valueOf();var millis=+ms;var to=scope.zoomTo.getTime();var from=to-millis;if(from<minBoundsMs){from=minBoundsMs;to=Math.min(minBoundsMs+millis,maxBoundsMs)}setContextBrushExtent(new Date(from),new Date(to),true)}function showFocusChartTooltip(marker,circle){var formattedDate=(0,_moment2.default)(marker.date).format("MMMM Do YYYY, HH:mm");var contents=formattedDate+"<br/><hr/>";if(_lodash2.default.has(marker,"anomalyScore")){var score=parseInt(marker.anomalyScore);var displayScore=score>0?score:"< 1";contents+="anomaly score: "+displayScore+"<br/>";if(false===scope.modelPlotEnabled)if(_lodash2.default.has(marker,"actual")){contents+="actual: "+(0,_format_value.formatValue)(marker.actual,marker.function,fieldFormat);contents+="<br/>typical: "+(0,_format_value.formatValue)(marker.typical,marker.function,fieldFormat)}else{contents+="value: "+(0,_format_value.formatValue)(marker.value,marker.function,fieldFormat);if(_lodash2.default.has(marker,"byFieldName")&&_lodash2.default.has(marker,"numberOfCauses")){var numberOfCauses=marker.numberOfCauses;var byFieldName=(0,_string_utils.mlEscape)(marker.byFieldName);contents+=numberOfCauses<10?"<br/> "+numberOfCauses+" unusual "+byFieldName+" values":"<br/> "+numberOfCauses+"+ unusual "+byFieldName+" values"}}else{contents+="value: "+(0,_format_value.formatValue)(marker.value,marker.function,fieldFormat);contents+="<br/>upper bounds: "+(0,_format_value.formatValue)(marker.upper,marker.function,fieldFormat);contents+="<br/>lower bounds: "+(0,_format_value.formatValue)(marker.lower,marker.function,fieldFormat)}}else{true===_lodash2.default.get(marker,"isForecast",false)?contents+="prediction: "+(0,_format_value.formatValue)(marker.value,marker.function,fieldFormat):contents+="value: "+(0,_format_value.formatValue)(marker.value,marker.function,fieldFormat);if(true===scope.modelPlotEnabled){contents+="<br/>upper bounds: "+(0,_format_value.formatValue)(marker.upper,marker.function,fieldFormat);contents+="<br/>lower bounds: "+(0,_format_value.formatValue)(marker.lower,marker.function,fieldFormat)}}_lodash2.default.has(marker,"scheduledEvents")&&(contents+="<br/><hr/>Scheduled events:<br/>"+marker.scheduledEvents.map(_string_utils.mlEscape).join("<br/>"));mlChartTooltipService.show(contents,circle,{x:2*FOCUS_CHART_ANOMALY_RADIUS,y:0})}function highlightFocusChartAnomaly(record){var anomalyTime=record.source.timestamp;var markerToSelect=(0,_timeseriesexplorer_utils.findNearestChartPointToTime)(scope.focusChartData,anomalyTime);if(void 0!==markerToSelect){var selectedMarker=_d2.default.select(".focus-chart-markers").selectAll(".focus-chart-highlighted-marker").data([markerToSelect]);selectedMarker.enter().append("circle").attr("r",FOCUS_CHART_ANOMALY_RADIUS);selectedMarker.attr("cx",function(d){return focusXScale(d.date)}).attr("cy",function(d){return focusYScale(d.value)}).attr("class",function(d){var markerClass="metric-value anomaly-marker highlighted ";markerClass+=(0,_anomaly_utils.getSeverityWithLow)(d.anomalyScore);return markerClass});var circle=(0,_jquery2.default)(".focus-chart-markers .anomaly-marker.highlighted");circle.length&&showFocusChartTooltip(markerToSelect,circle[0])}}function unhighlightFocusChartAnomaly(){_d2.default.select(".focus-chart-markers").selectAll(".anomaly-marker.highlighted").remove();mlChartTooltipService.hide()}}return{scope:{selectedJob:"=",detectorIndex:"=",modelPlotEnabled:"=",contextChartData:"=",contextForecastData:"=",contextChartAnomalyData:"=",focusChartData:"=",swimlaneData:"=",focusForecastData:"=",contextAggregationInterval:"=",focusAggregationInterval:"=",zoomFrom:"=",zoomTo:"=",autoZoomDuration:"=",showModelBounds:"=",showForecast:"="},link:link}})},3931:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default=ContextChartMask;var _d=__webpack_require__(19);var _d2=_interopRequireDefault(_d);var _chart_utils=__webpack_require__(256);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ContextChartMask(contextGroup,data,drawBounds,swimlaneHeight){this.contextGroup=contextGroup;this.data=data;this.drawBounds=drawBounds;this.swimlaneHeight=swimlaneHeight;this.mask=this.contextGroup.append("g").attr("class","mask");this.leftGroup=this.mask.append("g").attr("class","left-mask");this.rightGroup=this.mask.append("g").attr("class","right-mask");this.leftPolygon=this.leftGroup.append("polygon");this.rightPolygon=this.rightGroup.append("polygon");if(true===this.drawBounds){this.leftGroup.append("path").attr("class","left area bounds");this.rightGroup.append("path").attr("class","right area bounds")}this.leftGroup.append("path").attr("class","left values-line");this.rightGroup.append("path").attr("class","right values-line");this._x=null;this._y=null}ContextChartMask.prototype.style=function(prop,val){this.leftGroup.style(prop,val);this.rightGroup.style(prop,val);return this};ContextChartMask.prototype.x=function(f){if(null==f)return this._x;this._x=f;return this};ContextChartMask.prototype.y=function(f){if(null==f)return this._y;this._y=f;return this};ContextChartMask.prototype.redraw=function(){var yDomain=this._y.domain();var minY=yDomain[0];var maxY=yDomain[1];var xDomain=this._x.domain();var minX=xDomain[0];var maxX=xDomain[1];var that=this;var leftData=this.data.filter(function(d){return d.date<that.from});var rightData=this.data.filter(function(d){return d.date>that.to});if(true===this.drawBounds){var boundedArea=_d2.default.svg.area().x(function(d){return that._x(d.date)||1}).y0(function(d){return that._y(Math.min(maxY,Math.max(d.lower,minY)))}).y1(function(d){return that._y(Math.max(minY,Math.min(d.upper,maxY)))}).defined(function(d){return null!==d.lower&&null!==d.upper});this.leftGroup.select(".left.area.bounds").attr("d",boundedArea(leftData));this.rightGroup.select(".right.area.bounds").attr("d",boundedArea(rightData))}var valuesLine=_d2.default.svg.line().x(function(d){return that._x(d.date)}).y(function(d){return that._y(d.value)}).defined(function(d){return null!==d.value});this.leftGroup.select(".left.values-line").attr("d",valuesLine(leftData));(0,_chart_utils.drawLineChartDots)(leftData,this.leftGroup,valuesLine,1);this.rightGroup.select(".right.values-line").attr("d",valuesLine(rightData));(0,_chart_utils.drawLineChartDots)(rightData,this.rightGroup,valuesLine,1);var leftPoly={l:this._x(minX),t:this._y(minY)+this.swimlaneHeight,r:this._x(this.from),b:0};var rightPoly={l:this._x(this.to),t:this._y(minY)+this.swimlaneHeight,r:this._x(maxX),b:0};this.leftPolygon.attr("points",leftPoly.l+","+leftPoly.t+"  "+leftPoly.r+","+leftPoly.t+"  "+leftPoly.r+","+leftPoly.b+"  "+leftPoly.l+","+leftPoly.b);this.rightPolygon.attr("points",rightPoly.l+","+rightPoly.t+"  "+rightPoly.r+","+rightPoly.t+"  "+rightPoly.r+","+rightPoly.b+"  "+rightPoly.l+","+rightPoly.b);return this};ContextChartMask.prototype.reveal=function(extent){this.from=extent[0];this.to=extent[1];this.redraw();return this};module.exports=exports["default"]},3932:function(module,exports){},3933:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3934);__webpack_require__(1454)},3934:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);var _modules=__webpack_require__(2);var _form_label=__webpack_require__(3935);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlFormLabel",function(){return{scope:{labelId:"@"},restrict:"E",replace:false,transclude:true,link:function link(scope,element,attrs,ctrl,transclude){var props={labelId:scope.labelId,labelClassName:"kuiFormLabel",ref:function ref(c){return _angular2.default.element(c.labelRef.current).append(transclude())}};_reactDom2.default.render(_react2.default.createElement(_form_label.FormLabel,props),element[0])}}})},3935:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FormLabel=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();__webpack_require__(1454);var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _json_tooltip=__webpack_require__(1455);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var FormLabel=exports.FormLabel=function(_Component){_inherits(FormLabel,_Component);function FormLabel(props){_classCallCheck(this,FormLabel);var _this=_possibleConstructorReturn(this,(FormLabel.__proto__||Object.getPrototypeOf(FormLabel)).call(this,props));_this.labelRef=_react2.default.createRef();return _this}_createClass(FormLabel,[{key:"render",value:function render(){var _props=this.props,labelId=_props.labelId,_props$labelClassName=_props.labelClassName,labelClassName=void 0===_props$labelClassName?"euiFormLabel":_props$labelClassName,children=_props.children;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement("label",{className:labelClassName,id:"ml_aria_label_"+labelId,ref:this.labelRef},children),_react2.default.createElement(_json_tooltip.JsonTooltip,{id:labelId,position:"top"}))}}]);return FormLabel}(_react.Component);FormLabel.propTypes={labelId:_propTypes2.default.string}},3936:function(module,exports){module.exports={new_job_id:{text:"Unique identifier for job, can use lowercase alphanumeric and underscores."},new_job_description:{text:"Optional descriptive text."},new_job_group:{text:"Optional grouping for jobs. New groups can be created or picked from the list of existing groups."},new_job_custom_urls:{text:"Optional drill-through links to source data. Supports string substitution for analyzed fields e.g. $hostname$."},new_job_bucketspan:{text:"Interval for time series analysis."},new_job_sparsedata:{text:"Check if you wish to ignore empty buckets from being considered anomalous."},new_job_summarycountfieldname:{text:"Optional, for use if input data has been pre-summarized e.g. doc_count."},new_job_categorizationfieldname:{text:"Optional, for use if analyzing unstructured log data. Using text data types is recommended."},new_job_categorizationfilters:{text:"Optional, apply regular expressions to the categorization field"},new_job_detectors:{text:"Defines the fields and functions used for analysis."},new_job_influencers:{text:'Select which categorical fields have influence on the results. Who/what might you "blame" for an anomaly? Recommend 1-3 influencers.'},new_job_detector_description:{text:"User-friendly text used for dashboards."},new_job_detector_function:{text:"Analysis functions to be performed e.g. sum, count."},new_job_detector_fieldname:{text:"Required for functions: sum, mean, median, max, min, info_content, distinct_count."},new_job_detector_fieldname_subset:{text:"Required for functions: sum, mean, max, min, distinct_count."},new_job_detector_byfieldname:{text:"Required for individual analysis where anomalies are detected compared to an entity's own past behavior."},new_job_detector_overfieldname:{text:"Required for population analysis where anomalies are detected compared to the behavior of the population."},new_job_detector_partitionfieldname:{text:"Allows segmentation of modeling into logical groups."},new_job_detector_excludefrequent:{text:"If true will automatically identify and exclude frequently occurring entities which may otherwise have dominated results."},new_job_data_format:{text:"Describes the format of the input data: delimited, JSON, single line or Elasticsearch."},new_job_time_field:{text:"Name of the field containing the timestamp."},new_job_time_format:{text:"Format of the time field: epoch, epoch_ms or Java DateTimeFormatter string. Important to get right."},new_job_delimiter:{text:"Character used to separate fields."},new_job_quote_character:{text:"Character used to encapsulate values containing reserved characters."},new_job_enable_datafeed_job:{text:"Required for jobs that analyze data from Elasticsearch.\nRequires data format to be set to Elasticsearch/"},new_job_data_source:{text:"Elasticsearch versions 1.7.x and 2+ supported."},new_job_datafeed_query:{text:"Elasticsearch Query DSL for filtering input data."},new_job_datafeed_query_delay:{text:"Advanced option. Time delay in seconds, between current time and latest input data time."},new_job_datafeed_frequency:{text:"Advanced option. The interval between searches."},new_job_datafeed_scrollsize:{text:"Advanced option. The maximum number of documents requested for a search."},new_job_data_preview:{text:"This preview returns the contents of the source field only."},new_job_elasticsearch_server:{text:"Server address and port of Elasticsearch source."},new_job_enable_authenticated:{text:"Select to specify username and password for secure access."},new_job_datafeed_retrieve_source:{text:"Advanced option. Select to retrieve unfiltered _source document, instead of specified fields."},new_job_advanced_settings:{text:"Advanced options"},new_job_dedicated_index:{text:"Select to store results in a separate index for this job."},new_job_model_memory_limit:{text:"An approximate limit for the amount of memory used by the analytical models."},new_filter_ruleaction:{text:"A string specifying the rule action. Initially, the only valid option is 'filter_results' but it provisions for expansion to actions like 'disable_modeling'."},new_filter_targetfieldname:{text:"A string expecting a field name. The filter will apply on all results for the targetFieldName value the ruleConditions apply. When empty, filtering applies only to results for which the ruleConditions apply."},new_action_targetfieldvalue:{text:"A string expecting a value for targetFieldName. If any of the ruleConditions apply, all results will be excluded for that particular targetValue but not for others. Can only be specified if targetFieldName is not empty."},new_action_conditionsconnective:{text:"The logical connective of the ruleConditions."},new_action_ruleconditions:{text:"The list of conditions used to apply the rules."},new_action_conditiontype:{text:"A string specifying the condition type."},new_action_fieldname:{text:"A string specifying the field name on which the rule applies. When empty, rule applies to all results."},new_action_fieldvalue:{text:"A string specifying the numerical field value on which the rule applies. When empty, rule applies to all values of fieldName. Can only be specified if fieldName is not empty."},new_action_condition:{text:"The condition comparing fieldValue and value."},new_action_value:{text:"The numerical value to compare against fieldValue."},new_action_valuelist:{text:"A string that is a unique identifier to a list. Only applicable and required when conditionType is categorical."},forecasting_modal_run_duration:{text:"Length of forecast, up to a maximum of 8 weeks. Use s for seconds, m for minutes, h for hours, d for days, w for weeks."},forecasting_modal_view_list:{text:"Lists a maximum of five of the most recently run forecasts."},new_job_recognizer_job_prefix:{text:"A prefix which will be added to the beginning of each job ID."},new_custom_url_label:{text:"A label for the drill-through link."},new_custom_url_link_to:{text:"Link to a Kibana dashboard, Discover or another URL."},new_custom_url_dashboard:{text:"The dashboard to link to."},new_custom_url_discover_index:{text:"The index pattern to view in Discover."},new_custom_url_query_entity:{text:"Optional, entities from the anomaly that will be used in the dashboard query."},new_custom_url_value:{text:"URL of the drill-through link. Supports string substitution for analyzed fields e.g. $hostname$."},new_custom_url_time_range:{text:"The time span that will be displayed in the drill-down page. Set automatically, or enter a specific interval e.g. 10m or 1h."}}},3937:function(module,exports){},3938:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3939)},3939:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _modules=__webpack_require__(2);var _json_tooltip=__webpack_require__(1455);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlInfoIcon",function(){return{scope:{id:"@mlInfoIcon",position:"@"},restrict:"AE",replace:false,link:function link(scope,element){var props={id:scope.id,position:scope.position};_reactDom2.default.render(_react2.default.createElement(_json_tooltip.JsonTooltip,props),element[0])}}})},3940:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3941)},3941:function(module,exports,__webpack_require__){"use strict";var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _modules=__webpack_require__(2);var _tooltip_view=__webpack_require__(3942);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml",["react"]);_module.directive("mlTooltip",function($compile){var link=function link(scope,element){var content=element.html();element.html("");var props={position:scope.position,text:scope.text,transclude:function transclude(el){var transcludeScope=scope.$new();var compiled=$compile(content)(transcludeScope);el.append(compiled[0])}};_reactDom2.default.render(_react2.default.createElement(_tooltip_view.Tooltip,props),element[0])};return{restrict:"A",replace:true,scope:false,transclude:false,link:link}})},3942:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.Tooltip=Tooltip;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function Tooltip(_ref){var _ref$position=_ref.position,position=void 0===_ref$position?"top":_ref$position,text=_ref.text,transclude=_ref.transclude;return _react2.default.createElement(_eui.EuiToolTip,{position:position,content:text},_react2.default.createElement("span",{ref:transclude}))}Tooltip.propTypes={position:_propTypes2.default.string,text:_propTypes2.default.string,transclude:_propTypes2.default.func}},3943:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3944);__webpack_require__(3946);__webpack_require__(3947)},3944:function(module,exports,__webpack_require__){"use strict";var _confirm_modal=__webpack_require__(3945);var _confirm_modal2=_interopRequireDefault(_confirm_modal);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.service("mlConfirmModalService",function($modal){this.open=function(options){return new Promise(function(resolve,reject){$modal.open({template:_confirm_modal2.default,controller:"MlConfirmModal",backdrop:"static",keyboard:false,size:void 0===options.size?"sm":options.size,resolve:{params:function params(){return{message:options.message,title:options.title,okLabel:options.okLabel,cancelLabel:options.cancelLabel,hideCancel:options.hideCancel,ok:resolve,cancel:reject}}}})})}})},3945:function(module,exports){module.exports='<div class="confirm-modal">\n  <div class="modal-title" ng-show="(title !== undefined && title !== \'\' )">{{title}}</div>\n  <div class="modal-body" bind-html-unsafe="message"></div>\n  <div class="modal-footer">\n    <button\n      ng-click="ok()"\n      ng-disabled="(saveLock === true)"\n      class="kuiButton kuiButton--primary"\n      aria-label="OK">\n      {{okLabel}}\n    </button>\n    <button\n      ng-hide="hideCancel"\n      ng-click="cancel()"\n      ng-disabled="(saveLock === true)"\n      class="kuiButton kuiButton--primary"\n      aria-label="Cancel">\n      {{cancelLabel}}\n    </button>\n  </div>\n</div>\n'},3946:function(module,exports,__webpack_require__){"use strict";var _modules=__webpack_require__(2);var _module=_modules.uiModules.get("apps/ml");_module.controller("MlConfirmModal",function($scope,$modalInstance,params){$scope.okFunc=params.ok;$scope.cancelFunc=params.cancel;$scope.message=params.message||"";$scope.title=params.title||"";$scope.okLabel=params.okLabel||"OK";$scope.cancelLabel=params.cancelLabel||"Cancel";$scope.hideCancel=params.hideCancel||false;$scope.ok=function(){$scope.okFunc();$modalInstance.close()};$scope.cancel=function(){$scope.cancelFunc();$modalInstance.close()}})},3947:function(module,exports){},3948:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3949)},3949:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _nav_menu=__webpack_require__(3950);var _nav_menu2=_interopRequireDefault(_nav_menu);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlNavMenu",function(){return{restrict:"E",transclude:true,template:_nav_menu2.default,link:function link(scope,el,attrs){scope.name=attrs.name;scope.showTabs=false;"jobs"!==scope.name&&"settings"!==scope.name&&"timeseriesexplorer"!==scope.name&&"explorer"!==scope.name||(scope.showTabs=true);scope.isActiveTab=function(path){return scope.name===path};var crumbNames={jobs:{label:"Job Management",url:"#/jobs"},new_job:{label:"Create New Job",url:"#/jobs/new_job"},single_metric:{label:"Single Metric Job",url:""},multi_metric:{label:"Multi Metric job",url:""},population:{label:"Population job",url:""},advanced:{label:"Advanced Job Configuration",url:""},datavisualizer:{label:"Data Visualizer",url:""},explorer:{label:"Anomaly Explorer",url:"#/explorer"},timeseriesexplorer:{label:"Single Metric Viewer",url:"#/timeseriesexplorer"},settings:{label:"Settings",url:"#/settings"},calendars_list:{label:"Calendar Management",url:"#/settings/calendars_list"},new_calendar:{label:"New Calendar",url:"#/settings/calendars_list/new_calendar"},edit_calendar:{label:"Edit Calendar",url:"#/settings/calendars_list/edit_calendar"},filter_lists:{label:"Filter Lists",url:"#/settings/filter_lists"},new_filter_list:{label:"New Filter List",url:"#/settings/filter_lists/new"},edit_filter_list:{label:"Edit Filter List",url:"#/settings/filter_lists/edit"}};var breadcrumbs=[{label:"Machine Learning",url:"#/"}];var crumbs=_routes2.default.getBreadcrumbs();_lodash2.default.each(crumbs,function(crumb){breadcrumbs.push(crumbNames[crumb.id])});scope.breadcrumbs=breadcrumbs.filter(Boolean);el.ready(function(){var $crumbs=(0,_jquery2.default)(".kuiLocalBreadcrumbs a");$crumbs.length&&$crumbs[0].focus()})}}})},3950:function(module,exports){module.exports='<kbn-top-nav name="dashboard" config="topNavMenu">\n<div data-transclude-slots>\n    \x3c!-- Breadcrumbs. --\x3e\n    <div data-transclude-slot="topLeftCorner" class="kuiLocalBreadcrumbs">\n      <div ng-repeat="crumb in breadcrumbs" class="kuiLocalBreadcrumb">\n        <a ng-if="crumb.url" kbn-href="{{ crumb.url }}" class="kuiLocalBreadcrumb__link">{{ crumb.label }}</a>\n        <span ng-if="!crumb.url" class="kuiLocalBreadcrumb__link">{{ crumb.label }}</span>\n      </div>\n    </div>\n    \x3c!-- Tabs --\x3e\n    <div data-transclude-slot="bottomRow">\n      <div ng-if="showTabs" class="kuiLocalTabs" role="tablist">\n        <a kbn-href="#/jobs" class="kuiLocalTab" role="tab"\n        ng-class="{\'kuiLocalTab-isSelected\': isActiveTab(\'jobs\')}">\n        Job Management</a>\n        <a kbn-href="#/explorer" class="kuiLocalTab" role="tab"\n        ng-class="{\'kuiLocalTab-isSelected\': isActiveTab(\'explorer\')}">\n        Anomaly Explorer</a>\n        <a kbn-href="#/timeseriesexplorer" class="kuiLocalTab" role="tab"\n        ng-class="{\'kuiLocalTab-isSelected\': isActiveTab(\'timeseriesexplorer\')}">\n        Single Metric Viewer</a>\n        <a kbn-href="#/settings" class="kuiLocalTab" role="tab"\n        ng-class="{\'kuiLocalTab-isSelected\': isActiveTab(\'settings\')}">\n        Settings</a>\n      </div>\n    </div>\n  </div>\n</kbn-top-nav>\n'},3951:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3952)},3952:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3953);var _loading_indicator=__webpack_require__(3954);var _loading_indicator2=_interopRequireDefault(_loading_indicator);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlLoadingIndicator",function(){return{restrict:"E",template:_loading_indicator2.default,transclude:true,scope:{label:"@?",isLoading:"<",height:"<?"},link:function link(scope){scope.height=scope.height?+scope.height:100}}})},3953:function(module,exports){},3954:function(module,exports){module.exports='<div ng-if="isLoading" class="loading-indicator" style="height: {{height}}px">\n  <div class="loading-spinner"><i class=\'fa fa-spinner fa-spin\'></i></div>\n  <div ng-if="label!==undefined" ml-loading-indicator-label>{{label}}</div>\n</div>\n'},3955:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3956);__webpack_require__(3957);__webpack_require__(3959);__webpack_require__(3994)},3956:function(module,exports){},3957:function(module,exports,__webpack_require__){"use strict";var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(68);var _check_privilege=__webpack_require__(35);var _check_ml_nodes=__webpack_require__(69);var _promise=__webpack_require__(89);var _settings=__webpack_require__(3958);var _settings2=_interopRequireDefault(_settings);var _timefilter=__webpack_require__(14);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/settings",{template:_settings2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,mlNodeCount:_check_ml_nodes.getMlNodeCount,initPromise:(0,_promise.initPromise)(true)}});var _module=_modules.uiModules.get("apps/ml");_module.controller("MlSettings",function($scope){_timefilter.timefilter.disableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();$scope.canCreateFilter=(0,_check_privilege.checkPermission)("canCreateFilter")})},3958:function(module,exports){module.exports='<ml-nav-menu name="settings"></ml-nav-menu>\n<ml-settings ng-controller="MlSettings">\n\n  <div class="page-row">\n\n    <div class="kuiPanel management-panel">\n      <div class="kuiPanelHeader">\n        <div class="kuiPanelHeaderSection">\n          <div class="management-panel__heading-icon management-panel__heading-icon--elasticsearch"></div>\n          <div class="kuiPanelHeader__title ng-binding">\n            Job Management\n          </div>\n        </div>\n      </div>\n\n      <div class="kuiPanelBody management-panel__body">\n        <div class="row">\n          <ul class="list-unstyled">\n            <li class="col-xs-4 col-md-3 ng-scope">\n              <a\n                data-test-subj=""\n                class="management-panel__link ng-binding"\n                tooltip=""\n                tooltip-placement="bottom"\n                tooltip-popup-delay="400"\n                tooltip-append-to-body="1"\n                href="ml#/settings/calendars_list">\n                 Calendar management\n              </a>\n            </li>\n            <li class="col-xs-4 col-md-3 ng-scope">\n              <a\n                ng-if="(canCreateFilter === true)"\n                data-test-subj=""\n                class="management-panel__link ng-binding"\n                tooltip=""\n                tooltip-placement="bottom"\n                tooltip-popup-delay="400"\n                tooltip-append-to-body="1"\n                href="ml#/settings/filter_lists">\n                 Filter Lists\n              </a>\n              <span\n                ng-if="(canCreateFilter === false)"\n                class="management-panel__link disabled  ng-binding"\n                tooltip="You do not have permission to manage filter lists"\n                tooltip-placement="bottom"\n                tooltip-popup-delay="400"\n                tooltip-append-to-body="1"\n              >\n                Filter Lists\n              </span>\n            </li>\n          </ul>\n        </div>\n      </div>\n\n    </div>\n  </div>\n</ml-settings>\n'},3959:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3960);__webpack_require__(3972)},3960:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3961);__webpack_require__(3962)},3961:function(module,exports){},3962:function(module,exports,__webpack_require__){"use strict";var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);__webpack_require__(504);__webpack_require__(371);__webpack_require__(880);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(68);var _check_privilege=__webpack_require__(35);var _check_ml_nodes=__webpack_require__(69);var _buttons_enabled_checks=__webpack_require__(3970);var _ml_api_service=__webpack_require__(23);var _promise=__webpack_require__(89);var _calendars_list=__webpack_require__(3971);var _calendars_list2=_interopRequireDefault(_calendars_list);var _timefilter=__webpack_require__(14);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}_routes2.default.when("/settings/calendars_list",{template:_calendars_list2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,mlNodeCount:_check_ml_nodes.getMlNodeCount,initPromise:(0,_promise.initPromise)(true)}});var _module=_modules.uiModules.get("apps/ml",["ui.bootstrap"]);_module.controller("MlCalendarsList",function($scope,$filter,$route,$location,pagerFactory,mlConfirmModalService){$scope.permissions={canCreateCalendar:(0,_check_privilege.checkPermission)("canCreateCalendar"),canDeleteCalendar:(0,_check_privilege.checkPermission)("canDeleteCalendar")};_timefilter.timefilter.disableTimeRangeSelector();_timefilter.timefilter.disableAutoRefreshSelector();var mlConfirm=mlConfirmModalService;var calendars=[];$scope.displayCalendars=[];$scope.buttonChecks=(0,_buttons_enabled_checks.buttonsEnabledChecks)($scope.permissions,(0,_check_ml_nodes.mlNodesAvailable)());var PAGE_SIZE=20;var limitTo=$filter("limitTo");$scope.pager=pagerFactory.create(0,PAGE_SIZE,1);var SORT_FIELD_LABELS={CALENDAR_ID:"calendar_id",JOB_IDS:"job_ids",EVENT_COUNT:"event_count"};$scope.SORT_FIELD_LABELS=SORT_FIELD_LABELS;$scope.sortField=SORT_FIELD_LABELS.CALENDAR_ID;$scope.sortReverse=false;$scope.onSortChange=function(field,reverse){$scope.sortField=field;$scope.sortReverse=reverse};$scope.onQueryChange=function(query){$scope.filterRegexp=query?new RegExp("("+query+")","gi"):void 0};$scope.onPageNext=function(){$scope.pager.nextPage()};$scope.onPagePrevious=function(){$scope.pager.previousPage()};$scope.$watchMulti(["sortField","sortReverse","filterRegexp","pager.currentPage"],applyTableSettings);$scope.newCalendarClick=function(){$location.path("settings/calendars_list/new_calendar")};$scope.editCalendarClick=function(id){$location.path("settings/calendars_list/edit_calendar/"+id)};$scope.deleteCalendarClick=function(calendarId){mlConfirm.open({message:"Confirm deletion of "+calendarId+"?",title:"Delete calendar"}).then(function(){_ml_api_service.ml.deleteCalendar({calendarId:calendarId}).then(loadCalendars).catch(function(error){console.log(error)})}).catch(function(){})};function loadCalendars(){_ml_api_service.ml.calendars().then(function(resp){calendars=resp;$scope.pager=pagerFactory.create(calendars.length,PAGE_SIZE,1);applyTableSettings()})}function applyTableSettings(){var filteredCalendars=_lodash2.default.filter(calendars,function(calendar){return void 0===$scope.filterRegexp||calendar.calendar_id.match($scope.filterRegexp)||calendar.job_ids.join(" ").match($scope.filterRegexp)});filteredCalendars=_lodash2.default.sortBy(filteredCalendars,function(calendar){switch($scope.sortField){case SORT_FIELD_LABELS.JOB_IDS:return calendar.job_ids.join();case SORT_FIELD_LABELS.EVENT_COUNT:return calendar.events.length;case SORT_FIELD_LABELS.CALENDAR_ID:default:return calendar[$scope.sortField]}});true===$scope.sortReverse&&(filteredCalendars=filteredCalendars.reverse());$scope.displayCalendars=limitTo(filteredCalendars,$scope.pager.pageSize,$scope.pager.startIndex);$scope.pager.setTotalItems(filteredCalendars.length)}loadCalendars()})},3970:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.buttonsEnabledChecks=buttonsEnabledChecks;var _check_privilege=__webpack_require__(35);function buttonsEnabledChecks(permissions,mlNodesAvailable){var NO_ML_NODES_ERROR="No ML nodes available";function newButtonWrapperClass(){return permissions.canCreateCalendar&&mlNodesAvailable?"button-wrapper":["button-wrapper","disabled"]}function newButtonWrapperTooltip(){var tooltip=void 0;false===permissions.canCreateCalendar?tooltip=(0,_check_privilege.createPermissionFailureMessage)("canCreateCalendar"):false===mlNodesAvailable&&(tooltip=NO_ML_NODES_ERROR);return tooltip}function newButtonDisabled(){return false===permissions.canCreateCalendar||false===mlNodesAvailable}function deleteButtonWrapperClass(){return permissions.canDeleteCalendar&&mlNodesAvailable?"button-wrapper":["button-wrapper","disabled"]}function deleteButtonWrapperTooltip(){var tooltip=void 0;false===permissions.canDeleteCalendar?tooltip=(0,_check_privilege.createPermissionFailureMessage)("canDeleteCalendar"):false===mlNodesAvailable&&(tooltip=NO_ML_NODES_ERROR);return tooltip}function deleteButtonDisabled(){return false===(permissions.canDeleteCalendar&&mlNodesAvailable)}return{newButtonWrapperClass:newButtonWrapperClass,newButtonWrapperTooltip:newButtonWrapperTooltip,newButtonDisabled:newButtonDisabled,deleteButtonWrapperClass:deleteButtonWrapperClass,deleteButtonWrapperTooltip:deleteButtonWrapperTooltip,deleteButtonDisabled:deleteButtonDisabled}}},3971:function(module,exports){module.exports='<ml-nav-menu name="settings"></ml-nav-menu>\n<ml-calendars-list ng-controller="MlCalendarsList">\n  <ml-message-bar ></ml-message-bar>\n\n  <div class="calendars-list-container">\n    <div>\n      <div class="kuiViewContent kuiViewContent--constrainedWidth">\n        <div class="kuiViewContentItem kuiControlledTable kuiVerticalRhythm">\n          <div class="kuiToolBar">\n            <div class="kuiToolBarSearch">\n              <tool-bar-search-box\n                ng-disabled="true"\n                filter="query"\n                on-filter="onQueryChange">\n              </tool-bar-search-box>\n            </div>\n\n            <div class="kuiToolBarSection">\n              <div\n                ng-class="buttonChecks.newButtonWrapperClass()"\n                ng-attr-tooltip="{{buttonChecks.newButtonWrapperTooltip()}}"\n              >\n                <button class="kuiButton kuiButton--primary"\n                  ng-click="newCalendarClick()"\n                  aria-label="Create new calendar"\n                  tooltip="Create new calendar"\n                  ng-disabled=\'buttonChecks.newButtonDisabled()\'\n                  tooltip-append-to-body="true">\n                  <span aria-hidden="true" class="kuiButton__icon kuiIcon fa-plus"></span>\n                  New calendar\n                </button>\n              </div>\n            </div>\n\n            <div class="kuiToolBarSection">\n              <tool-bar-pager-text\n                start-item="pager.startItem"\n                end-item="pager.endItem"\n                total-items="pager.totalItems">\n              </tool-bar-pager-text>\n              <tool-bar-pager-buttons\n                has-previous-page="pager.hasPreviousPage"\n                has-next-page="pager.hasNextPage"\n                on-page-next="onPageNext"\n                on-page-previous="onPagePrevious">\n              </tool-bar-pager-buttons>\n            </div>\n          </div>\n\n          <table class="kuiTable">\n            <thead>\n              <tr>\n                <th scope="col" class="kuiTableHeaderCell">\n                  <sortable-column field="{{SORT_FIELD_LABELS.CALENDAR_ID}}" on-sort-change="onSortChange" sort-field="sortField" sort-reverse="sortReverse">\n                    ID\n                  </sortable-column>\n                </th>\n                <th scope="col" class="kuiTableHeaderCell">\n                  <sortable-column field="{{SORT_FIELD_LABELS.JOB_IDS}}" on-sort-change="onSortChange" sort-field="sortField" sort-reverse="sortReverse">\n                    Jobs\n                  </sortable-column>\n                </th>\n                <th scope="col" class="kuiTableHeaderCell">\n                  <sortable-column field="{{SORT_FIELD_LABELS.EVENT_COUNT}}" on-sort-change="onSortChange" sort-field="sortField" sort-reverse="sortReverse">\n                    Events\n                  </sortable-column>\n                </th>\n                <th scope="col" class="kuiTableHeaderCell actions-col"></th>\n              </tr>\n            </thead>\n\n            <tbody>\n              <tr ng-repeat="calendar in displayCalendars" class="kuiTableRow" ng-class="{ \'kuiTableRow-isBeingDeleted\': calendar.isBeingDeleted }">\n\n                <td class="kuiTableRowCell">\n                  <div class="kuiTableRowCell__liner">\n                    <span title="{{calendar.calendar_id}}">\n                      {{calendar.calendar_id}}\n                    </span>\n                  </div>\n                </td>\n\n                <td class="kuiTableRowCell">\n                  <div class="kuiTableRowCell__liner">\n                    <span title="{{calendar.job_ids.join(\', \')}}">\n                      {{calendar.job_ids.join(\', \')}}\n                    </span>\n                  </div>\n                </td>\n                <td class="kuiTableRowCell">\n                  <div class="kuiTableRowCell__liner">\n                    <span>\n                       {{calendar.events.length}} {{calendar.events.length === 1 ? \'event\' : \'events\'}}\n                    </span>\n                  </div>\n                </td>\n                <td class="kuiTableRowCell">\n                  <div class="kuiTableRowCell__liner">\n                    <div class="kuiMenuButtonGroup kuiMenuButtonGroup--alignRight">\n                      <div\n                        ng-class="buttonChecks.newButtonWrapperClass()"\n                        ng-attr-tooltip="{{buttonChecks.newButtonWrapperTooltip()}}">\n                        <button\n                          class="kuiMenuButton kuiMenuButton--basic kuiMenuButton--iconText"\n                          title="Edit"\n                          ng-disabled=\'buttonChecks.newButtonDisabled()\'\n                          ng-click="editCalendarClick(calendar.calendar_id)">\n                          <span class="kuiMenuButton__icon kuiIcon fa-pencil"></span>\n                          <span>Edit</span>\n                        </button>\n                      </div>\n                      <div\n                        ng-class="buttonChecks.deleteButtonWrapperClass()"\n                        ng-attr-tooltip="{{buttonChecks.deleteButtonWrapperTooltip()}}">\n                        <button\n                          class="kuiMenuButton kuiMenuButton--danger kuiMenuButton--iconText"\n                          title="Edit"\n                          ng-disabled=\'buttonChecks.deleteButtonDisabled()\'\n                          ng-click="deleteCalendarClick(calendar.calendar_id)"\n                          href="" >\n                          <span class="kuiMenuButton__icon kuiIcon fa-trash"></span>\n                          <span>Delete</span>\n                        </button>\n                      </div>\n                    </div>\n                  </div>\n                </td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n    </div>\n  </div>\n</ml-calendars-list>\n'},3972:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3973);__webpack_require__(3974)},3973:function(module,exports){},3974:function(module,exports,__webpack_require__){"use strict";var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);__webpack_require__(1418);__webpack_require__(1457);var _validate_calendar=__webpack_require__(3992);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _check_license=__webpack_require__(68);var _check_privilege=__webpack_require__(35);var _check_ml_nodes=__webpack_require__(69);var _job_service=__webpack_require__(24);var _calendar_service=__webpack_require__(630);var _messagebar_service=__webpack_require__(79);var _promise=__webpack_require__(89);var _ml_api_service=__webpack_require__(23);var _create_calendar=__webpack_require__(3993);var _create_calendar2=_interopRequireDefault(_create_calendar);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}_routes2.default.when("/settings/calendars_list/new_calendar",{template:_create_calendar2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,initPromise:(0,_promise.initPromise)(true)}}).when("/settings/calendars_list/edit_calendar/:calendarId",{template:_create_calendar2.default,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,checkMlNodesAvailable:_check_ml_nodes.checkMlNodesAvailable,initPromise:(0,_promise.initPromise)(true)}});var _module=_modules.uiModules.get("apps/ml",["ui.bootstrap"]);_module.controller("MlCreateCalendar",function($scope,$route,$location){var msgs=_messagebar_service.mlMessageBarService;msgs.clear();var calendarId=$route.current.params.calendarId;$scope.isNewCalendar=void 0===calendarId;$scope.pageTitle=$scope.isNewCalendar?"Create new calendar":"Edit calendar "+calendarId;$scope.calendarId=calendarId||"";$scope.description="";$scope.events=[];$scope.jobIds=[];$scope.allJobs=[];$scope.groupIds=[];$scope.allGroups=[];$scope.updateJobsList={};$scope.updateGroupsList={};$scope.saveLock=false;$scope.validation={checks:{calendarId:{valid:true}}};_job_service.mlJobService.loadJobs().then(function(){var jobs=_job_service.mlJobService.jobs;$scope.allJobs=jobs.map(function(j){return{id:j.job_id}});$scope.allGroups=_job_service.mlJobService.getJobGroups().map(function(g){return{id:g.id}});_calendar_service.mlCalendarService.loadCalendars(jobs).then(function(resp){var _$scope$allGroups;var calendars=resp.calendars;var calGroups=_calendar_service.mlCalendarService.getCalendarGroups();(_$scope$allGroups=$scope.allGroups).push.apply(_$scope$allGroups,_toConsumableArray(calGroups));$scope.allGroups=_lodash2.default.uniq($scope.allGroups,"id");$scope.allGroups=_lodash2.default.sortBy($scope.allGroups,"id");calendars.forEach(function(calendar){if(void 0!==calendarId&&calendarId===calendar.calendar_id){$scope.events=calendar.events||[];$scope.description=calendar.description||"";calendar.job_ids.forEach(function(id){$scope.allJobs.find(function(j){return j.id===id})?$scope.jobIds.push(id):$scope.allGroups.find(function(g){return g.id===id})&&$scope.groupIds.push(id)})}});$scope.updateJobsList.update($scope.jobIds);$scope.updateGroupsList.update($scope.groupIds)});(0,_jquery2.default)(".new-calendar-container #id").focus()});$scope.save=function(){msgs.clear();var events=$scope.events.map(function(event){return{description:event.description,start_time:event.start_time,end_time:event.end_time}});var calendar={calendarId:$scope.calendarId,description:$scope.description,events:events,job_ids:[].concat(_toConsumableArray($scope.jobIds),_toConsumableArray($scope.groupIds))};if((0,_validate_calendar.validateCalendarId)(calendar.calendarId,$scope.validation.checks)){$scope.saveLock=true;var saveFunc=$scope.isNewCalendar?function(c){return _ml_api_service.ml.addCalendar(c)}:function(c){return _ml_api_service.ml.updateCalendar(c)};saveFunc(calendar).then(function(){$location.path("settings/calendars_list");$scope.saveLock=false}).catch(function(error){msgs.error("Save calendar failed: ",error);$scope.saveLock=false})}};$scope.cancel=function(){$location.path("settings/calendars_list")};$scope.saveEnabled=function(){return""!==$scope.calendarId&&void 0!==$scope.calendarId&&false===$scope.saveLock}})},3975:function(module,exports){},3976:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3977);__webpack_require__(3982);var _events_list=__webpack_require__(3991);var _events_list2=_interopRequireDefault(_events_list);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}var _module=_modules.uiModules.get("apps/ml");_module.directive("mlEventsList",function($filter,pagerFactory,mlNewEventService,mlImportEventsService,config){return{restrict:"AE",replace:true,transclude:true,template:_events_list2.default,scope:{events:"=",showControls:"=",lockControls:"=",asteriskText:"="},controller:function controller($scope){$scope.pageOfEvents=[];$scope.dateFormatTz=config.get("dateFormat:tz");var TIME_FORMAT="YYYY-MM-DD HH:mm:ss";var PAGE_SIZE=20;var orderBy=$filter("orderBy");var limitTo=$filter("limitTo");$scope.pager=pagerFactory.create($scope.events.length,PAGE_SIZE,1);$scope.sortField="description";$scope.sortReverse=false;$scope.onSortChange=function(field,reverse){$scope.sortField=field;$scope.sortReverse=reverse};$scope.onPageNext=function(){$scope.pager.nextPage()};$scope.onPagePrevious=function(){$scope.pager.previousPage()};$scope.$watchMulti(["events","sortField","sortReverse","pager.currentPage"],applyTableSettings);$scope.clickNewEvent=function(){mlNewEventService.openNewEventWindow().then(function(event){$scope.events.push(event);applyTableSettings()}).catch(function(){})};$scope.formatTime=function(timeMs){var time=(0,_moment2.default)(timeMs);return time.format(TIME_FORMAT)};$scope.deleteEvent=function(eventToDelete){$scope.events.splice($scope.events.indexOf(eventToDelete),1);applyTableSettings()};$scope.clickImportEvents=function(){mlImportEventsService.openImportEventsWindow().then(function(events){var _$scope$events;(_$scope$events=$scope.events).push.apply(_$scope$events,_toConsumableArray(events));applyTableSettings()}).catch(function(){})};function applyTableSettings(){var pageOfEvents=orderBy($scope.events,$scope.sortField,$scope.sortReverse);$scope.pageOfEvents=limitTo(pageOfEvents,$scope.pager.pageSize,$scope.pager.startIndex);$scope.pager.setTotalItems($scope.events.length)}}}})},3977:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3978);__webpack_require__(3979);__webpack_require__(3981)},3978:function(module,exports){},3979:function(module,exports,__webpack_require__){"use strict";var _new_event_modal=__webpack_require__(3980);var _new_event_modal2=_interopRequireDefault(_new_event_modal);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.service("mlNewEventService",function($modal){this.openNewEventWindow=function(){return new Promise(function(resolve,reject){var modal=$modal.open({template:_new_event_modal2.default,controller:"MlNewEventModal",backdrop:"static",keyboard:false});modal.result.then(resolve).catch(reject)})}})},3980:function(module,exports){module.exports='<div class="new-event-modal">\n  <ml-message-bar ></ml-message-bar>\n  <h3 class="euiTitle">Create new event</h3>\n  <div class="euiSpacer euiSpacer--s"></div>\n\n  <div class="ml-new-event-contents" >\n\n    <div class="kuiFormSection" aria-hidden="false">\n      <label for="id" class="kuiFormLabel">\n        Description\n      </label>\n      <input\n        type="text"\n        ng-disabled="isNewCalendar===false"\n        id="id"\n        name="id"\n        ng-model="ui.description"\n        ng-trim="false"\n        class="kuiTextInput fullWidth"\n        autofocus\n        required />\n    </div>\n    <div class="main-container row1">\n      <div class="tabs-container">\n        <ul class="nav nav-pills nav-stacked">\n          <li ng-class="{ active: ui.rangeType === \'0\' }"><a ng-click="ui.setRangeType(\'0\')"> Single day</a></li>\n          <li ng-class="{ active: ui.rangeType === \'1\' }"><a ng-click="ui.setRangeType(\'1\')"> Day range</a></li>\n          <li ng-class="{ active: ui.rangeType === \'2\' }"><a ng-click="ui.setRangeType(\'2\')"> Time range</a></li>\n        </ul>\n      </div>\n      <div\n        class="calendar-container"\n        ng-class="{ \'top-tab-selected\': ui.rangeType === \'0\' }" >\n\n        <div\n          ng-show="ui.rangeType === RANGE_TYPE.SINGLE_DAY"\n          class="calendar">\n          <datepicker\n            offset-timezone\n            ng-model="ui.timepicker.start"\n            show-weeks="false">\n          </datepicker>\n        </div>\n\n        <div ng-show="ui.rangeType === RANGE_TYPE.DAY_RANGE">\n          <div class="row">\n            <div class="col-md-6 calendar">\n              <label class="kuiFormLabel">\n                From:\n              </label>\n              <datepicker\n                offset-timezone\n                ng-model="ui.timepicker.start"\n                max-date="ui.timepicker.end"\n                show-weeks="false">\n              </datepicker>\n              <div class="partition"></div>\n            </div>\n            <div class="col-md-6 calendar">\n              <label class="kuiFormLabel">\n                To:\n              </label>\n              <datepicker\n                offset-timezone\n                ng-model="ui.timepicker.end"\n                min-date="ui.timepicker.start"\n                show-weeks="false">\n              </datepicker>\n            </div>\n          </div>\n        </div>\n\n        <div ng-show="ui.rangeType === RANGE_TYPE.TIME_RANGE">\n          <div class="row">\n            <div class="col-md-6 calendar">\n              <div class="calendar-input-container">\n                <label class="kuiFormLabel">\n                  From:\n                </label>\n                <input type="text" class="form-control" input-datetime="YYYY-MM-DD HH:mm:ss" ng-model="ui.timepicker.start">\n              </div>\n              <datepicker\n                offset-timezone\n                ng-model="ui.timepicker.start"\n                max-date="ui.timepicker.end"\n                show-weeks="false">\n              </datepicker>\n              <div class="partition partition-large"></div>\n            </div>\n            <div class="col-md-6 calendar">\n              <label class="kuiFormLabel">\n                From:\n              </label>\n              <div class="calendar-input-container">\n                <input type="text" class="form-control" input-datetime="YYYY-MM-DD HH:mm:ss" ng-model="ui.timepicker.end">\n              </div>\n              <datepicker\n                offset-timezone\n                ng-model="ui.timepicker.end"\n                min-date="ui.timepicker.start"\n                show-weeks="false">\n              </datepicker>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n\n  </div>\n\n  <div class="clearfix"></div>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium" />\n\n  <button\n    ng-click="save()"\n    ng-disabled="ui.saveEnabled() === false"\n    class="kuiButton kuiButton--primary" >\n    Add\n  </button>\n  <button\n    ng-click="cancel()"\n    ng-disabled="(saveLock === true)"\n    class="kuiButton kuiButton--primary"\n    aria-label="Cancel">\n    Cancel\n  </button>\n\n</div>\n'},3981:function(module,exports,__webpack_require__){"use strict";var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.controller("MlNewEventModal",function($scope,$modalInstance,$timeout){var RANGE_TYPE={SINGLE_DAY:"0",DAY_RANGE:"1",TIME_RANGE:"2"};$scope.RANGE_TYPE=RANGE_TYPE;var MODAL_WIDTH_SMALL=425;var MODAL_WIDTH_LARGE=700;$scope.event={description:"",start:"",end:""};$scope.ui={saveEnabled:function saveEnabled(){return""!==$scope.ui.description&&void 0!==$scope.ui.description},description:"",rangeType:RANGE_TYPE.SINGLE_DAY,timepicker:{start:(0,_moment2.default)().startOf("day"),end:(0,_moment2.default)().startOf("day").add(1,"days")},setRangeType:function setRangeType(i){$scope.ui.rangeType=i;var width=MODAL_WIDTH_SMALL;i===RANGE_TYPE.SINGLE_DAY?width=MODAL_WIDTH_SMALL:i!==RANGE_TYPE.DAY_RANGE&&i!==RANGE_TYPE.TIME_RANGE||(width=MODAL_WIDTH_LARGE);(0,_jquery2.default)(".modal-dialog").width(width)}};$timeout(function(){$scope.ui.setRangeType("0");(0,_jquery2.default)(".ml-new-event-contents #id").focus()},0);function extractForm(){var start=null;var end=null;var startMoment=(0,_moment2.default)($scope.ui.timepicker.start);if($scope.ui.rangeType===RANGE_TYPE.SINGLE_DAY){var endMoment=(0,_moment2.default)($scope.ui.timepicker.start);start=startMoment.startOf("day");end=endMoment.startOf("day").add(1,"days")}else if($scope.ui.rangeType===RANGE_TYPE.DAY_RANGE){var _endMoment=(0,_moment2.default)($scope.ui.timepicker.end);start=startMoment.startOf("day");end=_endMoment.startOf("day").add(1,"days")}else if($scope.ui.rangeType===RANGE_TYPE.TIME_RANGE){start=startMoment;end=(0,_moment2.default)($scope.ui.timepicker.end)}return{description:$scope.ui.description,start_time:start.valueOf(),end_time:end.valueOf()}}$scope.save=function(){var event=extractForm();$modalInstance.close(event)};$scope.cancel=function(){$modalInstance.dismiss("cancel")}})},3982:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3983);__webpack_require__(3984);__webpack_require__(3986)},3983:function(module,exports){},3984:function(module,exports,__webpack_require__){"use strict";var _import_events_modal=__webpack_require__(3985);var _import_events_modal2=_interopRequireDefault(_import_events_modal);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");_module.service("mlImportEventsService",function($modal){this.openImportEventsWindow=function(){return new Promise(function(resolve,reject){var modal=$modal.open({template:_import_events_modal2.default,controller:"MlImportEventsModal",backdrop:"static",keyboard:false});modal.result.then(resolve).catch(reject)})}})},3985:function(module,exports){module.exports='<div class="import-events-modal">\n  <ml-message-bar ></ml-message-bar>\n  <h3 class="euiTitle">Import events</h3>\n  <div class="euiSpacer euiSpacer--s"></div>\n\n  <div>\n    Import events from an ICS file\n  </div>\n  <div class="euiSpacer euiSpacer--m"></div>\n\n  <div class="import-events-container">\n\n    <div class="kuiFormSection no-shadow euiPanel euiPanel--paddingMedium">\n      <input\n        type=\'file\'\n        ng-disabled="(loadingLock === true)"\n        ml-file-input-on-change="fileNameChanged"\n        />\n    </div>\n\n    <div\n      ng-if="fileLoaded===true && newEvents.length >= 0"\n      class="kuiFormSection">\n      <span class="kuiFormLabel">Events to import: {{newEvents.length}}</span>\n    </div>\n\n    <div\n      ng-if="error===true"\n      class="kuiFormSection euiCallOut euiCallOut--danger">\n      <div class="euiCallOutHeader">\n        <span class="euiCallOutHeader__title">{{errorMessage}}</span>\n      </div>\n    </div>\n\n    <div\n      ng-if="loadingLock === true"\n      class="kuiFormSection">\n      <ml-loading-indicator\n        label="Importing events"\n        is-loading="true"\n        height="50"\n      />\n    </div>\n\n    <div ng-show="fileLoaded===true && newEvents.length >= 0">\n      <ml-events-list\n        events=\'newEvents\'\n        show-controls=\'false\'\n        asterisk-text=\'RECURRING_WARNING\'\n        >\n      </ml-events-list>\n\n      <div class="euiSpacer euiSpacer--m"></div>\n\n      <div ng-if="showRecurringWarning" class="recurring-warning">\n        *{{RECURRING_WARNING}}\n        <div class="euiSpacer euiSpacer--m"></div>\n      </div>\n\n      <div>\n        <label class=\'kuiCheckBoxLabel kuiVerticalRhythm\'>\n          <input\n            ng-model=\'includePastEvents\'\n            type="checkbox"\n            class=\'kuiCheckBox\'\n            ng-click="createEventsList()"/>\n          <span class=\'kuiCheckBoxLabel__text\'>Include past events</span>\n        </label>\n      </div>\n    </div>\n  </div>\n\n  <div class="clearfix"></div>\n\n  <hr class="euiHorizontalRule euiHorizontalRule--full euiHorizontalRule--marginMedium" />\n\n  <button\n    ng-click="save()"\n    ng-disabled="loadingLock === true"\n    class="kuiButton kuiButton--primary" >\n    Import\n  </button>\n  <button\n    ng-click="cancel()"\n    ng-disabled="loadingLock === true"\n    class="kuiButton kuiButton--primary"\n    aria-label="Cancel">\n    Cancel\n  </button>\n\n</div>\n'},3986:function(module,exports,__webpack_require__){"use strict";var _jquery=__webpack_require__(13);var _jquery2=_interopRequireDefault(_jquery);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);__webpack_require__(1457);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}var icalendar=__webpack_require__(1458);var _module=_modules.uiModules.get("apps/ml");_module.controller("MlImportEventsModal",function($scope,$timeout,$modalInstance){$scope.loadingLock=false;$scope.allNewEvents=[];$scope.newEvents=[];$scope.fileLoaded=false;$scope.file=void 0;$scope.includePastEvents=false;$scope.showRecurringWarning=false;$scope.RECURRING_WARNING="Recurring events not supported. Only the first event will be imported.";$timeout(function(){(0,_jquery2.default)(".modal-dialog").width(750)},0);var MAX_FILE_SIZE_MB=100;$scope.fileNameChanged=function(event){$scope.$apply(function(){if(event.target.files.length){reset();$scope.file=event.target.files[0];if($scope.file.size<=1e6*MAX_FILE_SIZE_MB)readFile($scope.file).then(function(resp){try{$scope.allNewEvents=parseICSFile(resp.data);$scope.createEventsList();$scope.fileLoaded=true;$scope.loadingLock=false}catch(error){$scope.error=true;$scope.errorMessage="Could not parse ICS file"}}).catch(function(error){console.error(error);$scope.loadingLock=false});else{$scope.fileLoaded=false;$scope.loadingLock=false}}})};function readFile(file){return new Promise(function(resolve,reject){$scope.loadingLock=true;if(file&&file.size){var reader=new FileReader;reader.readAsText(file);reader.onload=function(){$scope.loadingLock=false;var data=reader.result;""===data?reject():resolve({data:data})}}else reject()})}function reset(){$scope.file=void 0;$scope.fileLoaded=false;$scope.loadingLock=false;$scope.newEvents=[];$scope.error=false;$scope.errorMessage=""}function parseICSFile(data){var cal=icalendar.parse_calendar(data);return createEvents(cal)}function createEvents(ical){var events=ical.events();var mlEvents=[];events.forEach(function(e){if("VEVENT"===e.element){var description=e.properties.SUMMARY;var start=e.properties.DTSTART;var end=e.properties.DTEND;var recurring=void 0!==e.properties.RRULE;description&&start&&end&&description.length&&start.length&&end.length&&mlEvents.push({description:description[0].value,start_time:start[0].value.valueOf(),end_time:end[0].value.valueOf(),asterisk:recurring})}});return mlEvents}$scope.createEventsList=function(){if($scope.includePastEvents)$scope.newEvents=[].concat(_toConsumableArray($scope.allNewEvents));else{var now=(0,_moment2.default)().valueOf();$scope.newEvents=$scope.allNewEvents.filter(function(e){return e.start_time>now})}$scope.showRecurringWarning=void 0!==$scope.newEvents.find(function(e){return e.asterisk})};$scope.save=function(){$modalInstance.close($scope.newEvents);reset()};$scope.cancel=function(){$modalInstance.dismiss("cancel")}}).directive("mlFileInputOnChange",function(){return{restrict:"A",link:function link(scope,element,attrs){var onChangeHandler=scope.$eval(attrs.mlFileInputOnChange);element.on("change",onChangeHandler);element.on("$destroy",function(){element.off()})}}})},3989:function(module,exports,__webpack_require__){"use strict";var util=__webpack_require__(428);var CalendarObject=__webpack_require__(145).CalendarObject;var schema=__webpack_require__(145).schema;var iCalendar=__webpack_require__(639).iCalendar;var RRule=__webpack_require__(638).RRule;var VEvent=exports.VEvent=function(calendar,uid){if(!(calendar instanceof iCalendar)&&null!=calendar){uid=calendar;calendar=null}CalendarObject.call(this,calendar,"VEVENT");if(void 0!==uid){this.addProperty("DTSTAMP",new Date);this.addProperty("UID",uid)}};util.inherits(VEvent,CalendarObject);VEvent.prototype.setSummary=function(summ){this.addProperty("SUMMARY",summ)};VEvent.prototype.setLocation=function(loc){this.addProperty("LOCATION",loc)};VEvent.prototype.setDescription=function(desc){this.addProperty("DESCRIPTION",desc)};VEvent.prototype.setDate=function(start,end){this.addProperty("DTSTART",start);end instanceof Date?this.addProperty("DTEND",end):this.addProperty("DURATION",end)};VEvent.prototype.rrule=function(){var rr=this.getPropertyValue("RRULE");if(!rr)return null;var exceptions=[];var ex,i=0;while(ex=this.getPropertyValue("EXDATE",i++))exceptions.push.apply(exceptions,ex);return new RRule(rr,{DTSTART:this.getPropertyValue("DTSTART"),DTEND:this.getPropertyValue("DTEND"),EXDATE:exceptions})};VEvent.prototype.inTimeRange=function(start,end){var rr=this.rrule();if(rr){var next=rr.next(start);return null!==next&&(!end||next<=end)}var dtstart=this.getPropertyValue("DTSTART");var dtend=this.getPropertyValue("DTEND");if(!dtend){var duration=this.getPropertyValue("DURATION");if(0===duration)return(!start||start<=dtstart)&&(!end||end>dtstart);dtend=duration?new Date(dtstart.valueOf()+1e3*this.getPropertyValue("DURATION")):new Date(dtstart.valueOf()+864e5)}return(!start||start<dtend)&&(!end||end>dtstart)};VEvent.prototype.reply=function(fromuser,status,options){var resp=this.clone(true);options=options||{};true===status||void 0===status?status="ACCEPTED":false===status&&(status="DECLINED");resp.setProperty("ATTENDEE",fromuser,{PARTSTAT:status,CN:options["CN"]||fromuser});resp.setProperty("DTSTAMP",new Date);resp.setProperty("LAST-MODIFIED",new Date);var ics=new iCalendar;ics.addProperty("METHOD","REPLY");this.calendar&&ics.addComponents(this.calendar.getComponents("VTIMEZONE"));ics.addComponent(resp);return ics};schema.VEVENT={factory:VEvent,valid_properties:[],required_properties:["DTSTAMP","UID"],valid_children:[],required_children:[]}},3990:function(module,exports,__webpack_require__){var assert=__webpack_require__(881);var util=__webpack_require__(428);var CalendarObject=__webpack_require__(145).CalendarObject;var schema=__webpack_require__(145).schema;var RRule=__webpack_require__(638).RRule;var VTimezone=exports.VTimezone=function(calendar,tzid){CalendarObject.call(this,calendar,"VTIMEZONE");this.addProperty("TZID",tzid)};util.inherits(VTimezone,CalendarObject);VTimezone.prototype.getRRule=function(section){var comp=this.getComponents(section)[0];if(!comp||!comp.getPropertyValue("RRULE"))return null;return new RRule(comp.getPropertyValue("RRULE"),comp.getPropertyValue("DTSTART"),comp.getPropertyValue("DTEND"))};VTimezone.prototype.getOffsetForDate=function(dt){if(!this.getComponents("DAYLIGHT").length)return this.getComponents("STANDARD")[0].getPropertyValue("TZOFFSETTO");assert.equal(1,this.components["STANDARD"].length);assert.equal(1,this.components["DAYLIGHT"].length);var next_std=this.getRRule("STANDARD");var next_dst=this.getRRule("DAYLIGHT");if(null===next_std||null===next_dst){var comp=this.getComponents("STANDARD")[0];return comp.getPropertyValue("TZOFFSETTO")}next_std=next_std.next(dt);next_dst=next_dst.next(dt);return this.getComponents(next_dst<next_std?"STANDARD":"DAYLIGHT")[0].getPropertyValue("TZOFFSETTO")};VTimezone.prototype.fromLocalTime=function(dtarray){var hrs=this.getOffsetForDate(dtarray);var min=hrs%100;hrs=(hrs-min)/100;return new Date(Date.UTC(dtarray[0],dtarray[1]-1,dtarray[2],dtarray[3]-hrs,dtarray[4]-min,dtarray[5]))};schema.VTIMEZONE={factory:VTimezone}},3991:function(module,exports){module.exports='<div class="events-list">\n  <div\n    class="kuiVerticalRhythm"\n    ng-class="{\'kuiControlledTable\': showControls}">\n    <div ng-if="showControls" class="kuiToolBar">\n\n      <div class="kuiToolBarSection">\n        <button\n          class="kuiButton kuiButton--primary"\n          href=""\n          aria-label="Create new event"\n          tooltip="Create new event"\n          tooltip-append-to-body="true"\n          ng-disabled="lockControls === true"\n          ng-click="clickNewEvent()">\n          <span aria-hidden="true" class="kuiButton__icon kuiIcon fa-plus"></span>\n          New event\n        </button>\n\n        <button\n          class="kuiButton kuiButton--primary"\n          href=""\n          aria-label="Import events"\n          tooltip="Import events"\n          tooltip-append-to-body="true"\n          ng-disabled="lockControls === true"\n          ng-click="clickImportEvents()">\n          <span aria-hidden="true" class="kuiButton__icon kuiIcon fa-upload"></span>\n          Import events\n        </button>\n      </div>\n\n      <div class="kuiToolBarSection">\n        <tool-bar-pager-text\n          start-item="pager.startItem"\n          end-item="pager.endItem"\n          total-items="pager.totalItems">\n        </tool-bar-pager-text>\n        <tool-bar-pager-buttons\n          has-previous-page="pager.hasPreviousPage"\n          has-next-page="pager.hasNextPage"\n          on-page-next="onPageNext"\n          on-page-previous="onPagePrevious">\n        </tool-bar-pager-buttons>\n      </div>\n    </div>\n\n    <table class="kuiTable" ng-show="pageOfEvents.length">\n      <thead>\n        <tr>\n          <th scope="col" class="kuiTableHeaderCell">\n            <sortable-column field="description" on-sort-change="onSortChange" sort-field="sortField" sort-reverse="sortReverse">\n              Description\n            </sortable-column>\n          </th>\n          <th scope="col" class="kuiTableHeaderCell">\n            <sortable-column field="start_time" on-sort-change="onSortChange" sort-field="sortField" sort-reverse="sortReverse">\n              Start\n            </sortable-column>\n          </th>\n          <th scope="col" class="kuiTableHeaderCell">\n            <sortable-column field="end_time" on-sort-change="onSortChange" sort-field="sortField" sort-reverse="sortReverse">\n              End\n            </sortable-column>\n          </th>\n          <th scope="col" class="kuiTableHeaderCell actions-col"></th>\n        </tr>\n      </thead>\n\n      <tbody>\n        <tr ng-repeat="event in pageOfEvents track by $index" class="kuiTableRow" ng-class="{ \'kuiTableRow-isBeingDeleted\': event.isBeingDeleted }">\n\n          <td class="kuiTableRowCell">\n            <div class="kuiTableRowCell__liner">\n              <span>\n                {{event.description}}\n              </span>\n              <span\n                ng-if="event.asterisk"\n                class="asterisk"\n                tooltip=\'{{asteriskText}}\'>*</span>\n            </div>\n          </td>\n\n          <td class="kuiTableRowCell">\n            <div class="kuiTableRowCell__liner">\n              <span>\n                {{formatTime(event.start_time)}}\n              </span>\n            </div>\n          </td>\n\n          <td class="kuiTableRowCell">\n            <div class="kuiTableRowCell__liner">\n              <span>\n                {{formatTime(event.end_time)}}\n              </span>\n            </div>\n          </td>\n          <td class="kuiTableRowCell">\n            <div class="kuiTableRowCell__liner">\n              <div class="kuiMenuButtonGroup kuiMenuButtonGroup--alignRight">\n                <button\n                  class="kuiMenuButton kuiMenuButton--danger kuiMenuButton--iconText"\n                  title="Edit"\n                  ng-disabled="lockControls === true"\n                  ng-click="deleteEvent(event)"\n                  href="">\n                  <span class="kuiMenuButton__icon kuiIcon fa-trash"></span>\n                  <span>Delete</span>\n                </button>\n              </div>\n            </div>\n          </td>\n\n        </tr>\n      </tbody>\n\n      <tfoot>\n        <tr>\n          <td colspan="4" class="kuiTableHeaderCell footer-cell">\n          Times are displayed in {{dateFormatTz === \'Browser\' ? \'the browser\' : dateFormatTz}} timezone\n        </td>\n        </tr>\n      </tfoot>\n\n    </table>\n\n\n  </div>\n</div>\n'},3992:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.validateCalendarId=validateCalendarId;var _job_utils=__webpack_require__(41);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function validateCalendarId(calendarId,checks){var valid=true;_lodash2.default.each(checks,function(item){return item.valid=true});if(""===calendarId||void 0===calendarId)checks.calendarId.valid=false;else if(false===(0,_job_utils.isJobIdValid)(calendarId)){checks.calendarId.valid=false;var msg="Calendar ID can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";msg+="must start and end with an alphanumeric character";checks.calendarId.message=msg}_lodash2.default.each(checks,function(item){false===item.valid&&(valid=false)});return valid}},3993:function(module,exports){module.exports='<ml-nav-menu name="calendars_list"></ml-nav-menu>\n<ml-new-calendar ng-controller="MlCreateCalendar">\n  <ml-message-bar></ml-message-bar>\n  <div class="new-calendar-container">\n    <div class="kuiViewContent kuiViewContent--constrainedWidth">\n      <h3 class="euiTitle">{{pageTitle}}</h3>\n      <div class="kuiViewContentItem kuiVerticalRhythm">\n        <div class="kuiBar">\n          <div class="kuiBarSection">\n            <div class="kuiButtonGroup">\n              <button\n                class="kuiButton kuiButton--primary"\n                ng-disabled="saveEnabled() === false"\n                ng-click="save()" >\n                Save\n              </button>\n              <button\n                class="kuiButton kuiButton--basic"\n                ng-click="cancel()"\n                ng-disabled="saveLock === true"\n                data-test-subj="btnCancel">\n                Cancel\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div class="kuiViewContentItem kuiVerticalRhythm">\n        <div class="kuiFormSection" aria-hidden="false">\n          <label for="id" class="kuiFormLabel">\n            Calendar ID\n          </label>\n          <input\n            type="text"\n            ng-disabled="isNewCalendar===false"\n            id="id"\n            name="id"\n            ng-model="calendarId"\n            ng-trim="true"\n            class="kuiTextInput fullWidth"\n            autofocus />\n            <div ng-hide="validation.checks.calendarId.valid" class="validation-error">\n              <div class="euiSpacer euiSpacer--s"></div>\n              {{ ( validation.checks.calendarId.message || "Enter a name for the calendar" ) }}\n            </div>\n          </div>\n          <div class="kuiFormSection" aria-hidden="false">\n            <label for="description" class="kuiFormLabel">\n              Description\n            </label>\n            <input\n            type="text"\n            ng-disabled="isNewCalendar===false"\n            id="description"\n            name="description"\n            ng-model="description"\n            class="kuiTextInput fullWidth" />\n        </div>\n        <div class="kuiFormSection">\n          <label class="kuiFormLabel">\n            Jobs\n          </label>\n          <ml-item-select\n            item-ids=\'jobIds\'\n            all-items=\'allJobs\'\n            placeholder=\'"Jobs"\'\n            external-update-function=\'updateJobsList\'\n            >\n          </ml-item-select>\n        </div>\n        <div class="kuiFormSection">\n          <label class="kuiFormLabel">\n            Groups\n          </label>\n          <ml-item-select\n            item-ids=\'groupIds\'\n            all-items=\'allGroups\'\n            placeholder=\'"Groups"\'\n            allow-tagging=\'true\'\n            tagging-text=\'"(new group)"\'\n            external-update-function=\'updateGroupsList\'\n            >\n          </ml-item-select>\n        </div>\n\n      </div>\n      <div class="kuiViewContentItem kuiVerticalRhythm">\n        <label class="kuiFormLabel">\n          Events\n        </label>\n        <ml-events-list\n          events=\'events\'\n          show-controls=\'true\'\n          lock-controls=\'saveLock\'\n        />\n      </div>\n\n    </div>\n\n  </div>\n</ml-calendars-list>\n'},3994:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3995);__webpack_require__(4012);__webpack_require__(4021)},3995:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3996);__webpack_require__(4011)},3996:function(module,exports,__webpack_require__){"use strict";__webpack_require__(93);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _modules=__webpack_require__(2);var _check_license=__webpack_require__(68);var _check_privilege=__webpack_require__(35);var _check_ml_nodes=__webpack_require__(69);var _promise=__webpack_require__(89);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _edit_filter_list=__webpack_require__(3997);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml",["react"]);var template='\n  <ml-nav-menu name="settings"></ml-nav-menu>\n  <div class="ml-filter-lists">\n    <ml-edit-filter-list></ml-edit-filter-list>\n  </div>\n';_routes2.default.when("/settings/filter_lists/new_filter_list",{template:template,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,mlNodeCount:_check_ml_nodes.getMlNodeCount,initPromise:(0,_promise.initPromise)(false)}}).when("/settings/filter_lists/edit_filter_list/:filterId",{template:template,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,mlNodeCount:_check_ml_nodes.getMlNodeCount,initPromise:(0,_promise.initPromise)(false)}});_module.directive("mlEditFilterList",function($route){return{restrict:"E",replace:false,scope:{},link:function link(scope,element){var props={filterId:$route.current.params.filterId};_reactDom2.default.render(_react2.default.createElement(_edit_filter_list.EditFilterList,props),element[0])}}})},3997:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EditFilterList=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _notify=__webpack_require__(9);var _header=__webpack_require__(3998);var _toolbar=__webpack_require__(4003);var _items_grid=__webpack_require__(4006);var _utils=__webpack_require__(4010);var _ml_api_service=__webpack_require__(23);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}var DEFAULT_ITEMS_PER_PAGE=50;function getMatchingFilterItems(searchBarQuery,items){if(void 0===searchBarQuery)return[].concat(_toConsumableArray(items));var allItems=items.map(function(item){return{value:item}});var matchingObjects=_eui.EuiSearchBar.Query.execute(searchBarQuery,allItems,{defaultFields:["value"]});return matchingObjects.map(function(item){return item.value})}function getActivePage(activePageState,itemsPerPage,numMatchingItems){var activePage=activePageState;var activePageStartIndex=itemsPerPage*activePageState;activePageStartIndex>numMatchingItems&&(activePage=Math.max(Math.ceil(numMatchingItems/itemsPerPage)-1,0));return activePage}function returnToFiltersList(){window.location.href="#/settings/filter_lists"}var EditFilterList=exports.EditFilterList=function(_Component){_inherits(EditFilterList,_Component);function EditFilterList(props){_classCallCheck(this,EditFilterList);var _this=_possibleConstructorReturn(this,(EditFilterList.__proto__||Object.getPrototypeOf(EditFilterList)).call(this,props));_this.loadFilterList=function(filterId){_ml_api_service.ml.filters.filters({filterId:filterId}).then(function(filter){_this.setLoadedFilterState(filter)}).catch(function(resp){console.log("Error loading filter "+filterId+":",resp);_notify.toastNotifications.addDanger("An error occurred loading details of filter "+filterId)})};_this.setLoadedFilterState=function(loadedFilter){_this.setState(function(prevState){var itemsPerPage=prevState.itemsPerPage,searchQuery=prevState.searchQuery;var matchingItems=getMatchingFilterItems(searchQuery,loadedFilter.items);var activePage=getActivePage(prevState.activePage,itemsPerPage,matchingItems.length);return{description:loadedFilter.description,items:[].concat(_toConsumableArray(loadedFilter.items)),matchingItems:matchingItems,selectedItems:[],loadedFilter:loadedFilter,isNewFilterIdInvalid:false,activePage:activePage,searchQuery:searchQuery,saveInProgress:false}})};_this.updateNewFilterId=function(newFilterId){_this.setState({newFilterId:newFilterId,isNewFilterIdInvalid:!(0,_utils.isValidFilterListId)(newFilterId)})};_this.updateDescription=function(description){_this.setState({description:description})};_this.addItems=function(itemsToAdd){_this.setState(function(prevState){var itemsPerPage=prevState.itemsPerPage,searchQuery=prevState.searchQuery;var items=[].concat(_toConsumableArray(prevState.items));var alreadyInFilter=[];itemsToAdd.forEach(function(item){-1===items.indexOf(item)?items.push(item):alreadyInFilter.push(item)});items.sort(function(str1,str2){return str1.localeCompare(str2)});alreadyInFilter.length>0&&_notify.toastNotifications.addWarning("The following items were already in the filter list: "+alreadyInFilter);var matchingItems=getMatchingFilterItems(searchQuery,items);var activePage=getActivePage(prevState.activePage,itemsPerPage,matchingItems.length);return{items:items,matchingItems:matchingItems,activePage:activePage,searchQuery:searchQuery}})};_this.deleteSelectedItems=function(){_this.setState(function(prevState){var selectedItems=prevState.selectedItems,itemsPerPage=prevState.itemsPerPage,searchQuery=prevState.searchQuery;var items=[].concat(_toConsumableArray(prevState.items));selectedItems.forEach(function(item){var index=items.indexOf(item);-1!==index&&items.splice(index,1)});var matchingItems=getMatchingFilterItems(searchQuery,items);var activePage=getActivePage(prevState.activePage,itemsPerPage,matchingItems.length);return{items:items,matchingItems:matchingItems,selectedItems:[],activePage:activePage,searchQuery:searchQuery}})};_this.onSearchChange=function(_ref){var query=_ref.query;_this.setState(function(prevState){var items=prevState.items,itemsPerPage=prevState.itemsPerPage;var matchingItems=getMatchingFilterItems(query,items);var activePage=getActivePage(prevState.activePage,itemsPerPage,matchingItems.length);return{matchingItems:matchingItems,activePage:activePage,searchQuery:query}})};_this.setItemSelected=function(item,isSelected){_this.setState(function(prevState){var selectedItems=[].concat(_toConsumableArray(prevState.selectedItems));var index=selectedItems.indexOf(item);true===isSelected&&-1===index?selectedItems.push(item):false===isSelected&&-1!==index&&selectedItems.splice(index,1);return{selectedItems:selectedItems}})};_this.setActivePage=function(activePage){_this.setState({activePage:activePage})};_this.setItemsPerPage=function(itemsPerPage){_this.setState({itemsPerPage:itemsPerPage,activePage:0})};_this.save=function(){_this.setState({saveInProgress:true});var _this$state=_this.state,loadedFilter=_this$state.loadedFilter,newFilterId=_this$state.newFilterId,description=_this$state.description,items=_this$state.items;var filterId=void 0!==_this.props.filterId?_this.props.filterId:newFilterId;(0,_utils.saveFilterList)(filterId,description,items,loadedFilter).then(function(savedFilter){_this.setLoadedFilterState(savedFilter);returnToFiltersList()}).catch(function(resp){console.log("Error saving filter "+filterId+":",resp);_notify.toastNotifications.addDanger("An error occurred saving filter "+filterId);_this.setState({saveInProgress:false})})};_this.state={description:"",items:[],matchingItems:[],selectedItems:[],loadedFilter:{},newFilterId:"",isNewFilterIdInvalid:true,activePage:0,itemsPerPage:DEFAULT_ITEMS_PER_PAGE,saveInProgress:false};return _this}_createClass(EditFilterList,[{key:"componentDidMount",value:function componentDidMount(){var filterId=this.props.filterId;void 0!==filterId?this.loadFilterList(filterId):this.setState({newFilterId:""})}},{key:"render",value:function render(){var _state=this.state,loadedFilter=_state.loadedFilter,newFilterId=_state.newFilterId,isNewFilterIdInvalid=_state.isNewFilterIdInvalid,description=_state.description,items=_state.items,matchingItems=_state.matchingItems,selectedItems=_state.selectedItems,itemsPerPage=_state.itemsPerPage,activePage=_state.activePage,saveInProgress=_state.saveInProgress;var totalItemCount=void 0!==items?items.length:0;return _react2.default.createElement(_eui.EuiPage,{className:"ml-edit-filter-lists"},_react2.default.createElement(_eui.EuiPageContent,{className:"ml-edit-filter-lists-content",verticalPosition:"center",horizontalPosition:"center"},_react2.default.createElement(_header.EditFilterListHeader,{filterId:this.props.filterId,newFilterId:newFilterId,isNewFilterIdInvalid:isNewFilterIdInvalid,updateNewFilterId:this.updateNewFilterId,description:description,updateDescription:this.updateDescription,totalItemCount:totalItemCount,usedBy:loadedFilter.used_by}),_react2.default.createElement(_toolbar.EditFilterListToolbar,{onSearchChange:this.onSearchChange,addItems:this.addItems,deleteSelectedItems:this.deleteSelectedItems,selectedItemCount:selectedItems.length}),_react2.default.createElement(_eui.EuiSpacer,{size:"xl"}),_react2.default.createElement(_items_grid.ItemsGrid,{totalItemCount:totalItemCount,items:matchingItems,selectedItems:selectedItems,itemsPerPage:itemsPerPage,setItemsPerPage:this.setItemsPerPage,setItemSelected:this.setItemSelected,activePage:activePage,setActivePage:this.setActivePage}),_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"flexEnd"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{onClick:returnToFiltersList},"Cancel")),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{onClick:this.save,disabled:true===saveInProgress||true===isNewFilterIdInvalid,fill:true},"Save")))))}}]);return EditFilterList}(_react.Component);EditFilterList.propTypes={filterId:_propTypes2.default.string}},3998:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EditFilterListHeader=EditFilterListHeader;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _edit_description_popover=__webpack_require__(3999);var _filter_list_usage_popover=__webpack_require__(4001);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EditFilterListHeader(_ref){var filterId=_ref.filterId,totalItemCount=_ref.totalItemCount,description=_ref.description,updateDescription=_ref.updateDescription,newFilterId=_ref.newFilterId,isNewFilterIdInvalid=_ref.isNewFilterIdInvalid,updateNewFilterId=_ref.updateNewFilterId,usedBy=_ref.usedBy;var title=void 0!==filterId?"Filter list "+filterId:"Create new filter list";var idField=void 0;var descriptionField=void 0;var usedByElement=void 0;if(void 0===filterId){var msg="Use lowercase alphanumerics (a-z and 0-9), hyphens or underscores; must start and end with an alphanumeric character";var helpText=false===isNewFilterIdInvalid?msg:void 0;var error=true===isNewFilterIdInvalid?[msg]:void 0;idField=_react2.default.createElement(_eui.EuiFormRow,{label:"Filter list ID",helpText:helpText,error:error,isInvalid:isNewFilterIdInvalid},_react2.default.createElement(_eui.EuiFieldText,{name:"new_filter_id",value:newFilterId,isInvalid:isNewFilterIdInvalid,onChange:function onChange(e){return updateNewFilterId(e.target.value)}}))}descriptionField=void 0!==description&&description.length>0?_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("p",null,description)):_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement(_eui.EuiTextColor,{color:"subdued"},"Add a description"));void 0!==filterId&&(usedByElement=void 0!==usedBy&&usedBy.jobs.length>0?_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement("div",{className:"ml-filter-list-usage"},_react2.default.createElement(_eui.EuiText,null,"This filter list is used in"),_react2.default.createElement(_filter_list_usage_popover.FilterListUsagePopover,{entityType:"detector",entityValues:usedBy.detectors}),_react2.default.createElement(_eui.EuiText,null,"across"),_react2.default.createElement(_filter_list_usage_popover.FilterListUsagePopover,{entityType:"job",entityValues:usedBy.jobs})),_react2.default.createElement(_eui.EuiSpacer,{size:"s"})):_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("p",null,"This filter list is not used by any jobs.")),_react2.default.createElement(_eui.EuiSpacer,{size:"s"})));return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"baseline"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"baseline",gutterSize:"m",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiTitle,null,_react2.default.createElement("h1",null,title))),_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiTextColor,{color:"subdued"},_react2.default.createElement("p",null,totalItemCount," ",1!==totalItemCount?"items":"item"," in total")))))),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),idField,_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"baseline",gutterSize:"s",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},descriptionField),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_edit_description_popover.EditDescriptionPopover,{description:description,updateDescription:updateDescription}))),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),usedByElement)}EditFilterListHeader.propTypes={filterId:_propTypes2.default.string,newFilterId:_propTypes2.default.string,isNewFilterIdInvalid:_propTypes2.default.bool,updateNewFilterId:_propTypes2.default.func.isRequired,totalItemCount:_propTypes2.default.number.isRequired,description:_propTypes2.default.string,updateDescription:_propTypes2.default.func.isRequired,usedBy:_propTypes2.default.object}},3999:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _edit_description_popover=__webpack_require__(4e3);Object.defineProperty(exports,"EditDescriptionPopover",{enumerable:true,get:function get(){return _edit_description_popover.EditDescriptionPopover}})},40:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.replaceStringTokens=replaceStringTokens;exports.detectorToString=detectorToString;exports.sortByKey=sortByKey;exports.guessTimeFormat=guessTimeFormat;exports.toLocaleString=toLocaleString;exports.mlEscape=mlEscape;exports.escapeForElasticsearchQuery=escapeForElasticsearchQuery;exports.isWebUrl=isWebUrl;exports.calculateTextWidth=calculateTextWidth;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _d=__webpack_require__(19);var _d2=_interopRequireDefault(_d);var _relative_to_absolute=__webpack_require__(1256);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function replaceStringTokens(str,valuesByTokenName,encodeForURI){return String(str).replace(/\$([^?&$\'"]{1,40})\$/g,function(match,name){var tokenValue=_lodash2.default.get(valuesByTokenName,name,null);true===encodeForURI&&null!==tokenValue&&(tokenValue=encodeURIComponent(tokenValue));return null!==tokenValue?tokenValue:match})}function detectorToString(dtr){var BY_TOKEN=" by ";var OVER_TOKEN=" over ";var USE_NULL_OPTION=" use_null=";var PARTITION_FIELD_OPTION=" partition_field_name=";var EXCLUDE_FREQUENT_OPTION=" exclude_frequent=";var txt="";if(void 0!==dtr.function&&""!==dtr.function){txt+=dtr.function;void 0!==dtr.field_name&&""!==dtr.field_name&&(txt+="("+quoteField(dtr.field_name)+")")}else void 0!==dtr.field_name&&""!==dtr.field_name&&(txt+=quoteField(dtr.field_name));void 0!==dtr.by_field_name&&""!==dtr.by_field_name&&(txt+=BY_TOKEN+quoteField(dtr.by_field_name));void 0!==dtr.over_field_name&&""!==dtr.over_field_name&&(txt+=OVER_TOKEN+quoteField(dtr.over_field_name));void 0!==dtr.use_null&&(txt+=USE_NULL_OPTION+dtr.use_null);void 0!==dtr.partition_field_name&&""!==dtr.partition_field_name&&(txt+=PARTITION_FIELD_OPTION+quoteField(dtr.partition_field_name));void 0!==dtr.exclude_frequent&&""!==dtr.exclude_frequent&&(txt+=EXCLUDE_FREQUENT_OPTION+dtr.exclude_frequent);return txt}function quoteField(field){return field.match(/\W/g)?'"'+field+'"':field}function sortByKey(list,reverse,comparator){var keys=_lodash2.default.sortBy(_lodash2.default.keys(list),function(key){return comparator?comparator(list[key],key):key});reverse&&(keys=keys.reverse());return _lodash2.default.object(keys,_lodash2.default.map(keys,function(key){return list[key]}))}function guessTimeFormat(time){var format="";var matched=false;if(isNaN(time)){var match=void 0;if(!matched){var reg="";reg+="(";reg+="(";reg+="(\\d{4})";reg+="([-/.\\s])";reg+="(";reg+="([01]\\d)";reg+="|";reg+="(\\w{3})";reg+=")";reg+="([-/.\\s])";reg+="([0-3]\\d)";reg+=")";reg+="|";reg+="(";reg+="(";reg+="(\\d{1,2})";reg+="|";reg+="(\\w{3})";reg+=")";reg+="([-/.\\s])";reg+="(";reg+="(\\d{1,2})";reg+="|";reg+="(\\w{3})";reg+=")";reg+="([-/.\\s])";reg+="(\\d{4})";reg+=")";reg+=")";reg+="([T\\s])?";reg+="([0-2]\\d)";reg+="([:.])";reg+="([0-5]\\d)";reg+="(";reg+="([:.])";reg+="([0-5]\\d)";reg+=")?";reg+="(";reg+="([:.])";reg+="(\\d{3})";reg+=")?";reg+="(";reg+="([+-]\\d{2}[:.]\\d{2}[:.]\\d{2})";reg+="|";reg+="([+-]\\d{2}[:.]\\d{2})";reg+="|";reg+="([+-]\\d{6})";reg+="|";reg+="([+-]\\d{4})";reg+="|";reg+="(Z)";reg+="|";reg+="([+-]\\d{2})";reg+="|";reg+="(";reg+="(\\s)";reg+="(\\w{1,4})";reg+=")";reg+=")?";console.log("guessTimeFormat: time format regex: "+reg);match=time.match(new RegExp(reg));if(match){if(void 0!==match[2]){format+="yyyy";format+=match[4];void 0!==match[6]?format+="MM":void 0!==match[7]&&(format+="MMM");format+=match[8];format+="dd"}else if(void 0!==match[10]){if(void 0!==match[13]){format+="MMM";format+=match[14];format+="dd"}else if(void 0!==match[17]){format+="dd";format+=match[14];format+="MMM"}else if(void 0!==match[12]&&+match[12]>12){format+="dd";format+=match[14];format+="MM"}else{format+="MM";format+=match[14];format+="dd"}format+=match[18];format+="yyyy"}format+="T"===match[20]?"'"+match[20]+"'":match[20];format+="HH";format+=match[22];format+="mm";if(void 0!==match[24]){format+=match[25];format+="ss"}if(void 0!==match[27]){format+=match[28];format+="SSS"}if(void 0!==match[31])format+="XXXXX";else if(void 0!==match[32])format+="XXX";else if(void 0!==match[33])format+="XXXX";else if(void 0!==match[34])format+="Z";else if(void 0!==match[35]||void 0!==match[36])format+="X";else if(void 0!==match[37]){void 0!==match[38]&&(format+=match[38]);for(var i=0;i<match[39].length;i++)format+="z"}matched=true}}}else{format=time>1e10?"epoch_ms":"epoch";matched=true}matched?console.log("guessTimeFormat: guessed time format: ",format):console.log("guessTimeFormat: time format could not be guessed from: "+time);return format}function toLocaleString(x){var result=x;if(x&&"number"===typeof x){var parts=x.toString().split(".");parts[0]=parts[0].replace(/\B(?=(\d{3})+(?!\d))/g,",");result=parts.join(".")}return result}function mlEscape(str){var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return String(str).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}function escapeForElasticsearchQuery(str){return String(str).replace(/[-[\]{}()+!<>=?:\/\\^"~*&|\s]/g,"\\$&")}function isWebUrl(str){var absoluteUrl=(0,_relative_to_absolute.relativeToAbsolute)(str);return absoluteUrl.startsWith("http://")||absoluteUrl.startsWith("https://")}function calculateTextWidth(txt,isNumber,elementSelection){txt=isNumber?_d2.default.format(",")(txt):txt;var svg=elementSelection;var $el=void 0;if(void 0===elementSelection){var $body=_d2.default.select("body");$el=$body.append("div");svg=$el.append("svg")}var tempLabelText=svg.append("g").attr("class","temp-axis-label tick").selectAll("text.temp.axis").data("a").enter().append("text").text(txt);var width=tempLabelText[0][0].getBBox().width;_d2.default.select(".temp-axis-label").remove();void 0!==$el&&$el.remove();return Math.ceil(width)}},4000:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EditDescriptionPopover=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var EditDescriptionPopover=exports.EditDescriptionPopover=function(_Component){_inherits(EditDescriptionPopover,_Component);function EditDescriptionPopover(props){_classCallCheck(this,EditDescriptionPopover);var _this=_possibleConstructorReturn(this,(EditDescriptionPopover.__proto__||Object.getPrototypeOf(EditDescriptionPopover)).call(this,props));_this.onChange=function(e){_this.setState({value:e.target.value})};_this.onButtonClick=function(){false===_this.state.isPopoverOpen?_this.setState({isPopoverOpen:!_this.state.isPopoverOpen,value:_this.props.description}):_this.closePopover()};_this.closePopover=function(){if(true===_this.state.isPopoverOpen){_this.setState({isPopoverOpen:false});_this.props.updateDescription(_this.state.value)}};_this.state={isPopoverOpen:false,value:props.description};return _this}_createClass(EditDescriptionPopover,[{key:"render",value:function render(){var _state=this.state,isPopoverOpen=_state.isPopoverOpen,value=_state.value;var button=_react2.default.createElement(_eui.EuiButtonIcon,{size:"s",color:"primary",onClick:this.onButtonClick,iconType:"pencil","aria-label":"Edit description"});return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiPopover,{id:"filter_list_description_popover",ownFocus:true,button:button,isOpen:isPopoverOpen,closePopover:this.closePopover},_react2.default.createElement("div",{style:{width:"300px"}},_react2.default.createElement(_eui.EuiForm,null,_react2.default.createElement(_eui.EuiFormRow,{label:"Filter list description"},_react2.default.createElement(_eui.EuiFieldText,{name:"filter_list_description",value:value,onChange:this.onChange}))))))}}]);return EditDescriptionPopover}(_react.Component);EditDescriptionPopover.propTypes={description:_propTypes2.default.string,updateDescription:_propTypes2.default.func.isRequired}},4001:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _filter_list_usage_popover=__webpack_require__(4002);Object.defineProperty(exports,"FilterListUsagePopover",{enumerable:true,get:function get(){return _filter_list_usage_popover.FilterListUsagePopover}})},4002:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FilterListUsagePopover=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var FilterListUsagePopover=exports.FilterListUsagePopover=function(_Component){_inherits(FilterListUsagePopover,_Component);function FilterListUsagePopover(props){_classCallCheck(this,FilterListUsagePopover);var _this=_possibleConstructorReturn(this,(FilterListUsagePopover.__proto__||Object.getPrototypeOf(FilterListUsagePopover)).call(this,props));_this.onButtonClick=function(){_this.setState({isPopoverOpen:!_this.state.isPopoverOpen})};_this.closePopover=function(){_this.setState({isPopoverOpen:false})};_this.state={isPopoverOpen:false};return _this}_createClass(FilterListUsagePopover,[{key:"render",value:function render(){var _props=this.props,entityType=_props.entityType,entityValues=_props.entityValues;var linkText=entityValues.length+" "+entityType+(1!==entityValues.length?"s":"");var listItems=entityValues.map(function(value){return _react2.default.createElement("li",{key:value},value)});var button=_react2.default.createElement(_eui.EuiButtonEmpty,{size:"s",color:"primary",onClick:this.onButtonClick},linkText);return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiPopover,{id:entityType+"_filter_list_usage",panelClassName:"ml-filter-list-usage-popover",ownFocus:true,button:button,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover},_react2.default.createElement("ul",null,listItems)))}}]);return FilterListUsagePopover}(_react.Component);FilterListUsagePopover.propTypes={entityType:_propTypes2.default.oneOf(["job","detector"]),entityValues:_propTypes2.default.array.isRequired}},4003:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.EditFilterListToolbar=EditFilterListToolbar;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _add_item_popover=__webpack_require__(4004);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function EditFilterListToolbar(_ref){var onSearchChange=_ref.onSearchChange,addItems=_ref.addItems,deleteSelectedItems=_ref.deleteSelectedItems,selectedItemCount=_ref.selectedItemCount;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"flexEnd"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_add_item_popover.AddItemPopover,{addItems:addItems}))),_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"center",gutterSize:"xl"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{color:"danger",disabled:0===selectedItemCount,onClick:deleteSelectedItems},"Delete item")),_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiSearchBar,{onChange:onSearchChange}))))}EditFilterListToolbar.propTypes={onSearchChange:_propTypes2.default.func.isRequired,addItems:_propTypes2.default.func.isRequired,deleteSelectedItems:_propTypes2.default.func.isRequired,selectedItemCount:_propTypes2.default.number.isRequired}},4004:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _add_item_popover=__webpack_require__(4005);Object.defineProperty(exports,"AddItemPopover",{enumerable:true,get:function get(){return _add_item_popover.AddItemPopover}})},4005:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.AddItemPopover=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var AddItemPopover=exports.AddItemPopover=function(_Component){_inherits(AddItemPopover,_Component);function AddItemPopover(props){_classCallCheck(this,AddItemPopover);var _this=_possibleConstructorReturn(this,(AddItemPopover.__proto__||Object.getPrototypeOf(AddItemPopover)).call(this,props));_this.onItemsTextChange=function(e){_this.setState({itemsText:e.target.value})};_this.onButtonClick=function(){_this.setState({isPopoverOpen:!_this.state.isPopoverOpen})};_this.closePopover=function(){_this.setState({isPopoverOpen:false})};_this.onAddButtonClick=function(){var items=_this.state.itemsText.split("\n");var addItems=[];items.forEach(function(item){-1===addItems.indexOf(item)&&item.length>0&&addItems.push(item)});_this.props.addItems(addItems);_this.setState({isPopoverOpen:false,itemsText:""})};_this.state={isPopoverOpen:false,itemsText:""};return _this}_createClass(AddItemPopover,[{key:"render",value:function render(){var button=_react2.default.createElement(_eui.EuiButton,{size:"s",color:"primary",iconType:"arrowDown",iconSide:"right",onClick:this.onButtonClick},"Add item");return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiPopover,{id:"add_item_popover",panelClassName:"ml-add-filter-item-popover",ownFocus:true,button:button,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover},_react2.default.createElement(_eui.EuiForm,null,_react2.default.createElement(_eui.EuiFormRow,{label:"Items"},_react2.default.createElement(_eui.EuiTextArea,{value:this.state.itemsText,onChange:this.onItemsTextChange}))),_react2.default.createElement(_eui.EuiText,{size:"xs"},"Enter one item per line"),_react2.default.createElement(_eui.EuiSpacer,{size:"s"}),_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"flexEnd"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButton,{onClick:this.onAddButtonClick,disabled:0===this.state.itemsText.length},"Add")))))}}]);return AddItemPopover}(_react.Component);AddItemPopover.propTypes={addItems:_propTypes2.default.func.isRequired}},4006:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _items_grid=__webpack_require__(4007);Object.defineProperty(exports,"ItemsGrid",{enumerable:true,get:function get(){return _items_grid.ItemsGrid}})},4007:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ItemsGrid=ItemsGrid;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _items_grid_pagination=__webpack_require__(4008);__webpack_require__(4009);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function ItemsGrid(_ref){var numberColumns=_ref.numberColumns,totalItemCount=_ref.totalItemCount,items=_ref.items,selectedItems=_ref.selectedItems,itemsPerPage=_ref.itemsPerPage,itemsPerPageOptions=_ref.itemsPerPageOptions,setItemsPerPage=_ref.setItemsPerPage,setItemSelected=_ref.setItemSelected,activePage=_ref.activePage,setActivePage=_ref.setActivePage;if(void 0===items||0===items.length)return _react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceAround"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("h4",null,0===totalItemCount?"No items have been added":"No matching items"))));var startIndex=activePage*itemsPerPage;var pageItems=items.slice(startIndex,startIndex+itemsPerPage);var gridItems=pageItems.map(function(item,index){return _react2.default.createElement(_eui.EuiFlexItem,{key:"ml_grid_item_"+index},_react2.default.createElement(_eui.EuiCheckbox,{id:"ml_grid_item_"+index,label:item,checked:selectedItems.indexOf(item)>=0,onChange:function onChange(e){setItemSelected(item,e.target.checked)}}))});return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiFlexGrid,{columns:numberColumns,className:"eui-textBreakWord",gutterSize:"m"},gridItems),_react2.default.createElement(_items_grid_pagination.ItemsGridPagination,{itemCount:items.length,itemsPerPage:itemsPerPage,itemsPerPageOptions:itemsPerPageOptions,setItemsPerPage:setItemsPerPage,activePage:activePage,setActivePage:setActivePage}))}ItemsGrid.propTypes={numberColumns:_propTypes2.default.oneOf([2,3,4]),totalItemCount:_propTypes2.default.number.isRequired,items:_propTypes2.default.array,selectedItems:_propTypes2.default.array,itemsPerPage:_propTypes2.default.number,itemsPerPageOptions:_propTypes2.default.arrayOf(_propTypes2.default.number),setItemsPerPage:_propTypes2.default.func.isRequired,setItemSelected:_propTypes2.default.func.isRequired,activePage:_propTypes2.default.number.isRequired,setActivePage:_propTypes2.default.func.isRequired};ItemsGrid.defaultProps={numberColumns:4,itemsPerPage:50,itemsPerPageOptions:[50,100,500,1e3]}},4008:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ItemsGridPagination=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function getContextMenuItemIcon(menuItemSetting,itemsPerPage){return menuItemSetting===itemsPerPage?"check":"empty"}var ItemsGridPagination=exports.ItemsGridPagination=function(_Component){_inherits(ItemsGridPagination,_Component);function ItemsGridPagination(props){_classCallCheck(this,ItemsGridPagination);var _this=_possibleConstructorReturn(this,(ItemsGridPagination.__proto__||Object.getPrototypeOf(ItemsGridPagination)).call(this,props));_this.onButtonClick=function(){_this.setState({isPopoverOpen:!_this.state.isPopoverOpen})};_this.closePopover=function(){_this.setState({isPopoverOpen:false})};_this.onPageClick=function(pageNumber){_this.props.setActivePage(pageNumber)};_this.onChangeItemsPerPage=function(pageSize){_this.closePopover();_this.props.setItemsPerPage(pageSize)};_this.state={isPopoverOpen:false};return _this}_createClass(ItemsGridPagination,[{key:"render",value:function render(){var _this2=this;var _props=this.props,itemCount=_props.itemCount,itemsPerPage=_props.itemsPerPage,itemsPerPageOptions=_props.itemsPerPageOptions,activePage=_props.activePage;var button=_react2.default.createElement(_eui.EuiButtonEmpty,{size:"s",color:"text",iconType:"arrowDown",iconSide:"right",onClick:this.onButtonClick},"Items per page: ",itemsPerPage);var pageCount=Math.ceil(itemCount/itemsPerPage);var items=itemsPerPageOptions.map(function(pageSize){return _react2.default.createElement(_eui.EuiContextMenuItem,{key:pageSize+" items",icon:getContextMenuItemIcon(pageSize,itemsPerPage),onClick:function onClick(){_this2.onChangeItemsPerPage(pageSize)}},pageSize," items")});return _react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"center"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiPopover,{id:"customizablePagination",button:button,isOpen:this.state.isPopoverOpen,closePopover:this.closePopover,panelPaddingSize:"none"},_react2.default.createElement(_eui.EuiContextMenuPanel,{items:items,className:"ml-items-grid-page-size-menu"}))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiPagination,{pageCount:pageCount,activePage:activePage,onPageClick:this.onPageClick})))}}]);return ItemsGridPagination}(_react.Component);ItemsGridPagination.propTypes={itemCount:_propTypes2.default.number.isRequired,itemsPerPage:_propTypes2.default.number.isRequired,itemsPerPageOptions:_propTypes2.default.arrayOf(_propTypes2.default.number).isRequired,setItemsPerPage:_propTypes2.default.func.isRequired,activePage:_propTypes2.default.number.isRequired,setActivePage:_propTypes2.default.func.isRequired}},4009:function(module,exports){},4010:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.isValidFilterListId=isValidFilterListId;exports.saveFilterList=saveFilterList;exports.addFilterList=addFilterList;exports.updateFilterList=updateFilterList;var _notify=__webpack_require__(9);var _job_utils=__webpack_require__(41);var _ml_api_service=__webpack_require__(23);function isValidFilterListId(id){return void 0!==id&&id.length>0&&(0,_job_utils.isJobIdValid)(id)}function saveFilterList(filterId,description,items,loadedFilterList){return new Promise(function(resolve,reject){void 0===loadedFilterList||void 0===loadedFilterList.filter_id?addFilterList(filterId,description,items).then(function(newFilter){resolve(newFilter)}).catch(function(error){reject(error)}):updateFilterList(loadedFilterList,description,items).then(function(updatedFilter){resolve(updatedFilter)}).catch(function(error){reject(error)})})}function addFilterList(filterId,description,items){return new Promise(function(resolve,reject){_ml_api_service.ml.filters.filtersStats().then(function(filterLists){var savedFilterIds=filterLists.map(function(filterList){return filterList.filter_id});if(-1===savedFilterIds.indexOf(filterId))_ml_api_service.ml.filters.addFilter(filterId,description,items).then(function(newFilter){resolve(newFilter)}).catch(function(error){reject(error)});else{_notify.toastNotifications.addDanger("A filter with id "+filterId+" already exists");reject(new Error("A filter with id "+filterId+" already exists"))}}).catch(function(error){reject(error)})})}function updateFilterList(loadedFilterList,description,items){return new Promise(function(resolve,reject){var loadedItems=loadedFilterList.items;var addItems=items.filter(function(item){return false===loadedItems.includes(item)});var removeItems=loadedItems.filter(function(item){return false===items.includes(item)});_ml_api_service.ml.filters.updateFilter(loadedFilterList.filter_id,description,addItems,removeItems).then(function(updatedFilter){resolve(updatedFilter)}).catch(function(error){reject(error)})})}},4011:function(module,exports){},4012:function(module,exports,__webpack_require__){"use strict";__webpack_require__(4013);__webpack_require__(4020)},4013:function(module,exports,__webpack_require__){"use strict";__webpack_require__(93);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _reactDom2=_interopRequireDefault(_reactDom);var _modules=__webpack_require__(2);var _check_license=__webpack_require__(68);var _check_privilege=__webpack_require__(35);var _check_ml_nodes=__webpack_require__(69);var _promise=__webpack_require__(89);var _routes=__webpack_require__(12);var _routes2=_interopRequireDefault(_routes);var _filter_lists=__webpack_require__(4014);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml",["react"]);var template='\n  <ml-nav-menu name="settings"></ml-nav-menu>\n  <div class="ml-filter-lists">\n    <ml-filter-lists></ml-filter-lists>\n  </div>\n';_routes2.default.when("/settings/filter_lists",{template:template,resolve:{CheckLicense:_check_license.checkLicense,privileges:_check_privilege.checkGetJobsPrivilege,mlNodeCount:_check_ml_nodes.getMlNodeCount,initPromise:(0,_promise.initPromise)(false)}});_module.directive("mlFilterLists",function(){return{restrict:"E",replace:false,scope:{},link:function link(scope,element){_reactDom2.default.render(_react2.default.createElement(_filter_lists.FilterLists),element[0])}}})},4014:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FilterLists=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _notify=__webpack_require__(9);var _header=__webpack_require__(4015);var _table=__webpack_require__(4016);var _ml_api_service=__webpack_require__(23);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}exports.FilterLists=function(_Component){_inherits(FilterLists,_Component);function FilterLists(props){_classCallCheck(this,FilterLists);var _this=_possibleConstructorReturn(this,(FilterLists.__proto__||Object.getPrototypeOf(FilterLists)).call(this,props));_this.setSelectedFilterLists=function(selectedFilterLists){_this.setState({selectedFilterLists:selectedFilterLists})};_this.refreshFilterLists=function(){_ml_api_service.ml.filters.filtersStats().then(function(filterLists){_this.setState(function(prevState){var loadedFilterIds=filterLists.map(function(filterList){return filterList.filter_id});var selectedFilterLists=prevState.selectedFilterLists.filter(function(filterList){return-1!==loadedFilterIds.indexOf(filterList.filter_id)});return{filterLists:filterLists,selectedFilterLists:selectedFilterLists}})}).catch(function(resp){console.log("Error loading list of filters:",resp);_notify.toastNotifications.addDanger("An error occurred loading the filter lists")})};_this.state={filterLists:[],selectedFilterLists:[]};return _this}_createClass(FilterLists,[{key:"componentDidMount",value:function componentDidMount(){this.refreshFilterLists()}},{key:"render",value:function render(){var _state=this.state,filterLists=_state.filterLists,selectedFilterLists=_state.selectedFilterLists;return _react2.default.createElement(_eui.EuiPage,{className:"ml-list-filter-lists"},_react2.default.createElement(_eui.EuiPageContent,{className:"ml-list-filter-lists-content",verticalPosition:"center",horizontalPosition:"center"},_react2.default.createElement(_header.FilterListsHeader,{totalCount:filterLists.length,refreshFilterLists:this.refreshFilterLists}),_react2.default.createElement(_table.FilterListsTable,{filterLists:filterLists,selectedFilterLists:selectedFilterLists,setSelectedFilterLists:this.setSelectedFilterLists,refreshFilterLists:this.refreshFilterLists})))}}]);return FilterLists}(_react.Component)},4015:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FilterListsHeader=FilterListsHeader;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _metadata=__webpack_require__(91);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var docsUrl="https://www.elastic.co/guide/en/elastic-stack-overview/"+_metadata.metadata.branch+"/ml-rules.html";function FilterListsHeader(_ref){var totalCount=_ref.totalCount,refreshFilterLists=_ref.refreshFilterLists;return _react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceBetween",alignItems:"baseline"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"baseline",gutterSize:"m",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiTitle,null,_react2.default.createElement("h1",null,"Filter Lists"))),_react2.default.createElement(_eui.EuiFlexItem,null,_react2.default.createElement(_eui.EuiTextColor,{color:"subdued"},_react2.default.createElement("p",null,totalCount," in total"))))),_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"baseline",gutterSize:"m",responsive:false},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiButtonEmpty,{size:"s",iconType:"refresh",onClick:function onClick(){return refreshFilterLists()}},"Refresh"))))),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}),_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("p",null,_react2.default.createElement(_eui.EuiTextColor,{color:"subdued"},"Filter lists contain values that you can use to include or exclude events from the machine learning analysis. You can use the same filter list in multiple jobs.",_react2.default.createElement("br",null),_react2.default.createElement(_eui.EuiLink,{href:docsUrl,target:"_blank"},"Learn more")))),_react2.default.createElement(_eui.EuiSpacer,{size:"m"}))}FilterListsHeader.propTypes={totalCount:_propTypes2.default.number.isRequired,refreshFilterLists:_propTypes2.default.func.isRequired}},4016:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FilterListsTable=FilterListsTable;var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _check_privilege=__webpack_require__(35);var _delete_filter_list_modal=__webpack_require__(4017);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function UsedByIcon(_ref){var usedBy=_ref.usedBy;var icon=void 0;icon=void 0!==usedBy&&usedBy.jobs.length>0?_react2.default.createElement(_eui.EuiIcon,{type:"check","aria-label":"In use"}):_react2.default.createElement(_eui.EuiIcon,{type:"cross","aria-label":"Not in use"});return icon}UsedByIcon.propTypes={usedBy:_propTypes2.default.object};function NewFilterButton(){var canCreateFilter=(0,_check_privilege.checkPermission)("canCreateFilter");return _react2.default.createElement(_eui.EuiButton,{key:"new_filter_list",href:_chrome2.default.getBasePath()+"/app/ml#/settings/filter_lists/new_filter_list",isDisabled:false===canCreateFilter},"New")}function getColumns(){var columns=[{field:"filter_id",name:"ID",render:function render(id){return _react2.default.createElement(_eui.EuiLink,{href:_chrome2.default.getBasePath()+"/app/ml#/settings/filter_lists/edit_filter_list/"+id},id)},sortable:true},{field:"description",name:"Description",sortable:true},{field:"item_count",name:"Item count",sortable:true},{field:"used_by",name:"In use",render:function render(usedBy){return _react2.default.createElement(UsedByIcon,{usedBy:usedBy})},sortable:true}];return columns}function renderToolsRight(selectedFilterLists,refreshFilterLists){return[_react2.default.createElement(NewFilterButton,{key:"new_filter_list"}),_react2.default.createElement(_delete_filter_list_modal.DeleteFilterListModal,{selectedFilterLists:selectedFilterLists,refreshFilterLists:refreshFilterLists})]}function FilterListsTable(_ref2){var filterLists=_ref2.filterLists,selectedFilterLists=_ref2.selectedFilterLists,setSelectedFilterLists=_ref2.setSelectedFilterLists,refreshFilterLists=_ref2.refreshFilterLists;var sorting={sort:{field:"filter_id",direction:"asc"}};var search={toolsRight:renderToolsRight(selectedFilterLists,refreshFilterLists),box:{incremental:true},filters:[]};var tableSelection={selectable:function selectable(filterList){return void 0===filterList.used_by||0===filterList.used_by.jobs.length},selectableMessage:function selectableMessage(){return},onSelectionChange:function onSelectionChange(selection){return setSelectedFilterLists(selection)}};return _react2.default.createElement(_react2.default.Fragment,null,void 0===filterLists||0===filterLists.length?_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiFlexGroup,{alignItems:"flexEnd",justifyContent:"flexEnd"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(NewFilterButton,null))),_react2.default.createElement(_eui.EuiSpacer,{size:"l"}),_react2.default.createElement(_eui.EuiFlexGroup,{justifyContent:"spaceAround"},_react2.default.createElement(_eui.EuiFlexItem,{grow:false},_react2.default.createElement(_eui.EuiText,null,_react2.default.createElement("h4",null,"No filters have been created"))))):_react2.default.createElement(_react2.default.Fragment,null,_react2.default.createElement(_eui.EuiInMemoryTable,{className:"ml-filter-lists-table",items:filterLists,itemId:"filter_id",columns:getColumns(),search:search,pagination:true,sorting:sorting,selection:tableSelection,isSelectable:true})))}FilterListsTable.propTypes={filterLists:_propTypes2.default.array,selectedFilterLists:_propTypes2.default.array,setSelectedFilterLists:_propTypes2.default.func.isRequired,refreshFilterLists:_propTypes2.default.func.isRequired}},4017:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _delete_filter_list_modal=__webpack_require__(4018);Object.defineProperty(exports,"DeleteFilterListModal",{enumerable:true,get:function get(){return _delete_filter_list_modal.DeleteFilterListModal}})},4018:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DeleteFilterListModal=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _propTypes=__webpack_require__(6);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _eui=__webpack_require__(3);var _check_privilege=__webpack_require__(35);var _delete_filter_lists=__webpack_require__(4019);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}return step("next")})}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var DeleteFilterListModal=exports.DeleteFilterListModal=function(_Component){_inherits(DeleteFilterListModal,_Component);function DeleteFilterListModal(props){_classCallCheck(this,DeleteFilterListModal);var _this=_possibleConstructorReturn(this,(DeleteFilterListModal.__proto__||Object.getPrototypeOf(DeleteFilterListModal)).call(this,props));_this.closeModal=function(){_this.setState({isModalVisible:false})};_this.showModal=function(){_this.setState({isModalVisible:true})};_this.onConfirmDelete=function(){_this.doDelete()};_this.state={isModalVisible:false};_this.canDeleteFilter=(0,_check_privilege.checkPermission)("canDeleteFilter");return _this}_createClass(DeleteFilterListModal,[{key:"doDelete",value:function(){var _ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(){var _props,selectedFilterLists,refreshFilterLists;return regeneratorRuntime.wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_props=this.props,selectedFilterLists=_props.selectedFilterLists,refreshFilterLists=_props.refreshFilterLists;_context.next=3;return(0,_delete_filter_lists.deleteFilterLists)(selectedFilterLists);case 3:refreshFilterLists();this.closeModal();case 5:case"end":return _context.stop()}},_callee,this)}));function doDelete(){return _ref.apply(this,arguments)}return doDelete}()},{key:"render",value:function render(){var selectedFilterLists=this.props.selectedFilterLists;var modal=void 0;if(this.state.isModalVisible){var title="Delete "+(selectedFilterLists.length>1?selectedFilterLists.length+" filter lists":selectedFilterLists[0].filter_id);modal=_react2.default.createElement(_eui.EuiOverlayMask,null,_react2.default.createElement(_eui.EuiConfirmModal,{title:title,className:"eui-textBreakWord",onCancel:this.closeModal,onConfirm:this.onConfirmDelete,cancelButtonText:"Cancel",confirmButtonText:"Delete",buttonColor:"danger",defaultFocusedButton:_eui.EUI_MODAL_CONFIRM_BUTTON},_react2.default.createElement("p",null,"Are you sure you want to delete ",selectedFilterLists.length>1?"these filter lists":"this filter list","?")))}return _react2.default.createElement("div",null,_react2.default.createElement(_eui.EuiButton,{key:"delete_filter_list",iconType:"trash",color:"danger",onClick:this.showModal,isDisabled:0===selectedFilterLists.length||false===this.canDeleteFilter},"Delete"),modal)}}]);return DeleteFilterListModal}(_react.Component);DeleteFilterListModal.propTypes={selectedFilterLists:_propTypes2.default.array.isRequired}},4019:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.deleteFilterLists=void 0;exports.deleteFilterLists=(_ref=_asyncToGenerator(regeneratorRuntime.mark(function _callee(filterListsToDelete){var messageId,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,filterList,filterId,errorMessage;return regeneratorRuntime.wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!(void 0===filterListsToDelete||0===filterListsToDelete.length)){_context.next=2;break}return _context.abrupt("return");case 2:messageId=""+(filterListsToDelete.length>1?filterListsToDelete.length+" filter lists":filterListsToDelete[0].filter_id);_notify.toastNotifications.add("Deleting "+messageId);_iteratorNormalCompletion=true;_didIteratorError=false;_iteratorError=void 0;_context.prev=7;_iterator=filterListsToDelete[Symbol.iterator]();case 9:if(_iteratorNormalCompletion=(_step=_iterator.next()).done){_context.next=26;break}filterList=_step.value;filterId=filterList.filter_id;_context.prev=12;_context.next=15;return _ml_api_service.ml.filters.deleteFilter(filterId);case 15:_context.next=23;break;case 17:_context.prev=17;_context.t0=_context["catch"](12);console.log("Error deleting filter list:",_context.t0);errorMessage="An error occurred deleting filter list "+filterList.filter_id;_context.t0.message&&(errorMessage+=" : "+_context.t0.message);_notify.toastNotifications.addDanger(errorMessage);case 23:_iteratorNormalCompletion=true;_context.next=9;break;case 26:_context.next=32;break;case 28:_context.prev=28;_context.t1=_context["catch"](7);_didIteratorError=true;_iteratorError=_context.t1;case 32:_context.prev=32;_context.prev=33;!_iteratorNormalCompletion&&_iterator.return&&_iterator.return();case 35:_context.prev=35;if(!_didIteratorError){_context.next=38;break}throw _iteratorError;case 38:return _context.finish(35);case 39:return _context.finish(32);case 40:_notify.toastNotifications.addSuccess(messageId+" deleted");case 41:case"end":return _context.stop()}},_callee,this,[[7,28,32,40],[12,17],[33,,35,39]])})),function deleteFilterLists(_x){return _ref.apply(this,arguments)});var _ref;var _notify=__webpack_require__(9);var _ml_api_service=__webpack_require__(23);function _asyncToGenerator(fn){return function(){var gen=fn.apply(this,arguments);return new Promise(function(resolve,reject){function step(key,arg){try{var info=gen[key](arg);var value=info.value}catch(error){reject(error);return}if(!info.done)return Promise.resolve(value).then(function(value){step("next",value)},function(err){step("throw",err)});resolve(value)}return step("next")})}}},4020:function(module,exports){},4021:function(module,exports){},41:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ML_DATA_PREVIEW_COUNT=exports.ML_MEDIAN_PERCENTS=void 0;var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};exports.calculateDatafeedFrequencyDefaultSeconds=calculateDatafeedFrequencyDefaultSeconds;exports.isTimeSeriesViewJob=isTimeSeriesViewJob;exports.isTimeSeriesViewDetector=isTimeSeriesViewDetector;exports.isTimeSeriesViewFunction=isTimeSeriesViewFunction;exports.getPartitioningFieldNames=getPartitioningFieldNames;exports.isModelPlotEnabled=isModelPlotEnabled;exports.isJobVersionGte=isJobVersionGte;exports.mlFunctionToESAggregation=mlFunctionToESAggregation;exports.isJobIdValid=isJobIdValid;exports.prefixDatafeedId=prefixDatafeedId;exports.getSafeAggregationName=getSafeAggregationName;exports.uniqWithIsEqual=uniqWithIsEqual;exports.basicJobValidation=basicJobValidation;exports.validateModelMemoryLimit=validateModelMemoryLimit;exports.validateGroupNames=validateGroupNames;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _semver=__webpack_require__(863);var _semver2=_interopRequireDefault(_semver);var _numeral=__webpack_require__(88);var _numeral2=_interopRequireDefault(_numeral);var _parse_interval=__webpack_require__(127);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function calculateDatafeedFrequencyDefaultSeconds(bucketSpanSeconds){var freq=3600;bucketSpanSeconds<=120?freq=60:bucketSpanSeconds<=1200?freq=Math.floor(bucketSpanSeconds/2):bucketSpanSeconds<=43200&&(freq=600);return freq}function isTimeSeriesViewJob(job){var isViewable=false;var dtrs=job.analysis_config.detectors;for(var i=0;i<dtrs.length;i++){isViewable=isTimeSeriesViewDetector(job,i);if(true===isViewable)break}return isViewable}function isTimeSeriesViewDetector(job,dtrIndex){var isDetectorViewable=false;var dtrs=job.analysis_config.detectors;if(dtrIndex>=0&&dtrIndex<dtrs.length){var dtr=dtrs[dtrIndex];isDetectorViewable=true===isTimeSeriesViewFunction(dtr.function)&&"mlcategory"!==dtr.by_field_name&&"mlcategory"!==dtr.partition_field_name&&"mlcategory"!==dtr.over_field_name;var usesScriptFields=_lodash2.default.has(job,"datafeed_config.script_fields");if(true===isDetectorViewable&&true===usesScriptFields){var scriptFields=usesScriptFields?_lodash2.default.keys(job.datafeed_config.script_fields):[];isDetectorViewable=-1===scriptFields.indexOf(dtr.field_name)&&-1===scriptFields.indexOf(dtr.partition_field_name)&&-1===scriptFields.indexOf(dtr.by_field_name)&&-1===scriptFields.indexOf(dtr.over_field_name)}}return isDetectorViewable}function isTimeSeriesViewFunction(functionName){return null!==mlFunctionToESAggregation(functionName)}function getPartitioningFieldNames(job,detectorIndex){var fieldNames=[];var detector=job.analysis_config.detectors[detectorIndex];_lodash2.default.has(detector,"partition_field_name")&&fieldNames.push(detector.partition_field_name);_lodash2.default.has(detector,"by_field_name")&&fieldNames.push(detector.by_field_name);_lodash2.default.has(detector,"over_field_name")&&fieldNames.push(detector.over_field_name);return fieldNames}function isModelPlotEnabled(job,detectorIndex,entityFields){var isEnabled=_lodash2.default.get(job,["model_plot_config","enabled"],false);if(true===isEnabled){var termsStr=_lodash2.default.get(job,["model_plot_config","terms"],"");if(""!==termsStr){var detector=job.analysis_config.detectors[detectorIndex];var detectorHasPartitionField=_lodash2.default.has(detector,"partition_field_name");var detectorHasByField=_lodash2.default.has(detector,"by_field_name");var terms=termsStr.split(",");if(true===detectorHasPartitionField){var partitionEntity=_lodash2.default.find(entityFields,{fieldName:detector.partition_field_name});isEnabled=void 0!==partitionEntity&&-1!==terms.indexOf(partitionEntity.fieldValue)}if(true===isEnabled&&true===detectorHasByField){var byEntity=_lodash2.default.find(entityFields,{fieldName:detector.by_field_name});isEnabled=void 0!==byEntity&&-1!==terms.indexOf(byEntity.fieldValue)}}}return isEnabled}function isJobVersionGte(job,version){var jobVersion=_lodash2.default.get(job,"job_version","0.0.0");return _semver2.default.gte(jobVersion,version)}function mlFunctionToESAggregation(functionName){if("mean"===functionName||"high_mean"===functionName||"low_mean"===functionName||"metric"===functionName)return"avg";if("sum"===functionName||"high_sum"===functionName||"low_sum"===functionName||"non_null_sum"===functionName||"low_non_null_sum"===functionName||"high_non_null_sum"===functionName)return"sum";if("count"===functionName||"high_count"===functionName||"low_count"===functionName||"non_zero_count"===functionName||"low_non_zero_count"===functionName||"high_non_zero_count"===functionName)return"count";if("distinct_count"===functionName||"low_distinct_count"===functionName||"high_distinct_count"===functionName)return"cardinality";if("median"===functionName||"high_median"===functionName||"low_median"===functionName)return"percentiles";if("min"===functionName||"max"===functionName)return functionName;return null}function isJobIdValid(jobId){return!(!jobId.match(/^[a-z0-9\-\_]{1,64}$/g)||jobId.match(/^([_-].*)?(.*[_-])?$/g))}exports.ML_MEDIAN_PERCENTS="50.0";exports.ML_DATA_PREVIEW_COUNT=10;function prefixDatafeedId(datafeedId,prefix){return datafeedId.match(/^datafeed-/)?datafeedId.replace(/^datafeed-/,"datafeed-"+prefix):""+prefix+datafeedId}function getSafeAggregationName(fieldName,index){return fieldName.match(/^[a-zA-Z0-9-_.]+$/)?fieldName:"field_"+index}function uniqWithIsEqual(arr){return arr.reduce(function(dedupedArray,value){0===dedupedArray.filter(function(compareValue){return _lodash2.default.isEqual(compareValue,value)}).length&&dedupedArray.push(value);return dedupedArray},[])}function basicJobValidation(job,fields,limits){var messages=[];var valid=true;if(job){if(_lodash2.default.isEmpty(job.job_id)){messages.push({id:"job_id_empty"});valid=false}else if(false===isJobIdValid(job.job_id)){messages.push({id:"job_id_invalid"});valid=false}else messages.push({id:"job_id_valid"});var _validateGroupNames=validateGroupNames(job),groupsMessages=_validateGroupNames.messages,groupsValid=_validateGroupNames.valid;messages.push.apply(messages,_toConsumableArray(groupsMessages));valid=valid&&groupsValid;if(job.analysis_config.categorization_filters){var v=true;_lodash2.default.each(job.analysis_config.categorization_filters,function(d){try{new RegExp(d)}catch(e){v=false}void 0!==job.analysis_config.categorization_field_name&&""!==job.analysis_config.categorization_field_name||(v=false);""===d&&(v=false)});if(v)messages.push({id:"categorization_filters_valid"});else{messages.push({id:"categorization_filters_invalid"});valid=false}}if(0===job.analysis_config.detectors.length){messages.push({id:"detectors_empty"});valid=false}else{var _v=true;_lodash2.default.each(job.analysis_config.detectors,function(d){_lodash2.default.isEmpty(d.function)&&(_v=false)});if(_v)messages.push({id:"detectors_function_not_empty"});else{messages.push({id:"detectors_function_empty"});valid=false}}if(job.analysis_config.detectors.length>=2){var compareSubSet=job.analysis_config.detectors.map(function(d){return _lodash2.default.pick(d,["function","field_name","by_field_name","over_field_name","partition_field_name"])});var dedupedSubSet=uniqWithIsEqual(compareSubSet);if(compareSubSet.length!==dedupedSubSet.length){messages.push({id:"detectors_duplicates"});valid=false}}if(""===job.analysis_config.bucket_span||void 0===job.analysis_config.bucket_span){messages.push({id:"bucket_span_empty"});valid=false}else{var bucketSpan=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span,false);if(null===bucketSpan||0===bucketSpan.asMilliseconds()){messages.push({id:"bucket_span_invalid"});valid=false}else messages.push({id:"bucket_span_valid",bucketSpan:job.analysis_config.bucket_span})}if("undefined"!==typeof fields){var loadedFields=Object.keys(fields);if(0===loadedFields.length){messages.push({id:"index_fields_invalid"});valid=false}else messages.push({id:"index_fields_valid"})}var _validateModelMemoryL=validateModelMemoryLimit(job,limits),mmlMessages=_validateModelMemoryL.messages,mmlValid=_validateModelMemoryL.valid;messages.push.apply(messages,_toConsumableArray(mmlMessages));valid=valid&&mmlValid}else valid=false;return{messages:messages,valid:valid,contains:function contains(id){return messages.some(function(m){return id===m.id})},find:function find(id){return messages.find(function(m){return id===m.id})}}}function validateModelMemoryLimit(job,limits){var messages=[];var valid=true;if("undefined"!==typeof job.analysis_limits&&"undefined"!==typeof job.analysis_limits.model_memory_limit&&"object"===("undefined"===typeof limits?"undefined":_typeof(limits))&&"undefined"!==typeof limits.max_model_memory_limit){var max=limits.max_model_memory_limit.toUpperCase();var mml=job.analysis_limits.model_memory_limit.toUpperCase();var mmlBytes=(0,_numeral2.default)(mml).value();var maxBytes=(0,_numeral2.default)(max).value();if(mmlBytes>maxBytes){messages.push({id:"model_memory_limit_invalid"});valid=false}else messages.push({id:"model_memory_limit_valid"})}return{valid:valid,messages:messages,contains:function contains(id){return messages.some(function(m){return id===m.id})},find:function find(id){return messages.find(function(m){return id===m.id})}}}function validateGroupNames(job){var messages=[];var valid=true;if(void 0!==job.groups){var groupIdValid=true;job.groups.forEach(function(group){if(false===isJobIdValid(group)){groupIdValid=false;valid=false}});job.groups.length>0&&groupIdValid?messages.push({id:"job_group_id_valid"}):job.groups.length>0&&!groupIdValid&&messages.push({id:"job_group_id_invalid"})}return{valid:valid,messages:messages,contains:function contains(id){return messages.some(function(m){return id===m.id})},find:function find(id){return messages.find(function(m){return id===m.id})}}}},423:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ACTION={SKIP_MODEL_UPDATE:"skip_model_update",SKIP_RESULT:"skip_result"};exports.FILTER_TYPE={EXCLUDE:"exclude",INCLUDE:"include"};exports.APPLIES_TO={ACTUAL:"actual",DIFF_FROM_TYPICAL:"diff_from_typical",TYPICAL:"typical"};exports.OPERATOR={LESS_THAN:"lt",LESS_THAN_OR_EQUAL:"lte",GREATER_THAN:"gt",GREATER_THAN_OR_EQUAL:"gte"};exports.CONDITIONS_NOT_SUPPORTED_FUNCTIONS=["freq_rare","lat_long","metric","rare"]},424:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3707);__webpack_require__(3709)},426:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlResultsService=void 0;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _job_utils=__webpack_require__(41);var _string_utils=__webpack_require__(40);var _index_patterns=__webpack_require__(368);var _ml_api_service=__webpack_require__(23);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true}):obj[key]=value;return obj}function getScoresByBucket(jobIds,earliestMs,latestMs,interval,maxResults){return new Promise(function(resolve,reject){var obj={success:true,results:{}};var boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}}];if(jobIds&&jobIds.length>0&&!(1===jobIds.length&&"*"===jobIds[0])){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){i>0&&(jobIdFilterStr+=" OR ");jobIdFilterStr+="job_id:";jobIdFilterStr+=jobId});boolCriteria.push({query_string:{analyze_wildcard:false,query:jobIdFilterStr}})}_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:bucket",analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},aggs:{jobId:{terms:{field:"job_id",size:void 0!==maxResults?maxResults:5,order:{anomalyScore:"desc"}},aggs:{anomalyScore:{max:{field:"anomaly_score"}},byTime:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1,extended_bounds:{min:earliestMs,max:latestMs}},aggs:{anomalyScore:{max:{field:"anomaly_score"}}}}}}}}}).then(function(resp){var dataByJobId=_lodash2.default.get(resp,["aggregations","jobId","buckets"],[]);_lodash2.default.each(dataByJobId,function(dataForJob){var jobId=dataForJob.key;var resultsForTime={};var dataByTime=_lodash2.default.get(dataForJob,["byTime","buckets"],[]);_lodash2.default.each(dataByTime,function(dataForTime){var value=_lodash2.default.get(dataForTime,["anomalyScore","value"]);if(void 0!==value){var time=dataForTime.key;resultsForTime[time]=_lodash2.default.get(dataForTime,["anomalyScore","value"])}});obj.results[jobId]=resultsForTime});resolve(obj)}).catch(function(resp){reject(resp)})})}function getScheduledEventsByBucket(jobIds,earliestMs,latestMs,interval,maxJobs,maxEvents){return new Promise(function(resolve,reject){var obj={success:true,events:{}};var boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{exists:{field:"scheduled_events"}}];if(jobIds&&jobIds.length>0&&!(1===jobIds.length&&"*"===jobIds[0])){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){jobIdFilterStr+=(i>0?" OR ":"")+"job_id:"+jobId});boolCriteria.push({query_string:{analyze_wildcard:false,query:jobIdFilterStr}})}_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:bucket",analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},aggs:{jobs:{terms:{field:"job_id",min_doc_count:1,size:maxJobs},aggs:{times:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1},aggs:{events:{terms:{field:"scheduled_events",size:maxEvents}}}}}}}}}).then(function(resp){var dataByJobId=_lodash2.default.get(resp,["aggregations","jobs","buckets"],[]);_lodash2.default.each(dataByJobId,function(dataForJob){var jobId=dataForJob.key;var resultsForTime={};var dataByTime=_lodash2.default.get(dataForJob,["times","buckets"],[]);_lodash2.default.each(dataByTime,function(dataForTime){var time=dataForTime.key;var events=_lodash2.default.get(dataForTime,["events","buckets"]);resultsForTime[time]=_lodash2.default.map(events,"key")});obj.events[jobId]=resultsForTime});resolve(obj)}).catch(function(resp){reject(resp)})})}function getTopInfluencers(jobIds,earliestMs,latestMs){var maxFieldValues=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;var influencers=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return new Promise(function(resolve,reject){var obj={success:true,influencers:{}};var boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{range:{influencer_score:{gt:0}}}];if(jobIds&&jobIds.length>0&&!(1===jobIds.length&&"*"===jobIds[0])){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){i>0&&(jobIdFilterStr+=" OR ");jobIdFilterStr+="job_id:";jobIdFilterStr+=jobId});boolCriteria.push({query_string:{analyze_wildcard:false,query:jobIdFilterStr}})}influencers.length>0&&boolCriteria.push({bool:{should:influencers.map(function(influencer){return{bool:{must:[{term:{influencer_field_name:influencer.fieldName}},{term:{influencer_field_value:influencer.fieldValue}}]}}}),minimum_should_match:1}});_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:influencer",analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},aggs:{influencerFieldNames:{terms:{field:"influencer_field_name",size:5,order:{maxAnomalyScore:"desc"}},aggs:{maxAnomalyScore:{max:{field:"influencer_score"}},influencerFieldValues:{terms:{field:"influencer_field_value",size:maxFieldValues,order:{maxAnomalyScore:"desc"}},aggs:{maxAnomalyScore:{max:{field:"influencer_score"}},sumAnomalyScore:{sum:{field:"influencer_score"}}}}}}}}}).then(function(resp){var fieldNameBuckets=_lodash2.default.get(resp,["aggregations","influencerFieldNames","buckets"],[]);_lodash2.default.each(fieldNameBuckets,function(nameBucket){var fieldName=nameBucket.key;var fieldValues=[];var fieldValueBuckets=_lodash2.default.get(nameBucket,["influencerFieldValues","buckets"],[]);_lodash2.default.each(fieldValueBuckets,function(valueBucket){var fieldValueResult={influencerFieldValue:valueBucket.key,maxAnomalyScore:valueBucket.maxAnomalyScore.value,sumAnomalyScore:valueBucket.sumAnomalyScore.value};fieldValues.push(fieldValueResult)});obj.influencers[fieldName]=fieldValues});resolve(obj)}).catch(function(resp){reject(resp)})})}function getTopInfluencerValues(jobIds,influencerFieldName,earliestMs,latestMs,maxResults){return new Promise(function(resolve,reject){var obj={success:true,results:[]};var boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}}];if(jobIds&&jobIds.length>0&&!(1===jobIds.length&&"*"===jobIds[0])){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){i>0&&(jobIdFilterStr+=" OR ");jobIdFilterStr+="job_id:";jobIdFilterStr+=jobId});boolCriteria.push({query_string:{analyze_wildcard:false,query:jobIdFilterStr}})}_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:influencer AND influencer_field_name: "+(0,_string_utils.escapeForElasticsearchQuery)(influencerFieldName),analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},aggs:{influencerFieldValues:{terms:{field:"influencer_field_value",size:void 0!==maxResults?maxResults:2,order:{maxAnomalyScore:"desc"}},aggs:{maxAnomalyScore:{max:{field:"influencer_score"}},sumAnomalyScore:{sum:{field:"influencer_score"}}}}}}}).then(function(resp){var buckets=_lodash2.default.get(resp,["aggregations","influencerFieldValues","buckets"],[]);_lodash2.default.each(buckets,function(bucket){var result={influencerFieldValue:bucket.key,maxAnomalyScore:bucket.maxAnomalyScore.value,sumAnomalyScore:bucket.sumAnomalyScore.value};obj.results.push(result)});resolve(obj)}).catch(function(resp){reject(resp)})})}function getOverallBucketScores(jobIds,topN,earliestMs,latestMs,interval){return new Promise(function(resolve,reject){var obj={success:true,results:{}};_ml_api_service.ml.overallBuckets({jobId:jobIds,topN:topN,bucketSpan:interval,start:earliestMs,end:latestMs}).then(function(resp){var dataByTime=_lodash2.default.get(resp,["overall_buckets"],[]);_lodash2.default.each(dataByTime,function(dataForTime){var value=_lodash2.default.get(dataForTime,["overall_score"]);void 0!==value&&(obj.results[dataForTime.timestamp]=value)});resolve(obj)}).catch(function(resp){reject(resp)})})}function getInfluencerValueMaxScoreByTime(jobIds,influencerFieldName,influencerFieldValues,earliestMs,latestMs,interval,maxResults){return new Promise(function(resolve,reject){var obj={success:true,results:{}};var boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{range:{influencer_score:{gt:0}}}];if(jobIds&&jobIds.length>0&&!(1===jobIds.length&&"*"===jobIds[0])){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){i>0&&(jobIdFilterStr+=" OR ");jobIdFilterStr+="job_id:"+jobId});boolCriteria.push({query_string:{analyze_wildcard:false,query:jobIdFilterStr}})}if(influencerFieldValues&&influencerFieldValues.length>0){var influencerFilterStr="";_lodash2.default.each(influencerFieldValues,function(value,i){i>0&&(influencerFilterStr+=" OR ");influencerFilterStr+="influencer_field_value:"+(0,_string_utils.escapeForElasticsearchQuery)(value)});boolCriteria.push({query_string:{analyze_wildcard:false,query:influencerFilterStr}})}_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:influencer AND influencer_field_name: "+(0,_string_utils.escapeForElasticsearchQuery)(influencerFieldName),analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},aggs:{influencerFieldValues:{terms:{field:"influencer_field_value",size:void 0!==maxResults?maxResults:10,order:{maxAnomalyScore:"desc"}},aggs:{maxAnomalyScore:{max:{field:"influencer_score"}},byTime:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1},aggs:{maxAnomalyScore:{max:{field:"influencer_score"}}}}}}}}}).then(function(resp){var fieldValueBuckets=_lodash2.default.get(resp,["aggregations","influencerFieldValues","buckets"],[]);_lodash2.default.each(fieldValueBuckets,function(valueBucket){var fieldValue=valueBucket.key;var fieldValues={};var timeBuckets=_lodash2.default.get(valueBucket,["byTime","buckets"],[]);_lodash2.default.each(timeBuckets,function(timeBucket){var time=timeBucket.key;var score=timeBucket.maxAnomalyScore.value;fieldValues[time]=score});obj.results[fieldValue]=fieldValues});resolve(obj)}).catch(function(resp){reject(resp)})})}function getRecordInfluencers(jobIds,threshold,earliestMs,latestMs,maxResults){return new Promise(function(resolve,reject){var obj={success:true,records:[]};var boolCriteria=[{nested:{path:"influencers",query:{bool:{must:[{exists:{field:"influencers"}}]}}}},{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{range:{record_score:{gte:threshold}}}];if(jobIds&&jobIds.length>0&&!(1===jobIds.length&&"*"===jobIds[0])){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){i>0&&(jobIdFilterStr+=" OR ");jobIdFilterStr+="job_id:";jobIdFilterStr+=jobId});boolCriteria.push({query_string:{analyze_wildcard:false,query:jobIdFilterStr}})}_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:void 0!==maxResults?maxResults:100,body:{_source:["job_id","detector_index","influencers","record_score"],query:{bool:{filter:[{query_string:{query:"result_type:record",analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},sort:[{record_score:{order:"desc"}}]}}).then(function(resp){0!==resp.hits.total&&_lodash2.default.each(resp.hits.hits,function(hit){obj.records.push(hit._source)});resolve(obj)}).catch(function(resp){reject(resp)})})}function getRecordsForInfluencer(jobIds,influencers,threshold,earliestMs,latestMs,maxResults){return new Promise(function(resolve,reject){var obj={success:true,records:[]};var boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{range:{record_score:{gte:threshold}}}];if(jobIds&&jobIds.length>0&&!(1===jobIds.length&&"*"===jobIds[0])){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){i>0&&(jobIdFilterStr+=" OR ");jobIdFilterStr+="job_id:";jobIdFilterStr+=jobId});boolCriteria.push({query_string:{analyze_wildcard:false,query:jobIdFilterStr}})}influencers.length>0&&boolCriteria.push({bool:{should:influencers.map(function(influencer){return{nested:{path:"influencers",query:{bool:{must:[{match:{"influencers.influencer_field_name":influencer.fieldName}},{match:{"influencers.influencer_field_values":influencer.fieldValue}}]}}}}}),minimum_should_match:1}});_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:void 0!==maxResults?maxResults:100,body:{query:{bool:{filter:[{query_string:{query:"result_type:record",analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},sort:[{record_score:{order:"desc"}}]}}).then(function(resp){0!==resp.hits.total&&_lodash2.default.each(resp.hits.hits,function(hit){obj.records.push(hit._source)});resolve(obj)}).catch(function(resp){reject(resp)})})}function getRecordsForDetector(jobId,detectorIndex,checkForInfluencers,influencerFieldName,influencerFieldValue,threshold,earliestMs,latestMs,maxResults){return new Promise(function(resolve,reject){var obj={success:true,records:[]};var boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{term:{job_id:jobId}},{term:{detector_index:detectorIndex}},{range:{record_score:{gte:threshold}}}];influencerFieldName&&influencerFieldValue?boolCriteria.push({nested:{path:"influencers",query:{bool:{must:[{match:{"influencers.influencer_field_name":influencerFieldName}},{match:{"influencers.influencer_field_values":influencerFieldValue}}]}}}}):true===checkForInfluencers&&boolCriteria.push({nested:{path:"influencers",query:{bool:{must:[{exists:{field:"influencers"}}]}}}});_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:void 0!==maxResults?maxResults:100,body:{query:{bool:{filter:[{query_string:{query:"result_type:record",analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},sort:[{record_score:{order:"desc"}}]}}).then(function(resp){0!==resp.hits.total&&_lodash2.default.each(resp.hits.hits,function(hit){obj.records.push(hit._source)});resolve(obj)}).catch(function(resp){reject(resp)})})}function getRecords(jobIds,threshold,earliestMs,latestMs,maxResults){return this.getRecordsForInfluencer(jobIds,[],threshold,earliestMs,latestMs,maxResults)}function getRecordsForCriteria(jobIds,criteriaFields,threshold,earliestMs,latestMs,maxResults){return new Promise(function(resolve,reject){var obj={success:true,records:[]};var boolCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{range:{record_score:{gte:threshold}}}];if(jobIds&&jobIds.length>0&&!(1===jobIds.length&&"*"===jobIds[0])){var jobIdFilterStr="";_lodash2.default.each(jobIds,function(jobId,i){i>0&&(jobIdFilterStr+=" OR ");jobIdFilterStr+="job_id:";jobIdFilterStr+=jobId});boolCriteria.push({query_string:{analyze_wildcard:false,query:jobIdFilterStr}})}_lodash2.default.each(criteriaFields,function(criteria){boolCriteria.push({term:_defineProperty({},criteria.fieldName,criteria.fieldValue)})});_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:void 0!==maxResults?maxResults:100,body:{query:{bool:{filter:[{query_string:{query:"result_type:record",analyze_wildcard:false}},{bool:{must:boolCriteria}}]}},sort:[{record_score:{order:"desc"}}]}}).then(function(resp){0!==resp.hits.total&&_lodash2.default.each(resp.hits.hits,function(hit){obj.records.push(hit._source)});resolve(obj)}).catch(function(resp){reject(resp)})})}function getMetricData(index,types,entityFields,query,metricFunction,metricFieldName,timeFieldName,earliestMs,latestMs,interval){return new Promise(function(resolve,reject){var obj={success:true,results:{}};var mustCriteria=[];var shouldCriteria=[];types&&types.length&&mustCriteria.push({terms:{_type:types}});mustCriteria.push({range:_defineProperty({},timeFieldName,{gte:earliestMs,lte:latestMs,format:"epoch_millis"})});query&&mustCriteria.push(query);_lodash2.default.each(entityFields,function(entity){if(0!==entity.fieldValue.length)mustCriteria.push({term:_defineProperty({},entity.fieldName,entity.fieldValue)});else{shouldCriteria.push({bool:{must:[{term:_defineProperty({},entity.fieldName,"")}]}});shouldCriteria.push({bool:{must_not:[{exists:{field:entity.fieldName}}]}})}});var body={query:{bool:{must:mustCriteria}},size:0,_source:{excludes:[]},aggs:{byTime:{date_histogram:{field:timeFieldName,interval:interval,min_doc_count:0}}}};if(shouldCriteria.length>0){body.query.bool.should=shouldCriteria;body.query.bool.minimum_should_match=shouldCriteria.length/2}if(void 0!==metricFieldName&&""!==metricFieldName){body.aggs.byTime.aggs={};var metricAgg=_defineProperty({},metricFunction,{field:metricFieldName});"percentiles"===metricFunction&&(metricAgg[metricFunction].percents=[_job_utils.ML_MEDIAN_PERCENTS]);body.aggs.byTime.aggs.metric=metricAgg}_ml_api_service.ml.esSearch({index:index,body:body}).then(function(resp){var dataByTime=_lodash2.default.get(resp,["aggregations","byTime","buckets"],[]);_lodash2.default.each(dataByTime,function(dataForTime){if("count"===metricFunction)obj.results[dataForTime.key]=dataForTime.doc_count;else{var value=_lodash2.default.get(dataForTime,["metric","value"]);var values=_lodash2.default.get(dataForTime,["metric","values"]);if(0===dataForTime.doc_count)obj.results[dataForTime.key]=null;else if(void 0!==value)obj.results[dataForTime.key]=value;else if(void 0!==values){var medianValues=values[_job_utils.ML_MEDIAN_PERCENTS];obj.results[dataForTime.key]=isNaN(medianValues)?null:medianValues}else obj.results[dataForTime.key]=null}});resolve(obj)}).catch(function(resp){reject(resp)})})}function getEventRateData(index,query,timeFieldName,earliestMs,latestMs,interval){return new Promise(function(resolve,reject){var obj={success:true,results:{}};var mustCriteria=[{range:_defineProperty({},timeFieldName,{gte:earliestMs,lte:latestMs,format:"epoch_millis"})}];query&&mustCriteria.push(query);_ml_api_service.ml.esSearch({index:index,size:0,body:{query:{bool:{must:mustCriteria}},_source:{excludes:[]},aggs:{eventRate:{date_histogram:{field:timeFieldName,interval:interval,min_doc_count:0,extended_bounds:{min:earliestMs,max:latestMs}}}}}}).then(function(resp){var dataByTimeBucket=_lodash2.default.get(resp,["aggregations","eventRate","buckets"],[]);_lodash2.default.each(dataByTimeBucket,function(dataForTime){var time=dataForTime.key;obj.results[time]=dataForTime.doc_count});obj.total=resp.hits.total;resolve(obj)}).catch(function(resp){reject(resp)})})}function getModelPlotOutput(jobId,detectorIndex,criteriaFields,earliestMs,latestMs,interval,aggType){return new Promise(function(resolve,reject){var obj={success:true,results:{}};var modelAggs=void 0===aggType?{max:"max",min:"min"}:{max:aggType.max,min:aggType.min};var mustCriteria=[{term:{job_id:jobId}},{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}}];_lodash2.default.each(criteriaFields,function(criteria){mustCriteria.push({term:_defineProperty({},criteria.fieldName,criteria.fieldValue)})});var shouldCriteria=[{term:{detector_index:detectorIndex}},{bool:{must_not:[{exists:{field:"detector_index"}}]}}];_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:model_plot",analyze_wildcard:true}},{bool:{must:mustCriteria,should:shouldCriteria,minimum_should_match:1}}]}},aggs:{times:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:0},aggs:{actual:{avg:{field:"actual"}},modelUpper:_defineProperty({},modelAggs.max,{field:"model_upper"}),modelLower:_defineProperty({},modelAggs.min,{field:"model_lower"})}}}}}).then(function(resp){var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]);_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=dataForTime.key;var modelUpper=_lodash2.default.get(dataForTime,["modelUpper","value"]);var modelLower=_lodash2.default.get(dataForTime,["modelLower","value"]);var actual=_lodash2.default.get(dataForTime,["actual","value"]);void 0!==modelUpper&&false!==isFinite(modelUpper)||(modelUpper=null);void 0!==modelLower&&false!==isFinite(modelLower)||(modelLower=null);obj.results[time]={actual:actual,modelUpper:modelUpper,modelLower:modelLower}});resolve(obj)}).catch(function(resp){reject(resp)})})}function getRecordMaxScoreByTime(jobId,criteriaFields,earliestMs,latestMs,interval){return new Promise(function(resolve,reject){var obj={success:true,results:{}};var mustCriteria=[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{term:{job_id:jobId}}];var shouldCriteria=[];_lodash2.default.each(criteriaFields,function(criteria){if(0!==criteria.fieldValue.length)mustCriteria.push({term:_defineProperty({},criteria.fieldName,criteria.fieldValue)});else{var emptyFieldCondition={bool:{must:[{term:{}}]}};emptyFieldCondition.bool.must[0].term[criteria.fieldName]="";shouldCriteria.push(emptyFieldCondition);shouldCriteria.push({bool:{must_not:[{exists:{field:criteria.fieldName}}]}})}});_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:record",analyze_wildcard:true}},{bool:{must:mustCriteria}}]}},aggs:{times:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1},aggs:{recordScore:{max:{field:"record_score"}}}}}}}).then(function(resp){var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]);_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=dataForTime.key;obj.results[time]={score:_lodash2.default.get(dataForTime,["recordScore","value"])}});resolve(obj)}).catch(function(resp){reject(resp)})})}exports.mlResultsService={getScoresByBucket:getScoresByBucket,getScheduledEventsByBucket:getScheduledEventsByBucket,getTopInfluencers:getTopInfluencers,getTopInfluencerValues:getTopInfluencerValues,getOverallBucketScores:getOverallBucketScores,getInfluencerValueMaxScoreByTime:getInfluencerValueMaxScoreByTime,getRecordInfluencers:getRecordInfluencers,getRecordsForInfluencer:getRecordsForInfluencer,getRecordsForDetector:getRecordsForDetector,getRecords:getRecords,getRecordsForCriteria:getRecordsForCriteria,getMetricData:getMetricData,getEventRateData:getEventRateData,getModelPlotOutput:getModelPlotOutput,getRecordMaxScoreByTime:getRecordMaxScoreByTime}},427:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getFieldTypeFromMapping=getFieldTypeFromMapping;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _ml_api_service=__webpack_require__(23);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getFieldTypeFromMapping(index,fieldName){return new Promise(function(resolve,reject){""!==index?_ml_api_service.ml.getFieldCaps({index:index,fields:[fieldName]}).then(function(resp){var fieldType="";_lodash2.default.each(resp.fields,function(field){_lodash2.default.each(field,function(type){""===fieldType&&(fieldType=type.type)})});resolve(fieldType)}).catch(function(error){reject(error)}):reject()})}},498:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.stateFactoryProvider=stateFactoryProvider;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _listener_factory=__webpack_require__(626);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function stateFactoryProvider(AppState){function initializeAppState(stateName,defaultState){var appState=new AppState;appState.fetch();if(void 0===appState[stateName]){appState[stateName]=_lodash2.default.cloneDeep(defaultState)||{};appState.save()}if("undefined"!==typeof defaultState&&appState[stateName]!==defaultState&&!_lodash2.default.isEqual(Object.keys(defaultState).sort(),Object.keys(appState[stateName]).sort())){appState[stateName]=_lodash2.default.cloneDeep(defaultState);appState.save()}return appState}return function(stateName,defaultState){if("string"!==typeof stateName)throw"stateName needs to be of type `string`";var appState=initializeAppState(stateName,defaultState);var listener=(0,_listener_factory.listenerFactoryProvider)()();var _changed=false;var state={get:function get(name){updateAppState();return appState[stateName][name]},set:function set(name,value){updateAppState();if(!_lodash2.default.isEqual(appState[stateName][name],value)){appState[stateName][name]=value;appState.save();_changed=true}return state},reset:function reset(){updateAppState();if(!_lodash2.default.isEqual(appState[stateName],defaultState)){appState[stateName]=_lodash2.default.cloneDeep(defaultState);appState.save();_changed=true}return state},watch:listener.watch,unwatch:listener.unwatch,changed:function changed(){if(_changed){listener.changed.apply(listener,arguments);_changed=false}}};function updateAppState(){appState.fetch();if("undefined"===typeof appState[stateName]){appState=initializeAppState(stateName,defaultState);_changed=true}}return state}}},499:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};exports.http=http;var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);__webpack_require__(594);var _system_api=__webpack_require__(477);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function http(options){return new Promise(function(resolve,reject){if(options&&options.url){var url="";url+=options.url||"";var headers=(0,_system_api.addSystemApiHeader)(_extends({"Content-Type":"application/json","kbn-version":_chrome2.default.getXsrfToken()},options.headers));var allHeaders=void 0===options.headers?headers:_extends({},options.headers,headers);var body=void 0===options.data?null:JSON.stringify(options.data);var payload={method:options.method||"GET",headers:allHeaders,credentials:"same-origin"};null!==body&&(payload.body=body);fetch(url,payload).then(function(resp){resp.json().then(true===resp.ok?resolve:reject)}).catch(function(resp){reject(resp)})}else reject()})}},500:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.addItemToRecentlyAccessed=addItemToRecentlyAccessed;var _persisted_log=__webpack_require__(250);function addItemToRecentlyAccessed(page,itemId,url){var pageLabel="";var id="ml-job-"+itemId;switch(page){case"explorer":pageLabel="Anomaly Explorer";break;case"timeseriesexplorer":pageLabel="Single Metric Viewer";break;case"jobs/new_job/datavisualizer":pageLabel="Data Visualizer";id="ml-datavisualizer-"+itemId;break;default:console.error("addItemToRecentlyAccessed - No page specified");return}url="ml#/"+page+"/"+url;_persisted_log.recentlyAccessed.add(url,"ML - "+itemId+" - "+pageLabel,id)}},501:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CHART_STATE={NOT_STARTED:0,LOADING:1,LOADED:2,NO_RESULTS:3};exports.JOB_STATE={NOT_STARTED:0,RUNNING:1,FINISHED:2,STOPPING:3}},502:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};exports.getNewConditionDefaults=getNewConditionDefaults;exports.getNewRuleDefaults=getNewRuleDefaults;exports.getScopeFieldDefaults=getScopeFieldDefaults;exports.isValidRule=isValidRule;exports.saveJobRule=saveJobRule;exports.deleteJobRule=deleteJobRule;exports.updateJobRules=updateJobRules;exports.buildRuleDescription=buildRuleDescription;exports.filterTypeToText=filterTypeToText;exports.appliesToText=appliesToText;exports.operatorToText=operatorToText;var _detector_rule=__webpack_require__(423);var _lodash=__webpack_require__(1);var _job_service=__webpack_require__(24);function getNewConditionDefaults(){return{applies_to:_detector_rule.APPLIES_TO.ACTUAL,operator:_detector_rule.OPERATOR.LESS_THAN,value:1}}function getNewRuleDefaults(){return{actions:[_detector_rule.ACTION.SKIP_RESULT],conditions:[]}}function getScopeFieldDefaults(filterListIds){var defaults={filter_type:_detector_rule.FILTER_TYPE.INCLUDE,enabled:false};void 0!==filterListIds&&filterListIds.length>0&&(defaults.filter_id=filterListIds[0]);return defaults}function isValidRule(rule){var isValid=false;var actions=rule.actions;if(actions.length>0){var conditions=rule.conditions;if(void 0!==conditions&&conditions.length>0)isValid=true;else{var scope=rule.scope;void 0!==scope&&(isValid=Object.keys(scope).some(function(field){return true===scope[field].enabled}))}}return isValid}function saveJobRule(job,detectorIndex,ruleIndex,editedRule){var detector=job.analysis_config.detectors[detectorIndex];var clonedRule=(0,_lodash.cloneDeep)(editedRule);var scope=clonedRule.scope;void 0!==scope&&Object.keys(scope).forEach(function(field){false===scope[field].enabled?delete scope[field]:delete scope[field].enabled});var rules=[];if(void 0===detector.custom_rules)rules=[clonedRule];else{rules=(0,_lodash.cloneDeep)(detector.custom_rules);ruleIndex<rules.length?rules[ruleIndex]=clonedRule:rules.push(clonedRule)}return updateJobRules(job,detectorIndex,rules)}function deleteJobRule(job,detectorIndex,ruleIndex){var detector=job.analysis_config.detectors[detectorIndex];var customRules=[];if(void 0!==detector.custom_rules&&ruleIndex<detector.custom_rules.length){customRules=(0,_lodash.cloneDeep)(detector.custom_rules);customRules.splice(ruleIndex,1);return updateJobRules(job,detectorIndex,customRules)}return Promise.reject(new Error("Rule no longer exists for detector index "+detectorIndex+" in job "+job.job_id))}function updateJobRules(job,detectorIndex,rules){var jobId=job.job_id;var jobData={detectors:[{detector_index:detectorIndex,custom_rules:rules}]};var customSettings={};if(void 0!==job.custom_settings){customSettings=_extends({},job.custom_settings);delete customSettings.created_by;jobData.custom_settings=customSettings}return new Promise(function(resolve,reject){_job_service.mlJobService.updateJob(jobId,jobData).then(function(resp){resp.success?_job_service.mlJobService.refreshJob(jobId).then(function(){resolve({success:true})}).catch(function(refreshResp){reject(refreshResp)}):reject(resp)}).catch(function(resp){reject(resp)})})}function buildRuleDescription(rule){var actions=rule.actions,conditions=rule.conditions,scope=rule.scope;var description="skip ";actions.forEach(function(action,i){i>0&&(description+=" AND ");switch(action){case _detector_rule.ACTION.SKIP_RESULT:description+="result";break;case _detector_rule.ACTION.SKIP_MODEL_UPDATE:description+="model update"}});description+=" when ";void 0!==conditions&&conditions.forEach(function(condition,i){i>0&&(description+=" AND ");description+=condition.applies_to+" is "+operatorToText(condition.operator)+" "+condition.value});if(void 0!==scope){void 0!==conditions&&conditions.length>0&&(description+=" AND ");var fieldNames=Object.keys(scope);fieldNames.forEach(function(fieldName,i){i>0&&(description+=" AND ");var filter=scope[fieldName];description+=fieldName+" is "+filterTypeToText(filter.filter_type)+" "+filter.filter_id})}return description}function filterTypeToText(filterType){switch(filterType){case _detector_rule.FILTER_TYPE.INCLUDE:return"in";case _detector_rule.FILTER_TYPE.EXCLUDE:return"not in";default:return filterType}}function appliesToText(appliesTo){switch(appliesTo){case _detector_rule.APPLIES_TO.ACTUAL:return"actual";case _detector_rule.APPLIES_TO.TYPICAL:return"typical";case _detector_rule.APPLIES_TO.DIFF_FROM_TYPICAL:return"diff from typical";default:return appliesTo}}function operatorToText(operator){switch(operator){case _detector_rule.OPERATOR.LESS_THAN:return"less than";case _detector_rule.OPERATOR.LESS_THAN_OR_EQUAL:return"less than or equal to";case _detector_rule.OPERATOR.GREATER_THAN:return"greater than";case _detector_rule.OPERATOR.GREATER_THAN_OR_EQUAL:return"greater than or equal to";default:return operator}}},503:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();exports.JobSelectServiceProvider=JobSelectServiceProvider;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _notify=__webpack_require__(9);var _job_service=__webpack_require__(24);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}var jobSelectService=void 0;function JobSelectServiceProvider($rootScope,globalState){function checkGlobalState(){if(void 0===globalState.ml){globalState.ml={};globalState.save()}}checkGlobalState();function loadJobIdsFromGlobalState(){var jobIds=[];if(globalState.ml&&globalState.ml.jobIds){var tempJobIds=[];"string"===typeof globalState.ml.jobIds?tempJobIds.push(globalState.ml.jobIds):tempJobIds=globalState.ml.jobIds;tempJobIds=tempJobIds.map(function(id){return String(id)});var invalidIds=getInvalidJobIds(removeGroupIds(tempJobIds));warnAboutInvalidJobIds(invalidIds);var validIds=_lodash2.default.difference(tempJobIds,invalidIds);if(0===validIds.length){var warningText="No jobs selected, auto selecting first job";_notify.toastNotifications.addWarning(warningText);_job_service.mlJobService.jobs.length&&(validIds=[_job_service.mlJobService.jobs[0].job_id])}jobIds.push.apply(jobIds,_toConsumableArray(validIds));storeJobIdsInGlobalState(jobIds)}else{checkGlobalState();_job_service.mlJobService.jobs.length&&jobIds.push(_job_service.mlJobService.jobs[0].job_id);storeJobIdsInGlobalState(jobIds)}return jobIds}function storeJobIdsInGlobalState(jobIds){globalState.ml.jobIds=jobIds;globalState.save()}function getInvalidJobIds(ids){return ids.filter(function(id){var job=_lodash2.default.find(_job_service.mlJobService.jobs,{job_id:id});return void 0===job&&"*"!==id})}function removeGroupIds(jobIds){return jobIds.map(function(id){var splitId=id.split(".");return splitId.length>1?splitId[1]:splitId[0]})}function warnAboutInvalidJobIds(invalidIds){if(invalidIds.length>0){var warningText=1===invalidIds.length?"Requested job "+invalidIds+" does not exist":"Requested jobs "+invalidIds+" do not exist";_notify.toastNotifications.addWarning(warningText)}}function createDescription(jobs){var txt="";var count=_job_service.mlJobService.jobs.reduce(function(sum,job){return sum+(void 0===job.groups?1:job.groups.length)},0);if(jobs.length===count)txt="All jobs";else{var groupCounts={};var groupLessJobs=0;jobs.forEach(function(job){var obj=splitJobId(job);obj.group?groupCounts[obj.group]=(groupCounts[obj.group]||0)+1:groupLessJobs++});var wholeGroups=[];var groups=_job_service.mlJobService.getJobGroups();groups.forEach(function(group){var groupCount=groupCounts[group.id];void 0!==groupCount&&groupCount===group.jobs.length?wholeGroups.push(group.id):void 0!==groupCount&&(groupLessJobs+=groupCount)});if(wholeGroups.length){txt=wholeGroups[0];if(wholeGroups.length>1||groupLessJobs>0){var total=wholeGroups.length-1+groupLessJobs;txt+=" and "+total+" other"+(total>1?"s":"")}}else{txt=splitJobId(jobs[0]).job;jobs.length>1&&(txt+=" and "+(jobs.length-1)+" other"+(jobs.length>2?"s":""))}}return txt}function splitJobId(jobId){var obj={};var splitId=jobId.split(".");obj=2===splitId.length?{group:splitId[0],job:splitId[1]}:{job:jobId};return obj}this.splitJobId=splitJobId;function expandGroups(jobIds){var newJobIds=[];var groups=_job_service.mlJobService.getJobGroups();jobIds.forEach(function(jobId){if("*"===jobId)_job_service.mlJobService.jobs.forEach(function(job){void 0===job.groups?newJobIds.push(job.job_id):newJobIds.push.apply(newJobIds,_toConsumableArray(job.groups.map(function(g){return g+"."+job.job_id})))});else{var splitId=splitJobId(jobId);if(void 0!==splitId.group&&"*"===splitId.job){var groupId=splitId.group;var group=groups.find(function(g){return g.id===groupId});group.jobs.forEach(function(j){newJobIds.push(groupId+"."+j.job_id)})}else newJobIds.push(jobId)}});return newJobIds}function getGroupIds(jobIds){var groupIds=[];jobIds.forEach(function(jobId){var splitId=splitJobId(jobId);void 0!==splitId.group&&"*"===splitId.job&&groupIds.push(splitId.group)});return groupIds}function processIds(service,ids){var _service$jobIdsWithGr,_service$jobIds;var expandedJobIds=expandGroups(ids);service.jobIdsWithGroup.length=0;(_service$jobIdsWithGr=service.jobIdsWithGroup).push.apply(_service$jobIdsWithGr,_toConsumableArray(expandedJobIds));service.groupIds=getGroupIds(ids);service.jobIds.length=0;(_service$jobIds=service.jobIds).push.apply(_service$jobIds,_toConsumableArray(removeGroupIds(expandedJobIds)));service.description.txt=createDescription(service.jobIdsWithGroup);service.singleJobDescription.txt=ids[0];setBrowserTitle(service.description.txt)}function setBrowserTitle(title){document.title=title+" - Kibana"}var JobSelectService=function(){function JobSelectService(){_classCallCheck(this,JobSelectService);this.jobIds=[];this.groupIds=[];this.description={txt:""};this.singleJobDescription={txt:""};this.jobSelectListState={applyTimeRange:true};this.jobIdsWithGroup=[];this.splitJobId=splitJobId}_createClass(JobSelectService,[{key:"broadcastJobSelectionChange",value:function broadcastJobSelectionChange(){$rootScope.$broadcast("jobSelectionChange",this.getSelectedJobIds())}},{key:"listenJobSelectionChange",value:function listenJobSelectionChange(scope,callback){var handler=$rootScope.$on("jobSelectionChange",callback);scope.$on("$destroy",handler)}},{key:"getSelectedJobIds",value:function getSelectedJobIds(loadFromURL){loadFromURL&&processIds(this,loadJobIdsFromGlobalState());return this.jobIds}},{key:"setJobIds",value:function setJobIds(jobIds){processIds(this,jobIds);storeJobIdsInGlobalState(jobIds);this.broadcastJobSelectionChange()}}]);return JobSelectService}();void 0===jobSelectService&&(jobSelectService=new JobSelectService);return jobSelectService}},505:function(module,exports,__webpack_require__){(function(Buffer){var RRule=__webpack_require__(638).RRule;function pad(n,d){d=d||2;var neg=n<0;neg&&(n*=-1);n=n.toString();var zeroes="000000000000000000";return(neg?"-":"")+zeroes.substr(0,d-n.length)+n}var _types={BINARY:{format:function(value){return value.toString("base64")},parse:function(value){return new Buffer(value,"base64")}},BOOLEAN:{format:function(value){return value?"TRUE":"FALSE"},parse:function(value){return"TRUE"==value.toUpperCase()}},"CAL-ADDRESS":{format:function(value){var v=value.toString();0!=v.lastIndexOf("mailto:")&&(v="mailto:"+v);return v}},DATE:{format:function(value){value instanceof Date||(value=new Date(value));return value.getFullYear()+pad(value.getMonth()+1)+pad(value.getDate())},parse:function(value){var dt=new Date(parseInt(value.substr(0,4),10),parseInt(value.substr(4,2),10)-1,parseInt(value.substr(6,2),10),0,0,0);dt.date_only=true;return dt}},"DATE-TIME":{format:function(value,parameters){value instanceof Date||(value=new Date(value));if(value.date_only||"DATE"===parameters["VALUE"])return format_value("DATE",value);return value.getUTCFullYear()+pad(value.getUTCMonth()+1)+pad(value.getUTCDate())+"T"+format_value("TIME",value)},parse:function(value,parameters,calendar){if("DATE"===parameters["VALUE"]||value.length<=8)return _types["DATE"].parse(value);var tz=parameters["TZID"];var d=[parseInt(value.substr(0,4),10),parseInt(value.substr(4,2),10),parseInt(value.substr(6,2),10),parseInt(value.substr(9,2),10),parseInt(value.substr(11,2),10),parseInt(value.substr(13,2),10)];var utc=value.length>15&&"Z"===value[15];if(void 0!==tz){var tzobj=calendar.timezone(tz);if(!tzobj)throw new Error("Unable to load TZ data for "+tz);return tzobj.fromLocalTime(d)}d[1]-=1;return utc?new Date(Date.UTC.apply(null,d)):new Date(d[0],d[1],d[2],d[3],d[4],d[5])}},DURATION:{format:function(value){var neg=value<0;neg&&(value*=-1);var w=Math.floor(value/604800);value-=60*w*60*24*7;var d=Math.floor(value/86400);value-=60*d*60*24;var h=Math.floor(value/3600);value-=60*h*60;var m=Math.floor(value/60);value-=60*m;var s=value;var dur=["P"];neg&&dur.unshift("-");w&&dur.push(w+"W");d&&dur.push(d+"D");(h||m||s)&&dur.push("T");h&&dur.push(h+"H");m&&dur.push(m+"M");s&&dur.push(s+"S");return dur.join("")},parse:function(value){var match=/(-)?P(\d+W)?(\d+D)?(?:T(\d+H)?(\d+M)?(\d+S)?)?/.exec(value).slice(1);var mul=[-1,604800,86400,3600,60,1];var dur=0;for(var i=1;i<match.length;++i)void 0!==match[i]&&(dur+=parseInt(match[i],10)*mul[i]);void 0!==match[0]&&(dur*=mul[0]);return dur}},FLOAT:{format:function(value){return value.toString()}},INTEGER:{format:function(value){return value.toString()}},PERIOD:{format:function(value){var start=format_value("DATE-TIME",value[0]);var end=format_value(value[1]instanceof Date?"DATE-TIME":"DURATION",value[1]);return start+"/"+end}},RECUR:{format:function(value){return(value instanceof RRule?value:new RRule(value)).toString()},parse:function(value){return RRule.parse(value)}},TEXT:{format:function(value){return(value||"").toString().replace(/([\\,;])/g,"\\$1").replace(/\n/g,"\\n")},parse:function(value){return value.replace(/\\([\\,;])/g,"$1").replace(/\\[nN]/g,"\n")}},TIME:{format:function(value){value instanceof Date||(value=new Date(value));return pad(value.getUTCHours())+pad(value.getUTCMinutes())+pad(value.getUTCSeconds())+"Z"},parse:function(value){var utc=value.length>6&&"Z"===value[6];return utc?new Date(Date.UTC(0,0,0,parseInt(value.substr(0,2),10),parseInt(value.substr(2,2),10),parseInt(value.substr(4,2),10))):new Date(0,0,0,parseInt(value.substr(0,2),10),parseInt(value.substr(2,2),10),parseInt(value.substr(4,2),10))}},URI:{format:function(value){return value.toString()}},"UTC-OFFSET":{format:function(value){var west=value<0;west&&(value*=-1);return(west?"-":"+")+pad(value,4)}}};var format_value=exports.format_value=function(type,value,parameters){if(void 0===value)return"";var fmt=_types[type||"TEXT"];if(void 0===fmt)throw Error("Invalid iCalendar datatype: "+type);return Array.isArray(value)&&"PERIOD"!==type||"PERIOD"===type&&value[0]&&Array.isArray(value[0])?value.map(function(v){return fmt.format(v,parameters||{})}).join(","):fmt.format(value,parameters||{})};var parse_value=exports.parse_value=function(type,value,parameters,calendar,expect_list){if(expect_list)return value.split(",").map(function(x){return parse_value(type,x,parameters,calendar)});var fmt=_types[type||"TEXT"];if(void 0===fmt)throw Error("Invalid iCalendar datatype: "+type);parameters=parameters||{};var otherFmt=parameters.VALUE&&_types[parameters.VALUE];otherFmt&&(fmt=otherFmt);return fmt.parse?fmt.parse(value,parameters,calendar):value}}).call(exports,__webpack_require__(243).Buffer)},626:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.listenerFactoryProvider=listenerFactoryProvider;function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function listenerFactoryProvider(){return function(){var listeners=[];return{changed:function changed(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];listeners.forEach(function(listener){return listener.apply(void 0,_toConsumableArray(args))})},watch:function watch(listener){listeners.push(listener)},unwatch:function unwatch(listener){var index=listeners.indexOf(listener);index>-1&&listeners.splice(index,1)},unwatchAll:function unwatchAll(){listeners.splice(0)}}}}},627:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlForecastService=void 0;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _index_patterns=__webpack_require__(368);var _ml_api_service=__webpack_require__(23);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true}):obj[key]=value;return obj}function getForecastsSummary(job,query,earliestMs,maxResults){return new Promise(function(resolve,reject){var obj={success:true,forecasts:[]};var filterCriteria=[{term:{result_type:"model_forecast_request_stats"}},{term:{job_id:job.job_id}},{range:{timestamp:{gte:earliestMs,format:"epoch_millis"}}}];query&&filterCriteria.push(query);_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:maxResults,body:{query:{bool:{filter:filterCriteria}},sort:[{forecast_create_timestamp:{order:"desc"}}]}}).then(function(resp){0!==resp.hits.total&&(obj.forecasts=resp.hits.hits.map(function(hit){return hit._source}));resolve(obj)}).catch(function(resp){reject(resp)})})}function getForecastDateRange(job,forecastId){return new Promise(function(resolve,reject){var obj={success:true,earliest:null,latest:null};var filterCriteria=[{query_string:{query:"result_type:model_forecast",analyze_wildcard:true}},{term:{job_id:job.job_id}},{term:{forecast_id:forecastId}}];_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:filterCriteria}},aggs:{earliest:{min:{field:"timestamp"}},latest:{max:{field:"timestamp"}}}}}).then(function(resp){obj.earliest=_lodash2.default.get(resp,"aggregations.earliest.value",null);obj.latest=_lodash2.default.get(resp,"aggregations.latest.value",null);null===obj.earliest||null===obj.latest?reject(resp):resolve(obj)}).catch(function(resp){reject(resp)})})}function getForecastData(job,detectorIndex,forecastId,entityFields,earliestMs,latestMs,interval,aggType){var criteriaFields=[];var detector=job.analysis_config.detectors[detectorIndex];if(_lodash2.default.has(detector,"partition_field_name")){var partitionEntity=_lodash2.default.find(entityFields,{fieldName:detector.partition_field_name});void 0!==partitionEntity&&criteriaFields.push({fieldName:"partition_field_name",fieldValue:partitionEntity.fieldName},{fieldName:"partition_field_value",fieldValue:partitionEntity.fieldValue})}if(_lodash2.default.has(detector,"over_field_name")){var overEntity=_lodash2.default.find(entityFields,{fieldName:detector.over_field_name});void 0!==overEntity&&criteriaFields.push({fieldName:"over_field_name",fieldValue:overEntity.fieldName},{fieldName:"over_field_value",fieldValue:overEntity.fieldValue})}if(_lodash2.default.has(detector,"by_field_name")){var byEntity=_lodash2.default.find(entityFields,{fieldName:detector.by_field_name});void 0!==byEntity&&criteriaFields.push({fieldName:"by_field_name",fieldValue:byEntity.fieldName},{fieldName:"by_field_value",fieldValue:byEntity.fieldValue})}return new Promise(function(resolve,reject){var obj={success:true,results:{}};var filterCriteria=[{query_string:{query:"result_type:model_forecast",analyze_wildcard:true}},{term:{job_id:job.job_id}},{term:{forecast_id:forecastId}},{term:{detector_index:detectorIndex}},{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}}];_lodash2.default.each(criteriaFields,function(criteria){filterCriteria.push({term:_defineProperty({},criteria.fieldName,criteria.fieldValue)})});var forecastAggs=void 0===aggType?{avg:"avg",max:"max",min:"min"}:{avg:aggType.avg,max:aggType.max,min:aggType.min};_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:filterCriteria}},aggs:{times:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1},aggs:{prediction:_defineProperty({},forecastAggs.avg,{field:"forecast_prediction"}),forecastUpper:_defineProperty({},forecastAggs.max,{field:"forecast_upper"}),forecastLower:_defineProperty({},forecastAggs.min,{field:"forecast_lower"})}}}}}).then(function(resp){var aggregationsByTime=_lodash2.default.get(resp,["aggregations","times","buckets"],[]);_lodash2.default.each(aggregationsByTime,function(dataForTime){var time=dataForTime.key;obj.results[time]={prediction:_lodash2.default.get(dataForTime,["prediction","value"]),forecastUpper:_lodash2.default.get(dataForTime,["forecastUpper","value"]),forecastLower:_lodash2.default.get(dataForTime,["forecastLower","value"])}});resolve(obj)}).catch(function(resp){reject(resp)})})}function runForecast(jobId,duration){console.log("ML forecast service run forecast with duration:",duration);return new Promise(function(resolve,reject){_ml_api_service.ml.forecast({jobId:jobId,duration:duration}).then(function(resp){resolve(resp)}).catch(function(err){reject(err)})})}function getForecastRequestStats(job,forecastId){return new Promise(function(resolve,reject){var obj={success:true,stats:{}};var filterCriteria=[{query_string:{query:"result_type:model_forecast_request_stats",analyze_wildcard:true}},{term:{job_id:job.job_id}},{term:{forecast_id:forecastId}}];_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:1,body:{query:{bool:{filter:filterCriteria}}}}).then(function(resp){0!==resp.hits.total&&(obj.stats=_lodash2.default.first(resp.hits.hits)._source);resolve(obj)}).catch(function(resp){reject(resp)})})}exports.mlForecastService={getForecastsSummary:getForecastsSummary,getForecastDateRange:getForecastDateRange,getForecastData:getForecastData,runForecast:runForecast,getForecastRequestStats:getForecastRequestStats}},628:function(module,exports){},629:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.validateJob=validateJob;exports.populateValidationMessages=populateValidationMessages;var _job_utils=__webpack_require__(41);var _new_job_defaults=__webpack_require__(253);var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function validateJob(job,checks){var limits=(0,_new_job_defaults.newJobLimits)();var validationResults=(0,_job_utils.basicJobValidation)(job,void 0,limits);var valid=true;_lodash2.default.each(checks,function(item){item.valid=true});populateValidationMessages(validationResults,checks);_lodash2.default.each(checks,function(item){false===item.valid&&(valid=false)});return valid}function populateValidationMessages(validationResults,checks){var limits=(0,_new_job_defaults.newJobLimits)();if(validationResults.contains("job_id_empty"))checks.jobId.valid=false;else if(validationResults.contains("job_id_invalid")){checks.jobId.valid=false;var msg="Job name can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";msg+="must start and end with an alphanumeric character";checks.jobId.message=msg}if(validationResults.contains("job_group_id_invalid")){checks.groupIds.valid=false;var _msg="Job group names can contain lowercase alphanumeric (a-z and 0-9), hyphens or underscores; ";_msg+="must start and end with an alphanumeric character";checks.groupIds.message=_msg}if(validationResults.contains("model_memory_limit_invalid")){checks.modelMemoryLimit.valid=false;var _msg2="Model memory limit cannot be higher than the maximum value of "+limits.max_model_memory_limit.toUpperCase();checks.modelMemoryLimit.message=_msg2}if(validationResults.contains("detectors_duplicates")){checks.duplicateDetectors.valid=false;var _msg3="Duplicate detectors were found.";checks.duplicateDetectors.message=_msg3}}},630:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlCalendarService=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _ml_api_service=__webpack_require__(23);var _job_service=__webpack_require__(24);var _messagebar_service=__webpack_require__(79);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var msgs=_messagebar_service.mlMessageBarService;var CalendarService=function(){function CalendarService(){_classCallCheck(this,CalendarService);this.calendars=[];this.jobCalendars={};this.groupCalendars={}}_createClass(CalendarService,[{key:"loadCalendars",value:function loadCalendars(jobs){var _this=this;return new Promise(function(resolve,reject){var calendars=[];jobs.forEach(function(j){_this.jobCalendars[j.job_id]=[]});var groups={};_job_service.mlJobService.getJobGroups().forEach(function(g){groups[g.id]=g});_ml_api_service.ml.calendars().then(function(resp){calendars=resp;calendars.forEach(function(cal){cal.job_ids.forEach(function(id){var isGroup=false;if(void 0!==_this.jobCalendars[id])_this.jobCalendars[id].push(cal.calendar_id);else if(void 0!==groups[id]){isGroup=true;groups[id].jobs.forEach(function(j){_this.jobCalendars[j.job_id].push(cal.calendar_id)})}else isGroup=true;isGroup&&(void 0===_this.groupCalendars[id]?_this.groupCalendars[id]=[cal.calendar_id]:_this.groupCalendars[id].push(cal.calendar_id))})});_lodash2.default.each(_this.jobCalendars,function(cal,id){_this.jobCalendars[id]=_lodash2.default.uniq(cal)});_this.calendars=calendars;resolve({calendars:calendars})}).catch(function(err){msgs.error("Calendars list could not be retrieved");msgs.error("",err);reject({calendars:calendars,err:err})})})}},{key:"getCalendarGroups",value:function getCalendarGroups(){return Object.keys(this.groupCalendars).map(function(id){return{id:id}})}}]);return CalendarService}();exports.mlCalendarService=new CalendarService},631:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getMostSevereMessageStatus=getMostSevereMessageStatus;exports.addJobValidationMethods=addJobValidationMethods;var _validation=__webpack_require__(1420);var contains=function contains(arr,str){return arr.findIndex(function(v){return v===str})>=0};function getMostSevereMessageStatus(messages){var statuses=messages.map(function(m){return m.status});return[_validation.VALIDATION_STATUS.INFO,_validation.VALIDATION_STATUS.WARNING,_validation.VALIDATION_STATUS.ERROR].reduce(function(previous,current){return contains(statuses,current)?current:previous},_validation.VALIDATION_STATUS.SUCCESS)}function addJobValidationMethods($scope,service){$scope.getDuration=function(){return{start:$scope.formConfig.start,end:$scope.formConfig.end}};$scope.isCurrentJobConfig=false;$scope.$watch("formConfig",function(){$scope.isCurrentJobConfig=false},true);$scope.getJobConfig=function(){$scope.isCurrentJobConfig=true;return service.getJobFromConfig($scope.formConfig)}}},632:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;"value"in descriptor&&(descriptor.writable=true);Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){protoProps&&defineProperties(Constructor.prototype,protoProps);staticProps&&defineProperties(Constructor,staticProps);return Constructor}}();var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};
/*!
                                                                                                                                                                                                                                                                                Copyright (c) 2018 Jed Watson.
                                                                                                                                                                                                                                                                                Licensed under the MIT License (MIT), see
                                                                                                                                                                                                                                                                                http://jedwatson.github.io/react-select
                                                                                                                                                                                                                                                                              */var _reactInputAutosize=__webpack_require__(1138);var _reactInputAutosize2=_interopRequireDefault(_reactInputAutosize);var _classnames=__webpack_require__(5);var _classnames2=_interopRequireDefault(_classnames);var _propTypes=__webpack_require__(323);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _reactDom=__webpack_require__(15);var _defaultArrowRenderer=__webpack_require__(1421);var _defaultArrowRenderer2=_interopRequireDefault(_defaultArrowRenderer);var _defaultClearRenderer=__webpack_require__(1422);var _defaultClearRenderer2=_interopRequireDefault(_defaultClearRenderer);var _defaultFilterOptions=__webpack_require__(869);var _defaultFilterOptions2=_interopRequireDefault(_defaultFilterOptions);var _defaultMenuRenderer=__webpack_require__(870);var _defaultMenuRenderer2=_interopRequireDefault(_defaultMenuRenderer);var _Option=__webpack_require__(1424);var _Option2=_interopRequireDefault(_Option);var _Value=__webpack_require__(1425);var _Value2=_interopRequireDefault(_Value);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i]}return target}function _defineProperty(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true}):obj[key]=value;return obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!==typeof call&&"function"!==typeof call?self:call}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var stringifyValue=function stringifyValue(value){return"string"===typeof value?value:null!==value&&JSON.stringify(value)||""};var stringOrNode=_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.node]);var stringOrNumber=_propTypes2.default.oneOfType([_propTypes2.default.string,_propTypes2.default.number]);var instanceId=1;var shouldShowValue=function shouldShowValue(state,props){var inputValue=state.inputValue,isPseudoFocused=state.isPseudoFocused,isFocused=state.isFocused;var onSelectResetsInput=props.onSelectResetsInput;if(!inputValue)return true;if(!onSelectResetsInput)return!(!isFocused&&isPseudoFocused||isFocused&&!isPseudoFocused);return false};var shouldShowPlaceholder=function shouldShowPlaceholder(state,props,isOpen){var inputValue=state.inputValue,isPseudoFocused=state.isPseudoFocused,isFocused=state.isFocused;var onSelectResetsInput=props.onSelectResetsInput;return!inputValue||!onSelectResetsInput&&!isOpen&&!isPseudoFocused&&!isFocused};var expandValue=function expandValue(value,props){var valueType="undefined"===typeof value?"undefined":_typeof(value);if("string"!==valueType&&"number"!==valueType&&"boolean"!==valueType)return value;var options=props.options,valueKey=props.valueKey;if(!options)return;for(var i=0;i<options.length;i++)if(String(options[i][valueKey])===String(value))return options[i]};var handleRequired=function handleRequired(value,multi){if(!value)return true;return multi?0===value.length:0===Object.keys(value).length};var Select=function(_React$Component){_inherits(Select,_React$Component);function Select(props){_classCallCheck(this,Select);var _this=_possibleConstructorReturn(this,(Select.__proto__||Object.getPrototypeOf(Select)).call(this,props));["clearValue","focusOption","getOptionLabel","handleInputBlur","handleInputChange","handleInputFocus","handleInputValueChange","handleKeyDown","handleMenuScroll","handleMouseDown","handleMouseDownOnArrow","handleMouseDownOnMenu","handleTouchEnd","handleTouchEndClearValue","handleTouchMove","handleTouchOutside","handleTouchStart","handleValueClick","onOptionRef","removeValue","selectValue"].forEach(function(fn){return _this[fn]=_this[fn].bind(_this)});_this.state={inputValue:"",isFocused:false,isOpen:false,isPseudoFocused:false,required:false};return _this}_createClass(Select,[{key:"componentWillMount",value:function componentWillMount(){this._instancePrefix="react-select-"+(this.props.instanceId||++instanceId)+"-";var valueArray=this.getValueArray(this.props.value);this.props.required&&this.setState({required:handleRequired(valueArray[0],this.props.multi)})}},{key:"componentDidMount",value:function componentDidMount(){"undefined"!==typeof this.props.autofocus&&"undefined"!==typeof console&&console.warn("Warning: The autofocus prop has changed to autoFocus, support will be removed after react-select@1.0");(this.props.autoFocus||this.props.autofocus)&&this.focus()}},{key:"componentWillReceiveProps",value:function componentWillReceiveProps(nextProps){var valueArray=this.getValueArray(nextProps.value,nextProps);nextProps.required?this.setState({required:handleRequired(valueArray[0],nextProps.multi)}):this.props.required&&this.setState({required:false});this.state.inputValue&&this.props.value!==nextProps.value&&nextProps.onSelectResetsInput&&this.setState({inputValue:this.handleInputValueChange("")})}},{key:"componentDidUpdate",value:function componentDidUpdate(prevProps,prevState){if(this.menu&&this.focused&&this.state.isOpen&&!this.hasScrolledToOption){var focusedOptionNode=(0,_reactDom.findDOMNode)(this.focused);var menuNode=(0,_reactDom.findDOMNode)(this.menu);var scrollTop=menuNode.scrollTop;var scrollBottom=scrollTop+menuNode.offsetHeight;var optionTop=focusedOptionNode.offsetTop;var optionBottom=optionTop+focusedOptionNode.offsetHeight;(scrollTop>optionTop||scrollBottom<optionBottom)&&(menuNode.scrollTop=focusedOptionNode.offsetTop);this.hasScrolledToOption=true}else this.state.isOpen||(this.hasScrolledToOption=false);if(this._scrollToFocusedOptionOnUpdate&&this.focused&&this.menu){this._scrollToFocusedOptionOnUpdate=false;var focusedDOM=(0,_reactDom.findDOMNode)(this.focused);var menuDOM=(0,_reactDom.findDOMNode)(this.menu);var focusedRect=focusedDOM.getBoundingClientRect();var menuRect=menuDOM.getBoundingClientRect();focusedRect.bottom>menuRect.bottom?menuDOM.scrollTop=focusedDOM.offsetTop+focusedDOM.clientHeight-menuDOM.offsetHeight:focusedRect.top<menuRect.top&&(menuDOM.scrollTop=focusedDOM.offsetTop)}if(this.props.scrollMenuIntoView&&this.menuContainer){var menuContainerRect=this.menuContainer.getBoundingClientRect();window.innerHeight<menuContainerRect.bottom+this.props.menuBuffer&&window.scrollBy(0,menuContainerRect.bottom+this.props.menuBuffer-window.innerHeight)}if(prevProps.disabled!==this.props.disabled){this.setState({isFocused:false});this.closeMenu()}if(prevState.isOpen!==this.state.isOpen){this.toggleTouchOutsideEvent(this.state.isOpen);var handler=this.state.isOpen?this.props.onOpen:this.props.onClose;handler&&handler()}}},{key:"componentWillUnmount",value:function componentWillUnmount(){this.toggleTouchOutsideEvent(false)}},{key:"toggleTouchOutsideEvent",value:function toggleTouchOutsideEvent(enabled){enabled?!document.addEventListener&&document.attachEvent?document.attachEvent("ontouchstart",this.handleTouchOutside):document.addEventListener("touchstart",this.handleTouchOutside):!document.removeEventListener&&document.detachEvent?document.detachEvent("ontouchstart",this.handleTouchOutside):document.removeEventListener("touchstart",this.handleTouchOutside)}},{key:"handleTouchOutside",value:function handleTouchOutside(event){this.wrapper&&!this.wrapper.contains(event.target)&&this.closeMenu()}},{key:"focus",value:function focus(){if(!this.input)return;this.input.focus()}},{key:"blurInput",value:function blurInput(){if(!this.input)return;this.input.blur()}},{key:"handleTouchMove",value:function handleTouchMove(){this.dragging=true}},{key:"handleTouchStart",value:function handleTouchStart(){this.dragging=false}},{key:"handleTouchEnd",value:function handleTouchEnd(event){if(this.dragging)return;this.handleMouseDown(event)}},{key:"handleTouchEndClearValue",value:function handleTouchEndClearValue(event){if(this.dragging)return;this.clearValue(event)}},{key:"handleMouseDown",value:function handleMouseDown(event){if(this.props.disabled||"mousedown"===event.type&&0!==event.button)return;if("INPUT"===event.target.tagName){if(this.state.isFocused)this.state.isOpen||this.setState({isOpen:true,isPseudoFocused:false});else{this._openAfterFocus=this.props.openOnClick;this.focus()}return}event.preventDefault();if(!this.props.searchable){this.focus();return this.setState({isOpen:!this.state.isOpen})}if(this.state.isFocused){this.focus();var input=this.input;var toOpen=true;"function"===typeof input.getInput&&(input=input.getInput());input.value="";if(this._focusAfterClear){toOpen=false;this._focusAfterClear=false}this.setState({isOpen:toOpen,isPseudoFocused:false,focusedOption:null})}else{this._openAfterFocus=this.props.openOnClick;this.focus();this.setState({focusedOption:null})}}},{key:"handleMouseDownOnArrow",value:function handleMouseDownOnArrow(event){if(this.props.disabled||"mousedown"===event.type&&0!==event.button)return;if(this.state.isOpen){event.stopPropagation();event.preventDefault();this.closeMenu()}else this.setState({isOpen:true})}},{key:"handleMouseDownOnMenu",value:function handleMouseDownOnMenu(event){if(this.props.disabled||"mousedown"===event.type&&0!==event.button)return;event.stopPropagation();event.preventDefault();this._openAfterFocus=true;this.focus()}},{key:"closeMenu",value:function closeMenu(){this.props.onCloseResetsInput?this.setState({inputValue:this.handleInputValueChange(""),isOpen:false,isPseudoFocused:this.state.isFocused&&!this.props.multi}):this.setState({isOpen:false,isPseudoFocused:this.state.isFocused&&!this.props.multi});this.hasScrolledToOption=false}},{key:"handleInputFocus",value:function handleInputFocus(event){if(this.props.disabled)return;var toOpen=this.state.isOpen||this._openAfterFocus||this.props.openOnFocus;toOpen=!this._focusAfterClear&&toOpen;this.props.onFocus&&this.props.onFocus(event);this.setState({isFocused:true,isOpen:!!toOpen});this._focusAfterClear=false;this._openAfterFocus=false}},{key:"handleInputBlur",value:function handleInputBlur(event){if(this.menu&&(this.menu===document.activeElement||this.menu.contains(document.activeElement))){this.focus();return}this.props.onBlur&&this.props.onBlur(event);var onBlurredState={isFocused:false,isOpen:false,isPseudoFocused:false};this.props.onBlurResetsInput&&(onBlurredState.inputValue=this.handleInputValueChange(""));this.setState(onBlurredState)}},{key:"handleInputChange",value:function handleInputChange(event){var newInputValue=event.target.value;this.state.inputValue!==event.target.value&&(newInputValue=this.handleInputValueChange(newInputValue));this.setState({inputValue:newInputValue,isOpen:true,isPseudoFocused:false})}},{key:"setInputValue",value:function setInputValue(newValue){if(this.props.onInputChange){var nextState=this.props.onInputChange(newValue);null!=nextState&&"object"!==("undefined"===typeof nextState?"undefined":_typeof(nextState))&&(newValue=""+nextState)}this.setState({inputValue:newValue})}},{key:"handleInputValueChange",value:function handleInputValueChange(newValue){if(this.props.onInputChange){var nextState=this.props.onInputChange(newValue);null!=nextState&&"object"!==("undefined"===typeof nextState?"undefined":_typeof(nextState))&&(newValue=""+nextState)}return newValue}},{key:"handleKeyDown",value:function handleKeyDown(event){if(this.props.disabled)return;if("function"===typeof this.props.onInputKeyDown){this.props.onInputKeyDown(event);if(event.defaultPrevented)return}switch(event.keyCode){case 8:if(!this.state.inputValue&&this.props.backspaceRemoves){event.preventDefault();this.popValue()}break;case 9:if(event.shiftKey||!this.state.isOpen||!this.props.tabSelectsValue)break;event.preventDefault();this.selectFocusedOption();break;case 13:event.preventDefault();event.stopPropagation();this.state.isOpen?this.selectFocusedOption():this.focusNextOption();break;case 27:event.preventDefault();if(this.state.isOpen){this.closeMenu();event.stopPropagation()}else if(this.props.clearable&&this.props.escapeClearsValue){this.clearValue(event);event.stopPropagation()}break;case 32:if(this.props.searchable)break;event.preventDefault();if(!this.state.isOpen){this.focusNextOption();break}event.stopPropagation();this.selectFocusedOption();break;case 38:event.preventDefault();this.focusPreviousOption();break;case 40:event.preventDefault();this.focusNextOption();break;case 33:event.preventDefault();this.focusPageUpOption();break;case 34:event.preventDefault();this.focusPageDownOption();break;case 35:if(event.shiftKey)break;event.preventDefault();this.focusEndOption();break;case 36:if(event.shiftKey)break;event.preventDefault();this.focusStartOption();break;case 46:if(!this.state.inputValue&&this.props.deleteRemoves){event.preventDefault();this.popValue()}}}},{key:"handleValueClick",value:function handleValueClick(option,event){if(!this.props.onValueClick)return;this.props.onValueClick(option,event)}},{key:"handleMenuScroll",value:function handleMenuScroll(event){if(!this.props.onMenuScrollToBottom)return;var target=event.target;target.scrollHeight>target.offsetHeight&&target.scrollHeight-target.offsetHeight-target.scrollTop<=0&&this.props.onMenuScrollToBottom()}},{key:"getOptionLabel",value:function getOptionLabel(op){return op[this.props.labelKey]}},{key:"getValueArray",value:function getValueArray(value){var nextProps=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;var props="object"===("undefined"===typeof nextProps?"undefined":_typeof(nextProps))?nextProps:this.props;if(props.multi){"string"===typeof value&&(value=value.split(props.delimiter));if(!Array.isArray(value)){if(null===value||void 0===value)return[];value=[value]}return value.map(function(value){return expandValue(value,props)}).filter(function(i){return i})}var expandedValue=expandValue(value,props);return expandedValue?[expandedValue]:[]}},{key:"setValue",value:function setValue(value){var _this2=this;this.props.autoBlur&&this.blurInput();if(this.props.required){var required=handleRequired(value,this.props.multi);this.setState({required:required})}this.props.simpleValue&&value&&(value=this.props.multi?value.map(function(i){return i[_this2.props.valueKey]}).join(this.props.delimiter):value[this.props.valueKey]);this.props.onChange&&this.props.onChange(value)}},{key:"selectValue",value:function selectValue(value){var _this3=this;this.props.closeOnSelect&&(this.hasScrolledToOption=false);var updatedValue=this.props.onSelectResetsInput?"":this.state.inputValue;this.props.multi?this.setState({focusedIndex:null,inputValue:this.handleInputValueChange(updatedValue),isOpen:!this.props.closeOnSelect},function(){var valueArray=_this3.getValueArray(_this3.props.value);valueArray.some(function(i){return i[_this3.props.valueKey]===value[_this3.props.valueKey]})?_this3.removeValue(value):_this3.addValue(value)}):this.setState({inputValue:this.handleInputValueChange(updatedValue),isOpen:!this.props.closeOnSelect,isPseudoFocused:this.state.isFocused},function(){_this3.setValue(value)})}},{key:"addValue",value:function addValue(value){var valueArray=this.getValueArray(this.props.value);var visibleOptions=this._visibleOptions.filter(function(val){return!val.disabled});var lastValueIndex=visibleOptions.indexOf(value);this.setValue(valueArray.concat(value));visibleOptions.length-1===lastValueIndex?this.focusOption(visibleOptions[lastValueIndex-1]):visibleOptions.length>lastValueIndex&&this.focusOption(visibleOptions[lastValueIndex+1])}},{key:"popValue",value:function popValue(){var valueArray=this.getValueArray(this.props.value);if(!valueArray.length)return;if(false===valueArray[valueArray.length-1].clearableValue)return;this.setValue(this.props.multi?valueArray.slice(0,valueArray.length-1):null)}},{key:"removeValue",value:function removeValue(value){var _this4=this;var valueArray=this.getValueArray(this.props.value);this.setValue(valueArray.filter(function(i){return i[_this4.props.valueKey]!==value[_this4.props.valueKey]}));this.focus()}},{key:"clearValue",value:function clearValue(event){if(event&&"mousedown"===event.type&&0!==event.button)return;event.preventDefault();this.setValue(this.getResetValue());this.setState({inputValue:this.handleInputValueChange(""),isOpen:false},this.focus);this._focusAfterClear=true}},{key:"getResetValue",value:function getResetValue(){return void 0!==this.props.resetValue?this.props.resetValue:this.props.multi?[]:null}},{key:"focusOption",value:function focusOption(option){this.setState({focusedOption:option})}},{key:"focusNextOption",value:function focusNextOption(){this.focusAdjacentOption("next")}},{key:"focusPreviousOption",value:function focusPreviousOption(){this.focusAdjacentOption("previous")}},{key:"focusPageUpOption",value:function focusPageUpOption(){this.focusAdjacentOption("page_up")}},{key:"focusPageDownOption",value:function focusPageDownOption(){this.focusAdjacentOption("page_down")}},{key:"focusStartOption",value:function focusStartOption(){this.focusAdjacentOption("start")}},{key:"focusEndOption",value:function focusEndOption(){this.focusAdjacentOption("end")}},{key:"focusAdjacentOption",value:function focusAdjacentOption(dir){var options=this._visibleOptions.map(function(option,index){return{option:option,index:index}}).filter(function(option){return!option.option.disabled});this._scrollToFocusedOptionOnUpdate=true;if(!this.state.isOpen){var newState={focusedOption:this._focusedOption||(options.length?options["next"===dir?0:options.length-1].option:null),isOpen:true};this.props.onSelectResetsInput&&(newState.inputValue="");this.setState(newState);return}if(!options.length)return;var focusedIndex=-1;for(var i=0;i<options.length;i++)if(this._focusedOption===options[i].option){focusedIndex=i;break}if("next"===dir&&-1!==focusedIndex)focusedIndex=(focusedIndex+1)%options.length;else if("previous"===dir)focusedIndex>0?focusedIndex-=1:focusedIndex=options.length-1;else if("start"===dir)focusedIndex=0;else if("end"===dir)focusedIndex=options.length-1;else if("page_up"===dir){var potentialIndex=focusedIndex-this.props.pageSize;focusedIndex=potentialIndex<0?0:potentialIndex}else if("page_down"===dir){var _potentialIndex=focusedIndex+this.props.pageSize;focusedIndex=_potentialIndex>options.length-1?options.length-1:_potentialIndex}-1===focusedIndex&&(focusedIndex=0);this.setState({focusedIndex:options[focusedIndex].index,focusedOption:options[focusedIndex].option})}},{key:"getFocusedOption",value:function getFocusedOption(){return this._focusedOption}},{key:"selectFocusedOption",value:function selectFocusedOption(){if(this._focusedOption)return this.selectValue(this._focusedOption)}},{key:"renderLoading",value:function renderLoading(){if(!this.props.isLoading)return;return _react2.default.createElement("span",{className:"Select-loading-zone","aria-hidden":"true"},_react2.default.createElement("span",{className:"Select-loading"}))}},{key:"renderValue",value:function renderValue(valueArray,isOpen){var _this5=this;var renderLabel=this.props.valueRenderer||this.getOptionLabel;var ValueComponent=this.props.valueComponent;if(!valueArray.length){var showPlaceholder=shouldShowPlaceholder(this.state,this.props,isOpen);return showPlaceholder?_react2.default.createElement("div",{className:"Select-placeholder"},this.props.placeholder):null}var onClick=this.props.onValueClick?this.handleValueClick:null;if(this.props.multi)return valueArray.map(function(value,i){return _react2.default.createElement(ValueComponent,{disabled:_this5.props.disabled||false===value.clearableValue,id:_this5._instancePrefix+"-value-"+i,instancePrefix:_this5._instancePrefix,key:"value-"+i+"-"+value[_this5.props.valueKey],onClick:onClick,onRemove:_this5.removeValue,placeholder:_this5.props.placeholder,value:value},renderLabel(value,i),_react2.default.createElement("span",{className:"Select-aria-only"}," "))});if(shouldShowValue(this.state,this.props)){isOpen&&(onClick=null);return _react2.default.createElement(ValueComponent,{disabled:this.props.disabled,id:this._instancePrefix+"-value-item",instancePrefix:this._instancePrefix,onClick:onClick,placeholder:this.props.placeholder,value:valueArray[0]},renderLabel(valueArray[0]))}}},{key:"renderInput",value:function renderInput(valueArray,focusedOptionIndex){var _classNames,_this6=this;var className=(0,_classnames2.default)("Select-input",this.props.inputProps.className);var isOpen=this.state.isOpen;var ariaOwns=(0,_classnames2.default)((_classNames={},_defineProperty(_classNames,this._instancePrefix+"-list",isOpen),_defineProperty(_classNames,this._instancePrefix+"-backspace-remove-message",this.props.multi&&!this.props.disabled&&this.state.isFocused&&!this.state.inputValue),_classNames));var value=this.state.inputValue;!value||this.props.onSelectResetsInput||this.state.isFocused||(value="");var inputProps=_extends({},this.props.inputProps,{"aria-activedescendant":isOpen?this._instancePrefix+"-option-"+focusedOptionIndex:this._instancePrefix+"-value","aria-describedby":this.props["aria-describedby"],"aria-expanded":""+isOpen,"aria-haspopup":""+isOpen,"aria-label":this.props["aria-label"],"aria-labelledby":this.props["aria-labelledby"],"aria-owns":ariaOwns,className:className,onBlur:this.handleInputBlur,onChange:this.handleInputChange,onFocus:this.handleInputFocus,ref:function ref(_ref){return _this6.input=_ref},role:"combobox",required:this.state.required,tabIndex:this.props.tabIndex,value:value});if(this.props.inputRenderer)return this.props.inputRenderer(inputProps);if(this.props.disabled||!this.props.searchable){var divProps=_objectWithoutProperties(this.props.inputProps,[]);var _ariaOwns=(0,_classnames2.default)(_defineProperty({},this._instancePrefix+"-list",isOpen));return _react2.default.createElement("div",_extends({},divProps,{"aria-expanded":isOpen,"aria-owns":_ariaOwns,"aria-activedescendant":isOpen?this._instancePrefix+"-option-"+focusedOptionIndex:this._instancePrefix+"-value","aria-disabled":""+this.props.disabled,"aria-label":this.props["aria-label"],"aria-labelledby":this.props["aria-labelledby"],className:className,onBlur:this.handleInputBlur,onFocus:this.handleInputFocus,ref:function ref(_ref2){return _this6.input=_ref2},role:"combobox",style:{border:0,width:1,display:"inline-block"},tabIndex:this.props.tabIndex||0}))}if(this.props.autosize)return _react2.default.createElement(_reactInputAutosize2.default,_extends({id:this.props.id},inputProps,{minWidth:"5"}));return _react2.default.createElement("div",{className:className,key:"input-wrap",style:{display:"inline-block"}},_react2.default.createElement("input",_extends({id:this.props.id},inputProps)))}},{key:"renderClear",value:function renderClear(){var valueArray=this.getValueArray(this.props.value);if(!this.props.clearable||!valueArray.length||this.props.disabled||this.props.isLoading)return;var ariaLabel=this.props.multi?this.props.clearAllText:this.props.clearValueText;var clear=this.props.clearRenderer();return _react2.default.createElement("span",{"aria-label":ariaLabel,className:"Select-clear-zone",onMouseDown:this.clearValue,onTouchEnd:this.handleTouchEndClearValue,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,title:ariaLabel},clear)}},{key:"renderArrow",value:function renderArrow(){if(!this.props.arrowRenderer)return;var onMouseDown=this.handleMouseDownOnArrow;var isOpen=this.state.isOpen;var arrow=this.props.arrowRenderer({onMouseDown:onMouseDown,isOpen:isOpen});if(!arrow)return null;return _react2.default.createElement("span",{className:"Select-arrow-zone",onMouseDown:onMouseDown},arrow)}},{key:"filterOptions",value:function filterOptions(excludeOptions){var filterValue=this.state.inputValue;var options=this.props.options||[];if(this.props.filterOptions){var filterOptions="function"===typeof this.props.filterOptions?this.props.filterOptions:_defaultFilterOptions2.default;return filterOptions(options,filterValue,excludeOptions,{filterOption:this.props.filterOption,ignoreAccents:this.props.ignoreAccents,ignoreCase:this.props.ignoreCase,labelKey:this.props.labelKey,matchPos:this.props.matchPos,matchProp:this.props.matchProp,trimFilter:this.props.trimFilter,valueKey:this.props.valueKey})}return options}},{key:"onOptionRef",value:function onOptionRef(ref,isFocused){isFocused&&(this.focused=ref)}},{key:"renderMenu",value:function renderMenu(options,valueArray,focusedOption){return options&&options.length?this.props.menuRenderer({focusedOption:focusedOption,focusOption:this.focusOption,inputValue:this.state.inputValue,instancePrefix:this._instancePrefix,labelKey:this.props.labelKey,onFocus:this.focusOption,onOptionRef:this.onOptionRef,onSelect:this.selectValue,optionClassName:this.props.optionClassName,optionComponent:this.props.optionComponent,optionRenderer:this.props.optionRenderer||this.getOptionLabel,options:options,removeValue:this.removeValue,selectValue:this.selectValue,valueArray:valueArray,valueKey:this.props.valueKey}):this.props.noResultsText?_react2.default.createElement("div",{className:"Select-noresults"},this.props.noResultsText):null}},{key:"renderHiddenField",value:function renderHiddenField(valueArray){var _this7=this;if(!this.props.name)return;if(this.props.joinValues){var value=valueArray.map(function(i){return stringifyValue(i[_this7.props.valueKey])}).join(this.props.delimiter);return _react2.default.createElement("input",{disabled:this.props.disabled,name:this.props.name,ref:function ref(_ref3){return _this7.value=_ref3},type:"hidden",value:value})}return valueArray.map(function(item,index){return _react2.default.createElement("input",{disabled:_this7.props.disabled,key:"hidden."+index,name:_this7.props.name,ref:"value"+index,type:"hidden",value:stringifyValue(item[_this7.props.valueKey])})})}},{key:"getFocusableOptionIndex",value:function getFocusableOptionIndex(selectedOption){var options=this._visibleOptions;if(!options.length)return null;var valueKey=this.props.valueKey;var focusedOption=this.state.focusedOption||selectedOption;if(focusedOption&&!focusedOption.disabled){var focusedOptionIndex=-1;options.some(function(option,index){var isOptionEqual=option[valueKey]===focusedOption[valueKey];isOptionEqual&&(focusedOptionIndex=index);return isOptionEqual});if(-1!==focusedOptionIndex)return focusedOptionIndex}for(var i=0;i<options.length;i++)if(!options[i].disabled)return i;return null}},{key:"renderOuter",value:function renderOuter(options,valueArray,focusedOption){var _this8=this;var menu=this.renderMenu(options,valueArray,focusedOption);if(!menu)return null;return _react2.default.createElement("div",{ref:function ref(_ref5){return _this8.menuContainer=_ref5},className:"Select-menu-outer",style:this.props.menuContainerStyle},_react2.default.createElement("div",{className:"Select-menu",id:this._instancePrefix+"-list",onMouseDown:this.handleMouseDownOnMenu,onScroll:this.handleMenuScroll,ref:function ref(_ref4){return _this8.menu=_ref4},role:"listbox",style:this.props.menuStyle,tabIndex:-1},menu))}},{key:"render",value:function render(){var _this9=this;var valueArray=this.getValueArray(this.props.value);var options=this._visibleOptions=this.filterOptions(this.props.multi&&this.props.removeSelected?valueArray:null);var isOpen=this.state.isOpen;this.props.multi&&!options.length&&valueArray.length&&!this.state.inputValue&&(isOpen=false);var focusedOptionIndex=this.getFocusableOptionIndex(valueArray[0]);var focusedOption=null;focusedOption=this._focusedOption=null!==focusedOptionIndex?options[focusedOptionIndex]:null;var className=(0,_classnames2.default)("Select",this.props.className,{"has-value":valueArray.length,"is-clearable":this.props.clearable,"is-disabled":this.props.disabled,"is-focused":this.state.isFocused,"is-loading":this.props.isLoading,"is-open":isOpen,"is-pseudo-focused":this.state.isPseudoFocused,"is-searchable":this.props.searchable,"Select--multi":this.props.multi,"Select--rtl":this.props.rtl,"Select--single":!this.props.multi});var removeMessage=null;this.props.multi&&!this.props.disabled&&valueArray.length&&!this.state.inputValue&&this.state.isFocused&&this.props.backspaceRemoves&&(removeMessage=_react2.default.createElement("span",{id:this._instancePrefix+"-backspace-remove-message",className:"Select-aria-only","aria-live":"assertive"},this.props.backspaceToRemoveMessage.replace("{label}",valueArray[valueArray.length-1][this.props.labelKey])));return _react2.default.createElement("div",{ref:function ref(_ref7){return _this9.wrapper=_ref7},className:className,style:this.props.wrapperStyle},this.renderHiddenField(valueArray),_react2.default.createElement("div",{ref:function ref(_ref6){return _this9.control=_ref6},className:"Select-control",onKeyDown:this.handleKeyDown,onMouseDown:this.handleMouseDown,onTouchEnd:this.handleTouchEnd,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,style:this.props.style},_react2.default.createElement("span",{className:"Select-multi-value-wrapper",id:this._instancePrefix+"-value"},this.renderValue(valueArray,isOpen),this.renderInput(valueArray,focusedOptionIndex)),removeMessage,this.renderLoading(),this.renderClear(),this.renderArrow()),isOpen?this.renderOuter(options,valueArray,focusedOption):null)}}]);return Select}(_react2.default.Component);Select.propTypes={"aria-describedby":_propTypes2.default.string,"aria-label":_propTypes2.default.string,"aria-labelledby":_propTypes2.default.string,arrowRenderer:_propTypes2.default.func,autoBlur:_propTypes2.default.bool,autoFocus:_propTypes2.default.bool,autofocus:_propTypes2.default.bool,autosize:_propTypes2.default.bool,backspaceRemoves:_propTypes2.default.bool,backspaceToRemoveMessage:_propTypes2.default.string,className:_propTypes2.default.string,clearAllText:stringOrNode,clearRenderer:_propTypes2.default.func,clearValueText:stringOrNode,clearable:_propTypes2.default.bool,closeOnSelect:_propTypes2.default.bool,deleteRemoves:_propTypes2.default.bool,delimiter:_propTypes2.default.string,disabled:_propTypes2.default.bool,escapeClearsValue:_propTypes2.default.bool,filterOption:_propTypes2.default.func,filterOptions:_propTypes2.default.any,id:_propTypes2.default.string,ignoreAccents:_propTypes2.default.bool,ignoreCase:_propTypes2.default.bool,inputProps:_propTypes2.default.object,inputRenderer:_propTypes2.default.func,instanceId:_propTypes2.default.string,isLoading:_propTypes2.default.bool,joinValues:_propTypes2.default.bool,labelKey:_propTypes2.default.string,matchPos:_propTypes2.default.string,matchProp:_propTypes2.default.string,menuBuffer:_propTypes2.default.number,menuContainerStyle:_propTypes2.default.object,menuRenderer:_propTypes2.default.func,menuStyle:_propTypes2.default.object,multi:_propTypes2.default.bool,name:_propTypes2.default.string,noResultsText:stringOrNode,onBlur:_propTypes2.default.func,onBlurResetsInput:_propTypes2.default.bool,onChange:_propTypes2.default.func,onClose:_propTypes2.default.func,onCloseResetsInput:_propTypes2.default.bool,onFocus:_propTypes2.default.func,onInputChange:_propTypes2.default.func,onInputKeyDown:_propTypes2.default.func,onMenuScrollToBottom:_propTypes2.default.func,onOpen:_propTypes2.default.func,onSelectResetsInput:_propTypes2.default.bool,onValueClick:_propTypes2.default.func,openOnClick:_propTypes2.default.bool,openOnFocus:_propTypes2.default.bool,optionClassName:_propTypes2.default.string,optionComponent:_propTypes2.default.func,optionRenderer:_propTypes2.default.func,options:_propTypes2.default.array,pageSize:_propTypes2.default.number,placeholder:stringOrNode,removeSelected:_propTypes2.default.bool,required:_propTypes2.default.bool,resetValue:_propTypes2.default.any,rtl:_propTypes2.default.bool,scrollMenuIntoView:_propTypes2.default.bool,searchable:_propTypes2.default.bool,simpleValue:_propTypes2.default.bool,style:_propTypes2.default.object,tabIndex:stringOrNumber,tabSelectsValue:_propTypes2.default.bool,trimFilter:_propTypes2.default.bool,value:_propTypes2.default.any,valueComponent:_propTypes2.default.func,valueKey:_propTypes2.default.string,valueRenderer:_propTypes2.default.func,wrapperStyle:_propTypes2.default.object};Select.defaultProps={arrowRenderer:_defaultArrowRenderer2.default,autosize:true,backspaceRemoves:true,backspaceToRemoveMessage:"Press backspace to remove {label}",clearable:true,clearAllText:"Clear all",clearRenderer:_defaultClearRenderer2.default,clearValueText:"Clear value",closeOnSelect:true,deleteRemoves:true,delimiter:",",disabled:false,escapeClearsValue:true,filterOptions:_defaultFilterOptions2.default,ignoreAccents:true,ignoreCase:true,inputProps:{},isLoading:false,joinValues:false,labelKey:"label",matchPos:"any",matchProp:"any",menuBuffer:0,menuRenderer:_defaultMenuRenderer2.default,multi:false,noResultsText:"No results found",onBlurResetsInput:true,onCloseResetsInput:true,onSelectResetsInput:true,openOnClick:true,optionComponent:_Option2.default,pageSize:5,placeholder:"Select...",removeSelected:true,required:false,rtl:false,scrollMenuIntoView:true,searchable:true,simpleValue:false,tabSelectsValue:true,trimFilter:true,valueComponent:_Value2.default,valueKey:"value"};exports.default=Select},633:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.FullTimeRangeSelectorServiceProvider=FullTimeRangeSelectorServiceProvider;var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _ml_api_service=__webpack_require__(23);var _timefilter=__webpack_require__(14);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function FullTimeRangeSelectorServiceProvider(Notifier){var notify=new Notifier;function setFullTimeRange(indexPattern,query){return _ml_api_service.ml.getTimeFieldRange({index:indexPattern.title,timeFieldName:indexPattern.timeFieldName,query:query}).then(function(resp){_timefilter.timefilter.setTime({from:(0,_moment2.default)(resp.start.epoch).toISOString(),to:(0,_moment2.default)(resp.end.epoch).toISOString()})}).catch(function(resp){notify.error(resp)})}return{setFullTimeRange:setFullTimeRange}}},634:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlSimpleJobSearchService=void 0;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _index_patterns=__webpack_require__(368);var _string_utils=__webpack_require__(40);var _ml_api_service=__webpack_require__(23);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function getScoresByRecord(jobId,earliestMs,latestMs,interval,firstSplitField){return new Promise(function(resolve,reject){var obj={success:true,results:{}};var jobIdFilterStr="job_id: "+jobId;if(firstSplitField&&void 0!==firstSplitField.value){jobIdFilterStr+=" AND "+(0,_string_utils.escapeForElasticsearchQuery)(firstSplitField.name)+":";jobIdFilterStr+='"'+String(firstSplitField.value).replace(/\\/g,"\\\\")+'"'}_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,size:0,body:{query:{bool:{filter:[{query_string:{query:"result_type:record"}},{bool:{must:[{range:{timestamp:{gte:earliestMs,lte:latestMs,format:"epoch_millis"}}},{query_string:{query:jobIdFilterStr}}]}}]}},aggs:{detector_index:{terms:{field:"detector_index",order:{recordScore:"desc"}},aggs:{recordScore:{max:{field:"record_score"}},byTime:{date_histogram:{field:"timestamp",interval:interval,min_doc_count:1,extended_bounds:{min:earliestMs,max:latestMs}},aggs:{recordScore:{max:{field:"record_score"}}}}}}}}}).then(function(resp){var detectorsByIndex=_lodash2.default.get(resp,["aggregations","detector_index","buckets"],[]);_lodash2.default.each(detectorsByIndex,function(dtr){var dtrResults={};var dtrIndex=+dtr.key;var buckets=_lodash2.default.get(dtr,["byTime","buckets"],[]);for(var j=0;j<buckets.length;j++){var bkt=buckets[j];var time=bkt.key;dtrResults[time]={recordScore:_lodash2.default.get(bkt,["recordScore","value"])}}obj.results[dtrIndex]=dtrResults});resolve(obj)}).catch(function(resp){reject(resp)})})}function getCategoryFields(index,field,size,query){return new Promise(function(resolve,reject){var obj={success:true,results:{}};_ml_api_service.ml.esSearch({index:index,size:0,body:{query:query,aggs:{catFields:{terms:{field:field,size:size}}}}}).then(function(resp){obj.results.values=[];var catFields=_lodash2.default.get(resp,["aggregations","catFields","buckets"],[]);_lodash2.default.each(catFields,function(f){obj.results.values.push(f.key)});resolve(obj)}).catch(function(resp){reject(resp)})})}exports.mlSimpleJobSearchService={getScoresByRecord:getScoresByRecord,getCategoryFields:getCategoryFields}},635:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3774)},636:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3810);__webpack_require__(3812)},637:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.formatValue=formatValue;var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _modules=__webpack_require__(2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _module=_modules.uiModules.get("apps/ml");var SIGFIGS_IF_ROUNDING=3;function formatValue(value,mlFunction,fieldFormat){if(Array.isArray(value)){if(1===value.length)return formatSingleValue(value[0],mlFunction,fieldFormat);var values=value.map(function(val){return formatSingleValue(val,mlFunction,fieldFormat)});return"["+values+"]"}return formatSingleValue(value,mlFunction,fieldFormat)}function formatSingleValue(value,mlFunction,fieldFormat){if(void 0===value||null===value)return"";if("time_of_week"===mlFunction){var d=new Date;var i=parseInt(value);d.setTime(1e3*i);return(0,_moment2.default)(d).format("ddd hh:mm")}if("time_of_day"===mlFunction){var _d=new Date;var _i=parseInt(value);_d.setTime(1e3*_i);return(0,_moment2.default)(_d).format("hh:mm")}if(void 0!==fieldFormat)return fieldFormat.convert(value,"text");var absValue=Math.abs(value);if(absValue>=1e4||absValue===Math.floor(absValue))return void 0!==fieldFormat?fieldFormat.convert(value,"text"):Number(value.toFixed(0));if(absValue>=10)return Number(value.toFixed(1));var multiple=void 0;multiple=value>0?Math.pow(10,SIGFIGS_IF_ROUNDING-Math.floor(Math.log(value)/Math.LN10)-1):Math.pow(10,SIGFIGS_IF_ROUNDING-Math.floor(Math.log(-1*value)/Math.LN10)-1);return Math.round(value*multiple)/multiple}_module.filter("formatValue",function(){return formatValue})},638:function(module,exports,__webpack_require__){var types=__webpack_require__(505);var SUPPORTED_PARTS=["FREQ","INTERVAL","COUNT","UNTIL","BYDAY","BYMONTH","BYMONTHDAY"];var WKDAYS=["SU","MO","TU","WE","TH","FR","SA"];function to_utc_date(dt){if(Array.isArray(dt)){dt=dt.slice(0);dt[1]--}else dt=[dt.getFullYear(),dt.getMonth(),dt.getDate(),dt.getHours(),dt.getMinutes(),dt.getSeconds(),dt.getMilliseconds()];return new Date(Date.UTC.apply(null,dt))}function from_utc_date(udt){var dt=new Date(udt.getUTCFullYear(),udt.getUTCMonth(),udt.getUTCDate(),udt.getUTCHours(),udt.getUTCMinutes(),udt.getUTCSeconds(),udt.getUTCMilliseconds());return dt}function trunc(n){return n<0?Math.ceil(n):Math.floor(n)}function y(dt){return dt.getUTCFullYear()}function m(dt){return dt.getUTCMonth()+1}function d(dt){return dt.getUTCDate()}function hr(dt){return dt.getUTCHours()}function min(dt){return dt.getUTCMinutes()}function sec(dt){return dt.getUTCSeconds()}function ms(dt){return dt.getUTCMilliseconds()}function set_y(dt,v){dt.setUTCFullYear(v);return dt}function set_m(dt,v){dt.setUTCMonth(v-1);return dt}function set_d(dt,v){dt.setUTCDate(v);return dt}function set_hr(dt,v){dt.setUTCHours(v);return dt}function set_min(dt,v){dt.setUTCMinutes(v);return dt}function set_sec(dt,v){dt.setUTCSeconds(v);return dt}function set_ms(dt,v){dt.setUTCMilliseconds(v);return dt}function add_y(dt,v){return set_y(dt,y(dt)+v)}function add_m(dt,v){return set_m(dt,m(dt)+v)}function add_d(dt,v){return set_d(dt,d(dt)+v)}function wkday(dt){return dt.getUTCDay()}function daydiff(dt1,dt2){return(dt2-dt1)/864e5}var RRule=exports.RRule=function(rule,options,dtend){options instanceof Date&&(options={DTSTART:options,DTEND:dtend});options=options||{};this.start=options.DTSTART?to_utc_date(options.DTSTART):null;this.end=options.DTEND?to_utc_date(options.DTEND):null;this.exceptions=options.EXDATE||[];"string"===typeof rule&&(rule=RRule.parse(rule));this.rule={};for(var i in rule||{}){if(-1==SUPPORTED_PARTS.indexOf(i))throw new Error(i+" is not currently supported!");this.rule[i]=RULE_PARTS[i]?RULE_PARTS[i].parse(rule[i]):rule[i]}};RRule.parse=function(value){var parts=value.split(/=|;/);var rrule={};for(var i=0;i<parts.length;i+=2)rrule[parts[i]]=parts[i+1];return rrule};RRule.prototype.setFrequency=function(freq){this.rule.FREQ=freq};RRule.prototype.valueOf=function(){return this.rule};RRule.prototype.toString=function(){var out=["FREQ="+this.rule.FREQ];for(var k in this.rule){if("FREQ"==k)continue;out.push(k+"="+((RULE_PARTS[k]||{}).format?RULE_PARTS[k].format(this.rule[k]):this.rule[k]))}return out.join(";")};RRule.prototype.next=function(after){after=after&&to_utc_date(after);(!after||after<this.start)&&(after=new Date(this.start.valueOf()-1));if(this.until&&after>this.until)return null;var freq=FREQ[this.rule.FREQ];if(!freq)throw new Error(this.rule.FREQ+" recurrence is not supported");NextOccurs:while(true){var next=freq.next(this.rule,this.start,after);var nextInLocal=from_utc_date(next);for(var i=0;i<this.exceptions.length;i++){var exdate=this.exceptions[i];if(exdate.valueOf()==nextInLocal.valueOf()||exdate.date_only&&y(to_utc_date(exdate))==y(nextInLocal)&&m(to_utc_date(exdate))==m(nextInLocal)&&d(to_utc_date(exdate))==d(nextInLocal)){after=next;continue NextOccurs}}break}if(this.until&&next>this.until)return null;if(this.rule.COUNT&&null!==this.count_end){if(void 0===this.count_end){this.count_end=null;this.count_end=this.nextOccurences(this.rule.COUNT).pop()}if(next>to_utc_date(this.count_end))return null}if(this.rule.UNTIL&&next>to_utc_date(this.rule.UNTIL))return null;return from_utc_date(next)};RRule.prototype.nextOccurences=function(after,count_or_until){if(1===arguments.length){count_or_until=after;after=void 0}var arr=[];if(count_or_until instanceof Date)while(true){after=this.next(after);if(!(after&&after<=count_or_until))break;arr.push(after)}else while(count_or_until--&&null!==after){after=this.next(after);after&&arr.push(after)}return arr};var RULE_PARTS={INTERVAL:{parse:function(v){return parseInt(v,10)}},UNTIL:{parse:function(v){if(v instanceof Date)return v;return types.parse_value("DATE-TIME",v)},format:function(v){return types.format_value("DATE-TIME",v)}},FREQ:{parse:function(v){return v}},BYMONTH:{parse:function(v){if("number"===typeof v)return[v];return v.split(",").map(function(mo){return parseInt(mo,10)})},format:function(v){return v.join(",")}},BYDAY:{parse:function(v){var days=v.split(",").map(function(day){var m=day.match(/([+-]?\d)?(SU|MO|TU|WE|TH|FR|SA)/);return[parseInt(m[1],10)||0,WKDAYS.indexOf(m[2])]});days.sort(function(d1,d2){return d1[0]==d2[0]?d1[1]-d2[1]:d1[0]-d2[0]});return days},format:function(v){return v.map(function(day){return(day[0]||"")+WKDAYS[day[1]]}).join(",")}},EXDATE:{parse:function(v){return v.split(",").map(function(dt){return 8==dt.length?types.parse_value("DATE",dt):types.parse_value("DATE-TIME",dt)})},format:function(v){return v.map(function(dt){return types.format_value(dt.date_only?"DATE":"DATE-TIME",dt)}).join(",")}}};RULE_PARTS["BYMONTHDAY"]=RULE_PARTS["BYMONTH"];RULE_PARTS["COUNT"]=RULE_PARTS["INTERVAL"];var FREQ={DAILY:{next:function(rule,start,after){var next=new Date(after);set_hr(next,hr(start));set_min(next,min(start));set_sec(next,sec(start));set_ms(next,ms(start));var interval=rule.INTERVAL||1;var mod_days=trunc(daydiff(next,start))%interval;mod_days&&add_d(next,interval-mod_days);for(var i=0;i<2;++i){next=byday(rule.BYDAY,next,after);if(next.valueOf()>after.valueOf())break;add_d(next,interval)}return next}},WEEKLY:{next:function(rule,start,after){var next=new Date(after);set_hr(next,hr(start));set_min(next,min(start));set_sec(next,sec(start));set_ms(next,ms(start));var interval=rule.INTERVAL||1;var mod_weeks=trunc(daydiff(start,next)/7)%interval;mod_weeks&&add_d(next,7*(interval-mod_weeks));while(true){next=byday(rule.BYDAY,next,after);if(!rule.BYDAY||!rule.BYDAY.length){startDayOfWeek=wkday(start);nextDayOfWeek=wkday(next);nextDayOfWeek>startDayOfWeek?add_d(next,startDayOfWeek-nextDayOfWeek):startDayOfWeek>nextDayOfWeek&&add_d(next,startDayOfWeek-nextDayOfWeek-7)}if(next.valueOf()>after.valueOf()&&check_bymonth(rule.BYMONTH,next))break;add_d(next,7*interval)}return next}},MONTHLY:{next:function(rule,start,after){var next=new Date(after);set_hr(next,hr(start));set_min(next,min(start));set_sec(next,sec(start));set_ms(next,ms(start));var interval=rule.INTERVAL||1;var delta=m(next)-m(start)+12*(y(next)-y(start));delta%interval&&add_m(next,interval-delta%interval);for(var i=0;i<2;++i){i&&set_d(next,1);next=byday(rule.BYDAY,next,after);next=bymonthday(rule.BYMONTHDAY,next,after);rule.BYDAY&&rule.BYDAY.length||rule.BYMONTHDAY&&rule.BYMONTHDAY.length||set_d(next,d(start));if(next.valueOf()>after.valueOf())break;add_m(next,interval)}return next}},YEARLY:{next:function(rule,start,after){var next=new Date(after);set_hr(next,hr(start));set_min(next,min(start));set_sec(next,sec(start));set_ms(next,ms(start));var interval=rule.INTERVAL||1;var mod_year=(y(after)-y(start))%interval;mod_year&&add_y(next,interval-mod_year);for(var i=0;i<2;++i){next=bymonth(rule.BYMONTH,next);next=bymonthday(rule.BYMONTHDAY,next,after);next=byday(rule.BYDAY,next,after);rule.BYMONTH&&rule.BYMONTH.length||set_m(next,m(start));rule.BYDAY&&rule.BYDAY.length||rule.BYMONTHDAY&&rule.BYMONTHDAY.length||set_d(next,d(start));if(next.valueOf()>after.valueOf())break;set_d(set_m(add_y(next,interval),1),1)}return next}}};function sort_dates(dateary){return dateary.sort(function(dt1,dt2){if(null===dt1&&null===dt2)return 0;if(null===dt1)return 1;if(null===dt2)return-1;return dt1.valueOf()-dt2.valueOf()})}function check_bymonth(rules,dt){if(!rules||!rules.length)return true;return-1!==rules.indexOf(m(dt))}function bymonth(rules,dt){if(!rules||!rules.length)return dt;var candidates=rules.map(function(rule){var delta=rule-m(dt);delta<0&&(delta+=12);var newdt=add_m(new Date(dt),delta);set_d(newdt,1);return newdt});var newdt=sort_dates(candidates).shift();return newdt||dt}function bymonthday(rules,dt,after){if(!rules||!rules.length)return dt;var candidates=rules.map(function(rule){var newdt=set_d(new Date(dt),rule);return newdt.valueOf()<=after.valueOf()?null:newdt});var newdt=sort_dates(candidates).shift();return newdt||dt}function byday(rules,dt,after){if(!rules||!rules.length)return dt;var candidates=rules.map(function(rule){var days=rule[1]-wkday(dt);days<0&&(days+=7);var newdt=add_d(new Date(dt),days);if(rule[0]>0){var wk=0|(d(newdt)-1)/7+1;if(wk>rule[0])return null;add_d(newdt,7*(rule[0]-wk))}else if(rule[0]<0){var dt2=new Date(newdt);days=[];while(m(dt2)===m(newdt)){days.push(d(dt2));add_d(dt2,7)}set_d(newdt,days.reverse()[-rule[0]-1])}if(newdt.valueOf()<=after.valueOf())return null;return newdt});var newdt=sort_dates(candidates).shift();return newdt||dt}},639:function(module,exports,__webpack_require__){__webpack_require__(881);var util=__webpack_require__(428);var CalendarObject=__webpack_require__(145).CalendarObject;__webpack_require__(145).CalendarProperty;var schema=__webpack_require__(145).schema;var iCalendar=exports.iCalendar=function(empty){CalendarObject.call(this,this,"VCALENDAR");this.calendar=this;if(!empty){this.addProperty("VERSION","2.0");this.addProperty("PRODID",__webpack_require__(1458).PRODID)}};util.inherits(iCalendar,CalendarObject);iCalendar.prototype.events=function(){return this.components["VEVENT"]||[]};iCalendar.prototype.timezone=function(tzid){for(var i=0;i<this.components["VTIMEZONE"].length;++i){var tz=this.components["VTIMEZONE"][i];if(tz.getPropertyValue("TZID")==tzid)return tz}};schema.VCALENDAR={factory:iCalendar,valid_properties:[],required_properties:["PRODID","VERSION"],valid_children:["VEVENT"],required_children:[]};schema.VTODO={required_properties:["DTSTAMP","UID"]};schema.VJOURNAL={required_properties:["DTSTAMP","UID"]};schema.VFREEBUSY={required_properties:["DTSTAMP","UID"]};schema.VALARM={required_properties:["ACTION","TRIGGER"]}},68:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.checkLicense=checkLicense;exports.checkLicenseExpired=checkLicenseExpired;exports.getLicenseHasExpired=getLicenseHasExpired;exports.xpackFeatureProvider=xpackFeatureProvider;var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);var _xpack_info=__webpack_require__(58);var _notify=__webpack_require__(9);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _eui=__webpack_require__(3);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var licenseHasExpired=true;var expiredLicenseBannerId=void 0;function checkLicense(Private,kbnBaseUrl){var xpackInfo=Private(_xpack_info.XPackInfoProvider);var features=xpackInfo.get("features.ml");var licenseAllowsToShowThisPage=features.isAvailable;if(!licenseAllowsToShowThisPage){var message=features.message;var queryString="?"+_notify.Notifier.QS_PARAM_LOCATION+"=Machine Learning&";queryString+=_notify.Notifier.QS_PARAM_LEVEL+"=error&"+_notify.Notifier.QS_PARAM_MESSAGE+"="+message;var url=_chrome2.default.addBasePath(kbnBaseUrl)+"#"+queryString;window.location.href=url;return Promise.halt()}licenseHasExpired=features.hasExpired||false;if(licenseHasExpired){var _message=features.message;void 0===expiredLicenseBannerId&&(expiredLicenseBannerId=_notify.banners.add({component:_react2.default.createElement(_eui.EuiCallOut,{iconType:"iInCircle",color:"warning",title:_message})}))}return Promise.resolve(features)}function checkLicenseExpired(Private,Promise,kbnBaseUrl,kbnUrl){return checkLicense(Private,Promise,kbnBaseUrl).then(function(features){if(features.hasExpired){kbnUrl.redirect("/jobs");return Promise.halt()}return Promise.resolve(features)}).catch(function(){return Promise.halt()})}function getLicenseHasExpired(){return licenseHasExpired}function xpackFeatureProvider(Private){var xpackInfo=Private(_xpack_info.XPackInfoProvider);function isAvailable(feature){return xpackInfo.get("features."+feature+".isAvailable",false)}return{isAvailable:isAvailable}}},69:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.checkMlNodesAvailable=checkMlNodesAvailable;exports.getMlNodeCount=getMlNodeCount;exports.mlNodesAvailable=mlNodesAvailable;exports.permissionToViewMlNodeCount=permissionToViewMlNodeCount;var _ml_api_service=__webpack_require__(23);var mlNodeCount=0;var userHasPermissionToViewMlNodeCount=false;function checkMlNodesAvailable(kbnUrl){getMlNodeCount().then(function(nodes){if(void 0!==nodes.count&&nodes.count>0)Promise.resolve();else{kbnUrl.redirect("/jobs");Promise.reject()}})}function getMlNodeCount(){return new Promise(function(resolve){_ml_api_service.ml.mlNodeCount().then(function(nodes){mlNodeCount=nodes.count;userHasPermissionToViewMlNodeCount=true;resolve(nodes)}).catch(function(error){mlNodeCount=0;403===error.statusCode?userHasPermissionToViewMlNodeCount=false:console.error(error);resolve({count:0})})})}function mlNodesAvailable(){return 0!==mlNodeCount}function permissionToViewMlNodeCount(){return userHasPermissionToViewMlNodeCount}},79:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlMessageBarService=void 0;var _typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _notify=__webpack_require__(9);var _ml_error=__webpack_require__(3607);var messages=[];var MSG_STYLE={INFO:"ml-message-info",WARNING:"ml-message-warning",ERROR:"ml-message-error"};function getMessages(){return messages}function addMessage(msg){void 0===messages.find(function(m){return m.text===msg.text&&m.style===msg.style})&&messages.push(msg)}function removeMessage(index){messages.splice(index,1)}function clear(){messages.length=0}function info(text){addMessage({text:text,style:MSG_STYLE.INFO})}function warning(text){addMessage({text:text,style:MSG_STYLE.WARNING})}function error(text,resp){text=text+" "+expandErrorMessageObj(resp);addMessage({text:text,style:MSG_STYLE.ERROR})}function expandErrorMessageObj(resp){var txt="";if(void 0!==resp&&"object"===("undefined"===typeof resp?"undefined":_typeof(resp)))try{var respObj=JSON.parse(resp.response);"object"===("undefined"===typeof respObj?"undefined":_typeof(respObj))&&void 0!==respObj.error&&(txt=respObj.error.reason)}catch(e){txt=resp.message}return txt}function errorNotify(text,resp){var err=null;"object"===("undefined"===typeof text?"undefined":_typeof(text))&&void 0!==text.response?resp=text.response:err="object"===("undefined"===typeof text?"undefined":_typeof(text))&&void 0!==text.message?new Error(text.message):new Error(text);_notify.notify.error(new _ml_error.MLRequestFailure(err,resp))}exports.mlMessageBarService={getMessages:getMessages,addMessage:addMessage,removeMessage:removeMessage,clear:clear,info:info,warning:warning,error:error,notify:{error:errorNotify}}},864:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _ml_job_editor=__webpack_require__(3623);Object.defineProperty(exports,"MLJobEditor",{enumerable:true,get:function get(){return _ml_job_editor.MLJobEditor}})},865:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.getNewCustomUrlDefaults=getNewCustomUrlDefaults;exports.getQueryEntityFieldNames=getQueryEntityFieldNames;exports.isValidCustomUrlLabel=isValidCustomUrlLabel;exports.isValidCustomUrlSettingsTimeRange=isValidCustomUrlSettingsTimeRange;exports.isValidCustomUrlSettings=isValidCustomUrlSettings;exports.buildCustomUrlFromSettings=buildCustomUrlFromSettings;exports.getTestUrl=getTestUrl;var _constants=__webpack_require__(866);var _chrome=__webpack_require__(8);var _chrome2=_interopRequireDefault(_chrome);var _risonNode=__webpack_require__(254);var _risonNode2=_interopRequireDefault(_risonNode);var _index_patterns=__webpack_require__(368);var _job_utils=__webpack_require__(41);var _parse_interval=__webpack_require__(127);var _custom_url_utils=__webpack_require__(867);var _ml_api_service=__webpack_require__(23);var _job_service=__webpack_require__(24);var _string_utils=__webpack_require__(40);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){key in obj?Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true}):obj[key]=value;return obj}function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}function getNewCustomUrlDefaults(job,dashboards,indexPatterns){var kibanaSettings={queryFieldNames:[]};var urlType=_constants.URL_TYPE.OTHER;if(void 0!==dashboards&&dashboards.length>0){urlType=_constants.URL_TYPE.KIBANA_DASHBOARD;kibanaSettings.dashboardId=dashboards[0].id}else void 0!==indexPatterns&&indexPatterns.length>0&&(urlType=_constants.URL_TYPE.KIBANA_DISCOVER);var datafeedConfig=job.datafeed_config;if(void 0!==indexPatterns&&indexPatterns.length>0&&void 0!==datafeedConfig&&void 0!==datafeedConfig.indices&&datafeedConfig.indices.length>0){var datafeedIndex=datafeedConfig.indices[0];var defaultIndexPattern=indexPatterns.find(function(indexPattern){return indexPattern.title===datafeedIndex});void 0===defaultIndexPattern&&(defaultIndexPattern=indexPatterns[0]);kibanaSettings.discoverIndexPatternId=defaultIndexPattern.id}return{label:"",type:urlType,timeRange:{type:_constants.TIME_RANGE_TYPE.AUTO,interval:""},kibanaSettings:kibanaSettings,otherUrlSettings:{urlValue:""}}}function getQueryEntityFieldNames(job){var influencers=job.analysis_config.influencers;var detectors=job.analysis_config.detectors;var entityFieldNames=[];void 0!==influencers&&entityFieldNames.push.apply(entityFieldNames,_toConsumableArray(influencers));detectors.forEach(function(detector,detectorIndex){var partitioningFields=(0,_job_utils.getPartitioningFieldNames)(job,detectorIndex);partitioningFields.forEach(function(fieldName){-1===entityFieldNames.indexOf(fieldName)&&entityFieldNames.push(fieldName)})});return entityFieldNames}function isValidCustomUrlLabel(label){return void 0!==label&&label.trim().length>0}function isValidCustomUrlSettingsTimeRange(timeRangeSettings){if(timeRangeSettings.type===_constants.TIME_RANGE_TYPE.INTERVAL){var interval=(0,_parse_interval.parseInterval)(timeRangeSettings.interval);return null!==interval}return true}function isValidCustomUrlSettings(settings){var isValid=isValidCustomUrlLabel(settings.label);true===isValid&&(isValid=isValidCustomUrlSettingsTimeRange(settings.timeRange));return isValid}function buildCustomUrlFromSettings(settings,job){if(settings.type===_constants.URL_TYPE.KIBANA_DASHBOARD)return buildDashboardUrlFromSettings(settings);if(settings.type===_constants.URL_TYPE.KIBANA_DISCOVER)return Promise.resolve(buildDiscoverUrlFromSettings(settings,job));var urlToAdd={url_name:settings.label,url_value:settings.otherUrlSettings.urlValue};return Promise.resolve(urlToAdd)}function buildDashboardUrlFromSettings(settings){return new Promise(function(resolve,reject){var _settings$kibanaSetti=settings.kibanaSettings,dashboardId=_settings$kibanaSetti.dashboardId,queryFieldNames=_settings$kibanaSetti.queryFieldNames;var savedObjectsClient=_chrome2.default.getSavedObjectsClient();savedObjectsClient.get("dashboard",dashboardId).then(function(response){var filters=[];var query=void 0;var searchSourceJSON=response.get("kibanaSavedObjectMeta.searchSourceJSON");if(void 0!==searchSourceJSON){var searchSourceData=JSON.parse(searchSourceJSON);void 0!==searchSourceData.filter&&(filters=searchSourceData.filter);query=searchSourceData.query}var _g=_risonNode2.default.encode({time:{from:"$earliest$",to:"$latest$",mode:"absolute"}});var appState={filters:filters};if(void 0!==queryFieldNames&&queryFieldNames.length>0){var queryString="";queryFieldNames.forEach(function(fieldName,index){index>0&&(queryString+=" AND ");queryString+=(0,_string_utils.escapeForElasticsearchQuery)(fieldName)+':"$'+fieldName+'$"'});query={language:"lucene",query:queryString}}void 0!==query&&(appState.query=query);var _a=_risonNode2.default.encode(appState);var urlValue="kibana#/dashboard/"+dashboardId+"?_g="+_g+"&_a="+_a;var urlToAdd={url_name:settings.label,url_value:urlValue,time_range:_constants.TIME_RANGE_TYPE.AUTO};settings.timeRange.type===_constants.TIME_RANGE_TYPE.INTERVAL&&(urlToAdd.time_range=settings.timeRange.interval);resolve(urlToAdd)}).catch(function(resp){reject(resp)})})}function buildDiscoverUrlFromSettings(settings,job){var _settings$kibanaSetti2=settings.kibanaSettings,discoverIndexPatternId=_settings$kibanaSetti2.discoverIndexPatternId,queryFieldNames=_settings$kibanaSetti2.queryFieldNames;var _g=_risonNode2.default.encode({time:{from:"$earliest$",to:"$latest$",mode:"absolute"}});var appState={index:discoverIndexPatternId};var query=job.datafeed_config.query;if(void 0!==queryFieldNames&&queryFieldNames.length>0){var queryString="";queryFieldNames.forEach(function(fieldName,i){i>0&&(queryString+=" AND ");queryString+=(0,_string_utils.escapeForElasticsearchQuery)(fieldName)+':"$'+fieldName+'$"'});query={language:"lucene",query:queryString}}void 0!==query&&(appState.query=query);var _a=_risonNode2.default.encode(appState);var urlValue="kibana#/discover?_g="+_g+"&_a="+_a;var urlToAdd={url_name:settings.label,url_value:urlValue};settings.timeRange.type===_constants.TIME_RANGE_TYPE.INTERVAL&&(urlToAdd.time_range=settings.timeRange.interval);return urlToAdd}function getTestUrl(job,customUrl){var urlValue=customUrl.url_value;var bucketSpanSecs=(0,_parse_interval.parseInterval)(job.analysis_config.bucket_span).asSeconds();var testUrl=customUrl.url_value;var body={query:{bool:{must:[{term:{job_id:job.job_id}},{term:{result_type:"record"}}]}},size:1,_source:{excludes:[]},sort:[{record_score:{order:"desc"}}]};return new Promise(function(resolve,reject){_ml_api_service.ml.esSearch({index:_index_patterns.ML_RESULTS_INDEX_PATTERN,body:body}).then(function(resp){if(resp.hits.total>0){var record=resp.hits.hits[0]._source;testUrl=(0,_custom_url_utils.replaceTokensInUrlValue)(customUrl,bucketSpanSecs,record,"timestamp");resolve(testUrl)}else _job_service.mlJobService.searchPreview(job).then(function(response){var testDoc=void 0;var docTimeFieldName=job.data_description.time_field;if(response.aggregations){var firstBucket=response.aggregations.buckets.buckets[0];testDoc=_defineProperty({},docTimeFieldName,firstBucket.key);urlValue.replace(/\$([^?&$\'"]{1,40})\$/g,function(match,name){if("earliest"!==name&&"latest"!==name&&void 0!==firstBucket[name]){var tokenBuckets=firstBucket[name];tokenBuckets.buckets&&(testDoc[name]=tokenBuckets.buckets[0].key)}})}else response.hits.total>0&&(testDoc=response.hits.hits[0]._source);void 0!==testDoc&&(testUrl=(0,_custom_url_utils.replaceTokensInUrlValue)(customUrl,bucketSpanSecs,testDoc,docTimeFieldName));resolve(testUrl)})}).catch(function(resp){reject(resp)})})}},866:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.URL_TYPE={KIBANA_DASHBOARD:"KIBANA_DASHBOARD",KIBANA_DISCOVER:"KIBANA_DISCOVER",OTHER:"OTHER"};exports.TIME_RANGE_TYPE={AUTO:"auto",INTERVAL:"interval"}},867:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.replaceTokensInUrlValue=replaceTokensInUrlValue;exports.getUrlForRecord=getUrlForRecord;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _moment=__webpack_require__(10);var _moment2=_interopRequireDefault(_moment);var _parse_interval=__webpack_require__(127);var _string_utils=__webpack_require__(40);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function replaceTokensInUrlValue(customUrlConfig,jobBucketSpanSecs,doc,timeFieldName){var urlValue=customUrlConfig.url_value;var timestamp=doc[timeFieldName];var timeRangeInterval=(0,_parse_interval.parseInterval)(customUrlConfig.time_range);if(urlValue.includes("$earliest$")){var earliestMoment=(0,_moment2.default)(timestamp);null!==timeRangeInterval?earliestMoment.subtract(timeRangeInterval):earliestMoment.subtract(jobBucketSpanSecs,"s");doc.earliest=earliestMoment.toISOString()}if(urlValue.includes("$latest$")){var latestMoment=(0,_moment2.default)(timestamp).add(jobBucketSpanSecs,"s");null!==timeRangeInterval?latestMoment.add(timeRangeInterval):latestMoment.add(jobBucketSpanSecs,"s");doc.latest=latestMoment.toISOString()}return getUrlForRecord(customUrlConfig,doc)}function getUrlForRecord(urlConfig,record){if(true===isKibanaUrl(urlConfig))return buildKibanaUrl(urlConfig,record);var urlPath=(0,_string_utils.replaceStringTokens)(urlConfig.url_value,record,false);return urlPath}function isKibanaUrl(urlConfig){var urlValue=urlConfig.url_value;return urlValue.startsWith("kibana#/discover")||urlValue.startsWith("kibana#/dashboard")}function buildKibanaUrl(urlConfig,record){var urlValue=urlConfig.url_value;return String(urlValue).replace(/\$([^?&$\'"]{1,40})\$/g,function(match,name){var tokenValue=_lodash2.default.get(record,name,null);Array.isArray(tokenValue)&&(tokenValue=tokenValue[0]);if(null!==tokenValue&&!("earliest"===name||"latest"===name)){tokenValue=""+(0,_string_utils.escapeForElasticsearchQuery)(tokenValue);tokenValue=tokenValue.replace(/[!']/g,"!$&");tokenValue=encodeURIComponent(tokenValue)}return null!==tokenValue?tokenValue:match})}},868:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3715);__webpack_require__(3716);__webpack_require__(369)},869:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _stripDiacritics=__webpack_require__(1423);var _stripDiacritics2=_interopRequireDefault(_stripDiacritics);var _trim=__webpack_require__(3753);var _trim2=_interopRequireDefault(_trim);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var isValid=function isValid(value){return"undefined"!==typeof value&&null!==value&&""!==value};var filterOptions=function filterOptions(options,filterValue,excludeOptions,props){props.ignoreAccents&&(filterValue=(0,_stripDiacritics2.default)(filterValue));props.ignoreCase&&(filterValue=filterValue.toLowerCase());props.trimFilter&&(filterValue=(0,_trim2.default)(filterValue));excludeOptions&&(excludeOptions=excludeOptions.map(function(i){return i[props.valueKey]}));return options.filter(function(option){if(excludeOptions&&excludeOptions.indexOf(option[props.valueKey])>-1)return false;if(props.filterOption)return props.filterOption.call(void 0,option,filterValue);if(!filterValue)return true;var value=option[props.valueKey];var label=option[props.labelKey];var hasValue=isValid(value);var hasLabel=isValid(label);if(!hasValue&&!hasLabel)return false;var valueTest=hasValue?String(value):null;var labelTest=hasLabel?String(label):null;if(props.ignoreAccents){valueTest&&"label"!==props.matchProp&&(valueTest=(0,_stripDiacritics2.default)(valueTest));labelTest&&"value"!==props.matchProp&&(labelTest=(0,_stripDiacritics2.default)(labelTest))}if(props.ignoreCase){valueTest&&"label"!==props.matchProp&&(valueTest=valueTest.toLowerCase());labelTest&&"value"!==props.matchProp&&(labelTest=labelTest.toLowerCase())}return"start"===props.matchPos?valueTest&&"label"!==props.matchProp&&valueTest.substr(0,filterValue.length)===filterValue||labelTest&&"value"!==props.matchProp&&labelTest.substr(0,filterValue.length)===filterValue:valueTest&&"label"!==props.matchProp&&valueTest.indexOf(filterValue)>=0||labelTest&&"value"!==props.matchProp&&labelTest.indexOf(filterValue)>=0})};exports.default=filterOptions},870:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _classnames=__webpack_require__(5);var _classnames2=_interopRequireDefault(_classnames);var _propTypes=__webpack_require__(323);var _propTypes2=_interopRequireDefault(_propTypes);var _react=__webpack_require__(0);var _react2=_interopRequireDefault(_react);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var menuRenderer=function menuRenderer(_ref){var focusedOption=_ref.focusedOption,focusOption=_ref.focusOption,inputValue=_ref.inputValue,instancePrefix=_ref.instancePrefix,onFocus=_ref.onFocus,onOptionRef=_ref.onOptionRef,onSelect=_ref.onSelect,optionClassName=_ref.optionClassName,optionComponent=_ref.optionComponent,optionRenderer=_ref.optionRenderer,options=_ref.options,removeValue=_ref.removeValue,selectValue=_ref.selectValue,valueArray=_ref.valueArray,valueKey=_ref.valueKey;var Option=optionComponent;return options.map(function(option,i){var isSelected=valueArray&&valueArray.some(function(x){return x[valueKey]===option[valueKey]});var isFocused=option===focusedOption;var optionClass=(0,_classnames2.default)(optionClassName,{"Select-option":true,"is-selected":isSelected,"is-focused":isFocused,"is-disabled":option.disabled});return _react2.default.createElement(Option,{className:optionClass,focusOption:focusOption,inputValue:inputValue,instancePrefix:instancePrefix,isDisabled:option.disabled,isFocused:isFocused,isSelected:isSelected,key:"option-"+i+"-"+option[valueKey],onFocus:onFocus,onSelect:onSelect,option:option,optionIndex:i,ref:function ref(_ref2){onOptionRef(_ref2,isFocused)},removeValue:removeValue,selectValue:selectValue},optionRenderer(option,i,inputValue))})};menuRenderer.propTypes={focusOption:_propTypes2.default.func,focusedOption:_propTypes2.default.object,inputValue:_propTypes2.default.string,instancePrefix:_propTypes2.default.string,onFocus:_propTypes2.default.func,onOptionRef:_propTypes2.default.func,onSelect:_propTypes2.default.func,optionClassName:_propTypes2.default.string,optionComponent:_propTypes2.default.func,optionRenderer:_propTypes2.default.func,options:_propTypes2.default.array,removeValue:_propTypes2.default.func,selectValue:_propTypes2.default.func,valueArray:_propTypes2.default.array,valueKey:_propTypes2.default.string};exports.default=menuRenderer},871:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.filterAggTypes=filterAggTypes;var _lodash=__webpack_require__(1);var _lodash2=_interopRequireDefault(_lodash);var _angular=__webpack_require__(16);var _angular2=_interopRequireDefault(_angular);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function filterAggTypes(aggTypes){var filteredAggTypes=[];var typeCopy=void 0;_lodash2.default.each(aggTypes,function(type){type.mlName=type.name;type.mlModelPlotAgg={max:type.name,min:type.name};type.isCountType=false;type.isAggregatableStringType=false;_lodash2.default.each(type.params,function(p){p.filterFieldTypes&&"string"===typeof p.filterFieldTypes&&(p.filterFieldTypes=p.filterFieldTypes.replace(",date",""))});if("count"===type.name){type.mlModelPlotAgg={max:"max",min:"min"};type.isCountType=true;filteredAggTypes.push(type);typeCopy=_angular2.default.copy(type);typeCopy.title="High count";typeCopy.mlName="high_count";filteredAggTypes.push(typeCopy);typeCopy=_angular2.default.copy(type);typeCopy.title="Low count";typeCopy.mlName="low_count";filteredAggTypes.push(typeCopy)}else if("sum"===type.name){filteredAggTypes.push(type);typeCopy=_angular2.default.copy(type);typeCopy.title="High sum";typeCopy.mlName="high_sum";filteredAggTypes.push(typeCopy);typeCopy=_angular2.default.copy(type);typeCopy.title="Low sum";typeCopy.mlName="low_sum";filteredAggTypes.push(typeCopy)}else if("avg"===type.name){type.title="Mean";type.mlName="mean";filteredAggTypes.push(type);typeCopy=_angular2.default.copy(type);typeCopy.title="High mean";typeCopy.mlName="high_mean";filteredAggTypes.push(typeCopy);typeCopy=_angular2.default.copy(type);typeCopy.title="Low mean";typeCopy.mlName="low_mean";filteredAggTypes.push(typeCopy)}else if("median"===type.name){type.mlModelPlotAgg={max:"max",min:"min"};filteredAggTypes.push(type);typeCopy=_angular2.default.copy(type);typeCopy.title="High median";typeCopy.mlName="high_median";filteredAggTypes.push(typeCopy);typeCopy=_angular2.default.copy(type);typeCopy.title="Low median";typeCopy.mlName="low_median";filteredAggTypes.push(typeCopy)}else if("min"===type.name)filteredAggTypes.push(type);else if("max"===type.name)filteredAggTypes.push(type);else if("cardinality"===type.name){type.title="Distinct count";type.mlName="distinct_count";type.mlModelPlotAgg={max:"max",min:"min"};type.isAggregatableStringType=true;_lodash2.default.each(type.params,function(p){p.filterFieldTypes&&(p.filterFieldTypes="number,boolean,ip,string")});filteredAggTypes.push(type)}});return filteredAggTypes}},872:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.adjustIntervalDisplayed=adjustIntervalDisplayed;var _parse_interval=__webpack_require__(127);function adjustIntervalDisplayed(formConfig){var makeTheSame=false;var intervalSeconds=formConfig.chartInterval.getInterval().asSeconds();var bucketSpan=(0,_parse_interval.parseInterval)(formConfig.bucketSpan);if(null!==bucketSpan){bucketSpan.asSeconds()>intervalSeconds&&(makeTheSame=true);if(void 0!==formConfig.agg.type){var mlName=formConfig.agg.type.mlName;"count"!==mlName&&"low_count"!==mlName&&"high_count"!==mlName&&"distinct_count"!==mlName||(makeTheSame=true)}makeTheSame&&formConfig.chartInterval.setInterval(formConfig.bucketSpan)}}},873:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};exports.createFields=createFields;exports.getIndexedFields=getIndexedFields;var _general=__webpack_require__(300);var _field_types=__webpack_require__(322);var _job_utils=__webpack_require__(41);var _field_types_utils=__webpack_require__(1428);function createFields(scope,indexPattern){var isPopulation=scope.formConfig.hasOwnProperty("overField");var agg=scope.formConfig.agg;var fields=[];var categoryFields=[];scope.ui.fields=[];agg.type.params.forEach(function(param){"field"===param.name&&(fields=getIndexedFields(indexPattern,[_field_types.KBN_FIELD_TYPES.NUMBER,_field_types.KBN_FIELD_TYPES.STRING,_field_types.KBN_FIELD_TYPES.IP]));"customLabel"===param.name&&(categoryFields=getIndexedFields(indexPattern,[_field_types.KBN_FIELD_TYPES.STRING,_field_types.KBN_FIELD_TYPES.IP]))});var countAgg={type:scope.ui.aggTypeOptions.find(function(o){return"count"===o.name})};var eventRateField={id:_general.EVENT_RATE_COUNT_FIELD,name:"event rate",tooltip:"System defined field",isCountField:true,agg:countAgg,mlType:_field_types.ML_JOB_FIELD_TYPES.NUMBER,splitField:void 0,firstSplitFieldName:void 0,cardLabels:void 0};if(isPopulation){eventRateField.splitField=void 0;eventRateField.firstSplitFieldName=void 0;eventRateField.cardLabels=void 0}scope.ui.fields.push(eventRateField);var cardinalityAgg={type:scope.ui.aggTypeOptions.find(function(o){return"cardinality"===o.name})};fields.forEach(function(field,i){var id=(0,_job_utils.getSafeAggregationName)(field.displayName,i);var f={id:id,name:field.displayName,tooltip:field.displayName,agg:field.mlType===_field_types.ML_JOB_FIELD_TYPES.KEYWORD||field.mlType===_field_types.ML_JOB_FIELD_TYPES.IP?_extends({},cardinalityAgg):_extends({},agg),mlType:field.mlType};if(isPopulation){f.splitField=void 0;f.firstSplitFieldName=void 0;f.cardLabels=void 0}scope.ui.fields.push(f)});categoryFields.forEach(function(field){scope.ui.splitFields.push(field);isPopulation&&scope.ui.overFields.push(field)})}function getIndexedFields(indexPattern,fieldTypes){var fields=indexPattern.fields.raw.filter(function(f){return true===f.aggregatable});if(fieldTypes){fields=fields.filter(function(f){return"_type"!==f.displayName&&"_id"!==f.displayName&&"_index"!==f.displayName&&true!==f.scripted});fields=fields.filter(function(f){return fieldTypes.find(function(t){return t===f.type})});fields.forEach(function(f){return f.mlType=(0,_field_types_utils.kbnTypeToMLJobType)(f)});fields=fields.sort(orderBy(["name","type"]))}return fields}function orderBy(items){return function(a,b){var result=0;items.forEach(function(i){var aa=a[i].toLowerCase();var bb=b[i].toLowerCase();aa<bb?result=-1:aa>bb&&(result=1)});return result||0}}},874:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.preLoadJob=preLoadJob;exports.jobSettingsFromJob=jobSettingsFromJob;var _job_service=__webpack_require__(24);var _app_state_settings=__webpack_require__(3763);var _general=__webpack_require__(300);function preLoadJob($scope,appState){var job=_job_service.mlJobService.currentJob;_job_service.mlJobService.currentJob=void 0;if(void 0!==job){var mlJobSettings=jobSettingsFromJob(job,$scope.ui.aggTypeOptions);(0,_app_state_settings.populateAppStateSettings)({mlJobSettings:mlJobSettings},$scope);$scope.setFullTimeRange().then(function(){return $scope.loadVis()}).catch(function(){return $scope.loadVis()})}else(0,_app_state_settings.populateAppStateSettings)(appState,$scope)}function jobSettingsFromJob(job,aggTypeOptions){if(void 0===job.custom_settings)return{};function getKibanaAggName(mlAggName){var agg=aggTypeOptions.find(function(a){return a.mlName===mlAggName});return agg?agg.name:void 0}var jobSettings={};var dtrs=job.analysis_config.detectors;if(job.custom_settings.created_by===_general.WIZARD_TYPE.SINGLE_METRIC){var d=dtrs[0];var field={agg:getKibanaAggName(d.function,aggTypeOptions)};d.field_name&&(field.fieldName=d.field_name);jobSettings.fields=[field]}else if(job.custom_settings.created_by===_general.WIZARD_TYPE.MULTI_METRIC){var splitField="";jobSettings.fields=dtrs.map(function(d){d.partition_field_name&&(splitField=d.partition_field_name);var field={agg:getKibanaAggName(d.function,aggTypeOptions)};d.field_name&&(field.fieldName=d.field_name);return field});""!==splitField&&(jobSettings.split=splitField)}else if(job.custom_settings.created_by===_general.WIZARD_TYPE.POPULATION){var overField="";var splitFields={};jobSettings.fields=dtrs.map(function(d){d.over_field_name&&(overField=d.over_field_name);var field={agg:getKibanaAggName(d.function,aggTypeOptions)};d.field_name&&(field.fieldName=d.field_name);d.by_field_name&&(field.split=d.by_field_name);return field});""!==overField&&(jobSettings.population=overField);var numberOfSplits=Object.keys(splitFields).length;if(numberOfSplits>0)if(numberOfSplits>1){for(var f in splitFields)if(splitFields.hasOwnProperty(f)){var i=splitFields[f];jobSettings.fields[i]=f}}else jobSettings.split=Object.keys(splitFields)[0]}jobSettings.bucketSpan=job.analysis_config.bucket_span;job.analysis_limits&&job.analysis_limits.model_memory_limit&&(jobSettings.modelMemoryLimit=job.analysis_limits.model_memory_limit);""!==job.description&&(jobSettings.description=job.description);void 0!==job.groups&&job.groups.length&&(jobSettings.groups=job.groups);job.analysis_config&&job.analysis_config.influencers&&(jobSettings.influencers=job.analysis_config.influencers);jobSettings.resultsIndexName=job.results_index_name;return jobSettings}},875:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3766);__webpack_require__(3767);__webpack_require__(868)},876:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.mlAnomaliesTableService=void 0;var _listener_factory=__webpack_require__(626);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var AnomaliesTableService=function AnomaliesTableService(){_classCallCheck(this,AnomaliesTableService);var listenerFactory=(0,_listener_factory.listenerFactoryProvider)();this.anomalyRecordMouseenter=listenerFactory();this.anomalyRecordMouseleave=listenerFactory()};exports.mlAnomaliesTableService=new AnomaliesTableService},877:function(module,exports,__webpack_require__){"use strict";__webpack_require__(3893);__webpack_require__(3895);__webpack_require__(503);__webpack_require__(3897)},878:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.PROGRESS_STATES={UNSET:-1,WAITING:0,DONE:1,ERROR:-10}},881:function(module,exports,__webpack_require__){"use strict";(function(global){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
function compare(a,b){if(a===b)return 0;var x=a.length;var y=b.length;for(var i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i];y=b[i];break}if(x<y)return-1;if(y<x)return 1;return 0}function isBuffer(b){if(global.Buffer&&"function"===typeof global.Buffer.isBuffer)return global.Buffer.isBuffer(b);return!!(null!=b&&b._isBuffer)}var util=__webpack_require__(428);var hasOwn=Object.prototype.hasOwnProperty;var pSlice=Array.prototype.slice;var functionsHaveNames="foo"===function foo(){}.name;function pToString(obj){return Object.prototype.toString.call(obj)}function isView(arrbuf){if(isBuffer(arrbuf))return false;if("function"!==typeof global.ArrayBuffer)return false;if("function"===typeof ArrayBuffer.isView)return ArrayBuffer.isView(arrbuf);if(!arrbuf)return false;if(arrbuf instanceof DataView)return true;if(arrbuf.buffer&&arrbuf.buffer instanceof ArrayBuffer)return true;return false}var assert=module.exports=ok;var regex=/\s*function\s+([^\(\s]*)\s*/;function getName(func){if(!util.isFunction(func))return;if(functionsHaveNames)return func.name;var str=func.toString();var match=str.match(regex);return match&&match[1]}assert.AssertionError=function AssertionError(options){this.name="AssertionError";this.actual=options.actual;this.expected=options.expected;this.operator=options.operator;if(options.message){this.message=options.message;this.generatedMessage=false}else{this.message=getMessage(this);this.generatedMessage=true}var stackStartFunction=options.stackStartFunction||fail;if(Error.captureStackTrace)Error.captureStackTrace(this,stackStartFunction);else{var err=new Error;if(err.stack){var out=err.stack;var fn_name=getName(stackStartFunction);var idx=out.indexOf("\n"+fn_name);if(idx>=0){var next_line=out.indexOf("\n",idx+1);out=out.substring(next_line+1)}this.stack=out}}};util.inherits(assert.AssertionError,Error);function truncate(s,n){return"string"===typeof s?s.length<n?s:s.slice(0,n):s}function inspect(something){if(functionsHaveNames||!util.isFunction(something))return util.inspect(something);var rawname=getName(something);var name=rawname?": "+rawname:"";return"[Function"+name+"]"}function getMessage(self){return truncate(inspect(self.actual),128)+" "+self.operator+" "+truncate(inspect(self.expected),128)}function fail(actual,expected,message,operator,stackStartFunction){throw new assert.AssertionError({message:message,actual:actual,expected:expected,operator:operator,stackStartFunction:stackStartFunction})}assert.fail=fail;function ok(value,message){value||fail(value,true,message,"==",assert.ok)}assert.ok=ok;assert.equal=function equal(actual,expected,message){actual!=expected&&fail(actual,expected,message,"==",assert.equal)};assert.notEqual=function notEqual(actual,expected,message){actual==expected&&fail(actual,expected,message,"!=",assert.notEqual)};assert.deepEqual=function deepEqual(actual,expected,message){_deepEqual(actual,expected,false)||fail(actual,expected,message,"deepEqual",assert.deepEqual)};assert.deepStrictEqual=function deepStrictEqual(actual,expected,message){_deepEqual(actual,expected,true)||fail(actual,expected,message,"deepStrictEqual",assert.deepStrictEqual)};function _deepEqual(actual,expected,strict,memos){if(actual===expected)return true;if(isBuffer(actual)&&isBuffer(expected))return 0===compare(actual,expected);if(util.isDate(actual)&&util.isDate(expected))return actual.getTime()===expected.getTime();if(util.isRegExp(actual)&&util.isRegExp(expected))return actual.source===expected.source&&actual.global===expected.global&&actual.multiline===expected.multiline&&actual.lastIndex===expected.lastIndex&&actual.ignoreCase===expected.ignoreCase;if(null!==actual&&"object"===typeof actual||null!==expected&&"object"===typeof expected){if(isView(actual)&&isView(expected)&&pToString(actual)===pToString(expected)&&!(actual instanceof Float32Array||actual instanceof Float64Array))return 0===compare(new Uint8Array(actual.buffer),new Uint8Array(expected.buffer));if(isBuffer(actual)!==isBuffer(expected))return false;memos=memos||{actual:[],expected:[]};var actualIndex=memos.actual.indexOf(actual);if(-1!==actualIndex&&actualIndex===memos.expected.indexOf(expected))return true;memos.actual.push(actual);memos.expected.push(expected);return objEquiv(actual,expected,strict,memos)}return strict?actual===expected:actual==expected}function isArguments(object){return"[object Arguments]"==Object.prototype.toString.call(object)}function objEquiv(a,b,strict,actualVisitedObjects){if(null===a||void 0===a||null===b||void 0===b)return false;if(util.isPrimitive(a)||util.isPrimitive(b))return a===b;if(strict&&Object.getPrototypeOf(a)!==Object.getPrototypeOf(b))return false;var aIsArgs=isArguments(a);var bIsArgs=isArguments(b);if(aIsArgs&&!bIsArgs||!aIsArgs&&bIsArgs)return false;if(aIsArgs){a=pSlice.call(a);b=pSlice.call(b);return _deepEqual(a,b,strict)}var ka=objectKeys(a);var kb=objectKeys(b);var key,i;if(ka.length!==kb.length)return false;ka.sort();kb.sort();for(i=ka.length-1;i>=0;i--)if(ka[i]!==kb[i])return false;for(i=ka.length-1;i>=0;i--){key=ka[i];if(!_deepEqual(a[key],b[key],strict,actualVisitedObjects))return false}return true}assert.notDeepEqual=function notDeepEqual(actual,expected,message){_deepEqual(actual,expected,false)&&fail(actual,expected,message,"notDeepEqual",assert.notDeepEqual)};assert.notDeepStrictEqual=notDeepStrictEqual;function notDeepStrictEqual(actual,expected,message){_deepEqual(actual,expected,true)&&fail(actual,expected,message,"notDeepStrictEqual",notDeepStrictEqual)}assert.strictEqual=function strictEqual(actual,expected,message){actual!==expected&&fail(actual,expected,message,"===",assert.strictEqual)};assert.notStrictEqual=function notStrictEqual(actual,expected,message){actual===expected&&fail(actual,expected,message,"!==",assert.notStrictEqual)};function expectedException(actual,expected){if(!actual||!expected)return false;if("[object RegExp]"==Object.prototype.toString.call(expected))return expected.test(actual);try{if(actual instanceof expected)return true}catch(e){}if(Error.isPrototypeOf(expected))return false;return true===expected.call({},actual)}function _tryBlock(block){var error;try{block()}catch(e){error=e}return error}function _throws(shouldThrow,block,expected,message){var actual;if("function"!==typeof block)throw new TypeError('"block" argument must be a function');if("string"===typeof expected){message=expected;expected=null}actual=_tryBlock(block);message=(expected&&expected.name?" ("+expected.name+").":".")+(message?" "+message:".");shouldThrow&&!actual&&fail(actual,expected,"Missing expected exception"+message);var userProvidedMessage="string"===typeof message;var isUnwantedException=!shouldThrow&&util.isError(actual);var isUnexpectedException=!shouldThrow&&actual&&!expected;(isUnwantedException&&userProvidedMessage&&expectedException(actual,expected)||isUnexpectedException)&&fail(actual,expected,"Got unwanted exception"+message);if(shouldThrow&&actual&&expected&&!expectedException(actual,expected)||!shouldThrow&&actual)throw actual}assert.throws=function(block,error,message){_throws(true,block,error,message)};assert.doesNotThrow=function(block,error,message){_throws(false,block,error,message)};assert.ifError=function(err){if(err)throw err};var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)hasOwn.call(obj,key)&&keys.push(key);return keys}}).call(exports,__webpack_require__(25))},89:function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.initPromise=initPromise;var promise=window.Promise;function initPromise(replacePromise){return function($q){window.Promise=replacePromise?$q:promise;return Promise.resolve()}}}},[1772]);